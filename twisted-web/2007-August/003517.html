<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] rest webservice and big data.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20rest%20webservice%20and%20big%20data.&In-Reply-To=op.txdcqbf73oj628%40dev007.texturallc.net">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003516.html">
   <LINK REL="Next"  HREF="003518.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] rest webservice and big data.</H1>
    <B>Jean-Paul Calderone</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20rest%20webservice%20and%20big%20data.&In-Reply-To=op.txdcqbf73oj628%40dev007.texturallc.net"
       TITLE="[Twisted-web] rest webservice and big data.">exarkun at divmod.com
       </A><BR>
    <I>Mon Aug 20 14:13:09 EDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="003516.html">[Twisted-web] rest webservice and big data.
</A></li>
        <LI>Next message: <A HREF="003518.html">[Twisted-web] rest webservice and big data.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3517">[ date ]</a>
              <a href="thread.html#3517">[ thread ]</a>
              <a href="subject.html#3517">[ subject ]</a>
              <a href="author.html#3517">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Mon, 20 Aug 2007 12:40:49 -0500, &quot;L. Daniel Burr&quot; &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">ldanielburr at mac.com</A>&gt; wrote:
&gt;<i>Hi S&#233;bastien,
</I>&gt;<i>
</I>&gt;<i>On Mon, 20 Aug 2007 12:11:33 -0500, S&#233;bastien HEITZMANN &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">2le at 2le.net</A>&gt; 
</I>&gt;<i>wrote:
</I>&gt;&gt;<i>Hi
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>I'm new to twisted programming and I'm wonder how to do the following 
</I>&gt;&gt;<i>thing.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>I would like to save in a file the content of a PUT method. But i need
</I>&gt;&gt;<i>this in a stream mode ( the data may be handred of MB )
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>Here is a part of my code.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>class DataResource(resource.Resource):
</I>&gt;&gt;<i>     def __init__(self, dbConnection):
</I>&gt;&gt;<i>         resource.Resource.__init__(self)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     def render_PUT(self, request):
</I>&gt;&gt;<i>         request.content.seek(0)
</I>&gt;&gt;<i>         file('data.dat','wb').write(request.content.read())
</I>&gt;&gt;<i>         request.write('OK')
</I>&gt;&gt;<i>         request.finish()
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>Thats inspired by an exemple of the oreilly book.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>Is there a way to get a coolback juste after the header was sended and
</I>&gt;&gt;<i>to handle the reading of the remaining data myself ?
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>I use only web, not the new web2 api.
</I>&gt;<i>
</I>&gt;<i>You cannot stream large files using twisted.web unless you write your
</I>&gt;<i>own mechanism.  On the other hand, web2 *does* support streaming file
</I>&gt;<i>uploads, so I would advise you to think about using web2 instead, if
</I>&gt;<i>you really want streaming.
</I>&gt;<i>
</I>&gt;<i>Someone with deeper knowledge of twisted.web may be able to propose
</I>&gt;<i>a strategy for implementing streaming file uploads
</I>
Don't mind if I do ;)

HTTPChannel already notices the difference between when the headers have
all been received and when the body has been received entirely. When the
former occurs, allHeadersReceived is called.  In the base implementation
this sets up a file-like object into which the body will be written.  It
would be possible to do something slightly different here in order to
support streaming uploads: do resource traversal to find the IResource
the upload is being sent to and then let it deal with bytes received in
the body of the request.

The only other things which might not be obvious here.  Changes to
twisted.web should be backwards compatible so that existing twisted.web
applications continue to work without being modified.  Implementing
what I've described above without regard for backwards compatibility would
probably mean subjecting existing applications to two things:

  * resource traversal would be performed earlier than usual for the
    application.  This might have adverse consequences, or it might not.
    In the absense of any way to know for sure, we shouldn't change this
    behavior.  So, instead, the code might require a new kind of site, or
    an attribute to be set on the root resource, or something else of this
    sort which would allow new applications to indicate their preference
    for the new behavior while preserving the existing behavior for existing
    applications.

  * The body of a request is currently available in the request object
    itself.  Existing applications won't expect it to be elsewhere, nor
    will they expect to have to handle the upload as it is happening.  It
    should be required that resources indicate in some way that they are
    capable of handling streaming uploads.  This might be done by adding a
    new interface which they must implement (since they will need to provide
    methods for handling bytes from the upload, this is necessary anyway).

&gt;<i>but I expect it would be a fair amount of work, and end up looking similar
</I>&gt;<i>to what is already in web2.
</I>
Well, &quot;fair&quot; is quite subjective, so maybe it is and maybe it isn't ;)  It
doesn't strike me as a massive undertaking, though.  I think an initial
patch could probably be done in a day or two.  Allow another couple of days
(not necessarily elapsed - there might be some latency in finding reviews,
etc) to get feedback and make whatever improvements are suggested, and that
would probably be it.

FWIW, what I described doesn't resemble the support for this functionality
in web2 at all, I think.

Jean-Paul

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003516.html">[Twisted-web] rest webservice and big data.
</A></li>
	<LI>Next message: <A HREF="003518.html">[Twisted-web] rest webservice and big data.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3517">[ date ]</a>
              <a href="thread.html#3517">[ thread ]</a>
              <a href="subject.html#3517">[ subject ]</a>
              <a href="author.html#3517">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
