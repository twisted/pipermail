<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] Sessions and Authentication for Web2
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Sessions%20and%20Authentication%20for%20Web2&In-Reply-To=D3346953-9BFD-4A5D-A710-F99BFFFE8EA7%40dreid.org">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002118.html">
   <LINK REL="Next"  HREF="002151.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] Sessions and Authentication for Web2</H1>
    <B>Phil Mayers</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Sessions%20and%20Authentication%20for%20Web2&In-Reply-To=D3346953-9BFD-4A5D-A710-F99BFFFE8EA7%40dreid.org"
       TITLE="[Twisted-web] Sessions and Authentication for Web2">p.mayers at imperial.ac.uk
       </A><BR>
    <I>Sun Nov 27 14:31:41 MST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="002118.html">[Twisted-web] Sessions and Authentication for Web2
</A></li>
        <LI>Next message: <A HREF="002151.html">[Twisted-web] Sessions and Authentication for Web2
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2148">[ date ]</a>
              <a href="thread.html#2148">[ thread ]</a>
              <a href="subject.html#2148">[ subject ]</a>
              <a href="author.html#2148">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>David Reid wrote:
&gt;&gt;&gt;<i>  c) Exarkun expressed a strong (ok, mandatory) preference for the
</I>&gt;&gt;&gt;<i>     use of tw.cred in any Authentication solution.  However, it was
</I>&gt;&gt;&gt;<i>     noted that tw.cred does not allow for challenge-response
</I>&gt;&gt;&gt;<i>     authentication mechanisms (which all of mine are).  Specific
</I>&gt;&gt;&gt;<i>     examples were noted: twisted.protocols.sip, SASL, OTP
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Hmm.  How did you get this idea?  Cred's design was specifically to 
</I>&gt;&gt;<i> facilitate challenge-response authentication.  That's why login() 
</I>&gt;&gt;<i> takes credentials and returns a Deferred.  The assumption is that the 
</I>&gt;&gt;<i> credentials object will encapsulate whatever facets of the user's 
</I>&gt;&gt;<i> connection are required to do the negotiation process.
</I>&gt;<i> 
</I>&gt;<i> While it might be a valid assumption, there is no common public 
</I>&gt;<i> interface provided to facilitate it.  Perhaps because no one knows what 
</I>&gt;<i> that should look like, perhaps because no one felt it was necessary.  
</I>&gt;<i> But I do believe that something like twisted.protocols.sip.IAuthorizer, 
</I>&gt;<i> that allows for an arbitrary number of round trips should be in cred, 
</I>&gt;<i> either the ICredentials interface should be extended (probably through a 
</I>&gt;<i> subclass) or a new interface should be created.  I'm toying with some 
</I>&gt;<i> ideas of how to best do this, but I don't really &quot;get&quot; cred so if you 
</I>&gt;<i> have any requirements other than arbitrary number of round trips, let me 
</I>&gt;<i> know so i can take those into account now rather than later.
</I>&gt;<i> 
</I>
I've been thinking more about this and I can indeed now see a slight 
impedance mismatch that I haven't yet thought my way around. I got here 
from thinking about implementing Negotiate support using PyGSS.

Exarkun and I posted examples of how one might do arbitrary 
challenge-response by making the creds a proxy object to the protocol 
instance, and I waved my hands saying &quot;HTTP is a bit more hard because 
of the statelessness / request-based nature of the protocol&quot;.

The best I've come up with that in theory supports &gt;1 auth mechanism[1] 
is here:

<A HREF="http://deadbeefbabe.org/paste/2249">http://deadbeefbabe.org/paste/2249</A>

To &quot;match&quot; HTTP to t.cred, it seems the &quot;credentials&quot; *are* the HTTP 
request object (which in fact is true, given how the HTTP spec is worded 
I think?). There's then a checker that can &quot;check&quot; HTTP requests against 
sub-mechanisms, and if none work then one or all of them can challenge 
the request.

This seems somewhat hackish as the &quot;checker&quot; then has to know about 
&quot;name: value&quot; rfc2822-style protocol PDUs, as opposed to just the 
elements of the auth algorithm. It might be more palatable if you could 
somehow &quot;chain&quot; checkers - e.g. return an IDigestCreds from 
requestAvatarId, or maybe have some kind of 2-pass thing?

[FreeRadius has an interesting thing in it's &quot;authorize&quot; config section 
where you first pass the request through the &quot;authorize&quot; section to 
determine how to authenticate it (and optionally return there and then 
with challenges etc.) then pass it through just one module as defined by 
the auth-type. This will mean nothing to you unless you've seen it, but 
that's what I mean by 2-pass]

On the other hand, this is a very flexible system as it permits you to 
allow based on other portions of the request such as arbitrary headers, 
SSL cert for the TCP connection, and so on.

(Note to all: a load of the code is ripped from the t.p.sip code, so 
appropriate credit where it's due. The stateless nonce thing might be 
worth ripping though)

Comments welcome.

[1] t.w.http does not appear to allow you to set headers &gt;1 time e.g.

WWW-Authenticate: basic realm=&quot;server.domain.com&quot;
WWW-Authenticate: digest realm=&quot;...&quot;,foo=&quot;bar&quot;,...

</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002118.html">[Twisted-web] Sessions and Authentication for Web2
</A></li>
	<LI>Next message: <A HREF="002151.html">[Twisted-web] Sessions and Authentication for Web2
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2148">[ date ]</a>
              <a href="thread.html#2148">[ thread ]</a>
              <a href="subject.html#2148">[ subject ]</a>
              <a href="author.html#2148">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
