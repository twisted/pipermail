<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] LivePage cannot append rows to tables?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20LivePage%20cannot%20append%20rows%20to%20tables%3F&In-Reply-To=200511211714.44689.mike%40mkp.ca">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002127.html">
   <LINK REL="Next"  HREF="002130.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] LivePage cannot append rows to tables?</H1>
    <B>Jean-Paul Calderone</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20LivePage%20cannot%20append%20rows%20to%20tables%3F&In-Reply-To=200511211714.44689.mike%40mkp.ca"
       TITLE="[Twisted-web] LivePage cannot append rows to tables?">exarkun at divmod.com
       </A><BR>
    <I>Mon Nov 21 16:12:41 MST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="002127.html">[Twisted-web] LivePage cannot append rows to tables?
</A></li>
        <LI>Next message: <A HREF="002130.html">[Twisted-web] LivePage cannot append rows to tables?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2128">[ date ]</a>
              <a href="thread.html#2128">[ thread ]</a>
              <a href="subject.html#2128">[ subject ]</a>
              <a href="author.html#2128">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Mon, 21 Nov 2005 17:14:43 -0500, Mike Pelletier &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">mike at mkp.ca</A>&gt; wrote:
&gt;<i>I'm at my wit's end!  Have mercy on a clueless JS user and examine the
</I>&gt;<i>attached page.
</I>&gt;<i>
</I>&gt;<i>The problem it illustates is one I am having with livepage.js's
</I>&gt;<i>nevow_appendNode function.  I am finding that whenever I attempt to append a
</I>&gt;<i>row to a table (or to a tbody, or for that matter to anything else) the HTML
</I>&gt;<i>is silently stripped out and my node is added as a single #TEXT node.
</I>&gt;<i>However, appending a DIV works fine, even when technically illegal; a DIV
</I>&gt;<i>node containing the #TEXT is added.
</I>&gt;<i>
</I>&gt;<i>The attachment includes a copy'n'pasted version of nevow_appendNode.  The only
</I>&gt;<i>modification I have made to it is to add an alert() which demonstrates the
</I>&gt;<i>precise point of failure; assigning &quot;what&quot; to &quot;newspan.innerHTML&quot;.  Note that
</I>&gt;<i>the &lt;div&gt; tags are unmolested, but the &lt;tr&gt; and &lt;td&gt; tags are stripped.  I
</I>&gt;<i>get the same behaviour from FF and IE, while Konq just barfs with a DOM
</I>&gt;<i>exception 7.
</I>&gt;<i>
</I>&gt;<i>I simply don't know how to chase this one down any further.  I hope someone
</I>&gt;<i>will tell me I'm a moron and point out what I've done wrong, but I think the
</I>&gt;<i>solution is going to require a change to nevow_appendNode.
</I>
This fails because nevow_appendNode sets the HTML string as the innerHTML property of a DIV node.  The browser validates the resulting DOM, notices it is illegal (you cannot put a TR or a TD inside a DIV) and then either silently &quot;fixes&quot; it or reports an error.

This might be fixable by appending the given HTML string to the target node's innerHTML property.  I have tested it with Firefox and it seems to work in many cases there, but I have not tested it anywhere else.

I'm not terribly interested in trying to fix this (nor all the JS and HTML quoting issues) in LivePage.  Currently I'm focusing development effort on Athena which side-steps this whole class of problems.  However, if someone contributes a patch along with something to instill confidence that the change does not introduce a regression, it might get applied.

Jean-Paul

</PRE>











<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002127.html">[Twisted-web] LivePage cannot append rows to tables?
</A></li>
	<LI>Next message: <A HREF="002130.html">[Twisted-web] LivePage cannot append rows to tables?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2128">[ date ]</a>
              <a href="thread.html#2128">[ thread ]</a>
              <a href="subject.html#2128">[ subject ]</a>
              <a href="author.html#2128">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
