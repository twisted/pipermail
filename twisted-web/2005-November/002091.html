<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] web2 response.setCookie and request.getCookie
	shortcuts?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20web2%20response.setCookie%20and%20request.getCookie%0A%09shortcuts%3F&In-Reply-To=20051117115711.10365.635838822.divmod.quotient.8775%40ohm">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002084.html">
   <LINK REL="Next"  HREF="002099.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] web2 response.setCookie and request.getCookie
	shortcuts?</H1>
    <B>Clark C. Evans</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20web2%20response.setCookie%20and%20request.getCookie%0A%09shortcuts%3F&In-Reply-To=20051117115711.10365.635838822.divmod.quotient.8775%40ohm"
       TITLE="[Twisted-web] web2 response.setCookie and request.getCookie
	shortcuts?">cce at clarkevans.com
       </A><BR>
    <I>Thu Nov 17 13:55:37 MST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="002084.html">[Twisted-web] web2 response.setCookie and request.getCookie
	shortcuts?
</A></li>
        <LI>Next message: <A HREF="002099.html">[Twisted-web] web2 response.setCookie and request.getCookie
	shortcuts?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2091">[ date ]</a>
              <a href="thread.html#2091">[ thread ]</a>
              <a href="subject.html#2091">[ subject ]</a>
              <a href="author.html#2091">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Glyph,

On Thu, Nov 17, 2005 at 06:57:11AM -0500, <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">glyph at divmod.com</A> wrote:
|<i> Do we have a list of use-cases somewhere that detail what &quot;per-request 
</I>|<i> data&quot; is really a requirement?  Most places I've seen the context 
</I>|<i> actually *used* in this manner it has been a disaster...
</I>
The system that I've layered over Twisted that I'm now porting to web2
is a request re-write system.  Basically, I view request handling as a
series of stages which _alter_ the request (I don't particularly like
the special status given to path segments in web2, btw; this should
be much higher-level logic).   For example:

  1.  I have one stage that converts /k=v/ path segments into cookie entries,
      so that user agents lacking a good cookie mechansim can still use
      the parts of my application that require &quot;context&quot; handling.

  2.  I have another stage that simply looks for a in-memory session object, 
      and attaches it to the request (for further down-stream stages).

  3.  My next stage does authentication; if a session object is already 
      marked authorized, this step is a no-op.  Otherwise, it handles
      one of many authentication protocols.

  4.  My application has many many ways to ask for the same thing, so
      my next stage simply 'canonicalizes' the request.  This replaces
      various short-cuts in the request's path segments or arguments
      with more tedious but explicit request.

  5.  Following is an 'authorization' step; which verifies that the
      current identity is allowed to perform the activity expressed
      by the (now canonicalized) request.

  6.  At this point; depending on many factors, my processing tree has
      many branches -- but at all stages, I'm passing around a request
      that is being continually modified to reflect the status of the
      request and where it goes next.  I use a state-transition graph to
      make sure that my request gets in the correct queue.

So, this is what I mean by per-request state.  Since each stage of
execution happens by a distinct Resource, a great deal of information
needs to be stored in the Request object (or what ever you want to call
it).   Now if a ClarkRequest extends a HttpRequest to add what I need,
so be it; right now my code is sloppy -- I just modify the request
object's dict.  Perhaps it is poor pratice; but with a decent regression
test it really isn't a problem at all.   I only have a handful of 
variables that are needed.

Anyway Glyph, I'm not quite certain I understand what you're saying or
recommending.  If you could detail a bit more, it would be wonderful.

|<i> &gt;I'm personally against polluting the request and response interfaces
</I>|<i> &gt;with this kind of stuff, in my opinion cookies are just headers, they
</I>|<i> &gt;shouldn't be special.  I wouldn't be opposed to higher level cookie
</I>|<i> &gt;management that presented a similar interface to both the client and the
</I>|<i> &gt;server developer, but I probably won't have any interest in writing
</I>|<i> &gt;it.
</I>
You got to put it this stuff somewhere.  An adapter is quite a kludgy,
but I guess workable.  The current solution, however, is ugly.

|<i> Pragmatically speaking cookies are not an &quot;optional&quot; extension to HTTP/1.1.
</I>
Hear! Hear!

Clark

</PRE>





























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002084.html">[Twisted-web] web2 response.setCookie and request.getCookie
	shortcuts?
</A></li>
	<LI>Next message: <A HREF="002099.html">[Twisted-web] web2 response.setCookie and request.getCookie
	shortcuts?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2091">[ date ]</a>
              <a href="thread.html#2091">[ thread ]</a>
              <a href="subject.html#2091">[ subject ]</a>
              <a href="author.html#2091">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
