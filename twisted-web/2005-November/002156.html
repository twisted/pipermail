<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] Sessions and Authentication for Web2
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Sessions%20and%20Authentication%20for%20Web2&In-Reply-To=20051129042021.1217.630084610.divmod.quotient.1629%40ohm">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002153.html">
   <LINK REL="Next"  HREF="002157.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] Sessions and Authentication for Web2</H1>
    <B>Phil Mayers</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Sessions%20and%20Authentication%20for%20Web2&In-Reply-To=20051129042021.1217.630084610.divmod.quotient.1629%40ohm"
       TITLE="[Twisted-web] Sessions and Authentication for Web2">p.mayers at imperial.ac.uk
       </A><BR>
    <I>Tue Nov 29 10:26:32 MST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="002153.html">[Twisted-web] Sessions and Authentication for Web2
</A></li>
        <LI>Next message: <A HREF="002157.html">[Twisted-web] Sessions and Authentication for Web2
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2156">[ date ]</a>
              <a href="thread.html#2156">[ thread ]</a>
              <a href="subject.html#2156">[ subject ]</a>
              <a href="author.html#2156">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">glyph at divmod.com</A> wrote:
&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> On Mon, 28 Nov 2005 18:18:28 -0800, Kevin Turner &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">kevin at janrain.com</A>&gt; wrote:
</I>&gt;&gt;<i> On Sun, 2005-11-27 at 21:31 +0000, Phil Mayers wrote:
</I>&gt;&gt;&gt;<i> it seems the &quot;credentials&quot; *are* the HTTP
</I>&gt;&gt;&gt;<i> request object (which in fact is true, given how the HTTP spec is worded
</I>&gt;&gt;&gt;<i> I think?).
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> This is what I tried up doing; including the request in the Credentials.
</I>&gt;&gt;<i> This works a bit, but it really isn't compatible with t.web.guard.
</I>&gt;&gt;<i> Mostly because my Checker ends up doing things to the request, but Guard
</I>&gt;&gt;<i> really had plans to do *other* things with that request once
</I>&gt;&gt;<i> Portal.login returned, so it ends up in a bit of a wreck.  Maybe it
</I>&gt;&gt;<i> would work better if I used a livepage channel instead of a dumb
</I>&gt;&gt;<i> request.
</I>&gt;<i> 
</I>&gt;<i> It would be better if some specific interface were published via 
</I>&gt;<i> wrapping the request, so that the authentication code could be clearly 
</I>&gt;<i> recognizable.  I don't think it makes sense to think of the request 
</I>
But the data you need to wrap is different for each mechanism, so all 
that does is move the knowledge of 1 protocol (HTTP) out of the checker 
(which I agree is hacky), and put the knowledge of N mechanisms into the 
protocol.

It's possible this is unavoidable with HTTP :o(

&gt;<i> itself as the authentication interface or the credentials, especially as 
</I>&gt;<i> any interesting HTTP-based authentication scheme (even simple 
</I>&gt;<i> challenge/response digest auth) spans multiple requests.
</I>
You're probably right. But there are non-obvious (to me at least) 
difficulties, in particular with keeping the HTTP protocol clear of 
knowledge about the specifics of the auth mechanisms, permitting &gt;1 
WWW-Authenticate challenge header, and keeping the HTTP server free of 
state to route challenge responses back to the appropriate deferreds 
(memory exhaustion attack waiting to happen). And also permitting the 
obligatory HTML-form-based fallback.

I'm having difficulty seeing what it would look like, especially the bit 
of allowing a single portal and list of checkers to support the 
multi-mechanism bit.

You need something pam-like or similar to traverse the checker list with 
&quot;empty&quot; creds, allow all checkers to challenge for their mechanism, then 
pass the challenge-response back to just the single mechanism that's chosen.

At the moment, the best I can come up with is:

class Request(http.Request):
   def process(self):
     variousCreds = []

     if self.isSecure():
       # Can't &quot;challenge&quot; at this stage, he doesn't need to know
       # about us
       variousCreds.append(SSLClientCert(self.sslFoo))

     authz = self.getHeader('Authorization')
     if authz:
       mech, rest = authz.split(' ', 1)
       mech = mech.lower()
       mechCreds = httpMechWrapperFactory(mech, rest, self)
       variousCreds.append(mechCreds)

     # other stuff goes here e.g. URL arguments, pubcookie cookies, etc.

     self.portal.login(variousCreds)

class MultiPortal(Portal):
   def login(self, credlist):
     for c in self.checkers:
       # All or a subset...
       if c.canHandle(credlist):
         return c.login(credlist)
     for c in self.checkers:
       c.maybeChallenge(credlist)

...which starts to look very different from cred as-is

Perhaps this comes from a misunderstanding in the goals? Am I right to 
assume we want to support both the HTTP-standard mechs and also 
HTML-form-based ones? Am I right in assuming &gt;1 mechanism challenge is a 
wanted?

The counter question is, if not, can I assume whatever replaces guard 
will be swappable-out without breaking sessions and/or livepage?

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002153.html">[Twisted-web] Sessions and Authentication for Web2
</A></li>
	<LI>Next message: <A HREF="002157.html">[Twisted-web] Sessions and Authentication for Web2
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2156">[ date ]</a>
              <a href="thread.html#2156">[ thread ]</a>
              <a href="subject.html#2156">[ subject ]</a>
              <a href="author.html#2156">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
