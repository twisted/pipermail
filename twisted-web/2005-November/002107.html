<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] HTTP-AUTH for web2 / Kudos on web2's operation
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20HTTP-AUTH%20for%20web2%20/%20Kudos%20on%20web2%27s%20operation&In-Reply-To=20051117212005.GD62588%40prometheusresearch.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002093.html">
   <LINK REL="Next"  HREF="002109.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] HTTP-AUTH for web2 / Kudos on web2's operation</H1>
    <B>glyph at divmod.com</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20HTTP-AUTH%20for%20web2%20/%20Kudos%20on%20web2%27s%20operation&In-Reply-To=20051117212005.GD62588%40prometheusresearch.com"
       TITLE="[Twisted-web] HTTP-AUTH for web2 / Kudos on web2's operation">glyph at divmod.com
       </A><BR>
    <I>Fri Nov 18 12:48:17 MST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="002093.html">[Twisted-web] HTTP-AUTH for web2 / Kudos on web2's operation
</A></li>
        <LI>Next message: <A HREF="002109.html">[Twisted-web] HTTP-AUTH for web2 / Kudos on web2's operation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2107">[ date ]</a>
              <a href="thread.html#2107">[ thread ]</a>
              <a href="subject.html#2107">[ subject ]</a>
              <a href="author.html#2107">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On Thu, 17 Nov 2005 16:20:05 -0500, &quot;Clark C. Evans&quot; &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">cce at clarkevans.com</A>&gt; wrote:
&gt;<i>On Thu, Nov 17, 2005 at 08:17:25AM -0500, <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">glyph at divmod.com</A> wrote:
</I>&gt;|<i> On Wed, 16 Nov 2005 11:11:49 -0500, James Y Knight &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">foom at fuhm.net</A>&gt; wrote:
</I>&gt;|<i> &gt; I think of something like parsing user authentication information at a
</I>&gt;|<i> &gt; high level up in the resource tree and making it available to a
</I>&gt;|<i> &gt; Resource low in the tree.
</I>
&gt;<i>Must we assume that resources form a Tree?  Mine form a Graph; I have
</I>&gt;<i>many resources which can be entered in any number of contexts with
</I>&gt;<i>different &quot;parent&quot; resources.   Viewed this way, the resources which
</I>&gt;<i>a _request_ has passed through forms a stack; but it isn't a tree.
</I>
&gt;<i>From the perspective of the request, yes, resources form a tree.  Although a tree-style API can certainly be used to access a graph, there is a definite &quot;up&quot; and &quot;down&quot; *with respect to a particular request*, and if your resources have relationships outside of that, then they can hold regular object references to each other and call methods on each other or whatever, but the web server should not grow abstractions to specifically support that.
</I>
Graphs can be problematic as a web data structure, for example, graphs can have cycles, which Nevow specifically disallows (and I think that is generally a good decision).

&gt;<i>Currently, it is my application; and I modify the request object to
</I>&gt;<i>my heart's content.  It may seem dangerous, but I've yet to hit a
</I>&gt;<i>single bug from this usage.
</I>
You'll continue to be able to do that indefinitely.  It certainly breaks encapsulation however, and encouraging it as a general technique will almost certainly create problems related to namespace clashes.  We shouldn't break it, but we also shouldn't suggest it.

&gt;|<i> Concretely: come to think of it I've never heard of a legitimate
</I>&gt;|<i> requirement other than &quot;currently logged in user&quot;, which ought to be
</I>&gt;|<i> handled by another system anyway.
</I>&gt;<i>
</I>&gt;<i>See my previous email.  My resources go through many stages of
</I>&gt;<i>processing and are heavily modified by the time I'm ready to
</I>&gt;<i>generate a Response.
</I>
I've gone through that message now and more thoroughly understood what is going on.  Those stages are interesting, but I don't think that any of them belong in twisted.web2.  Twisted's model of web interoperability is, and has always been, object publishing.  We aren't going to change that to a stage-based or filter-based scheme.

&gt;|<i> Though I missed the conversation, I imagine the handwavy stuff that JP
</I>&gt;|<i> was suggesting was &quot;the top resource, which is a proxy for the user,
</I>&gt;|<i> should pass information down to its children as it creates them&quot;.  Some
</I>&gt;|<i> kind of explicit relationship is required.
</I>&gt;<i>
</I>&gt;<i>This statement, I don't get at all.  As I understand it, a resource
</I>&gt;<i>processes more than one request; and hence, will be associated with
</I>&gt;<i>more than one user.
</I>
A resource is an object.  It may process requests for one user, or for many.  In the twisted.cred model of looking at resources, each user's top resource is unique to that user.  Depending on session management policy the anonymous resource may or may not be shared between anonymous sessions.  It may *wrap* a resource which is common to all users, but the cred way of looking at an object is that each user has a distinct object they communicate with, which determines their view of the world.

Think of it this way: a resource should know what it looks like.  If you are looking at a page that says &quot;Welcome, Clark!&quot;, then &quot;Welcome, Clark!&quot; should be an attribute of that resource.  Perhaps that data came from a cookie, perhaps it was somehow identified by a session identifier in the URL, but by whatever technique, by the time you are rendering a resource, it should not be looking at the Request object to determine every little thing about itself.  Things like accept-encodings and accept-languages can modify or filter the result, but the basic data that's there should be accessed by the application by looking at self, not by looking at request.getSession().getComponent(IMyApplication).dataFor(self).(...) or some similar monstrosity.

&gt;|<i> I'll here backpedal just a tiny bit on my earlier adamance on getSession
</I>&gt;|<i> and say that perhaps there is a valid use for access to the currently
</I>&gt;|<i> logged-in user as request data.  By &quot;currently logged-in user&quot; I mean
</I>&gt;|<i> &quot;'topmost' resource object&quot;.
</I>&gt;<i>
</I>&gt;<i>Sorry, I'm lost.   Are you saying that:
</I>&gt;<i>
</I>&gt;<i>    (a) An Avatar is a &quot;auto-generated&quot; resource perhaps constructed
</I>&gt;<i>        from the SessionManager resource?
</I>
That's the way guard works and should continue to work, yes.

&gt;<i>    (b) Each Request object would have a 'stack' of 'previous-resources'
</I>&gt;<i>        that it has visited?  And that I could ask for the 'Avatar'
</I>&gt;<i>        resource in that 'stack' via a method on the request object?
</I>
It's not a stack; certain resources can just put themselves into a slot.  If an API is provided to build up large amounts of implicit state through accretion during resource traversal, then the request will snowball in complexity as more and more junk gets stuck to it by different bits of different applications.

&gt;<i>If so, it sounds more complicated than plain-old getSession().  Perhaps
</I>&gt;<i>I just don't understand what problems you've had with getSession?
</I>
You're right that getSession and getSiteResource (or whatever this is called) are very similar, but there is a fundamentally different goal in mind.

getSession is designed to bridge requests automatically from within the HTTP server's framework code, by setting cookies and such.  Session management is a task that should be accomplished by a resource object which can be independently tested, not by the server code.

The proposed interface is something that would probably be *used* by a session-manager resource, and might even represent the session, but its purpose is simply to provide some per-request data that can be shared between resources processing the same request, without resorting to random attributes on the request, and with some way to link to the resource that provided that data.

&gt;|<i> Sketch of an interface:
</I>
(snip)

&gt;<i>Ok.  That's very nice.   Just remove the word 'Resource' and you're all
</I>&gt;<i>set; just let it be a regular object.
</I>
I suppose this doesn't make much difference.  I want it to be the resource because the accompanying URL should point to it, but I suppose that might be unnecessarily restrictive; at least the URL will point at the thing that set it.

&gt;<i>This similar system would work with Session then?
</I>&gt;<i>
</I>&gt;<i>   request.setSession( my ISession object )
</I>
We could call this object a session, although in that case there is no &quot;ISession&quot; - as I mentioned before, the object passed is application-specific, and the framework should expect absolutely nothing from it.

&gt;<i>Ok.  This is where I get confused.  The top level resource can handle
</I>&gt;<i>multiple requests.  I think you're just referring to one's application
</I>&gt;<i>data?  Perhaps...
</I>&gt;<i>
</I>&gt;<i>   request.setAppData(an IAppData object)
</I>&gt;<i>
</I>&gt;<i>where IAppData is any old object that the application wants.
</I>
The topmost resource for a particular user is unique to that user, assuming they have logged in with a system like cred.  It's shared among all users if there is no session management going on - in which case, why would you need to know the currently logged in user :).

&gt;|<i> - As I mentioned previously, error messages can be more detailed, since
</I>&gt;|<i> they will indicate what type the current site resource is, and thereby
</I>&gt;|<i> provide the developer some indication of how the offending resource got
</I>&gt;|<i> where it is.  Furthermore the URL can also be used to aid in error
</I>&gt;|<i> reporting, so the developer can tell &quot;where&quot; the path traversal went
</I>&gt;|<i> wrong.  If we want to push the error reporting even harder, we can have
</I>&gt;|<i> an explicit 'interface' argument which has to be passed to both
</I>&gt;|<i> setSiteResource and getSiteResource, used for nothing but matching up to
</I>&gt;|<i> make sure that the implicit state matches the application's expectations.
</I>&gt;<i>
</I>&gt;<i>Sorry; I don't get this one -- do you mind explaining a bit more?
</I>
error-reporting behavior with Nevow:

I have a resource which must be rendered after a Foo has been put into the context, remembered with IFoo.  This happens when FooRoot's locateChild is called, on the context passed to locate child.  I forget to put a FooRoot into the path, which I expect to be at /my-app/foo/&lt;id&gt;.

Keep in mind that locateChild is just one of many places the context is passed: it could be set in renderHTTP and used in the template, it could be set in locateChild and used in renderHTTP, it could be set somewhere early in the template and used somewhere later.

Someone else later places my Foo resource at /my-app/stuff/extra/current-foo.  They receive this error:

  KeyError: interface 'IFoo' not remembered

&quot;Where does IFoo get remembered&quot; can sometimes be as easy to find as a grep, but sometimes it's hard to figure out which of many places is being invoked in the actually-working example you're working from.

error-reporting behavior with interfaces and such using this system:

In a similar situation, I need a Foo on the request.  It's set by /my-app/foo.  I put my Foo resources at /my-app/foo/&lt;blah&gt;.  Someone else puts one at /my-app/stuff/extra/current-foo.  The error-reporting now becomes:

  SiteMismatchError: expected current site resource to provide 'IFoo', but instead found 'IMyApp' &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">MyApp at 13715</A>&gt; from <A HREF="http://example.com/my-app/">http://example.com/my-app/</A>

It is then possible for the developer to insert a 'print' statement into a working Foo and watch the logs, which would allow them to see that the URL which sets the IFoo it's using is <A HREF="http://example.com/my-app/foo/">http://example.com/my-app/foo/</A> - this might assist in figuring out how to set up a similar structure for /stuff/.


</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002093.html">[Twisted-web] HTTP-AUTH for web2 / Kudos on web2's operation
</A></li>
	<LI>Next message: <A HREF="002109.html">[Twisted-web] HTTP-AUTH for web2 / Kudos on web2's operation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2107">[ date ]</a>
              <a href="thread.html#2107">[ thread ]</a>
              <a href="subject.html#2107">[ subject ]</a>
              <a href="author.html#2107">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
