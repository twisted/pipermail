<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] web2 response.setCookie and request.getCookie
	shortcuts?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20web2%20response.setCookie%20and%20request.getCookie%0A%09shortcuts%3F&In-Reply-To=20051117115711.10365.635838822.divmod.quotient.8775%40ohm">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002099.html">
   <LINK REL="Next"  HREF="002083.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] web2 response.setCookie and request.getCookie
	shortcuts?</H1>
    <B>James Y Knight</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20web2%20response.setCookie%20and%20request.getCookie%0A%09shortcuts%3F&In-Reply-To=20051117115711.10365.635838822.divmod.quotient.8775%40ohm"
       TITLE="[Twisted-web] web2 response.setCookie and request.getCookie
	shortcuts?">foom at fuhm.net
       </A><BR>
    <I>Thu Nov 17 23:26:49 MST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="002099.html">[Twisted-web] web2 response.setCookie and request.getCookie
	shortcuts?
</A></li>
        <LI>Next message: <A HREF="002083.html">[Twisted-web] web2 response.setCookie and request.getCookie
	shortcuts?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2100">[ date ]</a>
              <a href="thread.html#2100">[ thread ]</a>
              <a href="subject.html#2100">[ subject ]</a>
              <a href="author.html#2100">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Nov 17, 2005, at 6:57 AM, <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">glyph at divmod.com</A> wrote:
&gt;<i> &quot;content-length&quot; and &quot;connection&quot; are just headers too: but the  
</I>&gt;<i> code has to support them because they're in the RFC.  Technically  
</I>&gt;<i> speaking cookies aren't in the *same* RFC, but they do have a  
</I>&gt;<i> standard of their own, rfc2109.
</I>&gt;<i>
</I>&gt;<i> If there were multiple possible implementations of cookies, I'd say  
</I>&gt;<i> there should be an adapter or something to keep it separate.  Since  
</I>&gt;<i> there is just the one way to do them, though, I think that it's  
</I>&gt;<i> reasonable to treat the standards as merged, and just put the  
</I>&gt;<i> methods on request to handle it.  Pragmatically speaking cookies  
</I>&gt;<i> are not an &quot;optional&quot; extension to HTTP/1.1.
</I>&gt;<i>
</I>
Agreed, cookies are important. But, there's not just one possible  
implementation. To start with, you've got three specs: netscape,  
RFC2109, and RFC2965. I believe RFC2109 is essentially dead, and  
shouldn't be cared about.

The code is there to parse and unparse all the cookie headers in both  
Netscape and RFC2965 format, in the same way the code is there to  
parse and unparse content-length. As cce indicated, you can directly  
manipulate the parsed header representation. However, a higher-level  
interface to cookies should be implemented.

However, this higher level implementation is not entirely trivial,  
which is why I haven't done it yet. As an example of some of the non- 
trivialities:

The Netscape cookie spec is insecure, often allowing random other  
hosts on the internet to set cookies for your host(*). Uptake of the  
RFC2965 spec is slow but gaining somewhat, and supporting it would be  
a good move. It adds the ability to determine what host/path the  
cookie was set for, so your application can verify that it isn't  
getting cookies from an unexpected source. So, the high level  
interface has to be more than a simple dictionary, it has to be  
filterable by acceptable source host/port/path. But only when you  
know you're talking to a client that supports RFC2965, which you can  
tell because of various attributes. And when setting a cookie,  
probably both Set-Cookie and Set-Cookie2 should be sent.

And stuff like that. All doable, and should be done, but to say  
there's only one obvious way to do things is not exactly true. :)


(*): Most common example: User follows a link to http:// 
attacker.co.uk/. Said webpage makes a request in the background to  
<A HREF="http://myserver.co.uk/">http://myserver.co.uk/</A> and I setup a new session and send back a  
cookie with the session id: SID=1234. Attacker then sends back to  
user a cookie: SID=1234, domain=.co.uk and redirects user to http:// 
myserver.co.uk/. Myserver gets the SID cookie, and uses that session.  
Attacker now has access to all data available through user's session.  
D'oh!

This was originally supposed to be prevented by the rule implemented  
in browsers that you cannot set a prefix cookie for domains without a  
dot, but that only protects domains which sell the second level  
(e.g. .com, .org, .net).

James

</PRE>
























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002099.html">[Twisted-web] web2 response.setCookie and request.getCookie
	shortcuts?
</A></li>
	<LI>Next message: <A HREF="002083.html">[Twisted-web] web2 response.setCookie and request.getCookie
	shortcuts?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2100">[ date ]</a>
              <a href="thread.html#2100">[ thread ]</a>
              <a href="subject.html#2100">[ subject ]</a>
              <a href="author.html#2100">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
