<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] State and web2 (or, how to not follow REST)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20State%20and%20web2%20%28or%2C%20how%20to%20not%20follow%20REST%29&In-Reply-To=20051120204530.GA8341%40prometheusresearch.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002125.html">
   <LINK REL="Next"  HREF="002127.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] State and web2 (or, how to not follow REST)</H1>
    <B>Clark C. Evans</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20State%20and%20web2%20%28or%2C%20how%20to%20not%20follow%20REST%29&In-Reply-To=20051120204530.GA8341%40prometheusresearch.com"
       TITLE="[Twisted-web] State and web2 (or, how to not follow REST)">cce at clarkevans.com
       </A><BR>
    <I>Mon Nov 21 12:41:47 MST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="002125.html">[Twisted-web] State and web2 (or, how to not follow REST)
</A></li>
        <LI>Next message: <A HREF="002127.html">[Twisted-web] LivePage cannot append rows to tables?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2126">[ date ]</a>
              <a href="thread.html#2126">[ thread ]</a>
              <a href="subject.html#2126">[ subject ]</a>
              <a href="author.html#2126">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On IRC today, foom pointed out that my idea for distinguishing between
things that modify a request (a IRequestHandler) such as setting up a
session or authenticating a user, must also be able to happen between
IResources.  The example given was /~user/bing/my-app/foo, where
authentication (and possibly setting up a session) happens:
/~user/bing/{HERE}my-app/foo

So, goal is to distinguish between Resources which should not be
modifying the request's context and RequestFilters which by definition
change the request. The glue can be done by having a ContextResource
that explicitly applies one or more RequestFilters on the current
request.  We can then designate a syntax for asserting that the
application of a particular IRequestFilter has been done on the request.
Anyway, just consider this a random attempt to detail the idea....

  class IRequestFilter(Interface):
      &quot;&quot;&quot;
          I am a filter that is applied to a given request, examples of
          a RequestFilter are, a &quot;SessionManager&quot;, &quot;Authenticator&quot;, etc.
      &quot;&quot;&quot;

      def apply(self, request):
          &quot;&quot;&quot; Perform necessary logic on the request, modifying the
              request's context as necessary and/or raising HTTPError
              as needed.   Ideally only an IRequestFilter modifies a
              request's context.
          &quot;&quot;&quot;

  class IResource:
      # same as before, adding:

      require = Attribute(
                   &quot;A sequence of IRequestFilters which must have
                    been applied to a Request before this resource
                    is accessed&quot;)

  class IRequest(Interface):
      # same as before, adding:
      
      filtered = Attribute(
                  &quot;A sequence of IRequestFilters that have been applied.&quot;)

      # since there are two objects that are so commonly used, I feel
      # that they merit their own &quot;slot&quot; on the Request object:

      session = Attribute(&quot;An optional ISession object added by the 
                  ISessionRequestFilter.&quot;)

      avatar = Attribute(&quot;An optional IAvatar object added by the
                 IAuthenticateRequestFilter, or other providers of
                 an IAvatar&quot;)

  class ContextResource(Resource):  # or SiteResource, or AppResource
      &quot;&quot;&quot;
          I am a application or site resource which modifies the
          incoming request via a set of RequestFilters.  Only 
          ContextResources should be doing this sort of thing.
      &quot;&quot;&quot;
       
      filter = None

      def registerFilter(self, requestFilter):
          if not self.filter:
               self.filter = [requestFilter]
               return
          self.filter.append(requestFilter)
     
      def locateChild(self, request, segments):
          for filter in self.filter:
              filter.apply(request)
              request.filtered.append(filter)
          Resource.locateChild(self, request, segments)


myapp = ContextResource()
myapp.registerFilter(SessionManager())
myapp.registerFilter(HTTPAuthHandler())



</PRE>










<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002125.html">[Twisted-web] State and web2 (or, how to not follow REST)
</A></li>
	<LI>Next message: <A HREF="002127.html">[Twisted-web] LivePage cannot append rows to tables?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2126">[ date ]</a>
              <a href="thread.html#2126">[ thread ]</a>
              <a href="subject.html#2126">[ subject ]</a>
              <a href="author.html#2126">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
