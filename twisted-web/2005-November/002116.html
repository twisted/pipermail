<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] Sessions and Authentication for Web2
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Sessions%20and%20Authentication%20for%20Web2&In-Reply-To=1132336272.24425.13.camel%40audrey.local">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002105.html">
   <LINK REL="Next"  HREF="002118.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] Sessions and Authentication for Web2</H1>
    <B>Phil Mayers</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Sessions%20and%20Authentication%20for%20Web2&In-Reply-To=1132336272.24425.13.camel%40audrey.local"
       TITLE="[Twisted-web] Sessions and Authentication for Web2">p.mayers at imperial.ac.uk
       </A><BR>
    <I>Sat Nov 19 16:00:31 MST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="002105.html">[Twisted-web] Sessions and Authentication for Web2
</A></li>
        <LI>Next message: <A HREF="002118.html">[Twisted-web] Sessions and Authentication for Web2
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2116">[ date ]</a>
              <a href="thread.html#2116">[ thread ]</a>
              <a href="subject.html#2116">[ subject ]</a>
              <a href="author.html#2116">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>David Reid wrote:
&gt;<i> 
</I>&gt;<i> But in Basic and Digest auth you don't have the username until you get
</I>&gt;<i> the response to your challenge.  So this is where IAuthorizer comes in
</I>&gt;<i> it handles all the steps prior to having something that you can use to
</I>&gt;<i> build a credentials.  
</I>
I'm no cred expert, and I dislike it conceptually, but as far as I can 
tell it's got all the facilities it needs. HTTP is slightly more complex 
so I'll start with a SASL-ised imap-like example, to see if I've got the 
right idea:

class simpleproto(basic.LineReceiver):
   def lineReceived(self, line):
     if self.creds:
       # forward to CR module that's in progress
       self.creds.lineReceived(line)
     else:
       cmd, rest = line.split(' ', 1)
       fn = getattr(self, 'do_'+cmd, None)
       if not fn:
         self.transport.write('NO unknown command %s\n' % (cmd,))
         self.transport.loseConnection()

   def do_AUTHENTICATE(self, mechanism):
     if mechanism=='GSSAPI':
       self.creds = ChallengeResponse(self)
       return self.portal.login(self.creds).addCallbacks(self.authok, 
self.authfail)

   def authok(self, avatar):
     self.avatar = avatar
     self.lineReceived = avatar.lineReceived

   def authfail(self, why):
     self.transport.write(why.getErrorMessage()+'\n')
     self.transport.loseConnection()

class ChallengeResponse:
   def __init__(self, conn):
     self.conn = conn
     self.started = False
     self.context = hypotheticalGssapiModule.init()

   def lineReceived(self, line):
     done, response = self.context.input(line.decode('base64'))
     self.conn.transport.write(response.encode('base64')+'\n')
     if done:
       if self.context.success():
         self.finish.callback(self.context.getPrincipal())
       else:
         self.finish.errback(self.context.errMsg())

class GssapiChecker:
   implements(checkers.ICredentialsChecker)
   def requestAvatarId(self, creds):
     creds.finish = defer.Deferred()
     return creds.finish

The neat thing about cred is that the code above (if it worked at all, 
which it would with only slight fiddling) doesn't require the portal or 
realm to change. Similarly, only a bit of fiddling permits multi-method 
auth e.g. for IMAP brokenness:

def do_LOGIN(self, data):
   user, pass = data.split(' ', 1)
   creds = credentials.UsernamePassword(user, pass)
   return self.portal.login(creds).addCallbacks(...)

...and add an appropriate checker to the portal.

HTTP is a bit of a pain because of the &quot;connectionless&quot; basis. The RFCs 
for the hacky mechanisms like &quot;Negotiate&quot; (the MS-ism for kerberos over 
HTTP) and such show that. Digest would want some kind of stateless 
version - you're effectively authenticating requests as opposed to the 
connection, but the basic principle is the same. I'm sure you know all this.

So am I missing something? It looks like cred needs no extending?

</PRE>









<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002105.html">[Twisted-web] Sessions and Authentication for Web2
</A></li>
	<LI>Next message: <A HREF="002118.html">[Twisted-web] Sessions and Authentication for Web2
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2116">[ date ]</a>
              <a href="thread.html#2116">[ thread ]</a>
              <a href="subject.html#2116">[ subject ]</a>
              <a href="author.html#2116">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
