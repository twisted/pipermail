<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] HTTP-AUTH for web2 / Kudos on web2's operation
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20HTTP-AUTH%20for%20web2%20/%20Kudos%20on%20web2%27s%20operation&In-Reply-To=20051117131725.10365.1102336207.divmod.quotient.8793%40ohm">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002087.html">
   <LINK REL="Next"  HREF="002107.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] HTTP-AUTH for web2 / Kudos on web2's operation</H1>
    <B>Clark C. Evans</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20HTTP-AUTH%20for%20web2%20/%20Kudos%20on%20web2%27s%20operation&In-Reply-To=20051117131725.10365.1102336207.divmod.quotient.8793%40ohm"
       TITLE="[Twisted-web] HTTP-AUTH for web2 / Kudos on web2's operation">cce at clarkevans.com
       </A><BR>
    <I>Thu Nov 17 14:20:05 MST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="002087.html">[Twisted-web] HTTP-AUTH for web2 / Kudos on web2's operation
</A></li>
        <LI>Next message: <A HREF="002107.html">[Twisted-web] HTTP-AUTH for web2 / Kudos on web2's operation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2093">[ date ]</a>
              <a href="thread.html#2093">[ thread ]</a>
              <a href="subject.html#2093">[ subject ]</a>
              <a href="author.html#2093">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Thu, Nov 17, 2005 at 08:17:25AM -0500, <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">glyph at divmod.com</A> wrote:
|<i> On Wed, 16 Nov 2005 11:11:49 -0500, James Y Knight &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">foom at fuhm.net</A>&gt; wrote:
</I>|<i> &gt; I think of something like parsing user authentication information at a 
</I>|<i> &gt; high level up in the resource tree and making it available to a  
</I>|<i> &gt; Resource low in the tree.
</I>
Must we assume that resources form a Tree?  Mine form a Graph; I have
many resources which can be entered in any number of contexts with 
different &quot;parent&quot; resources.   Viewed this way, the resources which
a _request_ has passed through forms a stack; but it isn't a tree.  

|<i> &gt;It is fairly clearly a per-request bit of  
</I>|<i> &gt;state which may be useful to a some subset of the pages, and as such  
</I>|<i> &gt;seems like it should be attached to the Request. Just going and  adding 
</I>|<i> &gt;random attributes onto Request is not nice thing to do, so  I'll pretend 
</I>|<i> &gt;I didn't just consider it. But it really seems like some  designated 
</I>|<i> &gt;storage spot for extra data is necessary.
</I>
Currently, it is my application; and I modify the request object to
my heart's content.  It may seem dangerous, but I've yet to hit a 
single bug from this usage.

|<i> Abstractly: if you have a page which requires some &quot;per-request state&quot; to 
</I>|<i> be set by a resource higher up in the tree, and can't operate without it, 
</I>|<i> how do you guarantee it's been set?  Can we come up with any declarative 
</I>|<i> interface for specifying this relationship?  I've never seen one and it 
</I>|<i> seems like it would be insanely hard to do. 
</I>
Each of my Resources 'assert' pre- and post- conditions.  If the assertion
fails, I get a nice internal server error and a stack trace.  What more
could a programmer want ;)

|<i> Concretely: come to think of it I've never heard of a legitimate 
</I>|<i> requirement other than &quot;currently logged in user&quot;, which ought to be 
</I>|<i> handled by another system anyway. 
</I>
See my previous email.  My resources go through many stages of
processing and are heavily modified by the time I'm ready to
generate a Response.

|<i> Though I missed the conversation, I imagine the handwavy stuff that JP 
</I>|<i> was suggesting was &quot;the top resource, which is a proxy for the user, 
</I>|<i> should pass information down to its children as it creates them&quot;.  Some 
</I>|<i> kind of explicit relationship is required.
</I>
This statement, I don't get at all.  As I understand it, a resource
processes more than one request; and hence, will be associated with
more than one user.

|<i> I'll here backpedal just a tiny bit on my earlier adamance on getSession 
</I>|<i> and say that perhaps there is a valid use for access to the currently 
</I>|<i> logged-in user as request data.  By &quot;currently logged-in user&quot; I mean 
</I>|<i> &quot;'topmost' resource object&quot;.
</I>
Sorry, I'm lost.   Are you saying that:
  
    (a) An Avatar is a &quot;auto-generated&quot; resource perhaps constructed
        from the SessionManager resource?

    (b) Each Request object would have a 'stack' of 'previous-resources'
        that it has visited?  And that I could ask for the 'Avatar'
        resource in that 'stack' via a method on the request object?

If so, it sounds more complicated than plain-old getSession().  Perhaps
I just don't understand what problems you've had with getSession?

|<i> Sketch of an interface:
</I>|<i> 
</I>|<i> Site resources call Request.setSiteResource() in locateChild - this 
</I>|<i> method takes no arguments, and preserves the current URL being processed 
</I>|<i> as well as the current resource.
</I>|<i> 
</I>|<i> Regular resources can, at any time, call Request.getSiteResource() or 
</I>|<i> Request.getSiteURL() which return, respectively, the last resource to 
</I>|<i> call setSiteResource() and a nevow.url-style object that indicates its 
</I>|<i> location.
</I>
Ok.  That's very nice.   Just remove the word 'Resource' and you're all
set; just let it be a regular object.

    request.setSite(myobject that complies with ISite)

|<i> I still think that this sort of interface should be used sparingly, but 
</I>|<i> it has several advantages over the context as manifested in Nevow.
</I>|<i> 
</I>|<i> - The relationship between objects which require implicit state and 
</I>|<i> objects which provide it is more explicit.  They must both be resources, 
</I>|<i> one calls setSiteResource, one calls getSiteResource.
</I>|<i> 
</I>|<i> - By default, no site resource is set, so you must always implement both 
</I>|<i> halves of the interface.  In other words, this is entirely a facility for 
</I>|<i> an application to communicate with itself, no framework code should ever 
</I>|<i> provide a site resource, and no framework code should ever expect to find 
</I>|<i> anything useful from the site resource.
</I>
This similar system would work with Session then?

   request.setSession( my ISession object )
   
|<i> - All information required by a given application must be encapsulated by 
</I>|<i> the single top-level resource.  No piecemeal assembling of required 
</I>|<i> information from 5 different interfaces set by 5 different systems during 
</I>|<i> resource traversal.  If you need information from a different system, the 
</I>|<i> top-level resource can aggregate it using traditional means (methods 
</I>|<i> returning different objects, attributes, adaptation, etc)
</I>
Ok.  This is where I get confused.  The top level resource can handle
multiple requests.  I think you're just referring to one's application
data?  Perhaps...

   request.setAppData(an IAppData object)
  
where IAppData is any old object that the application wants.
  
|<i> - All information is specifically &quot;per HTTP request&quot; rather than &quot;per 
</I>|<i> abstract transaction execution&quot; - Nevow (or other templating / page 
</I>|<i> generating mechanisms used with web2) can be expected to do any necessary 
</I>|<i> translations at render time and not abuse the same mechanism used by the 
</I>|<i> dispatch mechanism.
</I>
A big problem with my current codebase is that I don't have the 
notion of a Transaction.  I need one.  My back-end system has the
notion of 'Actions'.  Typically, you have one Action per Request,
but sometimes you have more than one Action per request and 
they need to all succeed or all fail.   

In my system, each Action has its own URL, and is essentially its own
mini Request, only that the &quot;parent&quot; request aggregates the results.


|<i> - By providing a URL as well as a site object, sub-applications can 
</I>|<i> properly link to resources defined by the application.  I'm sure that 
</I>|<i> most people will ignore that and link directly to / most of the time, but 
</I>|<i> at least it is the kind of issue which *can* be resolved by using this 
</I>|<i> interface.
</I>|<i>
</I>|<i> - As I mentioned previously, error messages can be more detailed, since 
</I>|<i> they will indicate what type the current site resource is, and thereby 
</I>|<i> provide the developer some indication of how the offending resource got 
</I>|<i> where it is.  Furthermore the URL can also be used to aid in error 
</I>|<i> reporting, so the developer can tell &quot;where&quot; the path traversal went 
</I>|<i> wrong.  If we want to push the error reporting even harder, we can have 
</I>|<i> an explicit 'interface' argument which has to be passed to both 
</I>|<i> setSiteResource and getSiteResource, used for nothing but matching up to 
</I>|<i> make sure that the implicit state matches the application's expectations.
</I>
Sorry; I don't get this one -- do you mind explaining a bit more?

Best,

Clark

</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002087.html">[Twisted-web] HTTP-AUTH for web2 / Kudos on web2's operation
</A></li>
	<LI>Next message: <A HREF="002107.html">[Twisted-web] HTTP-AUTH for web2 / Kudos on web2's operation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2093">[ date ]</a>
              <a href="thread.html#2093">[ thread ]</a>
              <a href="subject.html#2093">[ subject ]</a>
              <a href="author.html#2093">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
