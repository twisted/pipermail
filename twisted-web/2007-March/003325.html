<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] Using web2 to run a Cherrpy site
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Using%20web2%20to%20run%20a%20Cherrpy%20site&In-Reply-To=033D1AC8-A6A3-41A7-B420-C311F2CD15F0%40dreid.org">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003324.html">
   <LINK REL="Next"  HREF="003331.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] Using web2 to run a Cherrpy site</H1>
    <B>David Konerding</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Using%20web2%20to%20run%20a%20Cherrpy%20site&In-Reply-To=033D1AC8-A6A3-41A7-B420-C311F2CD15F0%40dreid.org"
       TITLE="[Twisted-web] Using web2 to run a Cherrpy site">dakoner at gmail.com
       </A><BR>
    <I>Tue Mar 20 09:55:59 CST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="003324.html">[Twisted-web] Using web2 to run a Cherrpy site
</A></li>
        <LI>Next message: <A HREF="003331.html">[Twisted-web] Using web2 to run a Cherrpy site
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3325">[ date ]</a>
              <a href="thread.html#3325">[ thread ]</a>
              <a href="subject.html#3325">[ subject ]</a>
              <a href="author.html#3325">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Which version of cherrypy are you using?  I did an easy_install
</I>&gt;<i> cherrypy and got 3.0.1 but your code didn't work on it.  wsgiApp is
</I>&gt;<i> somewhere else now or something.
</I>


OK, I've updated my test example to work with CherryPy 3.0.  This works a
bit better,
in fact, when I visit the root of the site I get my cherrypy application!
Since
I'm not tied to CherryPy 2.2 (unless TurboGears requires it) this 'fixes'
most of my problem.
I'm still having a problem if I access some URLs under the root, but I have
yet to determine if it's going
to be a problem.

Here's a CherryPy 3.0.1 application that works with Twisted web2 using the
WSGI app support.

from twisted.internet import reactor
from twisted.application import service, strports
from twisted.web2 import server, channel
from twisted.web2 import log
from twisted.web2 import wsgi
from twisted.web2.wsgi import WSGIResource
import cherrypy

## Basic cherrypy index object that dumps the WSGI environment
class Root(object):
    @cherrypy.expose
    def index(self):
        s = []
        for key in cherrypy.request.wsgi_environ:
            s.append(&quot;%s=%s&lt;br/&gt;&quot; % (key, cherrypy.request.wsgi_environ
[key]))

        return &quot;&quot;.join(s)

## Create an instance of the root application and mount it at /
r = Root()

## Convert the Root application to a hostable WSGI application
cpwsgiapp = cherrypy.Application(Root(), '/')

## Convert the CherryPy WSGI app to a Twisted WSGI resource
wsgi = wsgi.WSGIResource(cpwsgiapp)

## Set up the cherrypy environment
cherrypy.config.update({
    'server.environment':'production',
    })

## Start the cherrypy engine without starting a blocking server
cherrypy.engine.start(blocking=False)

## Setup default common access logging
res = log.LogWrapperResource(wsgi)
log.DefaultCommonAccessLoggingObserver().start()

# Create twisted web2 site
site = server.Site(res)

## Launch the HTTP site at port 8080

## code path invoked by twistd
if __name__ == '__builtin__':
    application = service.Application(&quot;demo&quot;)
    s = strports.service('tcp:8080', channel.HTTPFactory(site))
    s.setServiceParent(application)

## code path when run directly
if __name__ == '__main__':
    from twisted.python import log as pythonlog
    import sys
    pythonlog.startLogging(sys.stdout)
    reactor.listenTCP(8080, channel.HTTPFactory(site))
    reactor.run()
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://twistedmatrix.com/pipermail/twisted-web/attachments/20070320/1043f724/attachment.htm">http://twistedmatrix.com/pipermail/twisted-web/attachments/20070320/1043f724/attachment.htm</A>
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003324.html">[Twisted-web] Using web2 to run a Cherrpy site
</A></li>
	<LI>Next message: <A HREF="003331.html">[Twisted-web] Using web2 to run a Cherrpy site
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3325">[ date ]</a>
              <a href="thread.html#3325">[ thread ]</a>
              <a href="subject.html#3325">[ subject ]</a>
              <a href="author.html#3325">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
