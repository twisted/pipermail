<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] Using web2 to run a Cherrpy site
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Using%20web2%20to%20run%20a%20Cherrpy%20site&In-Reply-To=4f0f0cb0703200855w475261dbv99239a5626494cc9%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003325.html">
   <LINK REL="Next"  HREF="003326.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] Using web2 to run a Cherrpy site</H1>
    <B>Joshua Boverhof</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Using%20web2%20to%20run%20a%20Cherrpy%20site&In-Reply-To=4f0f0cb0703200855w475261dbv99239a5626494cc9%40mail.gmail.com"
       TITLE="[Twisted-web] Using web2 to run a Cherrpy site">JRBoverhof at lbl.gov
       </A><BR>
    <I>Thu Mar 22 14:18:23 CST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="003325.html">[Twisted-web] Using web2 to run a Cherrpy site
</A></li>
        <LI>Next message: <A HREF="003326.html">[Twisted-web] page.Element render directives don't support arguments
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3331">[ date ]</a>
              <a href="thread.html#3331">[ thread ]</a>
              <a href="subject.html#3331">[ subject ]</a>
              <a href="author.html#3331">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Here is a fix.

It looks like a bug in twisted.web2.twcgi to me.  Cherrypy is  
confused by the  &quot;//&quot;.

-josh

 &gt; svn diff
Index: twcgi.py
===================================================================
--- twcgi.py    (revision 19890)
+++ twcgi.py    (working copy)
@@ -51,7 +51,7 @@
      if request.postpath:
          # Should we raise an exception if this contains &quot;/&quot; chars?
-        env[&quot;PATH_INFO&quot;] = '/' + '/'.join(request.postpath)
+        env[&quot;PATH_INFO&quot;] = '/'.join(request.postpath)
      # MUST always be present, even if no query
      env[&quot;QUERY_STRING&quot;] = request.querystring






On Mar 20, 2007, at 8:55 AM, David Konerding wrote:

&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Which version of cherrypy are you using?  I did an easy_install
</I>&gt;<i> cherrypy and got 3.0.1 but your code didn't work on it.  wsgiApp is
</I>&gt;<i> somewhere else now or something.
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> OK, I've updated my test example to work with CherryPy 3.0.  This  
</I>&gt;<i> works a bit better,
</I>&gt;<i> in fact, when I visit the root of the site I get my cherrypy  
</I>&gt;<i> application!  Since
</I>&gt;<i> I'm not tied to CherryPy 2.2 (unless TurboGears requires it) this  
</I>&gt;<i> 'fixes' most of my problem.
</I>&gt;<i> I'm still having a problem if I access some URLs under the root,  
</I>&gt;<i> but I have yet to determine if it's going
</I>&gt;<i> to be a problem.
</I>&gt;<i>
</I>&gt;<i> Here's a CherryPy 3.0.1 application that works with Twisted web2  
</I>&gt;<i> using the WSGI app support.
</I>&gt;<i>
</I>&gt;<i> from twisted.internet import reactor
</I>&gt;<i> from twisted.application import service, strports
</I>&gt;<i> from twisted.web2 import server, channel
</I>&gt;<i> from twisted.web2 import log
</I>&gt;<i> from twisted.web2 import wsgi
</I>&gt;<i> from twisted.web2.wsgi import WSGIResource
</I>&gt;<i> import cherrypy
</I>&gt;<i>
</I>&gt;<i> ## Basic cherrypy index object that dumps the WSGI environment
</I>&gt;<i> class Root(object):
</I>&gt;<i>     @cherrypy.expose
</I>&gt;<i>     def index(self):
</I>&gt;<i>         s = []
</I>&gt;<i>         for key in cherrypy.request.wsgi_environ:
</I>&gt;<i>             s.append(&quot;%s=%s&lt;br/&gt;&quot; % (key,  
</I>&gt;<i> cherrypy.request.wsgi_environ [key]))
</I>&gt;<i>
</I>&gt;<i>         return &quot;&quot;.join(s)
</I>&gt;<i>
</I>&gt;<i> ## Create an instance of the root application and mount it at /
</I>&gt;<i> r = Root()
</I>&gt;<i>
</I>&gt;<i> ## Convert the Root application to a hostable WSGI application
</I>&gt;<i> cpwsgiapp = cherrypy.Application(Root(), '/')
</I>&gt;<i>
</I>&gt;<i> ## Convert the CherryPy WSGI app to a Twisted WSGI resource
</I>&gt;<i> wsgi = wsgi.WSGIResource(cpwsgiapp)
</I>&gt;<i>
</I>&gt;<i> ## Set up the cherrypy environment
</I>&gt;<i> cherrypy.config.update({
</I>&gt;<i>     'server.environment':'production',
</I>&gt;<i>     })
</I>&gt;<i>
</I>&gt;<i> ## Start the cherrypy engine without starting a blocking server
</I>&gt;<i> cherrypy.engine.start(blocking=False)
</I>&gt;<i>
</I>&gt;<i> ## Setup default common access logging
</I>&gt;<i> res = log.LogWrapperResource(wsgi)
</I>&gt;<i> log.DefaultCommonAccessLoggingObserver().start()
</I>&gt;<i>
</I>&gt;<i> # Create twisted web2 site
</I>&gt;<i> site = server.Site(res)
</I>&gt;<i>
</I>&gt;<i> ## Launch the HTTP site at port 8080
</I>&gt;<i>
</I>&gt;<i> ## code path invoked by twistd
</I>&gt;<i> if __name__ == '__builtin__':
</I>&gt;<i>     application = service.Application(&quot;demo&quot;)
</I>&gt;<i>     s = strports.service('tcp:8080', channel.HTTPFactory(site))
</I>&gt;<i>     s.setServiceParent(application)
</I>&gt;<i>
</I>&gt;<i> ## code path when run directly
</I>&gt;<i> if __name__ == '__main__':
</I>&gt;<i>     from twisted.python import log as pythonlog
</I>&gt;<i>     import sys
</I>&gt;<i>     pythonlog.startLogging(sys.stdout)
</I>&gt;<i>     reactor.listenTCP(8080, channel.HTTPFactory (site))
</I>&gt;<i>     reactor.run()
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-web mailing list
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">Twisted-web at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web</A>
</I>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 2526 bytes
Desc: not available
Url : <A HREF="http://twistedmatrix.com/pipermail/twisted-web/attachments/20070322/3a328245/smime.bin">http://twistedmatrix.com/pipermail/twisted-web/attachments/20070322/3a328245/smime.bin</A>
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003325.html">[Twisted-web] Using web2 to run a Cherrpy site
</A></li>
	<LI>Next message: <A HREF="003326.html">[Twisted-web] page.Element render directives don't support arguments
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3331">[ date ]</a>
              <a href="thread.html#3331">[ thread ]</a>
              <a href="subject.html#3331">[ subject ]</a>
              <a href="author.html#3331">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
