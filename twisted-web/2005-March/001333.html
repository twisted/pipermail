<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] Re: Nevow + adbapi
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Re%3A%20Nevow%20%2B%20adbapi&In-Reply-To=77bfa81a050321141345512442%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001332.html">
   <LINK REL="Next"  HREF="001337.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] Re: Nevow + adbapi</H1>
    <B>Andrew Bennetts</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Re%3A%20Nevow%20%2B%20adbapi&In-Reply-To=77bfa81a050321141345512442%40mail.gmail.com"
       TITLE="[Twisted-web] Re: Nevow + adbapi">andrew-twisted at puzzling.org
       </A><BR>
    <I>Mon Mar 21 21:21:33 MST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="001332.html">[Twisted-web] Re: Nevow + adbapi
</A></li>
        <LI>Next message: <A HREF="001337.html">[Twisted-web] Re: Nevow + adbapi
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1333">[ date ]</a>
              <a href="thread.html#1333">[ thread ]</a>
              <a href="subject.html#1333">[ subject ]</a>
              <a href="author.html#1333">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Mon, Mar 21, 2005 at 04:13:49PM -0600, Luis N wrote:
[...]
&gt;<i> 
</I>&gt;<i> Thank you. Now that I know how to use nevow and adbapi, I'm confused
</I>&gt;<i> by xmlrpc and adbapi.
</I>&gt;<i> 
</I>&gt;<i> class Educators(xmlrpc.XMLRPC):
</I>&gt;<i>     def xmlrpc_authEducator(self, educator, identify):
</I>&gt;<i>         self.educator = educator
</I>&gt;<i>         self.identify = identify
</I>&gt;<i>         if authenticate(self.educator).addCallback(authResult) == self.identify:
</I>&gt;<i>             return 1
</I>&gt;<i>         else:
</I>&gt;<i>             return 0
</I>
addCallback returns the Deferred, not the result of the callback.  It has
to; the callback normally won't have been run yet, because the Deferred
won't have been fired yet.

The xmlrpc.XMLRPC class can handle Deferreds just fine, though, so instead,
you can do this:

class Educators(xmlrpc.XMLRPC):
    def xmlrpc_authEducator(self, educator, identify):
        d = authenticate(educator)
        d.addCallback(authResult)
        d.addCallback(isExpectedIdentity, identity)
        return d

def isExpectedIdentity(result, identity):
    return result == identity

I've also removed the unnecessary assignments to self.educator and
self.identify.

&gt;<i> def authenticate(educator):
</I>&gt;<i>     return dbpool.runQuery(&quot;SELECT password FROM educatorgroup WHERE
</I>&gt;<i> educator LIKE %s&quot;, (educator,))
</I>&gt;<i> 
</I>&gt;<i> def authResult(db):
</I>&gt;<i>     if db:
</I>&gt;<i>         return db[0][0]
</I>&gt;<i>     else:
</I>&gt;<i>         return 0
</I>
These are fine.

-Andrew.


</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001332.html">[Twisted-web] Re: Nevow + adbapi
</A></li>
	<LI>Next message: <A HREF="001337.html">[Twisted-web] Re: Nevow + adbapi
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1333">[ date ]</a>
              <a href="thread.html#1333">[ thread ]</a>
              <a href="subject.html#1333">[ subject ]</a>
              <a href="author.html#1333">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
