<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] Listening on 2 addresses
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-web%5D%20Listening%20on%202%20addresses&In-Reply-To=%3C2ccdd885-0c0c-424e-b2d2-7ad3d79ea467%40www.fastmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="005359.html">
   <LINK REL="Next"  HREF="005361.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] Listening on 2 addresses</H1>
    <B>Tom Most</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-web%5D%20Listening%20on%202%20addresses&In-Reply-To=%3C2ccdd885-0c0c-424e-b2d2-7ad3d79ea467%40www.fastmail.com%3E"
       TITLE="[Twisted-web] Listening on 2 addresses">twm at freecog.net
       </A><BR>
    <I>Sat Mar 30 18:51:08 MDT 2019</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="005359.html">[Twisted-web] Listening on 2 addresses
</A></li>
        <LI>Next message (by thread): <A HREF="005361.html">[Twisted-web] Listening on 2 addresses
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5360">[ date ]</a>
              <a href="thread.html#5360">[ thread ]</a>
              <a href="subject.html#5360">[ subject ]</a>
              <a href="author.html#5360">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Axel,

makeService() returns an IService. twisted.internet.application.MultiService[1] is an IService that composes other services (it's an IServiceCollection). The implementation would be something like:

def makeService(self, options):
    ipv4 = internet.TCPServer(int(options['port'], meteo_factory, interface=options['ipv4_address'])
    ipv6 = internet.TCPServer(int(options['port'], meteo_factory, interface=options['ipv6_address'])
    root = MultiService()
    ipv4.setServiceParent(root)
    ipv6.setServiceParent(root)
    return root

You might prefer StreamServerEndpointService[2] to TCPServer. String endpoint descriptions[3] are pretty convenient for CLI use.

[1]: <A HREF="https://twistedmatrix.com/documents/current/api/twisted.application.service.MultiService.html">https://twistedmatrix.com/documents/current/api/twisted.application.service.MultiService.html</A>
[2]: <A HREF="https://twistedmatrix.com/documents/current/api/twisted.application.internet.StreamServerEndpointService.html">https://twistedmatrix.com/documents/current/api/twisted.application.internet.StreamServerEndpointService.html</A>
[3]: <A HREF="https://twistedmatrix.com/documents/current/api/twisted.internet.endpoints.html#serverFromString">https://twistedmatrix.com/documents/current/api/twisted.internet.endpoints.html#serverFromString</A>

-- 
  Tom Most
  <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">twm at freecog.net</A>

On Fri, Mar 29, 2019, at 11:39 AM, Axel Rau wrote:
&gt;<i> I have a simple web application with the plugin below.
</I>&gt;<i> It works fine with IPv4 or IPv6. The host has 2 addresses
</I>&gt;<i> (IPv4 + IPv6 = dual stack).
</I>&gt;<i> How can I extend the plugin to let my server listen on both
</I>&gt;<i> addresses?
</I>&gt;<i> 
</I>&gt;<i> Please advice,
</I>&gt;<i> Axel
</I>&gt;<i> 
</I>&gt;<i> PS: The plugin:
</I>&gt;<i> 
</I>&gt;<i> from zope.interface import implementer
</I>&gt;<i> 
</I>&gt;<i> from twisted.application.service import IServiceMaker
</I>&gt;<i> from twisted.application import internet
</I>&gt;<i> from twisted.plugin import IPlugin
</I>&gt;<i> from twisted.python import usage
</I>&gt;<i> 
</I>&gt;<i> from meteo import meteo_factory
</I>&gt;<i> 
</I>&gt;<i> class Options(usage.Options):
</I>&gt;<i> 	optParameters = [	['port', 'p', 80, 'The port number to listen on.'],
</I>&gt;<i> 						['ipv4_address', '4', None, 'The IPv4 address to listen on.'],
</I>&gt;<i> 						['ipv6_address', '6', None, 'The IPv6 address to listen on.'],
</I>&gt;<i> 						['host', 'l', None, 'The hostname where to listen at']]
</I>&gt;<i> 
</I>&gt;<i> @implementer(IServiceMaker, IPlugin)
</I>&gt;<i> class MeteoServiceMaker(object):
</I>&gt;<i> 	tapname = 'meteo'
</I>&gt;<i> 	description = 'A web application for the meteo package'
</I>&gt;<i> 	options = Options
</I>&gt;<i> 	
</I>&gt;<i> 	def makeService(self, options):
</I>&gt;<i> 		&quot;&quot;&quot;
</I>&gt;<i> 		Constructs a TCP server from a factory defined in meteo.py
</I>&gt;<i> 		&quot;&quot;&quot;
</I>&gt;<i> 		return internet.TCPServer(	int(options['port']), 
</I>&gt;<i>                                     meteo_factory,
</I>&gt;<i>                                     interface=options['ipv6_address'])			
</I>&gt;<i> 
</I>&gt;<i> serviceMaker = MeteoServiceMaker()
</I>&gt;<i> 
</I>&gt;<i> ---
</I>&gt;<i> PGP-Key:29E99DD6  â˜€  computing @ chaos claudius
</I>
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="005359.html">[Twisted-web] Listening on 2 addresses
</A></li>
	<LI>Next message (by thread): <A HREF="005361.html">[Twisted-web] Listening on 2 addresses
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5360">[ date ]</a>
              <a href="thread.html#5360">[ thread ]</a>
              <a href="subject.html#5360">[ subject ]</a>
              <a href="author.html#5360">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
