<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] new nevow know-how needs...;-)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="000211.html">
   <LINK REL="Next"  HREF="000215.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] new nevow know-how needs...;-)
   </H1>
    <B>James Y Knight
    </B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com"
       TITLE="[Twisted-web] new nevow know-how needs...;-)">twisted-web@twistedmatrix.com
       </A><BR>
    <I>Thu, 4 Mar 2004 20:40:34 -0500</I>
    <P><UL>
        <LI> Previous message: <A HREF="000211.html">[Twisted-web] new nevow know-how needs...;-)
</A></li>
        <LI> Next message: <A HREF="000215.html">[Twisted-web] Re: new nevow know-how needs...;-)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#214">[ date ]</a>
              <a href="thread.html#214">[ thread ]</a>
              <a href="subject.html#214">[ subject ]</a>
              <a href="author.html#214">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Mar 1, 2004, at 6:02 AM, Alex Martelli wrote:
&gt;<i> I currently have _one_ serious problem understanding what's going on 
</I>&gt;<i> (or
</I>&gt;<i> supposed to go on): nevow:data=&quot;whatever&quot; directives.  I don't 
</I>&gt;<i> understand
</I>&gt;<i> the rules regarding WHEN this causes a lookup (e.g. of 'data_whatever' 
</I>&gt;<i> on a
</I>&gt;<i> rend.Page subclass), WHAT it looks things up when it does do a lookup,
</I>&gt;<i> WHEN it calls method 'data_whatever' thereafter, and with what 
</I>&gt;<i> arguments.
</I>&gt;<i> Basically, I must be missing something important here -- it mostly 
</I>&gt;<i> feels
</I>&gt;<i> that once I've used a nevow:data= directive, I lose control of what's 
</I>&gt;<i> going
</I>&gt;<i> to happen and get nasty surprises.  So, I'm gradually moving to using
</I>&gt;<i> nevow.render= directives instead -- mixing the &quot;model&quot; aspect (getting 
</I>&gt;<i> the
</I>&gt;<i> data on which rendering is to be based) with the &quot;view&quot; one (rendering 
</I>&gt;<i> it).
</I>&gt;<i> Not nice, but with nevow.render I _do_ appear to have complete 
</I>&gt;<i> control, or
</I>&gt;<i> maybe better expressed, _understanding_, of what's gonna happen...
</I>
I just totally changed how this worked today. I'll describe what *now* 
happens, which is different from what used to happen:

def data_foo(context, data):
   return 4
def render_foo(context, data):
   return context.tag['Hi: '+data]
span(data=data_foo, renderer=render_foo)

This will first call data_foo, returning '4'. data_foo's context will 
be the context of the span (context.tag is the span tag), without its 
IData remembered yet (thus, the data argument will be whatever the 
containing data is, in most cases, the rend.Page instance.

Then, render_foo will be called, with the tag's context, again, but now 
with the result of data_foo's result (4) as 'data'.
Thus, this will result in the string &quot;&lt;span&gt;Hi: 4&lt;/span&gt;&quot;.

Now, take another example:
number = 0
def data_count(context, data):
   global number
   number = number + 1
   return number

span(data=data_count)[str, ' ', str, ' ', str], ' ', 
span(data=data_count)[str, ' ', str, ' ', str]

This will result in the string &quot;&lt;span&gt;1 1 1&lt;/span&gt; &lt;span&gt;2 2 2&lt;/span&gt;&quot;.

Note that returning deferreds from the data_ is now supported. In 
detail, the way this works:
nevow.flat.flatstan.TagRenderer calls (quite paraphrased) 
&quot;context.remember(convertToData(data, context), IData)&quot; when it first 
sees a tag, right before it calls the function specified by the render= 
attribute.

convertToData causes functions to be called, 'directive' statements to 
be looked up, and deferreds to be handled. Then, when the actual 
rendering function is called, it does context.locate(IData), which 
finds the previously remembered data, and passes it directly (no 
further fiddling is done!) to the data argument of the renderer.

If you use a directive('name') form in a data=, this causes the current 
data to be adapted to IContainer before calling .get on it. There are 
currently adapters for dict, list, and tuple for this.
Thus,
def data_foo(context, data):
   return defer.succeed({'foo':1, 'bar':2})

span(data=data_foo)[span(data=directive('foo'))[str], 
span(data=directive('bar')[str]]

Should work as expected, and call data_foo *once*, and produce 
&quot;&lt;span&gt;&lt;span&gt;1&lt;/span&gt;&lt;span&gt;2&lt;/span&gt;&lt;/span&gt;&quot;.

Hope this helps,
James



</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="000211.html">[Twisted-web] new nevow know-how needs...;-)
</A></li>
	<LI> Next message: <A HREF="000215.html">[Twisted-web] Re: new nevow know-how needs...;-)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#214">[ date ]</a>
              <a href="thread.html#214">[ thread ]</a>
              <a href="subject.html#214">[ subject ]</a>
              <a href="author.html#214">[ author ]</a>
         </LI>
       </UL>
</body></html>
