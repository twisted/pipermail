<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] A problem with convertToData in nevow.accessors
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="000237.html">
   <LINK REL="Next"  HREF="000239.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] A problem with convertToData in nevow.accessors
   </H1>
    <B>Russell Duhon
    </B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com"
       TITLE="[Twisted-web] A problem with convertToData in nevow.accessors">twisted-web@twistedmatrix.com
       </A><BR>
    <I>Fri, 26 Mar 2004 09:16:52 -0600</I>
    <P><UL>
        <LI> Previous message: <A HREF="000237.html">[Twisted-web] A problem with convertToData in nevow.accessors
</A></li>
        <LI> Next message: <A HREF="000239.html">[Twisted-web] A problem with convertToData in nevow.accessors
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#238">[ date ]</a>
              <a href="thread.html#238">[ thread ]</a>
              <a href="subject.html#238">[ subject ]</a>
              <a href="author.html#238">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

I created a quick workaround by just checking if data is a list and if  
so returning it before the IGettable call.

Its a hack, but it works well enough for now as all my Deferred db  
calls for data will return lists.


On Mar 25, 2004, at 10:11 PM, Russell Duhon wrote:

&gt;<i> -----BEGIN PGP SIGNED MESSAGE-----
</I>&gt;<i> Hash: SHA1
</I>&gt;<i>
</I>&gt;<i> I'm starting work on an app and ran into an odd little problem, and  
</I>&gt;<i> while in general I'd love to hack around on nevow to figure out  
</I>&gt;<i> exactly where its arising I need to go to sleep now, and would like to  
</I>&gt;<i> be able to progress on my project come tomorrow.
</I>&gt;<i>
</I>&gt;<i> Basically, I've got a data function that returns a Deferred (from the  
</I>&gt;<i> adbapi dbpool's runQuery method)-- that seems to get handled just fine  
</I>&gt;<i> - -- which is used for a sequence rendering.  However, in the function  
</I>&gt;<i> convertToData in accessors.py, an error occurs:
</I>&gt;<i>
</I>&gt;<i> (nevow is just checked out from CVS, twisted is checked out from CVS a  
</I>&gt;<i> few days ago.  I did install Nevow in site-packages, but I don't think  
</I>&gt;<i> that would be causing this).
</I>&gt;<i>
</I>&gt;<i> 2004/03/25 21:57 CST [-] FAILURE ! [Failure instance: Traceback:  
</I>&gt;<i> exceptions.AttributeError, ListContainer instance has no attribute  
</I>&gt;<i> 'get'
</I>&gt;<i> 2004/03/25 21:57 CST [-]  
</I>&gt;<i> /System/Library/Frameworks/Python.framework/Versions/2.3/lib/ 
</I>&gt;<i> python2.3/site-packages/twisted/internet/defer.py:338:_runCallbacks
</I>&gt;<i> 2004/03/25 21:57 CST [-]  
</I>&gt;<i> /System/Library/Frameworks/Python.framework/Versions/2.3/lib/ 
</I>&gt;<i> python2.3/site-packages/nevow/accessors.py:15:convertToData
</I>&gt;<i>
</I>&gt;<i> After educating myself somewhat on interfaces, I changed the code to  
</I>&gt;<i> help me debug the issue:
</I>&gt;<i>
</I>&gt;<i> def convertToData(data, context):
</I>&gt;<i>     from twisted.python import log
</I>&gt;<i>     log.err('data: ' + str(data))
</I>&gt;<i>     log.err('data type: ' + str(type(data)))
</I>&gt;<i>     newdata = IGettable(data, persist=False, default=None)
</I>&gt;<i>     log.err('newdata: ' + str(newdata))
</I>&gt;<i>     if newdata is not None:
</I>&gt;<i>         newdata = newdata.get(context)
</I>&gt;<i>         if isinstance(newdata, Deferred):
</I>&gt;<i>             return newdata.addCallback(convertToData, context)
</I>&gt;<i>         else:
</I>&gt;<i>             return convertToData(newdata, context)
</I>&gt;<i>     else:
</I>&gt;<i>         return data
</I>&gt;<i>
</I>&gt;<i> (original function was:
</I>&gt;<i>
</I>&gt;<i> def convertToData(data, context):
</I>&gt;<i>     newdata = IGettable(data, persist=False, default=None)
</I>&gt;<i>     if newdata is not None:
</I>&gt;<i>         newdata = newdata.get(context)
</I>&gt;<i>         if isinstance(newdata, Deferred):
</I>&gt;<i>             return newdata.addCallback(convertToData, context)
</I>&gt;<i>         else:
</I>&gt;<i>             return convertToData(newdata, context)
</I>&gt;<i>     else:
</I>&gt;<i>         return data
</I>&gt;<i> )
</I>&gt;<i>
</I>&gt;<i> Well, that produced some semi-mystifying results:
</I>&gt;<i>
</I>&gt;<i> 2004/03/25 21:57 CST [-] &quot;data: [['samson and delilah', 'delilah and  
</I>&gt;<i> frank']]&quot;
</I>&gt;<i> 2004/03/25 21:57 CST [-] &quot;data type: &lt;type 'list'&gt;&quot;
</I>&gt;<i> 2004/03/25 21:57 CST [-] 'newdata: &lt;nevow.accessors.ListContainer  
</I>&gt;<i> instance at 0x111d968&gt;'
</I>&gt;<i> 2004/03/25 21:57 CST [-] FAILURE ! [Failure instance: Traceback:  
</I>&gt;<i> exceptions.AttributeError, ListContainer instance has no attribute  
</I>&gt;<i> 'get'
</I>&gt;<i> 2004/03/25 21:57 CST [-]  
</I>&gt;<i> /System/Library/Frameworks/Python.framework/Versions/2.3/lib/ 
</I>&gt;<i> python2.3/site-packages/twisted/internet/defer.py:338:_runCallbacks
</I>&gt;<i> 2004/03/25 21:57 CST [-]  
</I>&gt;<i> /System/Library/Frameworks/Python.framework/Versions/2.3/lib/ 
</I>&gt;<i> python2.3/site-packages/nevow/accessors.py:19:convertToData
</I>&gt;<i>
</I>&gt;<i> My guess is that IGettable is in this case supposed to return the None  
</I>&gt;<i> of the default argument, and thus the list itself be returned, but I'm  
</I>&gt;<i> not absolutely certain of that, and if that is what's supposed to  
</I>&gt;<i> happen, I'm in the dark as to why its not happening, and would need to  
</I>&gt;<i> peruse how Nevow handles interfaces a fair amount more, I think.
</I>&gt;<i> -----BEGIN PGP SIGNATURE-----
</I>&gt;<i> Version: GnuPG v1.2.4 (Darwin)
</I>&gt;<i>
</I>&gt;<i> iD8DBQFAY61qFZO4LxR6+NgRAnE5AJ0TrpTFHOqJ/jP2yjAiz8pbpSgg2gCfXYtz
</I>&gt;<i> uqLcFj09SklpstYAKdRNZh4=
</I>&gt;<i> =yIwf
</I>&gt;<i> -----END PGP SIGNATURE-----
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-web mailing list
</I>&gt;<i> <A HREF="mailto:Twisted-web@twistedmatrix.com">Twisted-web@twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web</A>
</I>-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.4 (Darwin)

iD8DBQFAZEllFZO4LxR6+NgRAg9PAJ9+BJKdiD3JoUDVWaxYXh6+tEidVQCeIzLj
d8YJo7erIGXP9nz70kgVLfU=
=5W1S
-----END PGP SIGNATURE-----



</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="000237.html">[Twisted-web] A problem with convertToData in nevow.accessors
</A></li>
	<LI> Next message: <A HREF="000239.html">[Twisted-web] A problem with convertToData in nevow.accessors
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#238">[ date ]</a>
              <a href="thread.html#238">[ thread ]</a>
              <a href="subject.html#238">[ subject ]</a>
              <a href="author.html#238">[ author ]</a>
         </LI>
       </UL>
</body></html>
