<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] Single-threaded WSGIResource
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Single-threaded%20WSGIResource&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   
   <LINK REL="Next"  HREF="004416.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] Single-threaded WSGIResource</H1>
    <B>Cristiano Paris</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Single-threaded%20WSGIResource&In-Reply-To="
       TITLE="[Twisted-web] Single-threaded WSGIResource">cristiano.paris at gmail.com
       </A><BR>
    <I>Tue Feb  2 16:58:45 EST 2010</I>
    <P><UL>
        
        <LI>Next message: <A HREF="004416.html">[Twisted-web] Single-threaded WSGIResource
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4415">[ date ]</a>
              <a href="thread.html#4415">[ thread ]</a>
              <a href="subject.html#4415">[ subject ]</a>
              <a href="author.html#4415">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

I'm playing with Django (1.1.1) under Twisted Web (9.0.0) through the
WSGI interface. When using my web app under the test server with
sqlite3 as the DBMS, I'm having troubles since in-memory sqlite3 DBs
can't be shared among threads.

The solution I came up with was to run the WSGIResource in the main
thread. In order to do so, I subclassed the WSGIResource as follows:

-----
from twisted.web.wsgi import WSGIResource,_WSGIResponse
from twisted.web.server import NOT_DONE_YET

class MainThreadWSGIResource(WSGIResource):
  def __init__(self,reactor,app):
    WSGIResource.__init__(self,reactor,None,app)

  def render(self,request):
    response = _WSGIResponse(
        self._reactor, self._threadpool, self._application, request)
    response.run()
    return NOT_DONE_YET
-----

Basically, I replaced &quot;response.start()&quot; in the original render()
method with the &quot;response.run()&quot;, bypassing the callInThread() call in
the _WSGIResponse's start() method. Even if it works, I hate importing
_WSGIResponse and replicating the code of the original WSGIResource's
render() code. Anyhow, I can't think of a better/more elegant solution
with the current implementation.

I'll appreciate any comment on this.

Thank you.

Cristiano

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	
	<LI>Next message: <A HREF="004416.html">[Twisted-web] Single-threaded WSGIResource
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4415">[ date ]</a>
              <a href="thread.html#4415">[ thread ]</a>
              <a href="subject.html#4415">[ subject ]</a>
              <a href="author.html#4415">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
