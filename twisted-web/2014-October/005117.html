<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] Nginx vs Twisted Web
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-web%5D%20Nginx%20vs%20Twisted%20Web&In-Reply-To=%3CFDCBC7F5-90C7-470D-A06C-92984C1F7B6B%40twistedmatrix.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005116.html">
   <LINK REL="Next"  HREF="005120.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] Nginx vs Twisted Web</H1>
    <B>Glyph</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-web%5D%20Nginx%20vs%20Twisted%20Web&In-Reply-To=%3CFDCBC7F5-90C7-470D-A06C-92984C1F7B6B%40twistedmatrix.com%3E"
       TITLE="[Twisted-web] Nginx vs Twisted Web">glyph at twistedmatrix.com
       </A><BR>
    <I>Tue Oct  7 22:53:53 MDT 2014</I>
    <P><UL>
        <LI>Previous message: <A HREF="005116.html">[Twisted-web] Nginx vs Twisted Web
</A></li>
        <LI>Next message: <A HREF="005120.html">[Twisted-web] Auto-Re:  Boston Area Twisted Sprint
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5117">[ date ]</a>
              <a href="thread.html#5117">[ thread ]</a>
              <a href="subject.html#5117">[ subject ]</a>
              <a href="author.html#5117">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On Oct 7, 2014, at 3:21 PM, Carl D'Halluin &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">carl at amplidata.com</A>&gt; wrote:

&gt;<i> 
</I>&gt;&gt;<i> Another problem is that Twisted doesn't yet support SSL on adopted sockets.
</I>&gt;<i> 
</I>&gt;<i> I did this by hand:
</I>&gt;<i> 
</I>&gt;<i> # Suppose your create/bind/list your listen_socket, and
</I>&gt;<i> # its file descriptor is listen_socket_fd
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> site = server.Site(MyHttpsSite())
</I>&gt;<i> 
</I>&gt;<i> cert = '/path/to/my/cert'
</I>&gt;<i> key = '/path/to/my/key'
</I>&gt;<i> 
</I>&gt;<i> ctx = DefaultOpenSSLContextFactory(key, cert)
</I>&gt;<i> tlsFactory = tls.TLSMemoryBIOFactory(ctx, False, site)
</I>&gt;<i> p = tcp.Port._fromListeningDescriptor(reactor,
</I>&gt;<i>                                             listen_socket_fd,
</I>&gt;<i>                                             socket.AF_INET,
</I>&gt;<i>                                             tlsFactory)
</I>&gt;<i> p._type = 'TLS'
</I>&gt;<i> p.startListening()
</I>&gt;<i> 
</I>&gt;<i> os.close(listen_socket_fd)
</I>&gt;<i> reactor.run()
</I>
There is work underway for addressing this particular use-case (endpoint composition) via string endpoints:

&lt;<A HREF="https://twistedmatrix.com/trac/ticket/5642">https://twistedmatrix.com/trac/ticket/5642</A>&gt;

But even today you don't have to touch unsupported private APIs to do this.

As per &lt;<A HREF="https://twistedmatrix.com/trac/wiki/CompatibilityPolicy">https://twistedmatrix.com/trac/wiki/CompatibilityPolicy</A>&gt; we really like to discourage people from touching private (i.e. underscore-prefixed or imported-from-another-module) API, because it may well break in the next release and you'll have no recourse.

(Plus, you should really be using CertificateOptions, not DefaultOpenSSLContextFactory, either via PrivateCertificate(...).options() or directly constructed.)

from twisted.python.filepath import FilePath
site = server.Site(MyHttpsSite())

cert = FilePath('/path/to/my/cert').getContent()
key = FilePath('/path/to/my/key').getContent()

from twisted.internet.ssl import PrivateCertificate
certificateWithKey = PrivateCertificate.loadPEM(b&quot;\n&quot;.join([cert, key]))

tlsFactory = tls.TLSMemoryBIOFactory(certificateWithKey.options(), False, site)

import socket
from twisted.internet import reactor
reactor.adoptStreamPort(listen_socket_fd, socket.AF_INET, tlsFactory)
import os
os.close(listen_socket_fd)
reactor.run()

This code hasn't been tested, but no underscores should be necessary!

-glyph

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://twistedmatrix.com/pipermail/twisted-web/attachments/20141007/eaf9df04/attachment.html">http://twistedmatrix.com/pipermail/twisted-web/attachments/20141007/eaf9df04/attachment.html</A>&gt;
</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="005116.html">[Twisted-web] Nginx vs Twisted Web
</A></li>
	<LI>Next message: <A HREF="005120.html">[Twisted-web] Auto-Re:  Boston Area Twisted Sprint
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5117">[ date ]</a>
              <a href="thread.html#5117">[ thread ]</a>
              <a href="subject.html#5117">[ subject ]</a>
              <a href="author.html#5117">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
