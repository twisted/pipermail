<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] making streams optional in web2
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20making%20streams%20optional%20in%20web2&In-Reply-To=6B84E2B5-0662-4D66-80B6-64AA1F1D116A%40fuhm.net">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002479.html">
   <LINK REL="Next"  HREF="002483.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] making streams optional in web2</H1>
    <B>Glyph Lefkowitz</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20making%20streams%20optional%20in%20web2&In-Reply-To=6B84E2B5-0662-4D66-80B6-64AA1F1D116A%40fuhm.net"
       TITLE="[Twisted-web] making streams optional in web2">glyph at divmod.com
       </A><BR>
    <I>Thu Feb  9 12:20:05 MST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="002479.html">[Twisted-web] making streams optional in web2
</A></li>
        <LI>Next message: <A HREF="002483.html">[Twisted-web] making streams optional in web2
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2482">[ date ]</a>
              <a href="thread.html#2482">[ thread ]</a>
              <a href="subject.html#2482">[ subject ]</a>
              <a href="author.html#2482">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Thu, 2006-02-09 at 13:40 -0500, James Y Knight wrote:

&gt;<i> Benchmarking is a dangerous activity.
</I>
Truly.

&gt;<i> I only get 131req/sec from ab on my mac from the following IResource  
</I>&gt;<i> resource, vs 114 from the wsgi resource, vs 706 from apache. Vs 74  
</I>&gt;<i> from cherrypy's tut01_helloworld.py.
</I>
This is encouraging, at least with respect to the relative speed of
CherryPy.  I'd be quite happy to be wrong about needing API changes to
improve performance; these should be independent considerations.

&gt;<i> So, shrug, I'm sure my benchmark  
</I>&gt;<i> sucks, and must be measuring something completely different than  
</I>&gt;<i> yours, given the wide variance in relative numbers. Anyhow, I'm happy  
</I>&gt;<i> that someone is benchmarking web2, because I haven't done so any time  
</I>&gt;<i> recently, but what you write above comes quite close to random flaming.
</I>
I was hoping JP would publish his actual results before I wrote what I
did, but I didn't want the ideas to get too stale.  Maybe this will
prompt him to - I hope said results are not too different from what I
remember. 

At any rate, don't take it to heart, I'm glad just to get some
discussion started about this and have everybody following it on the
list publish their own trivial benchmarks to see if we can achieve some
consensus as to how much load web2 can actually handle these days.
Perhaps I should have been more direct in the first email, though.  Full
disclosure: I never liked streams as an API, and I have practically been
looking for reasons to complain about them.  Look for more soon, this
benchmark was only the first ;-).

Also, performance and aesthetic considerations aside, if a thing says it
implements IConsumer, it should *actually* implement IConsumer.  Is the
mistake in the declaration or the implementation here?  I hope it's the
implementation, because IConsumer is the API I'd prefer to use, streams
or no.  Or, is there some funny magic behind the scenes where a Response
actually does provide IConsumer somewhere?  Even if so, a
directlyProvides makes more sense for funny magic than an implements().

&gt;<i> Here's all the construction of Deferreds from the native response.
</I>
Hmm.  It is quite possible that the profile was not accurate - there
were some odd things about it, although it's also possible that the WSGI
test in question was doing something pathological that yours was not,
like generating tons of tiny little write()s.

&gt;<i> Only one is from the streams module. Looks like some of the others  
</I>&gt;<i> could be removed without changing any APIs, if that actually helps  
</I>&gt;<i> things. Going through the WSGI interface adds one additional deferred  
</I>&gt;<i> construction in addition to these 4.
</I>
Deferreds do have an embarrassingly high overhead.  The next step here
(in figuring out if those extra deferreds should be eliminated) is
probably for me to construct some more meaningful benchmark to measure
the performance impact in req/sec of additional deferreds in the
response pipeline.


</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002479.html">[Twisted-web] making streams optional in web2
</A></li>
	<LI>Next message: <A HREF="002483.html">[Twisted-web] making streams optional in web2
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2482">[ date ]</a>
              <a href="thread.html#2482">[ thread ]</a>
              <a href="subject.html#2482">[ subject ]</a>
              <a href="author.html#2482">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
