<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] domish.elementStream()
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20domish.elementStream%28%29&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001597.html">
   <LINK REL="Next"  HREF="001571.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] domish.elementStream()</H1>
    <B>Ross Jekel</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20domish.elementStream%28%29&In-Reply-To="
       TITLE="[Twisted-web] domish.elementStream()">ross at sourcelabs.com
       </A><BR>
    <I>Tue Jun 21 15:44:18 MDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="001597.html">[Twisted-web] Defers, the reactor,	and idiomatic/proper usage
	-- new user needs some advice?
</A></li>
        <LI>Next message: <A HREF="001571.html">[Twisted-web] Nevow, formless: complex widgets
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1570">[ date ]</a>
              <a href="thread.html#1570">[ thread ]</a>
              <a href="subject.html#1570">[ subject ]</a>
              <a href="author.html#1570">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

Neither or the two possible element stream classes when parsing
correctly hook the root element to its children. This is pretty easy to
see why from the code (below) but thought I would check to see if this
is on purpose or something. What I wanted to do was just save off the
root element passed to DocumentStartEvent from either class and be able
to do XPathQueries on it. Since the root element returned doesn't have
any children though, it fails.

The code for both classes is similar to this:

        # Construct the new element
        e = Element(qname, self.defaultNsStack[-1], attrs)

        # Document already started
        if self.documentStarted == 1:
            if self.currElem != None:
                self.currElem.children.append(e)
                e.parent = self.currElem
            self.currElem = e

        # New document
        else:
            self.documentStarted = 1
            self.DocumentStartEvent(e)

Since self.currElem isn't set to e for the first element, e never gets
it's children list filled in.

Below is a sample program that shows what I'm talking about. It prints
&quot;0 []&quot; when it should print &quot;1 [&lt;&lt;twisted.xish.domish.Element
object...&gt;, ...]&quot;.

from twisted.xish import domish
from twisted.xish import xpath

# Taken from twisted/xish/test/test_xpath.py
xmlBlob = &quot;&quot;&quot;
&lt;foo xmlns='testns' attrib1='value1' attrib3=&quot;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">user at host</A>/resource&quot;&gt;
     somecontent
     &lt;bar&gt;
        &lt;foo&gt;
         &lt;gar&gt;DEF&lt;/gar&gt;
        &lt;/foo&gt;
     &lt;/bar&gt;
     somemorecontent
     &lt;bar attrib2=&quot;value2&quot;&gt;
        &lt;bar&gt;
          &lt;foo/&gt;
          &lt;gar&gt;ABC&lt;/gar&gt;
        &lt;/bar&gt;
     &lt;/bar&gt;
 &lt;/foo&gt;
&quot;&quot;&quot;

p = domish.SuxElementStream()
elem = list()
p.DocumentStartEvent = lambda e: elem.append(e)
p.ElementEvent = lambda e: None
p.DocumentEndEvent = lambda: None
p.parse(xmlBlob)
print xpath.matches(&quot;/foo/bar&quot;, elem[0]), elem[0].children

Thanks,
Ross


</PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001597.html">[Twisted-web] Defers, the reactor,	and idiomatic/proper usage
	-- new user needs some advice?
</A></li>
	<LI>Next message: <A HREF="001571.html">[Twisted-web] Nevow, formless: complex widgets
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1570">[ date ]</a>
              <a href="thread.html#1570">[ thread ]</a>
              <a href="subject.html#1570">[ subject ]</a>
              <a href="author.html#1570">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
