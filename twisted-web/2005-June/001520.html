<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] Livepage, ClientHandle and context
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Livepage%2C%20ClientHandle%20and%20context&In-Reply-To=28d42ea7050601164640d423da%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001519.html">
   <LINK REL="Next"  HREF="001521.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] Livepage, ClientHandle and context</H1>
    <B>Donovan Preston</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Livepage%2C%20ClientHandle%20and%20context&In-Reply-To=28d42ea7050601164640d423da%40mail.gmail.com"
       TITLE="[Twisted-web] Livepage, ClientHandle and context">dp at ulaluma.com
       </A><BR>
    <I>Wed Jun  1 20:25:42 MDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="001519.html">[Twisted-web] Livepage, ClientHandle and context
</A></li>
        <LI>Next message: <A HREF="001521.html">[Twisted-web] Livepage, ClientHandle and context
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1520">[ date ]</a>
              <a href="thread.html#1520">[ thread ]</a>
              <a href="subject.html#1520">[ subject ]</a>
              <a href="author.html#1520">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
Thank you very much for your feedback. Please, anyone else on this  
list who is using or attempting to use LivePage, let me know what you  
are doing with it or plan on doing with it. I want to take it from  
long-running experiment to solid, deployable code before the next  
release, and need to know how much API stability/backwards  
compatibility I should provide. I also need to know how people want  
to use LivePage, and if it has any usability shortcomings with this  
new design which I describe below. If there are any, I'd like to fix  
them before the next release.

On Jun 1, 2005, at 4:46 PM, Alexey Shamrin wrote:

&gt;<i> On 5/31/05, Donovan Preston &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">dp at ulaluma.com</A>&gt; wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> In this branch, input handlers can also return javascript which will
</I>&gt;&gt;<i> be executed as the response to the input event.
</I>&gt;<i>
</I>&gt;<i> What do you mean? I don't understand...
</I>&gt;<i> Are you talking about javascript that will be executed without
</I>&gt;<i> round-trip to server?
</I>
When a client-side event generates a trip to the server over the  
input conduit, the server-side handler method which is invoked can  
now return javascript stan. This return result is written as the  
response to the HTTP request which dispatched the event to the  
server, and the browser evals it. Previously, the server would  
arrange for the handler method to be called in the next reactor  
iteration and close the input HTTP request, writing nothing to it.  
The handler method would then call methods on the client handle which  
would generate javascript and buffer it or write it directly to the  
output conduit.

So yes, one (output conduit) round trip is eliminated, and it becomes  
easier to support normal AJaX style events (where the browser is the  
only thing initiating requests, and the server does no pushing),  
which I call input only mode.

&gt;&gt;<i> I encourage anyone who is interested in livepage to take a look at
</I>&gt;&gt;<i> this branch to see where it is going. Take a look at the examples to
</I>&gt;&gt;<i> see what has changed, read the code, and experiment with it. Ask
</I>&gt;&gt;<i> questions if you have any. I'll be trying to merge this branch into
</I>&gt;&gt;<i> the mainline (after adding some backwards compatibility) in the next
</I>&gt;&gt;<i> week.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I'll also be adding some LivePage docs. I think the API will settle
</I>&gt;&gt;<i> down after this last round of changes.
</I>&gt;&gt;<i>
</I>&gt;<i>
</I>&gt;<i> 1. nevow_insertNode from liveglue.js (and livepage.insert) is broken.
</I>&gt;<i> And (as far as I can see) it is not used anywhere in Nevow (including
</I>&gt;<i> examples). Remove?
</I>
I think I might fix it rather than removing it. I'll also write a  
test for it, since livetest can now reliably test livepage apps.

&gt;<i> 2. I think you should have &quot;nevow_&quot; prefix for all things in  
</I>&gt;<i> liveglue.js.
</I>
I agree, except I think I want the new &quot;server&quot; object to keep that  
name. It will be much easier for people to understand and use  
livepage if they know that calling server.handle('foo') in javascript  
invokes the handle_foo method on the server. Are there other things  
in there that aren't prefixed with nevow_?

&gt;<i> 3. What is the purpose of ClientHandle.transient?
</I>
ClientHandle.transient and LivePage.locateHandler (whose default  
implementation looks for handle_* methods) are the new, easier to  
understand and use replacements for the handler decorator.  
Previously, there was a problem with handler because it registered  
the callable you gave it in a dictionary which lived for as long as  
the LivePage instance it was associated with. This means if you had a  
really, really long lived LivePage (which LivePage is designed to  
allow) you would leak more and more closures that the client can't  
ever call again (because you replaced the client-side dom that  
referenced those server-side closures with something else)

Now, if you provide a handle_foo method, the client can always call  
server.handle('foo') as many times as it wants. However, it is still  
useful to register closures on the server and give the client the  
capability to call it. To avoid the aforementioned garbage problem,  
transient allows you to do this, but only allows the client to call  
it once, then pops the registration.

This avoids the garbage problem well; if the client closes the  
browser, LivePage guarantees that the ClientHandle will die no more  
than 90 seconds later, taking the transient closure registration  
dictionary with it. If you are, for example, putting an &quot;ok/cancel&quot;  
dialog on the user's screen, you can register a single transient  
which gets called by either the ok or cancel button, ensuring that  
the transient will be popped when the client no longer has the  
capability to call it (because the UI has gone away, by the user  
clicking either ok or cancel)

&gt;<i> 4. Are these two equivalent?
</I>&gt;<i> onsubmit=livepage.server.handle(livepage.js.onSubmit, getValue 
</I>&gt;<i> ('inputline'))
</I>&gt;<i> onsubmit=livepage.server.handle('onSubmit', getValue('inputline'))
</I>
No, because the client-side javascript &quot;handle&quot; function takes a  
string. The first would render down to:

server.handle(onSubmit, getValue('inputline'))

The second would render down to:

server.handle('onSubmit', getValue('inputLine'))

The first would barf because the global name onSubmit doesn't exist.

The livepage.js object is like a stan.Tag for javascript; it creates  
literal javascript. For example:

livepage.js.foo -&gt; foo
livepage.js.foo('1') -&gt; foo('1')
livepage.js('any string') -&gt; any string
livepage.js['1'] -&gt; ['1']
livepage.js.foo['1'] -&gt; foo['1']

There are a bunch of other js objects in the module now, such as  
window, document, this, server, set, append, alert, etc. They are  
really convenient for making your python code much shorter.

I have an incredible LivePage app I wrote recently I am calling  
&quot;Pavel&quot;. I will be cleaning it up soon and I will create a new open  
source project for it (rather than including it as a nevow example).  
I think it really showcases the power of LivePage and I'm excited to  
show it to people, but for now it is somewhat of a secret :-)

&gt;<i> P.S. At this time I have only read the code and checked new
</I>&gt;<i> examples... I will try to experiment with it soon. But I must say your
</I>&gt;<i> javascript &quot;constructor&quot; looks interesting (livepage.assign,
</I>&gt;<i> livepage.var etc.)
</I>
assign and var are two experiments to get around the fact that python  
has no assignment overloading. Here are examples of usage:

var(js.x, 5) -&gt; var x = 5
assign(js.x, 10) -&gt; x = 10

One other thing while I am discussing stan for javascript. This is a  
pain once you start using it, but I don't think there is any way  
around it other than education. You need to terminate your  
statements, since the javascript flatteners have no idea where it is  
appropriate to put newlines in javascript. So if you were sending the  
following:

client.send([
     livepage.alert('hello'),
     livepage.set('name', 'Donovan Preston')])

You would need to terminate each statement, otherwise the javascript  
won't be correct. The above example would render as:

alert('hello')set('name', 'Donovan Preston')

Right now, you need to do:

client.send([
     livepage.alert('hello'), livepage.eol,
     livepage.set('name', 'Donovan Preston')])

Which will render down to:

alert('hello')
set('name', 'Donovan Preston')

It occurs to me that it may be possible for Nevow to just infer that  
a newline is required between each element of a list or a tuple while  
in JavascriptContext. I will have to experiment and see whether this  
causes any inadvertent problems. If not, the requirement to manually  
insert newline characters will go away (horray!)

Donovan

-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://twistedmatrix.com/pipermail/twisted-web/attachments/20050601/501e0bb3/attachment.htm">http://twistedmatrix.com/pipermail/twisted-web/attachments/20050601/501e0bb3/attachment.htm</A>
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001519.html">[Twisted-web] Livepage, ClientHandle and context
</A></li>
	<LI>Next message: <A HREF="001521.html">[Twisted-web] Livepage, ClientHandle and context
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1520">[ date ]</a>
              <a href="thread.html#1520">[ thread ]</a>
              <a href="subject.html#1520">[ subject ]</a>
              <a href="author.html#1520">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
