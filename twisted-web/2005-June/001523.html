<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] Livepage, ClientHandle and context
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Livepage%2C%20ClientHandle%20and%20context&In-Reply-To=0BA207CD-3ACA-4F49-9D03-B7B010582E82%40ulaluma.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001522.html">
   <LINK REL="Next"  HREF="001524.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] Livepage, ClientHandle and context</H1>
    <B>Alexey Shamrin</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Livepage%2C%20ClientHandle%20and%20context&In-Reply-To=0BA207CD-3ACA-4F49-9D03-B7B010582E82%40ulaluma.com"
       TITLE="[Twisted-web] Livepage, ClientHandle and context">shamrin at gmail.com
       </A><BR>
    <I>Mon Jun  6 10:24:51 MDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="001522.html">[Twisted-web] Livepage, ClientHandle and context
</A></li>
        <LI>Next message: <A HREF="001524.html">[Twisted-web] problem with livepage-completion-notification-3
	branche
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1523">[ date ]</a>
              <a href="thread.html#1523">[ thread ]</a>
              <a href="subject.html#1523">[ subject ]</a>
              <a href="author.html#1523">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello!

Thank you for good explanations! As far as I can see you have already
commited good docstrings and backward-compatibility code into your
branch (r1545). It looks good!

On 6/2/05, Donovan Preston &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">dp at ulaluma.com</A>&gt; wrote:
&gt;<i> I also need to know how people want to use LivePage, 
</I>&gt;<i> and if it has any usability shortcomings with this new 
</I>&gt;<i> design which I describe below.
</I>
As you ask to describe how people use LivePage, here is my small example.

In a smaill project I am doing I use LivePage as follows (simplified
extract from the working code -- I haven't tested it...):

# example.py
from nevow import loaders, livepage, rend, tags as T

def get_teachers_list():
     # some code that returns the list of teachers goes here
     pass

class Editor(rend.Page):
    &quot;&quot;&quot;Base class providing template for all pages&quot;&quot;&quot;
    addSlash=True

    docFactory = loaders.stan(T.html[T.body[T.directive('main_area')]])

class TeachersEditor(Editor,livepage.LivePage):
    &quot;&quot;&quot;This page is exposed to the web&quot;&quot;&quot;

    def render_main_area(self, ctx, data):
        return livepage.glue, TeachersList(get_teachers_list())

class TeachersList(rend.Fragment):
    docFactory = loaders.stan([
        T.ul(render=rend.sequence, id='teachers_list')[
                T.li(pattern='item', render=T.directive('teacher_item'))[
                    T.a(render=T.directive('teacher_link'), href='#')[
                        T.slot(name='teacher_name')]]],
        T.div(id='teacher_details')])

    def render_teacher_item(self, ctx, teacher):
        return ctx.tag(id='teacher_%d' % teacher.id)

    def render_teacher_link(self, ctx, teacher):
        @livepage.handler
        def show_teacher(client):
            client.set('teacher_details',TeacherDetails(teacher))

        ctx.fillSlots('teacher_name', teacher.name)
        return ctx.tag(onclick=show_teacher, id='teacher_link_%d' % teacher.id)

class TeacherDetails(rend.Fragment):
      # this rend.Fragment also has @livepage.handler-ed closures
      pass

# end of example.py

As you can see, I use LivePage from inside rend.Fragment's subclasses
(TeacherDetails and TeachersList). But only the main rend.Page
subclass (TeacherEditor) is a subclass of livepage.LivePage. I also
use livepage.handler's as closures (TeachersList.render_teacher_link).

There were two problems with your branch and my code:

1. Backward compatible code didn't work for me (I don't remember what
was the reason. If you need details, I can make a better, working,
example.).

2. I tried to use new LivePage api, but I couldn't figure out how to
translate my code using it. For example, your ClientHandler.transient
seems to provide the ability to make browser-callable functions as
closures, but I am confused about the limitation of one-time calling.
Is it really necessary for a solution of garbage problem you mention?

I also can't see a way to use handler_* methods, because this methods
must be inside a rend.Fragment subclass in my case.

How can use the new api in my application?

&gt;<i> 2. I think you should have &quot;nevow_&quot; prefix for all things in liveglue.js.
</I>&gt;<i> I agree, except I think I want the new &quot;server&quot; object to keep that name. It
</I>&gt;<i> will be much easier for people to understand and use livepage if they know
</I>&gt;<i> that calling server.handle('foo') in javascript invokes the handle_foo
</I>&gt;<i> method on the server. Are there other things in there that aren't prefixed
</I>&gt;<i> with nevow_?
</I>
Lot's of them. Just look inside liveglue.js... createRequest, connect,
auto_load, listener etc.

Or you can you preuso object-oriented approach like in Prototype
(<A HREF="http://prototype.conio.net/">http://prototype.conio.net/</A>) or dojo.

&gt;<i> I have an incredible LivePage app I wrote recently I am calling &quot;Pavel&quot;. I
</I>&gt;<i> will be cleaning it up soon and I will create a new open source project for
</I>&gt;<i> it (rather than including it as a nevow example). I think it really
</I>&gt;<i> showcases the power of LivePage and I'm excited to show it to people, but
</I>&gt;<i> for now it is somewhat of a secret :-)
</I>
I am looking forward for that!

&gt;<i> So if you were sending the following:
</I>&gt;<i> 
</I>&gt;<i> client.send([
</I>&gt;<i> &#65533;&#65533;&#65533; livepage.alert('hello'),
</I>&gt;<i> &#65533;&#65533;&#65533; livepage.set('name', 'Donovan Preston')])
</I>&gt;<i> 
</I>&gt;<i> You would need to terminate each statement, otherwise the javascript won't
</I>&gt;<i> be correct. The above example would render as:
</I>&gt;<i> 
</I>&gt;<i> alert('hello')set('name', 'Donovan Preston')
</I>&gt;<i> 
</I>&gt;<i> Right now, you need to do:
</I>&gt;<i> 
</I>&gt;<i> client.send([
</I>&gt;<i> &#65533;&#65533;&#65533; livepage.alert('hello'), livepage.eol,
</I>&gt;<i> &#65533;&#65533;&#65533; livepage.set('name', 'Donovan Preston')])
</I>&gt;<i> 
</I>&gt;<i> Which will render down to:
</I>&gt;<i> 
</I>&gt;<i> alert('hello')
</I>&gt;<i> set('name', 'Donovan Preston')
</I>&gt;<i> 
</I>&gt;<i> It occurs to me that it may be possible for Nevow to just infer that a
</I>&gt;<i> newline is required between each element of a list or a tuple while in
</I>&gt;<i> JavascriptContext. I will have to experiment and see whether this causes
</I>&gt;<i> any&#65533;inadvertent problems. If not, the requirement to manually insert newline
</I>&gt;<i> characters will go away (horray!)
</I>
I am not sure, but may be something like livepage.do would do the job
a little better?

client.send(livepage.do[
    livepage.alert('hello'),
    livepage.set('name', 'Donovan Preston')])

(or even livepage.progn...)

-- 
Alexey
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001522.html">[Twisted-web] Livepage, ClientHandle and context
</A></li>
	<LI>Next message: <A HREF="001524.html">[Twisted-web] problem with livepage-completion-notification-3
	branche
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1523">[ date ]</a>
              <a href="thread.html#1523">[ thread ]</a>
              <a href="subject.html#1523">[ subject ]</a>
              <a href="author.html#1523">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
