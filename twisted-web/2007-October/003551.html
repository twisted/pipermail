<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] XMLRPC response encoding
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20XMLRPC%20response%20encoding&In-Reply-To=20071022115549.8162.902805451.divmod.quotient.26351%40ohm">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003550.html">
   <LINK REL="Next"  HREF="003552.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] XMLRPC response encoding</H1>
    <B>Jean-Paul Calderone</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20XMLRPC%20response%20encoding&In-Reply-To=20071022115549.8162.902805451.divmod.quotient.26351%40ohm"
       TITLE="[Twisted-web] XMLRPC response encoding">exarkun at divmod.com
       </A><BR>
    <I>Mon Oct 22 08:10:32 EDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="003550.html">[Twisted-web] XMLRPC response encoding
</A></li>
        <LI>Next message: <A HREF="003552.html">[Twisted-web] installed twisted. twisted.web missing?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3551">[ date ]</a>
              <a href="thread.html#3551">[ thread ]</a>
              <a href="subject.html#3551">[ subject ]</a>
              <a href="author.html#3551">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Mon, 22 Oct 2007 07:55:49 -0400, Jean-Paul Calderone &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">exarkun at divmod.com</A>&gt; wrote:
&gt;<i> [snip]
</I>&gt;&gt;<i>How can I solve the encoding problem in the XMLRPC server response?
</I>&gt;<i>
</I>&gt;<i>Help resolve #1909.  The patch attached to the ticket is at least missing
</I>&gt;<i>unit tests for the new functionality it provides.  If you can provide this,
</I>&gt;<i>then we might be able to add the feature and resolve the ticket
</I>
Actually, this is wrong, please disregard it. :)

#1909 is misguided and the attached patch is incorrect.  Specifying the
encoding parameter to xmlrpclib.dumps() doesn't do anything to solve the
problem here.

You either need to specify the encoding in the content-type header of the
response or you need to use UTF-8 (the default encoding for XML).  Of these,
you can already do the latter without changing anything in Twisted, since
xmlrpclib will emit UTF-8 if you pass it unicode instead of already encoded
strings.

So the solution to your problem is to return unicode in your result, instead
of already encoded strings.  These will be encoded to UTF-8, which will be
decoded properly by the client.

Compare:

  &gt;&gt;&gt; from xml.dom.minidom import parseString
  &gt;&gt;&gt; from xmlrpclib import dumps
  &gt;&gt;&gt; parseString(dumps((u'f&#242;&#242;',)))
  &lt;xml.dom.minidom.Document instance at 0xb7c0080c&gt;

and

  &gt;&gt;&gt; parseString(dumps((u'f&#242;&#242;'.encode('latin-1'),), encoding='latin-1'))
  Traceback (most recent call last):
    File &quot;&lt;stdin&gt;&quot;, line 1, in ?
    File &quot;/home/exarkun/.local/lib/python2.4/site-packages/_xmlplus/dom/minidom.py&quot;, line 1925, in parseString
      return expatbuilder.parseString(string)
    File &quot;/home/exarkun/.local/lib/python2.4/site-packages/_xmlplus/dom/expatbuilder.py&quot;, line 942, in parseString
      return builder.parseString(string)
    File &quot;/home/exarkun/.local/lib/python2.4/site-packages/_xmlplus/dom/expatbuilder.py&quot;, line 223, in parseString
      parser.Parse(string, True)
xml.parsers.expat.ExpatError: not well-formed (invalid token): line 3, column 16

Jean-Paul

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003550.html">[Twisted-web] XMLRPC response encoding
</A></li>
	<LI>Next message: <A HREF="003552.html">[Twisted-web] installed twisted. twisted.web missing?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3551">[ date ]</a>
              <a href="thread.html#3551">[ thread ]</a>
              <a href="subject.html#3551">[ subject ]</a>
              <a href="author.html#3551">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
