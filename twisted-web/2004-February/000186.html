<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] LiveEvil output buffer patch
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com">
   <META NAME="robots" CONTENT="index,nofollow">
   
   <LINK REL="Previous"  HREF="000184.html">
   <LINK REL="Next"  HREF="000189.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] LiveEvil output buffer patch
   </H1>
    <B>Justin Johnson
    </B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com"
       TITLE="[Twisted-web] LiveEvil output buffer patch">twisted-web@twistedmatrix.com
       </A><BR>
    <I>Tue, 17 Feb 2004 13:26:21 -0600</I>
    <P><UL>
        <LI> Previous message: <A HREF="000184.html">[Twisted-web] twisted.internet.error.CannotListenError
</A></li>
        <LI> Next message: <A HREF="000189.html">[Twisted-web] fcgi.py
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#186">[ date ]</a>
              <a href="thread.html#186">[ thread ]</a>
              <a href="subject.html#186">[ subject ]</a>
              <a href="author.html#186">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Here's a patch to add script buffering to liveevil.py.  One additional
change is needed, but I'm not sure where to put it.  self.output needs to
be reset to None when the connection is closed.  Currently I'm getting
around this by using liveevil as the mind and setting mind.output = None
in my render_ method where I know I can reset it before using liveevil
again.  Anyone have any ideas for a better place to reset this?


Index: liveevil.py
===================================================================
RCS file: /cvs/Quotient/nevow/liveevil.py,v
retrieving revision 1.2
diff -u -r1.2 liveevil.py
--- liveevil.py 26 Jan 2004 18:30:12 -0000      1.2
+++ liveevil.py 17 Feb 2004 19:19:41 -0000
@@ -38,11 +38,16 @@
         # TODO set up an event hub
         self.events = events.EventNotification()
         self.hookupNotifications = []
+        self.outputBuffer = []

     def hookupOutput(self, output, finisher = None):
         #print &quot;output hooked up.&quot;
         self.output = output
         self.finisher = finisher
+        for buf in self.outputBuffer:
+            output(buf)
+            #print &quot;Sent buffered item: &quot;, buf
+        self.outputBuffer = []
         for notify in self.hookupNotifications:
             notify(self)

@@ -51,9 +56,11 @@

     def sendScript(self, script):
         if self.output:
+            #print &quot;output sent!&quot;, script
             self.output(script)
         else:
-            print &quot;output ignored!&quot;, script
+            self.outputBuffer.append(script)
+            #print &quot;output buffered!&quot;, script

     def handleInput(self, identifier, *args):
         #self.sendScript(input)


</PRE>
<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI> Previous message: <A HREF="000184.html">[Twisted-web] twisted.internet.error.CannotListenError
</A></li>
	<LI> Next message: <A HREF="000189.html">[Twisted-web] fcgi.py
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#186">[ date ]</a>
              <a href="thread.html#186">[ thread ]</a>
              <a href="subject.html#186">[ subject ]</a>
              <a href="author.html#186">[ author ]</a>
         </LI>
       </UL>
</body></html>
