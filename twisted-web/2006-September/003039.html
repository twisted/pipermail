<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] fragments with child lookup
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20fragments%20with%20child%20lookup&In-Reply-To=4517DE67.70008%40bluegap.ch">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003038.html">
   <LINK REL="Next"  HREF="003041.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] fragments with child lookup</H1>
    <B>Valentino Volonghi aka Dialtone</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20fragments%20with%20child%20lookup&In-Reply-To=4517DE67.70008%40bluegap.ch"
       TITLE="[Twisted-web] fragments with child lookup">dialtone at divmod.com
       </A><BR>
    <I>Mon Sep 25 10:38:14 CDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="003038.html">[Twisted-web] fragments with child lookup
</A></li>
        <LI>Next message: <A HREF="003041.html">[Twisted-web] fragments with child lookup
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3039">[ date ]</a>
              <a href="thread.html#3039">[ thread ]</a>
              <a href="subject.html#3039">[ subject ]</a>
              <a href="author.html#3039">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Mon, 25 Sep 2006 15:49:27 +0200, Markus Schiltknecht &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">markus at bluegap.ch</A>&gt; wrote:

&gt;<i>I see... unfortunately I don't know how to explain this better. I don't
</I>&gt;<i>understand why writing a pastebin, a blog, or a news system should not
</I>&gt;<i>be written as a component / Fragment, which can be embedded into other
</I>&gt;<i>sites. And by embedded I mean URL _and_ template embedding. Isn't that
</I>&gt;<i>obvious to give a lot of flexibility?
</I>&gt;&gt;<i>def render_content(self, level):
</I>&gt;&gt;<i>    def _(ctx, data):
</I>&gt;&gt;<i>        try:
</I>&gt;&gt;<i>            fragment_name = inevow.ICurrentSegments(ctx)[level]
</I>&gt;&gt;<i>        ...
</I>&gt;<i>
</I>&gt;<i>Hm... looks tricky. I didn't know about def _(...). But who is expected
</I>&gt;<i>to pass the level to the renderer? The designer?
</I>
There's no magic in def _()... it's just a closure. Yes, the designer should pass the level to the renderer.

&gt;&gt;<i>Used:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>&lt;nevow:invisible nevow:render=&quot;content 1&quot;&gt;...&lt;/nevow:invisible&gt;
</I>&gt;<i>
</I>&gt;<i>That way I still have the level hard coded into the template.
</I>
That's why I told you to always use -1 or simply avoid this confusing thing.

&gt;<i>Uh.. macros? This is where it gets frustrating for me, because I think you 
</I>&gt;<i>still don't known what I want to achieve. Macros don't know a lot. Their 
</I>&gt;<i>context is very limited. How am I supposed to resolve the all the 
</I>&gt;<i>locateChild machinery? How do I give that information to the 'child', the 
</I>&gt;<i>pastebin in my example?
</I>
macros are a much better way to integrate a pre-existing template into a basic template. They work at TEMPLATE level not at Page or Fragment level.

&gt;<i>That portion of the code works, but with the macro I don't know how pass 
</I>&gt;<i>necessary information around.
</I>
Code conventions is a clear option. Passing arguments is another one.

&gt;<i>Hm... check 'C++ template metaprogramming'  *joking*
</I>&gt;<i>How static is that?   :-)
</I>
The point is how easy it is to build abstractions on that stuff? It isn't 
that's why you need to rely on external configuration or whatever machinery, 
because it's too hard to work at code level.

&gt;<i>My macro try:
</I>
Maybe I haven't been very clear at first. In order to embed an application in another one you MUST DESIGN one of the two to be embeddable. You CANNOT embed a Page instance in another Page instance, it's wrong and won't work even if you think it might.

Going back to the 'problem':

I have an application and this is the directory structure:

main/
    static/ -- contains images, css, javascript files
    template/ -- contains the application templates
    appname/ -- contains the code

Since we know about Object Oriented Programming we work by providing a base
class that can be inherited to provide some default behavior:

class BasePage(rend.Page):
    docFactory = loaders.xmlfile('mymacro.xhtml', templateDir=templateDir)

    # we define that this BasePage can fill some default macros:
    def macro_content(self, ctx):
        return ctx.tag[loaders.xmlfile(self.__class__.__name__+'.html', ignoreDocType=True).load()]

    def macro_sidebar(self, ctx):
        return ctx.tag[loaders.xmlfile(self.__class__.__name__+'_sidebar.html', ignoreDocType=True).load()]


what does this class do? It allows the classes that inherit from it to embed
html fragments (not the rend.Fragment class) inside a base template. How?

class Root(BasePage):
    #whatever functionality

This class will look for 2 files: root.html and root_sidebar.html.

Let's say that mymacro.xhtml (the default macro template) is the following:

&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot;
    &quot;<A HREF="http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;">http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;</A>&gt;
&lt;html xmlns=&quot;<A HREF="http://www.w3.org/1999/xhtml&quot;">http://www.w3.org/1999/xhtml&quot;</A> xml:lang=&quot;en&quot; lang=&quot;en&quot;
      xmlns:nevow=&quot;<A HREF="http://nevow.com/ns/nevow/0.1&quot;">http://nevow.com/ns/nevow/0.1&quot;</A>&gt;
    &lt;head&gt;
        Wowow
    &lt;/head&gt;

    &lt;body&gt;
        &lt;div id=&quot;content&quot; nevow:macro=&quot;content&quot; /&gt;
        &lt;div id=&quot;sidebar&quot; nevow:macro=&quot;sidebar&quot; /&gt;
    &lt;/body&gt;
&lt;/html&gt;

Then the 2 root.html and root_sidebar.html templates are:

&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot;
    &quot;<A HREF="http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;">http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;</A>&gt;
&lt;nevow:invisible xmlns=&quot;<A HREF="http://www.w3.org/1999/xhtml&quot;">http://www.w3.org/1999/xhtml&quot;</A> xml:lang=&quot;en&quot; lang=&quot;en&quot;
                 xmlns:nevow=&quot;<A HREF="http://nevow.com/ns/nevow/0.1&quot;">http://nevow.com/ns/nevow/0.1&quot;</A>&gt;

    I'm the content of the page arrrrrrrrr!
    aye I define whatever behavior I want, the only thing I care is that
    Root class can provide me with this functionality!

&lt;/nevow:invisible&gt;

&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot;
    &quot;<A HREF="http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;">http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;</A>&gt;
&lt;nevow:invisible xmlns=&quot;<A HREF="http://www.w3.org/1999/xhtml&quot;">http://www.w3.org/1999/xhtml&quot;</A> xml:lang=&quot;en&quot; lang=&quot;en&quot;
                 xmlns:nevow=&quot;<A HREF="http://nevow.com/ns/nevow/0.1&quot;">http://nevow.com/ns/nevow/0.1&quot;</A>&gt;

    I'm the sidebar of the ship, could you believe it?
    &lt;div nevow:render=&quot;greeting&quot; /&gt;

&lt;/nevow:invisible&gt;

When you first try to render this page Nevow runs all the nevow:macro 
directives it can find (because they are pre-compilable, unlike nevow:render and nevow:data directives), this results in the following final template:

&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot;
    &quot;<A HREF="http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;">http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;</A>&gt;
&lt;html xmlns=&quot;<A HREF="http://www.w3.org/1999/xhtml&quot;">http://www.w3.org/1999/xhtml&quot;</A> xml:lang=&quot;en&quot; lang=&quot;en&quot;
      xmlns:nevow=&quot;<A HREF="http://nevow.com/ns/nevow/0.1&quot;">http://nevow.com/ns/nevow/0.1&quot;</A>&gt;
    &lt;head&gt;
        Wowow
    &lt;/head&gt;

    &lt;body&gt;
        &lt;div id=&quot;content&quot;&gt;

    I'm the content of the page arrrrrrrrr!
    aye I define whatever behavior I want, the only thing I care is that
    Root class can provide me with this functionality!

        &lt;/div&gt;
        &lt;div id=&quot;sidebar&quot;&gt;

    I'm the sidebar of the ship, could you believe it?
    &lt;div nevow:render=&quot;greeting&quot; /&gt;

        &lt;/div&gt;
    &lt;/body&gt;
&lt;/html&gt;

This template will be used for the Root class ONLY. Any other subclass will re-pre-compile the macro to get its own template.

After having worked in this way... How do you embed applications then?
SIMPLE!! You Change the macro template and instead of providing that one, you 
simply provide a new one that fits your web application defaults while 
keeping the macro slots defined in there so that the application you want to 
embed won't be surprised by the new template. How is that simple? It's so 
simple I shouldn't even tell you... templateDir is a configuration option, 
change it in the configuration and give it a new location where the new 
templates are available.

There is no other way and there's no cleaner way to do this in my opinion.
Why? Because you cannot embed applications randomly without having first planned for this option in the application that needs to be embedded because it has certain requirements about the API and simply moving around class cannot work anyway. Is this good or bad? I don't know, I think it's good. Is it possible to just put applications running in another one like they are completely separate? Of course... it's even easier, just return one's root page from the appropriate link.

The same can be done with Fragments and in fact Mantissa does exactly the 
same thing just with Fragments.

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003038.html">[Twisted-web] fragments with child lookup
</A></li>
	<LI>Next message: <A HREF="003041.html">[Twisted-web] fragments with child lookup
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3039">[ date ]</a>
              <a href="thread.html#3039">[ thread ]</a>
              <a href="subject.html#3039">[ subject ]</a>
              <a href="author.html#3039">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
