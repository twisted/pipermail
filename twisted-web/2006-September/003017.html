<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] fragments with child lookup
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20fragments%20with%20child%20lookup&In-Reply-To=4512BE2C.5040600%40bluegap.ch">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003016.html">
   <LINK REL="Next"  HREF="003019.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] fragments with child lookup</H1>
    <B>Markus Schiltknecht</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20fragments%20with%20child%20lookup&In-Reply-To=4512BE2C.5040600%40bluegap.ch"
       TITLE="[Twisted-web] fragments with child lookup">markus at bluegap.ch
       </A><BR>
    <I>Fri Sep 22 02:32:47 CDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="003016.html">[Twisted-web] fragments with child lookup
</A></li>
        <LI>Next message: <A HREF="003019.html">[Twisted-web] fragments with child lookup
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3017">[ date ]</a>
              <a href="thread.html#3017">[ thread ]</a>
              <a href="subject.html#3017">[ subject ]</a>
              <a href="author.html#3017">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

I've now solved my problem, sort of. I'm still wondering, if there is a 
more elegant solution, probably integrated into nevow. Since, IMHO, this 
is one of the use-cases of a template system.

I did more or less the following (simplified, naming could be improved, 
too):


class Container(rend.Page):
	addSlash = True

	def __init__(self, source):
		self.source = source
		self.docFactory = self.source.getFactory();

	def locateChild(self, ctx, segments):
		&quot;&quot;&quot; Loads sub-pages (fragments?) for all the remaining
		    segments. It does its own lookup with the
		    childFragmentLookup() method.
		    All children are then added to the slot 'children'
		    in reversed ordering, so I can simply pop()
		&quot;&quot;&quot;
		children = []

		child = self
		while len(segments) &gt; 0:
			if segments[0] != '':
				child = child.childFragmentFactory(segments[0])
				if child is None:
					return appserver.NotFound

				children.append(child)

			segments = segments[1:]

		children.reverse()
		ctx.fillSlots('children', children)
		curr_counter = len(children)
		return self, ()

	def childFragmentFactory(self, name):
		&quot;&quot;&quot; Tries to create a child for a given name. May return
		    None! (This should probably better raise an
		    exception, no?)
		&quot;&quot;&quot;
		child_source = self.source.getChild(name)
		if child_source is not None:
			return Container(child_source)

	def render_content(self, ctx, data):
		&quot;&quot;&quot; every fragment may have a 'content' renderer, where
		    it's child fragment should be included. This looks
		    up the next child and returns it for rendering.
		&quot;&quot;&quot;
		children = ctx.locateSlotData('children')
		if len(children) &gt; 0:
			child = children.pop()
			curr_counter = len(children)
			return child
		else:
			raise Exception(&quot;content renderer called too many times!&quot;)



The children have to be stored in the context. I've also tried returning 
  the child in the Container.locateChild() method, and then hook the 
renderHTTP() method to render the parents first. But I've had no luck 
with fetching the parents from the context (and it's parent contexts). I 
would prefer that, because I wouldn't have to write my own childLookup() 
method.

Thoughts? Comments?

Regards

Markus

</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003016.html">[Twisted-web] fragments with child lookup
</A></li>
	<LI>Next message: <A HREF="003019.html">[Twisted-web] fragments with child lookup
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3017">[ date ]</a>
              <a href="thread.html#3017">[ thread ]</a>
              <a href="subject.html#3017">[ subject ]</a>
              <a href="author.html#3017">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
