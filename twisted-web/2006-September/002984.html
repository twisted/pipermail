<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] Re: Nevow and template like files
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Re%3A%20Nevow%20and%20template%20like%20files&In-Reply-To=87d5a9bewf.fsf%40aka.i.naked.iki.fi">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002983.html">
   <LINK REL="Next"  HREF="002985.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] Re: Nevow and template like files</H1>
    <B>Valentino Volonghi aka Dialtone</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Re%3A%20Nevow%20and%20template%20like%20files&In-Reply-To=87d5a9bewf.fsf%40aka.i.naked.iki.fi"
       TITLE="[Twisted-web] Re: Nevow and template like files">dialtone at divmod.com
       </A><BR>
    <I>Wed Sep  6 18:46:01 CDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="002983.html">[Twisted-web] Re: Nevow and template like files
</A></li>
        <LI>Next message: <A HREF="002985.html">[Twisted-web] Re: Nevow and template like files
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2984">[ date ]</a>
              <a href="thread.html#2984">[ thread ]</a>
              <a href="subject.html#2984">[ subject ]</a>
              <a href="author.html#2984">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Wed, 06 Sep 2006 11:03:28 +0300, Nuutti Kotivuori &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">naked at iki.fi</A>&gt; wrote:
&gt;<i>Valentino Volonghi aka Dialtone wrote:
</I>&gt;<i>Okay, consider the content page shown above. Now let's assume that
</I>&gt;<i>most pages don't need the &quot;head&quot; pattern at all. I wouldn't want to
</I>&gt;<i>write the empty pattern on all pages just because it has to be there,
</I>&gt;<i>instead I would just want to say that put T.invisible() there if the
</I>&gt;<i>pattern doesn't exist. (With just the &quot;head&quot; pattern it wouldn't be so
</I>&gt;<i>much of a problem, but I might later on have to add some more, and I
</I>&gt;<i>don't want to change every content page just because one content page
</I>&gt;<i>requires something special.)
</I>
&gt;<i>So this is what I'd like the default for. But ofcourse, if I load the
</I>&gt;<i>entire page first, and then just use the inevow.IQ machinery, making
</I>&gt;<i>the default patterns is easy.
</I>
Another solution is to write your own loader by implementing inevow.IDocFactory and the using loaders.xmlfile internally so that you can catch exceptions and do what you want with the behavior. This also sounds reasonable a reasonably easy.

&gt;&gt;<i> loaded = loaders.xmlfile('file')
</I>&gt;&gt;<i> some_pattern = inevow.IQ(loaded).onePattern('whatever')
</I>&gt;<i>
</I>&gt;<i>That seems to work at first - but if there are any macros or render
</I>&gt;<i>methods inside the file I load, then I get Could not adapt error to
</I>&gt;<i>IMacroFactory.
</I>
Uhmmm... Indeed the problem of the macro factory is not of secondary importance. Basically it doesn't make sense to call load() without a MacroFactory. This can be solved by building your own WovenContext before passing it to the loader.

&gt;&gt;<i> Don't pass the context, what's the problem here?
</I>&gt;<i>
</I>&gt;<i>Macros and render methods. In the case of the snippet pages, I would
</I>&gt;<i>like them to be interpreted in the context of the Fragment class that
</I>&gt;<i>is loading the entire snippet page.
</I>
That is done by default if you pass the context you are given by any of the methods in the Fragment.

&gt;<i>I understand that the macro is not reloaded - but each macro will load
</I>&gt;<i>the page once. Which would be a problem on a page with hundreds of
</I>&gt;<i>snippets if every snippet would cause the page to be loaded once.
</I>
It's still a one time cost.

&gt;<i>Okay, I will try to be a bit clearer. For now, I have two problems -
</I>&gt;<i>how to load the &quot;content&quot; page all at once and then use patterns with
</I>&gt;<i>optional defaults from it. And then the snippet problem. I will
</I>&gt;<i>outline the snippet problem later.
</I>&gt;<i>
</I>&gt;<i>I wrote a really tiny testsite outlining my problem. I will put the
</I>&gt;<i>three files here:
</I>&gt;<i>
</I>&gt;<i>,----[ testpage.xhtml ]
</I>&gt;|<i> &lt;?xml version=&quot;1.0&quot;?&gt;
</I>&gt;|<i> &lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot;
</I>&gt;|<i> &quot;<A HREF="http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;">http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;</A>&gt;
</I>&gt;|<i> &lt;html xmlns=&quot;<A HREF="http://www.w3.org/1999/xhtml&quot;">http://www.w3.org/1999/xhtml&quot;</A>
</I>&gt;|<i>   xmlns:n=&quot;<A HREF="http://nevow.com/ns/nevow/0.1&quot;">http://nevow.com/ns/nevow/0.1&quot;</A>&gt;
</I>&gt;|<i>   &lt;head&gt;
</I>&gt;|<i>     &lt;title&gt;
</I>&gt;|<i>       &lt;n:invisible n:macro=&quot;title&quot;&gt;Page Title&lt;/n:invisible&gt;
</I>&gt;|<i>     &lt;/title&gt;
</I>&gt;|<i>     &lt;n:invisible n:macro=&quot;head&quot; /&gt;
</I>&gt;|<i>   &lt;/head&gt;
</I>&gt;|<i>
</I>&gt;|<i>   &lt;body&gt;
</I>&gt;|<i>     &lt;h1&gt;&lt;n:invisible n:macro=&quot;title&quot;&gt;Page Title&lt;/n:invisible&gt;&lt;/h1&gt;
</I>&gt;|<i>
</I>&gt;|<i>     &lt;div class=&quot;plain-content&quot;&gt;
</I>&gt;|<i>       &lt;n:invisible n:macro=&quot;content&quot; /&gt;
</I>&gt;|<i>     &lt;/div&gt;
</I>&gt;|<i>   &lt;/body&gt;
</I>&gt;|<i> &lt;/html&gt;
</I>&gt;<i>`----
</I>&gt;<i>
</I>&gt;<i>,----[ datapage.xhtml ]
</I>&gt;|<i> &lt;?xml version=&quot;1.0&quot;?&gt;
</I>&gt;|<i> &lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot;
</I>&gt;|<i> &quot;<A HREF="http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;">http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;</A>&gt;
</I>&gt;|<i> &lt;html xmlns=&quot;<A HREF="http://www.w3.org/1999/xhtml&quot;">http://www.w3.org/1999/xhtml&quot;</A>
</I>&gt;|<i>   xmlns:n=&quot;<A HREF="http://nevow.com/ns/nevow/0.1&quot;">http://nevow.com/ns/nevow/0.1&quot;</A>&gt;
</I>&gt;|<i>   &lt;head&gt;
</I>&gt;|<i>     &lt;title&gt;&lt;n:invisible n:pattern=&quot;title&quot;&gt;Data Page&lt;/n:invisible&gt;&lt;/title&gt;
</I>&gt;|<i>     &lt;n:invisible n:pattern=&quot;head&quot; /&gt;
</I>&gt;|<i>   &lt;/head&gt;
</I>&gt;|<i>   &lt;body&gt;
</I>&gt;|<i>     &lt;n:invisible n:pattern=&quot;content&quot;&gt;
</I>&gt;|<i>       &lt;p&gt;
</I>&gt;|<i>       &lt;n:invisible n:macro=&quot;test&quot;&gt;
</I>&gt;|<i>           Replaced by test data.
</I>&gt;|<i>         &lt;/n:invisible&gt;
</I>&gt;|<i>       &lt;/p&gt;
</I>&gt;|<i>     &lt;/n:invisible&gt;
</I>&gt;|<i>   &lt;/body&gt;
</I>&gt;|<i> &lt;/html&gt;
</I>&gt;<i>`----
</I>&gt;<i>
</I>&gt;<i>,----
</I>&gt;|<i> from nevow import inevow, loaders, rend, guard, url, stan, tags as T
</I>&gt;|<i>
</I>&gt;|<i> class TestPage(rend.Page):
</I>&gt;|<i>     docFactory = loaders.xmlfile('testpage.xhtml')
</I>&gt;|<i>     datapage = None
</I>&gt;|<i>
</I>&gt;|<i>     def macro_title(self, ctx):
</I>&gt;|<i>         return loaders.xmlfile(self.datapage, pattern='title')
</I>&gt;|<i>
</I>&gt;|<i>     def macro_head(self, ctx):
</I>&gt;|<i>         return loaders.xmlfile(self.datapage, pattern='head')
</I>&gt;|<i>
</I>&gt;|<i>     def macro_content(self, ctx):
</I>&gt;|<i>         return loaders.xmlfile(self.datapage, pattern='content')
</I>&gt;|<i>
</I>&gt;|<i> class DataPage(TestPage):
</I>&gt;|<i>     datapage = 'datapage.xhtml'
</I>&gt;|<i>
</I>&gt;|<i>     def macro_test(self, ctx):
</I>&gt;|<i>         return 'Test successful.'
</I>&gt;<i>`----
</I>
I'd rewrite the example in the following way:

class TestPage(rend.Page):
    docFactory = loaders.xmlfile('testpage.xhtml')
    patternGenerator = None

    def macro_title(self, ctx):
        return inevow.IQ(self.patternGenerator).onePattern('title')

    def macro_head(self, ctx):
        return inevow.IQ(self.patternGenerator).onePattern('head')

    def macro_content(self, ctx):
        return inevow.IQ(self.patternGenerator).onePattern('content')

class DataPage(TestPage):
    patternGenerator = loaders.xmlfile('datapage.xhtml')

    def macro_test(self, ctx):
        return 'Test successful.'


&gt;<i>Now, how would I modify this example so that &quot;datapage.xhtml&quot; is
</I>&gt;<i>loaded only once, even though there are three different macros using
</I>&gt;<i>it. And also so that the &quot;head&quot; pattern could be optional and is
</I>&gt;<i>replaced by T.invisible() if not present. All the while not breaking
</I>&gt;<i>the macro_test part, splitting the pages into several files or
</I>&gt;<i>breaking the normal html rendability/editability of the datapage.
</I>
I think the solution above should work without any problems, except I'm not sure that macro_test could actually work at all in nevow currently, but it may work.

In case you want to avoid to call loaders.xmlfile('datapage.html') each time you might try a simple metaclass solution that grabs patternGenerator attribute before building the class and changes it to be an instance of loaders.xmlfile.

&gt;<i>I will come up with something outlining the snippet problem later.
</I>
ok.

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002983.html">[Twisted-web] Re: Nevow and template like files
</A></li>
	<LI>Next message: <A HREF="002985.html">[Twisted-web] Re: Nevow and template like files
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2984">[ date ]</a>
              <a href="thread.html#2984">[ thread ]</a>
              <a href="subject.html#2984">[ subject ]</a>
              <a href="author.html#2984">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
