<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] fragments with child lookup
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20fragments%20with%20child%20lookup&In-Reply-To=45152E09.4090109%40bluegap.ch">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003026.html">
   <LINK REL="Next"  HREF="003028.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] fragments with child lookup</H1>
    <B>Valentino Volonghi aka Dialtone</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20fragments%20with%20child%20lookup&In-Reply-To=45152E09.4090109%40bluegap.ch"
       TITLE="[Twisted-web] fragments with child lookup">dialtone at divmod.com
       </A><BR>
    <I>Sat Sep 23 09:22:06 CDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="003026.html">[Twisted-web] fragments with child lookup
</A></li>
        <LI>Next message: <A HREF="003028.html">[Twisted-web] fragments with child lookup
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3027">[ date ]</a>
              <a href="thread.html#3027">[ thread ]</a>
              <a href="subject.html#3027">[ subject ]</a>
              <a href="author.html#3027">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i>I've learned about nevow macros. I don't quite understand what the big 
</I>&gt;<i>difference to a renderer is, but that's another story...
</I>
One is processed once and only once at pre-compile time, the other is not.

&gt;<i>I'm still trying to get my 'component' based thinking migrated to nevow. As 
</I>&gt;<i>an exercise, I thought I'd try to use the nevow example pastebin as a 
</I>&gt;<i>component. What I want to achieve is having the pastebin available under 
</I>&gt;<i><A HREF="http://localhost:8080/pastebin/,">http://localhost:8080/pastebin/,</A> wrapped within my own template.
</I>&gt;<i><A HREF="http://localhost:8080/">http://localhost:8080/</A>  should simply show a welcome page, within the same 
</I>&gt;<i>template.
</I>
You can't do that because pastebin is not designed to be used in that way. Otherwise simply return the root page of the pastebin from the child_pastebin method of the root page of your site.


&gt;<i>Index: pastebin.tac
</I>&gt;<i>===================================================================
</I>&gt;<i>--- pastebin.tac        (revision 9132)
</I>&gt;<i>+++ pastebin.tac        (working copy)
</I>&gt;<i>@@ -5,6 +5,7 @@
</I>&gt;<i>
</I>&gt;<i>  from nevow import appserver
</I>&gt;<i>  from nevow import vhost
</I>&gt;<i>+from nevow import inevow, rend, stan, loaders, tags as T
</I>&gt;<i>
</I>&gt;<i>  from pastebin import interfaces
</I>&gt;<i>  from pastebin.service import FSPasteBinService
</I>&gt;<i>@@ -16,7 +17,31 @@
</I>&gt;<i>  pastebin = FSPasteBinService('data')
</I>&gt;<i>  pastebin.setServiceParent(application)
</I>&gt;<i>
</I>&gt;<i>-appResource = pages.RootPage(pastebin)
</I>&gt;<i>+class SuperiorRootPage(rend.Page):
</I>&gt;<i>+    addSlash = True
</I>&gt;<i>+    docFactory = loaders.stan(
</I>&gt;<i>+        T.html[
</I>&gt;<i>+            T.head(),
</I>&gt;<i>+            T.body[
</I>&gt;<i>+                T.h1['hello world'],
</I>&gt;<i>+                T.invisible(macro=T.directive('content')),
</I>&gt;<i>+            ]])
</I>&gt;<i>+
</I>&gt;<i>+    def locateChild(self, ctx, segments):
</I>&gt;<i>+        self.remaining_segments = segments[1:]
</I>&gt;<i>+        return self, ()
</I>
This stuff above is just wrong.

&gt;<i>+    child_pastebin = pages.RootPage(pastebin)
</I>&gt;<i>+
</I>&gt;<i>+    def macro_content(self, ctx):
</I>&gt;<i>+        print &quot;remaining_segments: %s&quot; % str(self.remaining_segments)
</I>&gt;<i>+        if len(self.remaining_segments) == 0:
</I>&gt;<i>+            return &quot;welcome!&quot;
</I>&gt;<i>+        else:
</I>&gt;<i>+            # what to return here???
</I>&gt;<i>+            return &quot;duh!&quot;
</I>&gt;<i>+
</I>&gt;<i>+appResource = SuperiorRootPage(pastebin)
</I>&gt;<i>  appResource.putChild('robots.txt', static.File('static/robots.txt'))
</I>&gt;<i>  vResource = vhost.VHostMonsterResource()
</I>&gt;<i>  appResource.putChild('vhost', vResource)
</I>

As I told you the first time you should use a dictionary that contains fragments, in fact that's exactly what you should do.

What you are trying to do is far less dynamic than what you tried to explain.

Just pass the docFactory argument to the Page class when you create it and let the Fragments render themselves with the appropriate template (when the are needed, and they are not strictly here).

if you only want to change the outer parts of a page then use the macro system (it is _static_ and request agnostic, it's compiled at the first request but has no connection with it (and it's wrong to act in that way).

Use a single macro.html template in your application and write everything else in order to fill the macro slots, when you need to change the macro change it (the macro template is the docFactory of the base Page class, when the rest inherits it will fill the content macro (or sidebar or whatever macro) with its own template that statically depends on the page you are writing in that moment.

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003026.html">[Twisted-web] fragments with child lookup
</A></li>
	<LI>Next message: <A HREF="003028.html">[Twisted-web] fragments with child lookup
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3027">[ date ]</a>
              <a href="thread.html#3027">[ thread ]</a>
              <a href="subject.html#3027">[ subject ]</a>
              <a href="author.html#3027">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
