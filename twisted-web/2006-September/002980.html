<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] Re: Nevow and template like files
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Re%3A%20Nevow%20and%20template%20like%20files&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002978.html">
   <LINK REL="Next"  HREF="002981.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] Re: Nevow and template like files</H1>
    <B>Nuutti Kotivuori</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Re%3A%20Nevow%20and%20template%20like%20files&In-Reply-To="
       TITLE="[Twisted-web] Re: Nevow and template like files">naked at iki.fi
       </A><BR>
    <I>Tue Sep  5 14:48:08 CDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="002978.html">[Twisted-web] Nevow and template like files
</A></li>
        <LI>Next message: <A HREF="002981.html">[Twisted-web] Re: Nevow and template like files
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2980">[ date ]</a>
              <a href="thread.html#2980">[ thread ]</a>
              <a href="subject.html#2980">[ subject ]</a>
              <a href="author.html#2980">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Valentino Volonghi aka Dialtone wrote:
&gt;<i> On Tue, 05 Sep 2006 18:13:37 +0300, Nuutti Kotivuori &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">naked at iki.fi</A>&gt; wrote:
</I>&gt;&gt;<i> First are layout pages. These will provide the general
</I>&gt;&gt;<i> layout and functionality for a set of pages that will make up a
</I>&gt;&gt;<i> section of the site. These pages will contain the actual
</I>&gt;&gt;<i> html/head/body tags and such.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Second are the content pages. These pages will fit in a certain layout
</I>&gt;&gt;<i> and provide the actual page content to it. There will be static pages,
</I>&gt;&gt;<i> dynamic status pages and pages with web forms. The layout pages need
</I>&gt;&gt;<i> to be able to dig sections out of the content pages to fill in to the
</I>&gt;&gt;<i> layout; for example additional css/javascript to go into head, sidebar
</I>&gt;&gt;<i> items, actual content.
</I>&gt;<i>
</I>&gt;<i> I think what you said sounds reasonable. Maybe have a look here:
</I>&gt;<i> <A HREF="http://trac.stiq.it/main/browser/stiq/ui/base.py">http://trac.stiq.it/main/browser/stiq/ui/base.py</A>
</I>&gt;<i>
</I>&gt;<i> Specifically base.Base class which defines 2 class attributes:
</I>&gt;<i> template and sidebar that are used to fill a sidebar pane and the
</I>&gt;<i> content pane of the macro.html template.  Basically you just use
</I>&gt;<i> macro.html as the basis for all the pages and fill the 2 macro slots
</I>&gt;<i> with a different couple of templates each time.
</I>
Thanks! I've looked already at that and it seems nice... except for
two points.

First of all, the content is looked up like this:

,----
|<i> def macro_content(self, ctx):
</I>|<i>     return loaders.xmlfile(self.template+'.html', ignoreDocType=True,
</I>|<i>                            templateDir=conf.TEMPLATE_PATH)
</I>`----

Since I have several patterns in a single file, I would need to append
pattern='content' keyword into that. But if I do that, then the file
will get read once by every macro that uses a pattern from it? That
I'd like to avoid - I'd like to keep the loaders in a class
variable nicely, or a Fragment, or something.

Also, if I say pattern='content', then that loader will throw a hissy
fit if the pattern isn't present. So I'd need a loader that would
return some default value when the .load() method is called and that
sounds like an icky solution again. No worries though, it's easy to
hack.

So, any ideas how I could have just one loader that would load the
file once, and then just use normal nevow machinery to fetch the
patterns from it (where it is easier to get a default value if the
pattern does not exist)?

&gt;&gt;<i> Third are so called snippet pages. These will contain a large
</I>&gt;&gt;<i> number of text snippets (with markup) that are re-used on many
</I>&gt;&gt;<i> content pages. These snippets need to be easily includable from the
</I>&gt;&gt;<i> content pages. Some of the snippets are used as is, where as some
</I>&gt;&gt;<i> of the snippets need to be parameterised - the calling code needs
</I>&gt;&gt;<i> to be able to fill in some things easily.
</I>&gt;<i>
</I>&gt;&gt;<i> Snippet pages are a bit troublesome. I was thinking of making a
</I>&gt;&gt;<i> Fragment that would have the docFactory for such a page. Then that
</I>&gt;&gt;<i> fragment would be instantiated where ever some snippet was to be
</I>&gt;&gt;<i> used, and a simple method would be called on it. This method would
</I>&gt;&gt;<i> get the document, get a pattern from it, call fillSlots a couple
</I>&gt;&gt;<i> times and return it. I could make a macro which does this based on
</I>&gt;&gt;<i> the arguments it receives.
</I>&gt;<i>
</I>&gt;<i> Seems reasonable.
</I>
Actually, I have a bit of a problem there - how do I get the whole
document loaded in the methods I have? I can call
self.docFactory.load() in every method ofcourse, but then the context
is a bit screwy - however, I hesitate to pass in the context that is
available at the time of the first call, since that might come from a
different page each time and I'm not sure if the render/macro methods
are going to be invoked from the correct object and such.

&gt;&gt;<i> But it's all a bit in the air.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Things I'd like to avoid or achieve. I wouldn't want the actual
</I>&gt;&gt;<i> xhtml templates to be read many times in the life of the program -
</I>&gt;&gt;<i> it may even be a problem with macros if a page is read once per
</I>&gt;&gt;<i> every pattern used from it - so I'd like for them to be read just
</I>&gt;&gt;<i> once. I'd like a way to have some patterns be optional, so I could
</I>&gt;&gt;<i> provide a default thing to do in case they are not found. And I'd
</I>&gt;&gt;<i> like the lookup of the snippet patterns be somehow pre-done, so
</I>&gt;&gt;<i> that every inclusion of a snippet wouldn't have go to through 1000
</I>&gt;&gt;<i> DOM nodes to find the right part.
</I>&gt;<i>
</I>&gt;<i> Each template is rendered/parsed once and only once (not because of
</I>&gt;<i> my code, but that's how nevow works) unless you modify it (and it's
</I>&gt;<i> not in a macro, in fact if you modify a template included by a macro
</I>&gt;<i> you have to modify the macro too).
</I>
I thought that the rendered/parsed version of the template resided in
the loaders.xmlfile instance that is created - and if I return a new
loaders.xmlfile instance (with a different pattern clause) from
several different macros, then the page would get loaded as many
times. Or if I returned a loaders.xmlfile instance from a render
method, then the file would be parsed on each rendition of the page -
am I wrong?

&gt;<i> patterns are always optional.  pre-doing the pattern lookup can be
</I>&gt;<i> done using self.docFactory as an argument to
</I>&gt;<i> inevow.IQ(self.docFactory).onePattern() either at class level or at
</I>&gt;<i> __init__ level. Another way is to simply load a different template
</I>&gt;<i> for the pattern at class level calling it in another way.  pattern
</I>&gt;<i> lookup anyway doesn't go through 1000 DOM nodes. Nevow does
</I>&gt;<i> precompiling of whatever it can.
</I>
Patterns are optional yes, but if I call

  loaders.xmlfile(filename, pattern='foobar')

that will throw an exception if pattern 'foobar' is not present in the
file. So will onePattern(), but that is easily wrapped in a try/catch
block (or I can use patternGenerator which does take a default
argument in some cases) - where as a loader being wrapped doesn't do
anything since the actual loading happens later (when the load()
method is called).

&gt;&gt;<i> So, any suggestions on how to actually go about making this happen?
</I>&gt;<i>
</I>&gt;<i> What you have in mind already seems good enough.
</I>&gt;<i>
</I>&gt;<i> HTH.
</I>
Thanks - I guess my ideas are somewhat in the ballpark of what it
should be - now I just need to iron out the small problems.

-- Naked


</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002978.html">[Twisted-web] Nevow and template like files
</A></li>
	<LI>Next message: <A HREF="002981.html">[Twisted-web] Re: Nevow and template like files
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2980">[ date ]</a>
              <a href="thread.html#2980">[ thread ]</a>
              <a href="subject.html#2980">[ subject ]</a>
              <a href="author.html#2980">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
