<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] DOM manipulation in an athena widget
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20DOM%20manipulation%20in%20an%20athena%20widget&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003060.html">
   <LINK REL="Next"  HREF="003062.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] DOM manipulation in an athena widget</H1>
    <B>Phil Mayers</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20DOM%20manipulation%20in%20an%20athena%20widget&In-Reply-To="
       TITLE="[Twisted-web] DOM manipulation in an athena widget">p.mayers at imperial.ac.uk
       </A><BR>
    <I>Sat Sep 30 18:14:14 CDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="003060.html">[Twisted-web] _win32stdio
</A></li>
        <LI>Next message: <A HREF="003062.html">[Twisted-web] DOM manipulation in an athena widget
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3061">[ date ]</a>
              <a href="thread.html#3061">[ thread ]</a>
              <a href="subject.html#3061">[ subject ]</a>
              <a href="author.html#3061">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Following on from my post of a couple of weeks ago, I'm rendering a 
*large* (~150 editable fields) form for a CRUD application and am 
wanting client-side processing of incremental updates to said form, 
since round-tripping adds considerable delay to the user experience.

I'm sending the form as a table with appropriate athena:handler defined. 
On a mouse click, the athena:handler replaces the &lt;span&gt; containing the 
text with an &lt;input type=&quot;text&quot; /&gt; or other control as appropriate.

What I'm then trying to do is hook up an event handler to onBlur (or 
whatever) to compare the old and new values, set a dirty flag and enable 
the &quot;save&quot; button.

I couldn't find a way to do this with the Divmod.NotQuiteMochiKit 
packages (indeed, they seem wedded to innerHTML), so I whacked MochiKit 
in the page header and tried this:

class Frag(athena.LiveFragment):
   jsModule = u&quot;db.Record&quot;
   docFactory = loaders.stan(
     T.table(render=T.directive('sequence'), data=T.directive('sql'))[
       T.tr(pattern='item', render=T.directive('mapping'))[
         T.td[T.slot(name='fieldName')],
         T.td[
           athena.handler(event='onclick', handler='editField'),
           T.span[T.slot(name='fieldValue')],
         ], # end of td
       ], # end of tr
     ])

...and the jsmodule has:

db.Record.methods(
   function editField(self, node, event) {
     if (node.inEdit) return false;
     /* make the textbox */
     var tb = INPUT({'type': 'text', 'value': scrapeText(node)});
     /* swap the span for a textbox */
     replaceChildNodes(
       getElementsByTagAndClassName('span', null, node)[0], tb
     );

     /* THIS FAILS */
     connect(tb, 'onblur', self.saveField);

     return false;
   });

The nevow debug console thing logs &quot;self has no properties&quot; - what is 
self in this context of a widget method/event call? Why does it have no 
properties?

Absent a more complete set of DOM and event handling functions, and 
given whatever the (to me) unfathomable incompatibility with Mochi and 
the Divmod runtime is, how does one attach event handlers to client-side 
created DOM nodes? Are the events normalised cross-browser as they are 
in Mochi? There's an &quot;xbevent&quot; function in one of the examples that 
indicates not?

Suggestions welcome. Sorry for abruptness of mail, workrave is nagging 
me to stop typing...

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003060.html">[Twisted-web] _win32stdio
</A></li>
	<LI>Next message: <A HREF="003062.html">[Twisted-web] DOM manipulation in an athena widget
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3061">[ date ]</a>
              <a href="thread.html#3061">[ thread ]</a>
              <a href="subject.html#3061">[ subject ]</a>
              <a href="author.html#3061">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
