<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] DOM manipulation in an athena widget
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20DOM%20manipulation%20in%20an%20athena%20widget&In-Reply-To=451EFA46.1070901%40imperial.ac.uk">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003064.html">
   <LINK REL="Next"  HREF="003065.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] DOM manipulation in an athena widget</H1>
    <B>glyph at divmod.com</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20DOM%20manipulation%20in%20an%20athena%20widget&In-Reply-To=451EFA46.1070901%40imperial.ac.uk"
       TITLE="[Twisted-web] DOM manipulation in an athena widget">glyph at divmod.com
       </A><BR>
    <I>Sat Sep 30 18:38:54 CDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="003064.html">[Twisted-web] DOM manipulation in an athena widget
</A></li>
        <LI>Next message: <A HREF="003065.html">[Twisted-web] DOM manipulation in an athena widget
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3063">[ date ]</a>
              <a href="thread.html#3063">[ thread ]</a>
              <a href="subject.html#3063">[ subject ]</a>
              <a href="author.html#3063">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Sun, 01 Oct 2006 00:14:14 +0100, Phil Mayers &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">p.mayers at imperial.ac.uk</A>&gt; wrote:

&gt;<i>What I'm then trying to do is hook up an event handler to onBlur (or 
</I>&gt;<i>whatever) to compare the old and new values, set a dirty flag and enable the 
</I>&gt;<i>&quot;save&quot; button.
</I>
&gt;<i>I couldn't find a way to do this with the Divmod.NotQuiteMochiKit packages 
</I>
I assume you're talking about Divmod.Runtime?

&gt;<i>(indeed, they seem wedded to innerHTML), so I whacked MochiKit in the page 
</I>&gt;<i>header and tried this:
</I>
Some parts of the Divmod infrastructure still use MochiKit.  We're trying to remove this dependency in the future to allow Nevow users to use whatever version of MochiKit they like, but at least for the time being you can get to the version of MochiKit distributed with Nevow by putting an &quot;//import MochiKit.Whatever&quot; statement at the top of your JS module.

&gt;<i>class Frag(athena.LiveFragment):
</I>&gt;<i>   jsModule = u&quot;db.Record&quot;
</I>&gt;<i>   docFactory = loaders.stan(
</I>&gt;<i>     T.table(render=T.directive('sequence'), data=T.directive('sql'))[
</I>&gt;<i>       T.tr(pattern='item', render=T.directive('mapping'))[
</I>&gt;<i>         T.td[T.slot(name='fieldName')],
</I>&gt;<i>         T.td[
</I>&gt;<i>           athena.handler(event='onclick', handler='editField'),
</I>&gt;<i>           T.span[T.slot(name='fieldValue')],
</I>&gt;<i>         ], # end of td
</I>&gt;<i>       ], # end of tr
</I>&gt;<i>     ])
</I>
I don't see a render=T.directive(&quot;liveFragment&quot;) anywhere, so this fragment is going to be complete garbage by the time it reaches the client.  There really ought to be a warning or something but it's a hard thing for the infrastructure to inspect.

&gt;<i>...and the jsmodule has:
</I>&gt;<i>
</I>&gt;<i>db.Record.methods(
</I>&gt;<i>   function editField(self, node, event) {
</I>&gt;<i>     if (node.inEdit) return false;
</I>&gt;<i>     /* make the textbox */
</I>&gt;<i>     var tb = INPUT({'type': 'text', 'value': scrapeText(node)});
</I>&gt;<i>     /* swap the span for a textbox */
</I>&gt;<i>     replaceChildNodes(
</I>&gt;<i>       getElementsByTagAndClassName('span', null, node)[0], tb
</I>&gt;<i>     );
</I>&gt;<i>
</I>&gt;<i>     /* THIS FAILS */
</I>&gt;<i>     connect(tb, 'onblur', self.saveField);
</I>&gt;<i>
</I>&gt;<i>     return false;
</I>&gt;<i>   });
</I>&gt;<i>
</I>&gt;<i>The nevow debug console thing logs &quot;self has no properties&quot; - what is self 
</I>&gt;<i>in this context of a widget method/event call?
</I>
It *should* be an instance of db.Record in this case.

&gt;<i>Why does it have no properties?
</I>
I am not completely sure but I have a few theories:

 * You didn't include the appropriate render directive to set up the widget.
 * You didn't set 'self.saveField = XXX' anywhere.
 * You stomped on the version of MochiKit that Divmod was using internally.

&gt;<i>Absent a more complete set of DOM and event handling functions, and given 
</I>&gt;<i>whatever the (to me) unfathomable incompatibility with Mochi and the Divmod 
</I>&gt;<i>runtime is, how does one attach event handlers to client-side created DOM 
</I>&gt;<i>nodes? Are the events normalised cross-browser as they are in Mochi? There's 
</I>&gt;<i>an &quot;xbevent&quot; function in one of the examples that indicates not?
</I>
The major &quot;incompatibility&quot; is that it's a huge cost to pay on top of the already too-large Divmod runtime.  We're trying to reduce the dependency so that we don't require all users to pay that cost.  However, far from being incompatible, Nevow *includes* a lightly modified version of MochiKit, and will probably continue to so that you can use it as a &quot;divmod module&quot; in Athena applications, even after the Athena core no longer uses it.


</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003064.html">[Twisted-web] DOM manipulation in an athena widget
</A></li>
	<LI>Next message: <A HREF="003065.html">[Twisted-web] DOM manipulation in an athena widget
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3063">[ date ]</a>
              <a href="thread.html#3063">[ thread ]</a>
              <a href="subject.html#3063">[ subject ]</a>
              <a href="author.html#3063">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
