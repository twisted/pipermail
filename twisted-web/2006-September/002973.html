<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] Athena DOM manipulation
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Athena%20DOM%20manipulation&In-Reply-To=44FCAFCA.8090909%40imperial.ac.uk">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002972.html">
   <LINK REL="Next"  HREF="002977.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] Athena DOM manipulation</H1>
    <B>Jean-Paul Calderone</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Athena%20DOM%20manipulation&In-Reply-To=44FCAFCA.8090909%40imperial.ac.uk"
       TITLE="[Twisted-web] Athena DOM manipulation">exarkun at divmod.com
       </A><BR>
    <I>Mon Sep  4 18:35:20 CDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="002972.html">[Twisted-web] Athena DOM manipulation
</A></li>
        <LI>Next message: <A HREF="002977.html">[Twisted-web] Athena DOM manipulation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2973">[ date ]</a>
              <a href="thread.html#2973">[ thread ]</a>
              <a href="subject.html#2973">[ subject ]</a>
              <a href="author.html#2973">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Mon, 04 Sep 2006 23:59:22 +0100, Phil Mayers &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">p.mayers at imperial.ac.uk</A>&gt; wrote:
&gt;<i>Is it possible for an athena LivePage to add new LiveElements? To remove 
</I>&gt;<i>them?
</I>&gt;<i>
</I>&gt;<i>The application is a web-based database editor which due to operational 
</I>&gt;<i>requirements has suddenly had a ballooning in the number of fields per HTML 
</I>&gt;<i>page, and the round-tripping of the form submits plus rendering of the 
</I>&gt;<i>extremely large HTML in one large block is actually now causing operational 
</I>&gt;<i>difficulties.
</I>&gt;<i>
</I>&gt;<i>Something like:
</I>&gt;<i>
</I>&gt;<i>+-(main)-------------------+
</I>&gt;|<i> field1: ______           |
</I>&gt;|<i> field2: ______           |
</I>&gt;|<i> checkbox: [__]           |
</I>&gt;|<i>                          |
</I>&gt;<i>+-(subitems)---------------+
</I>&gt;|<i> key | name | dom |       |
</I>&gt;<i>+-----+------+-----+-------+
</I>&gt;|<i>     |      |     | [del] | &lt;&lt; this is a 3-textbox row for each subitem
</I>&gt;<i>+-----+------+-----+-------+
</I>&gt;|<i> [Add new subitem?]       | &lt;&lt; this is a
</I>&gt;<i>+--------------------------+
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>...with maybe ~60 and climbing rows of subitems. I can handle the initial 
</I>&gt;<i>loading of the page taking a bit of time, but a user might want to add, 
</I>&gt;<i>change or delete ~10-25 rows of subitems each time they visit the page, and 
</I>&gt;<i>the round-tripping is genuinely detrimental.
</I>&gt;<i>
</I>&gt;<i>Can you do something like returning a LiveElement from a callRemote? Or can 
</I>&gt;<i>you somehow create (in a supported fashion) a server-side LiveElement, 
</I>&gt;<i>return the ID/html/whatever from the callRemote'ed method, and then run the 
</I>&gt;<i>client-side widget creation JavaScript, supplying the ID?
</I>&gt;<i>
</I>&gt;<i>Is this just plain a bad idea? Should I somehow make the entire list of 
</I>&gt;<i>subitems a single widget (less attractive, because the in-built client and 
</I>&gt;<i>server-side demuxing of the LiveElement -&gt; row is attractive)
</I>
Hey Phil,

One can indeed add new LiveElements to an already-rendered Athena page. The
simplest way to go about this is to just return the LiveElement from a
method.  The Element will be serialized in the same manner as one included
in the initial page render and arrive as an xml string given to the callback
of the Deferred returned by callRemote on the client.  The xml string can be
added to the page using Divmod.Runtime.theRuntime.{set,append}NodeContent.

Now, this is pretty nasty.

I would much rather this work in a very similar manner, but with the
important difference that the client should receive an actual Widget
instance, rather than an xml string.

I currently have no plans to implement this, but it is the way I would
ultimately like Athena to work.  In order to future proof Athena
applications, I would recommend explicitly serializing the Element when
returning it, rather than relying on Athena to do it for you.  This will
produce exactly the same behavior as I described above, with the difference
that when Athena changes, your application won't suddenly begin receiving
Widgets where it expects xml strings.

Flattening an Element is straightforward: simply pass it to
nevow.flat.flatten.  In order to exactly replicate Athena's treatment, you
will also need to wrap it in a div with the xhtml namespace.  In other words,

flat.flatten(tags.div(xmlns=&quot;<A HREF="http://www.w3.org/1999/xhtml&quot;">http://www.w3.org/1999/xhtml&quot;</A>)[obj])

Of course, if anyone would care to implement the change I described above,
I would be delighted.

Hope this clears things up,

Jean-Paul

</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002972.html">[Twisted-web] Athena DOM manipulation
</A></li>
	<LI>Next message: <A HREF="002977.html">[Twisted-web] Athena DOM manipulation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2973">[ date ]</a>
              <a href="thread.html#2973">[ thread ]</a>
              <a href="subject.html#2973">[ subject ]</a>
              <a href="author.html#2973">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
