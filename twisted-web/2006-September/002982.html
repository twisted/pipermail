<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] Re: Nevow and template like files
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Re%3A%20Nevow%20and%20template%20like%20files&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002981.html">
   <LINK REL="Next"  HREF="002983.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] Re: Nevow and template like files</H1>
    <B>Nuutti Kotivuori</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Re%3A%20Nevow%20and%20template%20like%20files&In-Reply-To="
       TITLE="[Twisted-web] Re: Nevow and template like files">naked at iki.fi
       </A><BR>
    <I>Wed Sep  6 03:03:28 CDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="002981.html">[Twisted-web] Re: Nevow and template like files
</A></li>
        <LI>Next message: <A HREF="002983.html">[Twisted-web] Re: Nevow and template like files
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2982">[ date ]</a>
              <a href="thread.html#2982">[ thread ]</a>
              <a href="subject.html#2982">[ subject ]</a>
              <a href="author.html#2982">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Valentino Volonghi aka Dialtone wrote:
&gt;<i> On Tue, 05 Sep 2006 22:48:08 +0300, Nuutti Kotivuori &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">naked at iki.fi</A>&gt; wrote:
</I>&gt;&gt;<i> Thanks! I've looked already at that and it seems nice... except for
</I>&gt;&gt;<i> two points.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> First of all, the content is looked up like this:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> ,----
</I>&gt;&gt;<i> | def macro_content(self, ctx):
</I>&gt;&gt;<i> | return loaders.xmlfile(self.template+'.html', ignoreDocType=True,
</I>&gt;&gt;<i> |                            templateDir=conf.TEMPLATE_PATH)
</I>&gt;&gt;<i> `----
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Since I have several patterns in a single file, I would need to append
</I>&gt;&gt;<i> pattern='content' keyword into that. But if I do that, then the file
</I>&gt;<i>
</I>&gt;<i> I disagree. If you use a template as a pattern container than load
</I>&gt;<i> it completely and use inevow.IQ() to get patterns from it. Patterns
</I>&gt;<i> are not rendered anyway so just style the real content of the
</I>&gt;<i> template and grab patterns togheter with it. Later on you'll be able
</I>&gt;<i> to merge the patterns inside the rendering result.
</I>
Yes, I would want to load it completely - but where should I do that
and how? I don't know if I should call the .load() method on the
docfactory myself if I want to keep the preprocessors machinery intact
and everything.

Or hmm, are you proposing on returning the entire docfactory from
somewhere? I don't want to do that as the file contains &lt;html&gt;&lt;head&gt;
etc. blocks outside the patterns so that it will be nicer to edit in
HTML editors.

Let's assume I have a content file like this (pseudohtml)

,----[ content.xhtml ]
|<i> &lt;html&gt;
</I>|<i>   &lt;head&gt;
</I>|<i>     &lt;title&gt;&lt;n:invisible n:pattern=&quot;title&quot;&gt;Page title&lt;/n:invisible&gt;&lt;/title&gt;
</I>|<i>     &lt;n:invisible n:pattern=&quot;head&quot;&gt;
</I>|<i>       &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;additional.css&quot; /&gt;
</I>|<i>     &lt;/n:invisible&gt;
</I>|<i>   &lt;/head
</I>|<i>   &lt;body&gt;
</I>|<i>     &lt;div class=&quot;content&quot;&gt;
</I>|<i>       &lt;n:invisible n:pattern=&quot;content&quot;&gt;
</I>|<i>         &lt;p&gt;Page content.&lt;/p&gt;
</I>|<i>       &lt;/n:invisible&gt;
</I>|<i>     &lt;/div&gt;
</I>|<i>     &lt;div class=&quot;help&quot;&gt;
</I>|<i>       &lt;n:invisible n:pattern=&quot;help&quot;&gt;
</I>|<i>         &lt;p&gt;Page help.&lt;/p&gt;
</I>|<i>       &lt;/n:invisible&gt;
</I>|<i>     &lt;/div&gt;
</I>|<i>   &lt;/body&gt;
</I>|<i> &lt;/html&gt;
</I>`----

Now, from this, I'd want to use the patterns defined by embedding them
in a layout page.

&gt;&gt;<i> will get read once by every macro that uses a pattern from it? That
</I>&gt;<i>
</I>&gt;<i> Once by every macro yes, but only once per macro, not once per
</I>&gt;<i> request per macro. It's a very light cost.
</I>
I meant once by every macro - this is no longer really relevant if I
load the whole page completely first.

But if I didn't, loading the whole page once per macro would still
amount to quite a lot of extra loadings of the file if I read the
entire file for each pattern.

&gt;&gt;<i> I'd like to avoid - I'd like to keep the loaders in a class
</I>&gt;&gt;<i> variable nicely, or a Fragment, or something.
</I>&gt;&gt;<i> Also, if I say pattern='content', then that loader will throw a hissy
</I>&gt;&gt;<i> fit if the pattern isn't present. So I'd need a loader that would
</I>&gt;&gt;<i> return some default value when the .load() method is called and that
</I>&gt;&gt;<i> sounds like an icky solution again. No worries though, it's easy to
</I>&gt;&gt;<i> hack.
</I>&gt;<i>
</I>&gt;<i> You should not hack it. Nope, what if the default value is not there
</I>&gt;<i> too?  Use a Fragment (or rather an Element instead). Besides that I
</I>&gt;<i> don't really think that templates containing many patterns are a
</I>&gt;<i> good way to deal with the problem, many templates each with a
</I>&gt;<i> Fragment associated is a much better way to solve it.
</I>
Okay, consider the content page shown above. Now let's assume that
most pages don't need the &quot;head&quot; pattern at all. I wouldn't want to
write the empty pattern on all pages just because it has to be there,
instead I would just want to say that put T.invisible() there if the
pattern doesn't exist. (With just the &quot;head&quot; pattern it wouldn't be so
much of a problem, but I might later on have to add some more, and I
don't want to change every content page just because one content page
requires something special.)

So this is what I'd like the default for. But ofcourse, if I load the
entire page first, and then just use the inevow.IQ machinery, making
the default patterns is easy.

&gt;&gt;<i> So, any ideas how I could have just one loader that would load the
</I>&gt;&gt;<i> file once, and then just use normal nevow machinery to fetch the
</I>&gt;&gt;<i> patterns from it (where it is easier to get a default value if the
</I>&gt;&gt;<i> pattern does not exist)?
</I>&gt;<i>
</I>&gt;<i> I told you:
</I>&gt;<i>
</I>&gt;<i> loaded = loaders.xmlfile('file')
</I>&gt;<i> some_pattern = inevow.IQ(loaded).onePattern('whatever')
</I>
That seems to work at first - but if there are any macros or render
methods inside the file I load, then I get Could not adapt error to
IMacroFactory.

&gt;&gt;<i> Actually, I have a bit of a problem there - how do I get the whole
</I>&gt;&gt;<i> document loaded in the methods I have? I can call
</I>&gt;&gt;<i> self.docFactory.load() in every method ofcourse, but then the context
</I>&gt;&gt;<i> is a bit screwy - however, I hesitate to pass in the context that is
</I>&gt;&gt;<i> available at the time of the first call, since that might come from a
</I>&gt;&gt;<i> different page each time and I'm not sure if the render/macro methods
</I>&gt;&gt;<i> are going to be invoked from the correct object and such.
</I>&gt;<i>
</I>&gt;<i> Don't pass the context, what's the problem here?
</I>
Macros and render methods. In the case of the snippet pages, I would
like them to be interpreted in the context of the Fragment class that
is loading the entire snippet page.

&gt;&gt;<i> I thought that the rendered/parsed version of the template resided in
</I>&gt;&gt;<i> the loaders.xmlfile instance that is created - and if I return a new
</I>&gt;&gt;<i> loaders.xmlfile instance (with a different pattern clause) from
</I>&gt;&gt;<i> several different macros, then the page would get loaded as many
</I>&gt;&gt;<i> times. Or if I returned a loaders.xmlfile instance from a render
</I>&gt;<i>
</I>&gt;<i> No because the macro is not reloaded. Just try to modify a file that
</I>&gt;<i> was compiled in macro. You'll see that unless you modify the file
</I>&gt;<i> containing the macro nothing changes.
</I>
I understand that the macro is not reloaded - but each macro will load
the page once. Which would be a problem on a page with hundreds of
snippets if every snippet would cause the page to be loaded once.

&gt;&gt;<i> method, then the file would be parsed on each rendition of the page -
</I>&gt;&gt;<i> am I wrong?
</I>&gt;<i>
</I>&gt;<i> Yes a bit.
</I>&gt;<i>
</I>&gt;&gt;<i> Patterns are optional yes, but if I call
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> loaders.xmlfile(filename, pattern='foobar')
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> that will throw an exception if pattern 'foobar' is not present in the
</I>&gt;<i>
</I>&gt;<i> Of course... You are telling it to search exactly for a particular pattern.
</I>
...and this was exactly the problem I was having - if I would use a
construct like that

&gt;&gt;<i> file. So will onePattern(), but that is easily wrapped in a try/catch
</I>&gt;&gt;<i> block (or I can use patternGenerator which does take a default
</I>&gt;&gt;<i> argument in some cases) - where as a loader being wrapped doesn't do
</I>&gt;&gt;<i> anything since the actual loading happens later (when the load()
</I>&gt;&gt;<i> method is called).
</I>&gt;<i>
</I>&gt;<i> correct.
</I>&gt;<i>
</I>&gt;<i> It's not very clear what's your problem though. Maybe you should
</I>&gt;<i> either show some code or try to solve it in the way you explained
</I>&gt;<i> which seemed reasonable anyway.
</I>
Okay, I will try to be a bit clearer. For now, I have two problems -
how to load the &quot;content&quot; page all at once and then use patterns with
optional defaults from it. And then the snippet problem. I will
outline the snippet problem later.

I wrote a really tiny testsite outlining my problem. I will put the
three files here:

,----[ testpage.xhtml ]
|<i> &lt;?xml version=&quot;1.0&quot;?&gt;
</I>|<i> &lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot;
</I>|<i> &quot;<A HREF="http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;">http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;</A>&gt;
</I>|<i> &lt;html xmlns=&quot;<A HREF="http://www.w3.org/1999/xhtml&quot;">http://www.w3.org/1999/xhtml&quot;</A>
</I>|<i>   xmlns:n=&quot;<A HREF="http://nevow.com/ns/nevow/0.1&quot;">http://nevow.com/ns/nevow/0.1&quot;</A>&gt;
</I>|<i>   &lt;head&gt;
</I>|<i>     &lt;title&gt;
</I>|<i>       &lt;n:invisible n:macro=&quot;title&quot;&gt;Page Title&lt;/n:invisible&gt;
</I>|<i>     &lt;/title&gt;
</I>|<i>     &lt;n:invisible n:macro=&quot;head&quot; /&gt;
</I>|<i>   &lt;/head&gt;
</I>|<i> 
</I>|<i>   &lt;body&gt;
</I>|<i>     &lt;h1&gt;&lt;n:invisible n:macro=&quot;title&quot;&gt;Page Title&lt;/n:invisible&gt;&lt;/h1&gt;
</I>|<i> 
</I>|<i>     &lt;div class=&quot;plain-content&quot;&gt;
</I>|<i>       &lt;n:invisible n:macro=&quot;content&quot; /&gt;
</I>|<i>     &lt;/div&gt;
</I>|<i>   &lt;/body&gt;
</I>|<i> &lt;/html&gt;
</I>`----

,----[ datapage.xhtml ]
|<i> &lt;?xml version=&quot;1.0&quot;?&gt;
</I>|<i> &lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot;
</I>|<i> &quot;<A HREF="http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;">http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd&quot;</A>&gt;
</I>|<i> &lt;html xmlns=&quot;<A HREF="http://www.w3.org/1999/xhtml&quot;">http://www.w3.org/1999/xhtml&quot;</A>
</I>|<i>   xmlns:n=&quot;<A HREF="http://nevow.com/ns/nevow/0.1&quot;">http://nevow.com/ns/nevow/0.1&quot;</A>&gt;
</I>|<i>   &lt;head&gt;
</I>|<i>     &lt;title&gt;&lt;n:invisible n:pattern=&quot;title&quot;&gt;Data Page&lt;/n:invisible&gt;&lt;/title&gt;
</I>|<i>     &lt;n:invisible n:pattern=&quot;head&quot; /&gt;
</I>|<i>   &lt;/head&gt;
</I>|<i>   &lt;body&gt;
</I>|<i>     &lt;n:invisible n:pattern=&quot;content&quot;&gt;
</I>|<i>       &lt;p&gt;
</I>|<i>       &lt;n:invisible n:macro=&quot;test&quot;&gt;
</I>|<i>           Replaced by test data.
</I>|<i>         &lt;/n:invisible&gt;
</I>|<i>       &lt;/p&gt;
</I>|<i>     &lt;/n:invisible&gt;
</I>|<i>   &lt;/body&gt;
</I>|<i> &lt;/html&gt;
</I>`----

,----
|<i> from nevow import inevow, loaders, rend, guard, url, stan, tags as T
</I>|<i> 
</I>|<i> class TestPage(rend.Page):
</I>|<i>     docFactory = loaders.xmlfile('testpage.xhtml')
</I>|<i>     datapage = None
</I>|<i> 
</I>|<i>     def macro_title(self, ctx):
</I>|<i>         return loaders.xmlfile(self.datapage, pattern='title')
</I>|<i> 
</I>|<i>     def macro_head(self, ctx):
</I>|<i>         return loaders.xmlfile(self.datapage, pattern='head')
</I>|<i> 
</I>|<i>     def macro_content(self, ctx):
</I>|<i>         return loaders.xmlfile(self.datapage, pattern='content')
</I>|<i> 
</I>|<i> class DataPage(TestPage):
</I>|<i>     datapage = 'datapage.xhtml'
</I>|<i> 
</I>|<i>     def macro_test(self, ctx):
</I>|<i>         return 'Test successful.'
</I>`----

Now, how would I modify this example so that &quot;datapage.xhtml&quot; is
loaded only once, even though there are three different macros using
it. And also so that the &quot;head&quot; pattern could be optional and is
replaced by T.invisible() if not present. All the while not breaking
the macro_test part, splitting the pages into several files or
breaking the normal html rendability/editability of the datapage.

I will come up with something outlining the snippet problem later.

Thanks in advance,
-- Naked


</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002981.html">[Twisted-web] Re: Nevow and template like files
</A></li>
	<LI>Next message: <A HREF="002983.html">[Twisted-web] Re: Nevow and template like files
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2982">[ date ]</a>
              <a href="thread.html#2982">[ thread ]</a>
              <a href="subject.html#2982">[ subject ]</a>
              <a href="author.html#2982">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
