<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] Standard sequence renderer &quot;loosing&quot; tags?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Standard%20sequence%20renderer%20%22loosing%22%20tags%3F&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002234.html">
   <LINK REL="Next"  HREF="002236.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] Standard sequence renderer &quot;loosing&quot; tags?</H1>
    <B>A. Goryunov</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Standard%20sequence%20renderer%20%22loosing%22%20tags%3F&In-Reply-To="
       TITLE="[Twisted-web] Standard sequence renderer &quot;loosing&quot; tags?">agoryunov at list.ru
       </A><BR>
    <I>Sat Dec 17 14:22:50 MST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="002234.html">[Twisted-web] interface.queryDescriptionFor instead of getattr
</A></li>
        <LI>Next message: <A HREF="002236.html">[Twisted-web] Standard sequence renderer &quot;loosing&quot; tags?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2235">[ date ]</a>
              <a href="thread.html#2235">[ thread ]</a>
              <a href="subject.html#2235">[ subject ]</a>
              <a href="author.html#2235">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I've noticed that Page.renderString() &quot;swallows&quot; some of the stan nodes. 
I've also tried the example below in an actual Twisted service and got 
the same result. Doing it with an XML template also yields erroneous 
output. Namely, it looses &quot;table&quot;, &quot;tr&quot;, a couple of &quot;td&quot; tags were MIA 
too I believe, as well as two &quot;input&quot;s.

The code I was using for testing is attached. It's supposed to be a 
library of widgets that are constructed using Fragments and render_sequence.

-------------- next part --------------
from nevow import tags as T
from nevow import flat, rend, loaders




class TestPage(rend.Page):
    docFactory = loaders.stan(
        T.html[
            T.body[
                T.invisible(render=T.directive(&quot;widget&quot;))[
                    T.invisible(pattern=&quot;widget_name&quot;)['PortalContent'],
                    T.invisible(pattern=&quot;widget_slot&quot;)['main_content'],
                    T.invisible(pattern=&quot;widget_slot&quot;)[
                        T.invisible(render=T.directive(&quot;widget&quot;))[
                            T.invisible(pattern=&quot;widget_name&quot;)['PortalBarVert'],
                            T.invisible(pattern=&quot;widget_slot&quot;)[
                                T.invisible(render=T.directive(&quot;widget&quot;))[
                                    T.invisible(pattern=&quot;widget_name&quot;)['LoginForm'],
                                    T.invisible(pattern=&quot;widget_slot&quot;)['Sign in'],
                                    T.invisible(pattern=&quot;widget_slot&quot;)['User: '],
                                    T.invisible(pattern=&quot;widget_slot&quot;)['Password: '],
                                    T.invisible(pattern=&quot;widget_slot&quot;)[T.input(type=&quot;submit&quot;, name=&quot;null&quot;, value=&quot;Submit&quot;)]
                                ]
                            ]
                        ]
                    ]
                ]
            ]])

    def render_widget(self,ctx,data):
        wName = ctx.tag.onePattern(&quot;widget_name&quot;).children[0].strip('\n\t ')
        attrs = ctx.tag.allPatterns(&quot;widget_slot&quot;)
        args = []
        for attr in attrs:
            args.append(T.xml(attr.children))
        try:
            wdgt = globals()[wName](args)
            return ctx.tag[wdgt]
        except IndexError:
            return ctx.tag[T.p(style=&quot;font-color : red&quot;)[&quot;Unknown widget name: %s&quot; % wName]]
        
        
class LoginForm(rend.Fragment):
    docFactory = loaders.stan(
        T.div(class_=&quot;login-form&quot;, render=T.directive(&quot;sequence&quot;))[
            T.p(class_=&quot;small-form-title&quot;, pattern=&quot;item&quot;, render=T.directive('arg')),
            T.form(action=&quot;_submit&quot;, method=&quot;post&quot;)[
                T.table(id=&quot;login-form-table&quot;)[
                    T.tr[
                        T.td(align=&quot;right&quot;)[
                            T.label(for_=&quot;user&quot;, pattern=&quot;item&quot;, render=T.directive('arg'))
                            ],
                        T.td(align=&quot;left&quot;)[
                            T.input(type=&quot;text&quot;, name=&quot;user&quot;,
                                    class_=&quot;login-input&quot;)
                            ]
                        ],
                    T.tr[
                        T.td(align=&quot;right&quot;)[
                            T.label(for_=&quot;pass&quot;, pattern=&quot;item&quot;, render=T.directive('arg'))
                            ],
                        T.td(align=&quot;left&quot;)[
                            T.input(type=&quot;password&quot;, name=&quot;pass&quot;,
                                    class_=&quot;login-input&quot;)
                            ]
                        ],
                    T.tr[T.td(colspan=&quot;2&quot;)],
                    T.tr[
                        T.td(colspan=&quot;2&quot;, align=&quot;center&quot;, pattern=&quot;item&quot;, render=T.directive('arg'))
                        ]
                    ]
                ]
            ])

    def render_arg(self,ctx,data):
        return ctx.tag[data]

class PortalContent(rend.Fragment):
    docFactory = loaders.stan(
        T.table(id=&quot;portal-content&quot;, render=T.directive(&quot;sequence&quot;))[
            T.tr[
                T.td(class_=&quot;portal-content-main&quot;, pattern='item', render=T.directive('arg')),
                T.td(class_=&quot;portal-content-sidebar&quot;, id=&quot;portal-sidebar-right&quot;,
                     pattern=&quot;item&quot;, render=T.directive(&quot;arg&quot;))
                ]
            ])

    def render_arg(self,ctx,data):
        return ctx.tag[data]
    
class PortalBarVert(rend.Fragment):
    docFactory = loaders.stan(
        T.table(class_=&quot;portal-bar-vertical&quot;, render=T.directive('sequence'))[
            T.tr(pattern='item', render=T.directive('arg'))
            ])

    def render_arg(self,ctx,data):
        return ctx.tag[T.td(class_='vert-sidebar-slot')[data]]



page = TestPage()
df = page.renderString()
def printPage(result):
    print result

def printErr(err):
    print err
df.addCallback(printPage)
df.addErrback(printErr)
</PRE>











<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002234.html">[Twisted-web] interface.queryDescriptionFor instead of getattr
</A></li>
	<LI>Next message: <A HREF="002236.html">[Twisted-web] Standard sequence renderer &quot;loosing&quot; tags?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2235">[ date ]</a>
              <a href="thread.html#2235">[ thread ]</a>
              <a href="subject.html#2235">[ subject ]</a>
              <a href="author.html#2235">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
