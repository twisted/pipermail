<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] Matt's &quot;forms&quot; - validation error when field name
	is not ASCII
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Matt%27s%20%22forms%22%20-%20validation%20error%20when%20field%20name%0A%09is%20not%20ASCII&In-Reply-To=20051210184802.GB26145%40divmod.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002204.html">
   <LINK REL="Next"  HREF="002206.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] Matt's &quot;forms&quot; - validation error when field name
	is not ASCII</H1>
    <B>Jean-Paul Calderone</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Matt%27s%20%22forms%22%20-%20validation%20error%20when%20field%20name%0A%09is%20not%20ASCII&In-Reply-To=20051210184802.GB26145%40divmod.com"
       TITLE="[Twisted-web] Matt's &quot;forms&quot; - validation error when field name
	is not ASCII">exarkun at divmod.com
       </A><BR>
    <I>Sat Dec 10 12:23:36 MST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="002204.html">[Twisted-web] Matt's &quot;forms&quot; - validation error when field name
	is not ASCII
</A></li>
        <LI>Next message: <A HREF="002206.html">[Twisted-web] Matt's &quot;forms&quot; - error when using field
	Integer(immutable=True)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2205">[ date ]</a>
              <a href="thread.html#2205">[ thread ]</a>
              <a href="subject.html#2205">[ subject ]</a>
              <a href="author.html#2205">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Sat, 10 Dec 2005 19:48:02 +0100, Valentino Volonghi aka Dialtone &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">dialtone at divmod.com</A>&gt; wrote:
&gt;<i>On Sat, Dec 10, 2005 at 06:43:28PM +0100, Paul Reznicek wrote:
</I>&gt;&gt;<i> Yes, this is a way too, but than you must take care in each
</I>&gt;&gt;<i> &quot;.addField(&quot; line, my patch save those sorrows ...
</I>&gt;<i>
</I>&gt;<i>Actually that is the only way, not one way. All the other ways, if they work,
</I>&gt;<i>they do by chance and are very fragile.
</I>&gt;<i>
</I>&gt;<i>For example your 'solution' is simply broken by using a different encoding
</I>&gt;<i>that cannot be decoded with the default one used by unicode().
</I>
Here are some concrete examples:

<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">exarkun at boson</A>:~$ python
Python 2.4.2 (#2, Sep 30 2005, 21:19:01)
[GCC 4.0.2 20050808 (prerelease) (Ubuntu 4.0.1-4ubuntu8)] on linux2
Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.
&gt;&gt;&gt;<i> unicode('&#233;')
</I>Traceback (most recent call last):
  File &quot;&lt;stdin&gt;&quot;, line 1, in ?
UnicodeDecodeError: 'ascii' codec can't decode byte 0xc3 in position 0: 
ordinal not in range(128)
&gt;&gt;&gt;<i>
</I>
Oops, I typed an accented e, which ended up in the code as UTF-8, since 
that's how my terminal is configured.  But Python has no way of knowing 
this, so it has to use the system specified default encoding to decode 
the bytes my terminal sent to it.  Since that's ASCII (the only sane 
system encoding, unfortunately), not UTF-8, the decode explodes.

Well fine.  How about I change the system encoding to UTF-8, then things 
will work, right?

&gt;&gt;&gt;<i> [magic censored - the system encoding is utf-8 now, trust me]
</I>&gt;&gt;&gt;<i> unicode('&#233;')
</I>u'\xe9'

Hey cool, that worked.  Let's try another character.

&gt;&gt;&gt;<i> unicode('&#24369;')
</I>Traceback (most recent call last):
  File &quot;&lt;stdin&gt;&quot;, line 1, in ?
UnicodeDecodeError: 'ascii' codec can't decode byte 0xae in position 0: 
ordinal not in range(128)
&gt;&gt;&gt;<i>
</I>
Ahh crud.  This time I typed in some Big-5 encoded bytes to represent a 
Han character.  The system encoding is still UTF-8 though, so again it 
is broken.

Now, you might think it is unreasonable to be typing things in UTF-8 to 
start with and then randomly switch over to Big-5 (actually, doing 
anything with Big-5 is crazy, but I digress).  But just imagine you are 
trying to use two different libraries in your program: one developed in 
Sweden and one developed in China.  Nevow has to work with both of 
these *at the same time*.  So it cannot assume an encoding anywhere, 
even the system default encoding (you might be trying to run the program 
in the United States!), so the encodings have to be provided at the 
location of the actual bytes themselves: the way you do this in Python 
is by using unicode strings (u'...'), not byte strings ('...') and 
declaring the encoding of the source file the literals appear in.

Hope this helps clear things up,

Jean-Paul

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002204.html">[Twisted-web] Matt's &quot;forms&quot; - validation error when field name
	is not ASCII
</A></li>
	<LI>Next message: <A HREF="002206.html">[Twisted-web] Matt's &quot;forms&quot; - error when using field
	Integer(immutable=True)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2205">[ date ]</a>
              <a href="thread.html#2205">[ thread ]</a>
              <a href="subject.html#2205">[ subject ]</a>
              <a href="author.html#2205">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
