<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] freeform and adbapi
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20freeform%20and%20adbapi&In-Reply-To=4262E49E.60802%40gmx.net">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001392.html">
   <LINK REL="Next"  HREF="001394.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] freeform and adbapi</H1>
    <B>Tommi Virtanen</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20freeform%20and%20adbapi&In-Reply-To=4262E49E.60802%40gmx.net"
       TITLE="[Twisted-web] freeform and adbapi">tv at twistedmatrix.com
       </A><BR>
    <I>Sun Apr 17 22:58:18 MDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="001392.html">[Twisted-web] freeform and adbapi
</A></li>
        <LI>Next message: <A HREF="001394.html">[Twisted-web] Efficient server-side web-scraping?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1393">[ date ]</a>
              <a href="thread.html#1393">[ thread ]</a>
              <a href="subject.html#1393">[ subject ]</a>
              <a href="author.html#1393">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Stephan Cieszynski wrote:
&gt;<i> Sorry, but the following description lead me to use a deferred:
</I>&gt;<i> 
</I>&gt;<i> formless/iformless.py:
</I>&gt;<i>     def coerce(self, val, configurable):
</I>&gt;<i>         &quot;&quot;&quot;Coerce the input 'val' from a string into a value suitable
</I>&gt;<i>         for the type described by the implementor. If coercion fails,
</I>&gt;<i>         coerce should raise InputError with a suitable error message
</I>&gt;<i>         to be shown to the user. 'configurable' is the configurable object
</I>&gt;<i>         in whose context the coercion is taking place.
</I>&gt;<i> 
</I>&gt;<i>         May return a Deferred.
</I>&gt;<i> -----------------------^
</I>&gt;<i>         &quot;&quot;&quot;
</I>
That's what the documents say, but sadly not what the code always does.
It may even work in some cases, but definitely not in many cases.

.coerce() is called from .process(), which returns the value
directly through, and only does exception handling for immediately
raised exceptions:

         try:
             result[binding.name] = iformless.IInputProcessor(
                 binding.typedValue).process(context, boundTo,
                 data.get(binding.name, ['']))
         except formless.InputError, e:
             result[binding.name] = data.get(binding.name, [''])
             raise formless.ValidateError({binding.name: e.reason},
                                          e.reason, result)
...
         return result

A Deferred returning an errback in the above will go unnoticed by that
code.

&gt;<i> Your example not working:
</I>&gt;<i> First, if 'foo' is a deferred the callback isn't fired at this time and 
</I>&gt;<i> validating isn't possible.
</I>
&quot;foo&quot; is a _function_. It cannot be a Deferred. Did you mean if &quot;foo&quot;
_returns_ a Deferred, that is &quot;if 'foo' is deferred&quot;, without &quot;a&quot;?
I still can't parse that sentence.

 &gt; Second, raising an exception in a autocallable like this
&gt;<i> def foo(self, ctx, bar):
</I>&gt;<i>     def _cb(r):
</I>&gt;<i>         if not valid(r):
</I>&gt;<i>             raise annotate.ValidateError(...)
</I>&gt;<i> 
</I>&gt;<i>     bar.addCallback(_cb)
</I>&gt;<i> 
</I>&gt;<i> take no effect at rendering time and the slot('error') isn't filled with 
</I>&gt;<i> our errormessage.
</I>
bar.addCallback? If bar is Deferred, nevow should not call that function
until it has a result for the Deferred. Though I wouldn't be surprised
to see more bugs in this area..

Callers not seeing the raise ValidateError is only logical, because you
raise it in a callback of a Deferred nothing waits on. That's like 
returning a value from function, but no one using or storing that value
in any way. &quot;return bar&quot; may change things there.

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001392.html">[Twisted-web] freeform and adbapi
</A></li>
	<LI>Next message: <A HREF="001394.html">[Twisted-web] Efficient server-side web-scraping?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1393">[ date ]</a>
              <a href="thread.html#1393">[ thread ]</a>
              <a href="subject.html#1393">[ subject ]</a>
              <a href="author.html#1393">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
