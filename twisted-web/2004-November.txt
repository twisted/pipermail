From janeaustine50 at hotmail.com  Wed Nov  3 03:55:59 2004
From: janeaustine50 at hotmail.com (Austine Jane)
Date: Wed Nov  3 03:57:48 2004
Subject: [Twisted-web] Using Twisted-web with Nevow for high-traffic site
Message-ID: <BAY16-F20zMcvsq9IcV0000d9d5@hotmail.com>

Hello

We are going to build a web application and want to know if twisted+nevow 
fit our situation. Our server has four cpus running. Our web application 
would require high cpu load sometimes, and a multiple of users might use the 
system at the same time.

I guess twisted is single threaded server model. How could we make it scale 
well and make advantage of four cpus? Does it support process farm like scgi 
server?

Thanks.

Jane

_________________________________________________________________
Express yourself instantly with MSN Messenger! Download today it's FREE! 
http://messenger.msn.com/


From tv at twistedmatrix.com  Thu Nov  4 00:47:58 2004
From: tv at twistedmatrix.com (Tommi Virtanen)
Date: Thu Nov  4 00:49:53 2004
Subject: [Twisted-web] Using Twisted-web with Nevow for high-traffic site
In-Reply-To: <BAY16-F20zMcvsq9IcV0000d9d5@hotmail.com>
References: <BAY16-F20zMcvsq9IcV0000d9d5@hotmail.com>
Message-ID: <4189DEAE.2060306@twistedmatrix.com>

Austine Jane wrote:

>  We are going to build a web application and want to know if
>  twisted+nevow fit our situation. Our server has four cpus running.
>  Our web application would require high cpu load sometimes, and a
>  multiple of users might use the system at the same time.
>
>  I guess twisted is single threaded server model. How could we make it
>  scale well and make advantage of four cpus? Does it support process
>  farm like scgi server?

Have a frontend service that load balances connections to four or maybe
five instances of Twisted. For example LVS, iptables NAT rules, apache
or Twisted itself can be used as the load balancer, depending on your
needs.

In essence, treat your 4 CPUs like you would treat 4 separate machines.




From floydophone at gmail.com  Thu Nov  4 11:35:34 2004
From: floydophone at gmail.com (Peter Hunt)
Date: Thu Nov  4 11:35:43 2004
Subject: [Twisted-web] Buffered requests
Message-ID: <6654eac404110410353e82b23d@mail.gmail.com>

I'm wondering if there is a way that I can "buffer" a request, store
the output it would normally send to the client in a string, and then
output something different, such as a redirect, to the client.

For example, it'd be nice if it worked like this:

buffered_request.setHeader("Content-type","text/html")
buffered_request.write("<html>Hello %s</html>" %
buffered_request.args.get("name",["world"])[0])
buffered_request.finish()
output = buffered_request.getOutput()
request.setHeader("Content-type","text/plain")
request.write("The output that will be written to the client is:\n " + output)

The end result (in the browser) should be:

The output that will be written to the client is:
200 OK
Content-type: text/plain

<html>Hello world</html>

I've tried playing around with something called "queued", but I'm not
sure if that's what I want. Essentially I just want to capture the
output of a request in a string.

Thanks in advance.

From dp at ulaluma.com  Thu Nov  4 14:02:14 2004
From: dp at ulaluma.com (Donovan Preston)
Date: Thu Nov  4 14:02:24 2004
Subject: [Twisted-web] Buffered requests
In-Reply-To: <6654eac404110410353e82b23d@mail.gmail.com>
References: <6654eac404110410353e82b23d@mail.gmail.com>
Message-ID: <CDDA18EB-2EA4-11D9-8344-000A95864FC4@ulaluma.com>


On Nov 4, 2004, at 10:35 AM, Peter Hunt wrote:

> I'm wondering if there is a way that I can "buffer" a request, store
> the output it would normally send to the client in a string, and then
> output something different, such as a redirect, to the client.
>
> For example, it'd be nice if it worked like this:
>
> buffered_request.setHeader("Content-type","text/html")
> buffered_request.write("<html>Hello %s</html>" %
> buffered_request.args.get("name",["world"])[0])
> buffered_request.finish()
> output = buffered_request.getOutput()
> request.setHeader("Content-type","text/plain")
> request.write("The output that will be written to the client is:\n " + 
> output)
>
> The end result (in the browser) should be:
>
> The output that will be written to the client is:
> 200 OK
> Content-type: text/plain
>
> <html>Hello world</html>
>
> I've tried playing around with something called "queued", but I'm not
> sure if that's what I want. Essentially I just want to capture the
> output of a request in a string.

You'll have to do it yourself. You could just do it explicitly by 
constructing an object around the request and doing the buffering in 
that. Or you could try being really tricky and doing something like 
this (untested):

class Foo(Resource):
     def render_GET(self, request):
         buffer = StringIO()
         original_write = request.write
         request.write = buffer.write
         original_finish = request.finish
         request.finish = lambda: (original_write(buffer.getvalue()), 
original_finish())
         self.renderTheActualPage()
         return NOT_DONE_YET

nevow's rend.Page has a "buffered" attribute which, when set, does all 
this for you, so you can set headers any time during the rendering 
process and the headers will not be written until the entire body has 
been rendered.

dp


From floydophone at gmail.com  Thu Nov  4 14:27:11 2004
From: floydophone at gmail.com (Peter Hunt)
Date: Thu Nov  4 14:27:46 2004
Subject: [Twisted-web] Buffered requests
In-Reply-To: <CDDA18EB-2EA4-11D9-8344-000A95864FC4@ulaluma.com>
References: <6654eac404110410353e82b23d@mail.gmail.com>
	<CDDA18EB-2EA4-11D9-8344-000A95864FC4@ulaluma.com>
Message-ID: <6654eac404110413275abed0e7@mail.gmail.com>

Will that include the HTTP response code and headers?


On Thu, 4 Nov 2004 13:02:14 -0800, Donovan Preston <dp@ulaluma.com> wrote:
> 
> 
> 
> On Nov 4, 2004, at 10:35 AM, Peter Hunt wrote:
> 
> > I'm wondering if there is a way that I can "buffer" a request, store
> > the output it would normally send to the client in a string, and then
> > output something different, such as a redirect, to the client.
> >
> > For example, it'd be nice if it worked like this:
> >
> > buffered_request.setHeader("Content-type","text/html")
> > buffered_request.write("<html>Hello %s</html>" %
> > buffered_request.args.get("name",["world"])[0])
> > buffered_request.finish()
> > output = buffered_request.getOutput()
> > request.setHeader("Content-type","text/plain")
> > request.write("The output that will be written to the client is:\n " +
> > output)
> >
> > The end result (in the browser) should be:
> >
> > The output that will be written to the client is:
> > 200 OK
> > Content-type: text/plain
> >
> > <html>Hello world</html>
> >
> > I've tried playing around with something called "queued", but I'm not
> > sure if that's what I want. Essentially I just want to capture the
> > output of a request in a string.
> 
> You'll have to do it yourself. You could just do it explicitly by
> constructing an object around the request and doing the buffering in
> that. Or you could try being really tricky and doing something like
> this (untested):
> 
> class Foo(Resource):
>     def render_GET(self, request):
>         buffer = StringIO()
>         original_write = request.write
>         request.write = buffer.write
>         original_finish = request.finish
>         request.finish = lambda: (original_write(buffer.getvalue()),
> original_finish())
>         self.renderTheActualPage()
>         return NOT_DONE_YET
> 
> nevow's rend.Page has a "buffered" attribute which, when set, does all
> this for you, so you can set headers any time during the rendering
> process and the headers will not be written until the entire body has
> been rendered.
> 
> dp
> 
>

From erik at splunktechnology.com  Thu Nov  4 14:33:10 2004
From: erik at splunktechnology.com (Erik Swan)
Date: Thu Nov  4 14:33:19 2004
Subject: [Twisted-web] Nested Nevow templates
Message-ID: <418AA016.4080506@splunktechnology.com>

Everyone,

I'm somewhat new to Nevow and have a simple question - btw, it maybe 
already possible and i missed the man page...

We mostly use HTML based templates to drive our presentations as we have 
an html designer that can design and maintain a large majority of the UI 
without knowledge of any coding.  The designer delivers html that can be 
rendered on its own for review but also adds in directives, patterns and 
slots to make the programmers life easier.

My question centers around the best way to have nested templates - that 
is i'd like a directive that would function as an include and all the 
appropriate Nevow render code get executed automatically. That way our 
designer can build a header, footer, sidebars, and other html components 
as separate files and the main template just "includes" as appropriate.  
Something like
  <nevow:include name="blah.html">

Additionally, and here is my Nevow ignorance, there must be a simple few 
lines of code that does the equivalent in code for example if i had:
  <nevow:render name = templateName>

then in...
  def render_templateName(self, context, data):
      #load and render file templateName as include and return result

Lastly, if the above method works OK then I'd rather have
  <nevow:render name=include nevow:arg=templateName>
where i can have a generic include render method and take an argument 
from the html tag.

So, like i said, being new this maybe all be easy/possible and i just 
missed it. Also, i've felt the wrath of mvc and proper separation of 
code from html for almost 10 years now and i understand how the above is 
in violation ;-)

Thanks in advance for any help.
Cheers,
e.



From orbitz at ezabel.com  Thu Nov  4 15:09:35 2004
From: orbitz at ezabel.com (orbitz)
Date: Thu Nov  4 15:09:44 2004
Subject: [Twisted-web] Nested Nevow templates
In-Reply-To: <418AA016.4080506@splunktechnology.com>
References: <418AA016.4080506@splunktechnology.com>
Message-ID: <418AA89F.1000604@ezabel.com>

Render methods can return rend.Page's. so

def render_nested(self, context, data):
    return Mypage()

If you want to pass data then just do
<nevow:data="whatever" nevow:render="nested"/>

Then define data_whatever to put some data on the stack and 
render_whatever to take the data and pass it ot yoru page constructor


Erik Swan wrote:

> Everyone,
>
> I'm somewhat new to Nevow and have a simple question - btw, it maybe 
> already possible and i missed the man page...
>
> We mostly use HTML based templates to drive our presentations as we 
> have an html designer that can design and maintain a large majority of 
> the UI without knowledge of any coding.  The designer delivers html 
> that can be rendered on its own for review but also adds in 
> directives, patterns and slots to make the programmers life easier.
>
> My question centers around the best way to have nested templates - 
> that is i'd like a directive that would function as an include and all 
> the appropriate Nevow render code get executed automatically. That way 
> our designer can build a header, footer, sidebars, and other html 
> components as separate files and the main template just "includes" as 
> appropriate.  Something like
>  <nevow:include name="blah.html">
>
> Additionally, and here is my Nevow ignorance, there must be a simple 
> few lines of code that does the equivalent in code for example if i had:
>  <nevow:render name = templateName>
>
> then in...
>  def render_templateName(self, context, data):
>      #load and render file templateName as include and return result
>
> Lastly, if the above method works OK then I'd rather have
>  <nevow:render name=include nevow:arg=templateName>
> where i can have a generic include render method and take an argument 
> from the html tag.
>
> So, like i said, being new this maybe all be easy/possible and i just 
> missed it. Also, i've felt the wrath of mvc and proper separation of 
> code from html for almost 10 years now and i understand how the above 
> is in violation ;-)
>
> Thanks in advance for any help.
> Cheers,
> e.
>
>
>
> _______________________________________________
> Twisted-web mailing list
> Twisted-web@twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web
>


From dialtone at gmail.com  Thu Nov  4 15:17:49 2004
From: dialtone at gmail.com (Valentino Volonghi)
Date: Thu Nov  4 15:18:24 2004
Subject: [Twisted-web] Nested Nevow templates
In-Reply-To: <418AA016.4080506@splunktechnology.com>
References: <418AA016.4080506@splunktechnology.com>
Message-ID: <c893b85304110414175b92b604@mail.gmail.com>

On Thu, 04 Nov 2004 13:33:10 -0800, Erik Swan <erik@splunktechnology.com> wrote:
> Everyone,
> 
> I'm somewhat new to Nevow and have a simple question - btw, it maybe
> already possible and i missed the man page...

Actually... Even a poor man page would be welcome these days :)
 
> My question centers around the best way to have nested templates - that
> is i'd like a directive that would function as an include and all the
> appropriate Nevow render code get executed automatically. That way our
> designer can build a header, footer, sidebars, and other html components
> as separate files and the main template just "includes" as appropriate.
> Something like
>   <nevow:include name="blah.html">

Nevow provides Fragments that are mostly like Page objects but could
be rendered inside another Page like they were simple tags or strings
(that fill slots).

<nevow:invisible nevow:render="content">
    <nevow:slot name="content" />
</nevow:invisible>

And in the code side:

    def render_content(self, ctx, data):
        ctx.tag.fillSlots('content', MyFragment())
        return ctx.tag

class MyFragment(rend.Fragment):
    docFactory = loaders.xmlfile('some_partial_html.html', ignoreDocType=True)

I also suggest putting all the html from the partial html inside a
<nevow:invisible> tag.

I've implemented such a thing in weever:
http://svn.berlios.de/viewcvs/weever/trunk/src/?rev=55#dirlist

Here is the source view from svn, in the templates directory you will
find all the templates while under web all the logic that handles the
composition (main.py is the most important file)

HTH

-- 
Valentino Volonghi aka Dialtone
Now running FreeBSD 5.3-beta6
Blog: http://vvolonghi.blogspot.com
Home Page: http://xoomer.virgilio.it/dialtone/

From matt at pollenation.net  Thu Nov  4 15:28:37 2004
From: matt at pollenation.net (Matt Goodall)
Date: Thu Nov  4 15:28:55 2004
Subject: [Twisted-web] Nested Nevow templates
In-Reply-To: <418AA016.4080506@splunktechnology.com>
References: <418AA016.4080506@splunktechnology.com>
Message-ID: <1099607317.20913.25.camel@stock.localhost>

On Thu, 2004-11-04 at 13:33 -0800, Erik Swan wrote:
> Everyone,
> 
> I'm somewhat new to Nevow and have a simple question - btw, it maybe 
> already possible and i missed the man page...
> 
> We mostly use HTML based templates to drive our presentations as we have 
> an html designer that can design and maintain a large majority of the UI 
> without knowledge of any coding.  The designer delivers html that can be 
> rendered on its own for review but also adds in directives, patterns and 
> slots to make the programmers life easier.
> 
> My question centers around the best way to have nested templates - that 
> is i'd like a directive that would function as an include and all the 
> appropriate Nevow render code get executed automatically. That way our 
> designer can build a header, footer, sidebars, and other html components 
> as separate files and the main template just "includes" as appropriate.  
> Something like
>   <nevow:include name="blah.html">

WARNING: Experimental code alert. Use at your own risk. ;-)

This sounds like you want macros. There is a relatively simple
implementation in my sandbox ...

    svn co svn://divmod.org/svn/Nevow/sandbox/mg/macro

The basic idea is that you have one (or more) XHTML files containing the
macros. The page templates include a macro by adding a n:render="macro
myMacro" attribute to some element.

Macros are located, via the LocateMacroMixin, as macro_* attributes of
the page (or more likely, some base page class). The macro_* attributes
can use anything (stan, xmlfile, whatever) to load and return the
template for the macro.

The interesting bit of all this is that any pattern inside the page's
macro-including element are pushed into the macro using fillSlots. Take
a look at how page.html specifies the <title> for the 'head' macro or
how the content is passed to the 'body' macro and you'll see what I
mean.

I've been using this technique for a while now and it works fairly well.
Whether it fits your needs I'm not sure but any feedback/improvements
would be gratefully accepted.

Note: I know this implementation can be improved, i.e. perhaps an
explicit n:macro tag to make things clearer and optional macro expansion
at precompile time.


> Additionally, and here is my Nevow ignorance, there must be a simple few 
> lines of code that does the equivalent in code for example if i had:
>   <nevow:render name = templateName>
> 
> then in...
>   def render_templateName(self, context, data):
>       #load and render file templateName as include and return result
> 
> Lastly, if the above method works OK then I'd rather have
>   <nevow:render name=include nevow:arg=templateName>
> where i can have a generic include render method and take an argument 
> from the html tag.

This is already possible using a parameterised renderer. In fact, the
macro renderer described above does exactly this. See the render_macro
function in macro.py.


Hope this helps.


Cheers, Matt


From matt at pollenation.net  Thu Nov  4 15:47:01 2004
From: matt at pollenation.net (Matt Goodall)
Date: Thu Nov  4 15:47:18 2004
Subject: [Twisted-web] Nevow: Authenticated site with "remember me" and
	vhosts
In-Reply-To: <7E2ACDB2-2A90-11D9-82AC-000A95864FC4@divmod.org>
References: <uoeik9rkr.fsf@yahoo.co.uk>
	<7E2ACDB2-2A90-11D9-82AC-000A95864FC4@divmod.org>
Message-ID: <1099608421.20913.42.camel@stock.localhost>

On Sat, 2004-10-30 at 12:26 -0400, Donovan Preston wrote:
> On Oct 30, 2004, at 11:03 AM, Paul Moore wrote:
[...]
> > 2. I'd like to add a "remember me" checkbox, which if checked sets a
> >    cookie to remember the user's ID, so that they don't have to log
> >    in again for (say) 2 weeks. Much like gmail, or Yahoo, do. But I'm
> >    not too sure how I'd go about this. I'm not even sure where I'd
> >    *put* auto-login code: the page is too late (the guard has done
> >    its thing by then) but anything else seems to be too early (ie,
> >    not per-session, if you see what I mean). I suspect I need to
> >    subclass the Portal, or something, but I'm not sure...
> 
> I'm not sure guard is sufficiently flexible to allow this. Perhaps one 
> of the guard replacements that is being worked on will help? mg, can 
> you comment? Also, indigo, can you comment on the session system you 
> wrote and/or perhaps turn it into an example or a module?

Hmm, I don't think there's any way of handling cookie logins right now
except maybe redirecting to the __login__ URL with the username and
password as query params. But yuck!

One of the problems with guard is that there is no API exposed. It might
be nice if guard remembered an IGuard interface for application code to
use. What that would look like and how it would behave is something I
have not considered.


> > I've scanned the various examples, both in the distribution and in
> > the Nevow sandbox, but nothing seems to do what I want. Can anyone
> > give me some pointers?
> 
> Sorry I can't be of more help. Guard is one of nevow's weak spots, 
> since I didn't write it and therefore don't understand it, because it 
> is pretty horrifically complex.

Yes. I tried to understand the guard code and got lost so I ended up
rewriting it as a learning exercise with the intention of porting bits
back into nevow.guard.

My rewrite is *much* simpler. It's not as complete as nevow.guard
although it does work and has the distinct advantage that it does not
create a session until it's really needed.

Valentino (aka dialtone) recently started patching my version in an
attempt to bring it inline with the real guard. He's even started
calling it newguard ;-). I guess this is a case of "watch this space".

Cheers, Matt

-- 
Matt Goodall <matt@pollenation.net>


From dp at ulaluma.com  Thu Nov  4 16:04:20 2004
From: dp at ulaluma.com (Donovan Preston)
Date: Thu Nov  4 16:04:39 2004
Subject: [Twisted-web] Buffered requests
In-Reply-To: <6654eac404110413275abed0e7@mail.gmail.com>
References: <6654eac404110410353e82b23d@mail.gmail.com>
	<CDDA18EB-2EA4-11D9-8344-000A95864FC4@ulaluma.com>
	<6654eac404110413275abed0e7@mail.gmail.com>
Message-ID: <DC606FED-2EB5-11D9-8344-000A95864FC4@ulaluma.com>


On Nov 4, 2004, at 1:27 PM, Peter Hunt wrote:

> Will that include the HTTP response code and headers?

Yep.

dp


From dialtone at gmail.com  Thu Nov  4 16:08:57 2004
From: dialtone at gmail.com (Valentino Volonghi)
Date: Thu Nov  4 16:09:31 2004
Subject: [Twisted-web] Nevow: Authenticated site with "remember me" and
	vhosts
In-Reply-To: <1099608421.20913.42.camel@stock.localhost>
References: <uoeik9rkr.fsf@yahoo.co.uk>
	<7E2ACDB2-2A90-11D9-82AC-000A95864FC4@divmod.org>
	<1099608421.20913.42.camel@stock.localhost>
Message-ID: <c893b8530411041508194625c@mail.gmail.com>

On Thu, 04 Nov 2004 22:47:01 +0000, Matt Goodall <matt@pollenation.net> wrote:

> One of the problems with guard is that there is no API exposed. It might
> be nice if guard remembered an IGuard interface for application code to
> use. What that would look like and how it would behave is something I
> have not considered.

Actually I think the current implementation is better since it's
completely unaware of what it is guarding, thus making it really
pluggable and easy to remove.

Probably, a good thing to do is to set as a component the current
avatarId in the session. So that from application code one could say:

ICurrentUser(inevow.IRequest(ctx)).name/login/some_other_stuff

and probably also provide some functionality to set some default
'rememberings' which I currently do with the RememberResourceWrapper

> My rewrite is *much* simpler. It's not as complete as nevow.guard
> although it does work and has the distinct advantage that it does not
> create a session until it's really needed.

indeed it's far better than current nevow and a lot easier to hack.
 
> Valentino (aka dialtone) recently started patching my version in an
> attempt to bring it inline with the real guard. He's even started
> calling it newguard ;-). I guess this is a case of "watch this space"

Ehe :), If can get things to work as I want, and get some help from
Tv, newguard should be ready soon. Right now it works fairly well and
it's backwards compatible with old guard.

And, as I wrote in the note inside guard.py, I'm willing to write some
support for database session storage, which will come in handy for my
next university project about distributed systems.

-- 
Valentino Volonghi aka Dialtone
Now running FreeBSD 5.3-beta6
Blog: http://vvolonghi.blogspot.com
Home Page: http://xoomer.virgilio.it/dialtone/

From erik at splunktechnology.com  Thu Nov  4 17:24:52 2004
From: erik at splunktechnology.com (Erik Swan)
Date: Thu Nov  4 17:24:56 2004
Subject: [Twisted-web] Nested Nevow templates
Message-ID: <418AC854.8070103@splunktechnology.com>

Matt,
Brilliant.

Got the macro code in and its more or less what i need to do! Saved me a 
few days of wresting code i dont understand.

I prefer not having to define the macro's as methods as you did in the 
tac file but instead just dynamically build them in the macroFactory by 
munging the filename and caching results - that way i dont need to 
change code if a designer just wants to make an html "include".  In my 
case, someone other than an engineer is changing html files, cutting 
them up, rearranging components, and it would be great if they could do 
all that and never touch code.

Thanks everyone else for the comments.

e.

From alex-news at comcast.net  Fri Nov  5 15:00:01 2004
From: alex-news at comcast.net (Alexander May)
Date: Fri Nov  5 14:59:51 2004
Subject: [Twisted-web] RE: [Twisted-Python] Log in - state of the art?
In-Reply-To: <418BDA9A.5030303@rogers.com>
Message-ID: <E1CQC7Z-0008KB-00@pyramid.twistedmatrix.com>

Thanks Mike and Donovan.  The examples were very helpful.  Two questions
though:

1) If the user types in something like mysite.com/foo/bar and is not yet
logged in, they get the "Sorry, but I couldn't find the object you
requested." page.  I would like them to get the log in page, and then be
redirected to the mysite.com/foo/bar afterwards.  Can I do this?

2) How do I replace the "Sorry, but I couldn't find the object you
requested." with my own page?

Thanks,
Alex

(cross posted to twisted web group)


-----Original Message-----
From: twisted-python-bounces@twistedmatrix.com
[mailto:twisted-python-bounces@twistedmatrix.com] On Behalf Of Mike C.
Fletcher
Sent: Friday, November 05, 2004 2:55 PM
To: Twisted general discussion
Subject: Re: [Twisted-Python] Log in - state of the art?

I did up a few howtos in my blog a while back:

    http://blog.vrplumber.com/356
    http://blog.vrplumber.com/358
    http://blog.vrplumber.com/371

which covers the "official" way to protect a Nevow site (as gleaned from IRC
conversations with Nevow's creators).  I think Mary was planning on doing up
official docs for the process at some point.

HTH,
Mike

Alexander May wrote:
...

>What modules and classes should I be looking at?  Are there any 
>examples out there?  Is the how-to on the website
>(http://twistedmatrix.com/documents/current/howto/cred) up to date?  
>  
>
...

________________________________________________
  Mike C. Fletcher
  Designer, VR Plumber, Coder
  http://www.vrplumber.com
  http://blog.vrplumber.com


_______________________________________________
Twisted-Python mailing list
Twisted-Python@twistedmatrix.com
http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python


From alex-news at comcast.net  Fri Nov  5 15:12:14 2004
From: alex-news at comcast.net (Alexander May)
Date: Fri Nov  5 15:12:03 2004
Subject: [Twisted-web] RE: [Twisted-Python] Log in - state of the art?
In-Reply-To: <E1CQC7Z-0008KB-00@pyramid.twistedmatrix.com>
Message-ID: <E1CQCJN-0008SM-00@pyramid.twistedmatrix.com>

Minor correction for question 1.  My specific case is:
Mysite.com/abcd.html, not Mysite.com/foo/bar

-----Original Message-----
From: twisted-web-bounces@twistedmatrix.com
[mailto:twisted-web-bounces@twistedmatrix.com] On Behalf Of Alexander May
Sent: Friday, November 05, 2004 5:00 PM
To: 'Twisted general discussion'; twisted-web@twistedmatrix.com
Subject: [Twisted-web] RE: [Twisted-Python] Log in - state of the art?

Thanks Mike and Donovan.  The examples were very helpful.  Two questions
though:

1) If the user types in something like mysite.com/foo/bar and is not yet
logged in, they get the "Sorry, but I couldn't find the object you
requested." page.  I would like them to get the log in page, and then be
redirected to the mysite.com/foo/bar afterwards.  Can I do this?

2) How do I replace the "Sorry, but I couldn't find the object you
requested." with my own page?

Thanks,
Alex

(cross posted to twisted web group)


-----Original Message-----
From: twisted-python-bounces@twistedmatrix.com
[mailto:twisted-python-bounces@twistedmatrix.com] On Behalf Of Mike C.
Fletcher
Sent: Friday, November 05, 2004 2:55 PM
To: Twisted general discussion
Subject: Re: [Twisted-Python] Log in - state of the art?

I did up a few howtos in my blog a while back:

    http://blog.vrplumber.com/356
    http://blog.vrplumber.com/358
    http://blog.vrplumber.com/371

which covers the "official" way to protect a Nevow site (as gleaned from IRC
conversations with Nevow's creators).  I think Mary was planning on doing up
official docs for the process at some point.

HTH,
Mike

Alexander May wrote:
...

>What modules and classes should I be looking at?  Are there any 
>examples out there?  Is the how-to on the website
>(http://twistedmatrix.com/documents/current/howto/cred) up to date?  
>  
>
...

________________________________________________
  Mike C. Fletcher
  Designer, VR Plumber, Coder
  http://www.vrplumber.com
  http://blog.vrplumber.com


_______________________________________________
Twisted-Python mailing list
Twisted-Python@twistedmatrix.com
http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-python


_______________________________________________
Twisted-web mailing list
Twisted-web@twistedmatrix.com
http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web


From dp at ulaluma.com  Sat Nov  6 18:25:28 2004
From: dp at ulaluma.com (Donovan Preston)
Date: Sat Nov  6 18:25:36 2004
Subject: [Twisted-web] RE: [Twisted-Python] Log in - state of the art?
In-Reply-To: <E1CQC7Z-0008KB-00@pyramid.twistedmatrix.com>
References: <E1CQC7Z-0008KB-00@pyramid.twistedmatrix.com>
Message-ID: <E8C9C6D5-305B-11D9-BBE1-000A95864FC4@ulaluma.com>


On Nov 5, 2004, at 2:00 PM, Alexander May wrote:

> 1) If the user types in something like mysite.com/foo/bar and is not 
> yet
> logged in, they get the "Sorry, but I couldn't find the object you
> requested." page.  I would like them to get the log in page, and then 
> be
> redirected to the mysite.com/foo/bar afterwards.  Can I do this?
>
> 2) How do I replace the "Sorry, but I couldn't find the object you
> requested." with my own page?

These are the same question. You need to implement ICanHandleNotFound 
and remember the implementor in the context higher than the url 
/foo/bar. You could then do one of two things:

1) Always render a login page, then when they are done logging in 
redirect to the original URL. This is done by rendering a login form 
action like so: /__login__/foo/bar. When this form is posted and login 
succeeds, the user will be redirected to /foo/bar. If it fails, the 
user will be redirected to the same url with a query parameter letting 
you know that authentication has failed.

2) Do something similar to the above, but check to see if the url 
actually exists before rendering a login page. If the url doesn't 
exist, render a 404 instead. I never bother doing this because I don't 
really see the point; it also lets potential attackers know which 
protected urls actually exist and which don't.

dp


From pyp at gmx.net  Sun Nov  7 05:36:19 2004
From: pyp at gmx.net (Mike Mueller)
Date: Sun Nov  7 05:33:13 2004
Subject: [Twisted-web] reverse proxy with nevow
Message-ID: <5.2.1.1.1.20041107132735.01bd6698@pop.gmx.net>

After fiddling for quite a while I am running out of ideas how get the 
following to work.

I would like to run a nevow site on port 8080 on the same machine I run a 
twisted web
server that serves static pages. Instead of showing the 8080 in the address 
I would like
to run the nevow site as VHostMonsterResource.

My twisted web server looks like this:

#twistedStaticServer.py

from twisted.web import vhost, static, server, proxy
from twisted.application import internet, service
import os

vhostDir = '..\hosts'
root = vhost.NameVirtualHost()
dir = 'domain1.com'
root.addHost(dir, static.File(os.path.join(vhostDir, dir)))
vhostName = 'domain2.com'
reverseProxy = proxy.ReverseProxyResource('localhost', 8080,
                                           '/vhost/http/'+vhostName)
root.addHost(vhostName, reverseProxy)
application = service.Application('web')
sc = service.IServiceCollection(application)
site = server.Site(root)
i = internet.TCPServer(80, site)
i.setServiceParent(sc)

The nevow site looks like this:

#nevowProxy.py

import random
from nevow import appserver, vhost
from twisted.application import internet, service
from nevow import rend, tags
from nevow import loaders

vResource = vhost.VHostMonsterResource()

class VHostGreeter(rend.Page):
     docFactory = loaders.stan(
     tags.html[
     tags.head[ tags.title[ "Runnig as VHostMonsterResource" ]],
     tags.body[
         tags.h1(style="font-size: large")[ "This works." ]
     ]
])

default = VHostGreeter()
default.putChild("vhost", vResource)

application = service.Application('web-proxy')
sc = service.IServiceCollection(application)
site = appserver.NevowSite(default)
i = internet.TCPServer(8080, site)
i.setServiceParent(sc)

After modifying /etc/hosts (or C:\WINNT\system32\drivers\etc\hosts):

127.0.0.1       domain1.com
127.0.0.1       domain2.com


domain1.com works as expected. It serves static pages out of the given 
directory.

Also domain2.com:8080 works.

But domain2.com just shows an empty page.

I tested this with Opera 7.11 and IE 6.0.

The nevow server gets an GET request. There is no difference in the server 
messages
between a direct call (8080) or using it as a reverse proxy:

Opera:

domain2.com:
2004/11/07 13:06 Westeurop?ische Normalzeit [HTTPChannel,1,127.0.0.1] 127.0.0.1
- - [07/Nov/2004:12:06:20 +0000] "GET / HTTP/1.0" 200 129 "-" "Mozilla/4.0 
(comp
atible; MSIE 6.0; Windows NT 5.0) Opera 7.11  [de]"

domain2.com:8080:
2004/11/07 13:06 Westeurop?ische Normalzeit [HTTPChannel,2,127.0.0.1] 127.0.0.1
- - [07/Nov/2004:12:06:32 +0000] "GET / HTTP/1.1" 200 129 "-" "Mozilla/4.0 
(comp
atible; MSIE 6.0; Windows NT 5.0) Opera 7.11  [de]"

IE6.0:

domain2.com:
2004/11/07 13:07 Westeurop?ische Normalzeit [HTTPChannel,3,127.0.0.1] 127.0.0.1
- - [07/Nov/2004:12:07:25 +0000] "GET / HTTP/1.1" 200 129 "-" "Mozilla/4.0 
(comp
atible; MSIE 6.0; Windows NT 5.0)"

domain2.com:8080:
2004/11/07 13:07 Westeurop?ische Normalzeit [HTTPChannel,4,127.0.0.1] 127.0.0.1
- - [07/Nov/2004:12:07:46 +0000] "GET / HTTP/1.1" 200 129 "-" "Mozilla/4.0 
(comp
atible; MSIE 6.0; Windows NT 5.0)"

The twisted web server shows the following messages:

2004/11/07 13:07 Westeurop?ische Normalzeit [HTTPChannel,2,127.0.0.1] 
Starting f
actory <twisted.web.proxy.ProxyClientFactory instance at 0x00B716E8>
2004/11/07 13:07 Westeurop?ische Normalzeit [ProxyClient,client] Stopping 
factor
y <twisted.web.proxy.ProxyClientFactory instance at 0x00B716E8>

How do get the page display when requesting domain2.com?

Thanks.

Mike


From tv at twistedmatrix.com  Mon Nov  8 04:09:30 2004
From: tv at twistedmatrix.com (Tommi Virtanen)
Date: Mon Nov  8 04:10:06 2004
Subject: [Twisted-web] reverse proxy with nevow
In-Reply-To: <5.2.1.1.1.20041107132735.01bd6698@pop.gmx.net>
References: <5.2.1.1.1.20041107132735.01bd6698@pop.gmx.net>
Message-ID: <418F53EA.6060904@twistedmatrix.com>

Mike Mueller wrote:

>  I would like to run a nevow site on port 8080 on the same machine I
>  run a twisted web server that serves static pages. Instead of showing
>  the 8080 in the address I would like to run the nevow site as
>  VHostMonsterResource.

I don't have time to carefully go through your mail, but I'd just like to
state that there are a lot of examples of proxies in Nevow SVN, path
/sandbox/tv. For example, /sandbox/tv/reversemonster/ contains a
resource to use on the public server side, that automatically gives the
correct arguments to the vhost element on the private site.
Many of the directories contain README files that explain the motivation
behind the code.


From gavrie at disksites.com  Mon Nov  8 11:56:41 2004
From: gavrie at disksites.com (Gavrie Philipson)
Date: Mon Nov  8 11:56:58 2004
Subject: [Twisted-web] Problem using formless with a deferred value
Message-ID: <200411082056.42285.gavrie@disksites.com>

Hi,

I am having a peculiar problem related to using a deferred value together with 
Nevow's formless:
When trying to return a deferred value from a formless autocallable, no result 
is returned to the browser even though the deferred does fire.

Attached is an example, based on the "formpost2.tac" example from the Nevow 
distribution, that illustrates the problem: Submitting the form causes the 
deferred to fire, but the browser hangs while waiting for the result (which 
is never sent).

I have tested this with the latest Nevow version from Subversion (updated 
today), together with both Twisted 1.3.0 and 1.1.0. The platform is Fedora 
Core 1, with Python 2.3.2.

This deferred-with-formless functionality used to work for me using an older 
version of Nevow (pre-0.1), but upgrading seems to have broken it.

Am I doing something wrong here, or is this a bug in Twisted or Nevow?

Thanks,

-- Gavrie.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: formpost2-deferred.tac
Type: text/x-java
Size: 1660 bytes
Desc: not available
Url : http://twistedmatrix.com/pipermail/twisted-web/attachments/20041108/ac3bbe93/formpost2-deferred.bin
From tv at twistedmatrix.com  Tue Nov  9 03:23:42 2004
From: tv at twistedmatrix.com (Tommi Virtanen)
Date: Tue Nov  9 03:24:15 2004
Subject: [Twisted-web] Problem using formless with a deferred value
In-Reply-To: <200411082056.42285.gavrie@disksites.com>
References: <200411082056.42285.gavrie@disksites.com>
Message-ID: <41909AAE.9000705@twistedmatrix.com>

Gavrie Philipson wrote:

>Am I doing something wrong here, or is this a bug in Twisted or Nevow?
>  
>
The former.

>class Implementation(object):
>    __implements__ = IMyForm,
>
>    def bar(self, baz):
>
>        def _cb():
>            print "Done!"
>            return "hello..."
>
>        print "baz!", baz
>
>        d = defer.Deferred()
>        reactor.callLater(0, _cb)
>
>        return d
>  
>
Your _cb is in no way connected to the Deferred.
Try

    def bar(self, baz):
        def _cb(result):
            print "Done!", result
            return "hello..."

        print "baz!", baz

        d = defer.Deferred()
	d.addCallback(_cb)
        reactor.callLater(0, d.callback, 42)
        return d



From gavrie at disksites.com  Tue Nov  9 03:45:45 2004
From: gavrie at disksites.com (Gavrie Philipson)
Date: Tue Nov  9 03:46:21 2004
Subject: [Twisted-web] Problem using formless with a deferred value
Message-ID: <7B4DD91F9C5D474898E5F4E43B9213F5010B47A8@santarosa.dsnt.disksites.com>

Tommi Virtanen wrote:
> Gavrie Philipson wrote:
> 
>> Am I doing something wrong here, or is this a bug in Twisted or
>> Nevow? 
>> 
>> 
> The former.
...
> Your _cb is in no way connected to the Deferred.

Doh! Of course -- I must have been zoned out.

This example was just meant to demonstrate the recreation of an actual problem which I have in a larger application. I didn't pay enough attention when rewriting the example.
I'm back to trying to reproduce the original problem...

-- Gavrie.

From matt at pollenation.net  Tue Nov  9 05:20:05 2004
From: matt at pollenation.net (Matt Goodall)
Date: Tue Nov  9 05:20:17 2004
Subject: [Twisted-web] Add fromContext to nevow.url and add a warning to
	fromRequest
Message-ID: <1100002805.28895.9.camel@localhost.localdomain>

Hi,

I've mentioned this issue but I find some of the nevow.url module
non-obvious mostly because of naming. fromRequest is one of the methods
I dislike because its name implies (to me, at least) that it will build
a URI that matches the request but it actually uses the prepath.

Attached is an initial patch (i.e. not tested) that adds a fromContext
class method and displays a warning for fromRequest. My intention is to
change fromRequest sometime in the future so it builds a URL from
request.uri.

What do you all think of this change?

Cheers, Matt

-- 
     __
    /  \__     Matt Goodall, Pollenation Internet Ltd
    \__/  \    w: http://www.pollenation.net
  __/  \__/    e: matt@pollenation.net
 /  \__/  \    t: +44 (0)113 2252500
 \__/  \__/
 /  \          Any views expressed are my own and do not necessarily
 \__/          reflect the views of my employer.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: url.diff
Type: text/x-patch
Size: 2028 bytes
Desc: not available
Url : http://twistedmatrix.com/pipermail/twisted-web/attachments/20041109/631c480c/url.bin
From dp at ulaluma.com  Tue Nov  9 09:02:40 2004
From: dp at ulaluma.com (Donovan Preston)
Date: Tue Nov  9 09:02:46 2004
Subject: [Twisted-web] Add fromContext to nevow.url and add a warning to
	fromRequest
In-Reply-To: <1100002805.28895.9.camel@localhost.localdomain>
References: <1100002805.28895.9.camel@localhost.localdomain>
Message-ID: <C82D2EBE-3268-11D9-A561-000A95864FC4@ulaluma.com>


On Nov 9, 2004, at 4:20 AM, Matt Goodall wrote:

> Hi,
>
> I've mentioned this issue but I find some of the nevow.url module
> non-obvious mostly because of naming. fromRequest is one of the methods
> I dislike because its name implies (to me, at least) that it will build
> a URI that matches the request but it actually uses the prepath.
>
> Attached is an initial patch (i.e. not tested) that adds a fromContext
> class method and displays a warning for fromRequest. My intention is to
> change fromRequest sometime in the future so it builds a URL from
> request.uri.
>
> What do you all think of this change?

+1

dp


From dialtone at gmail.com  Tue Nov  9 09:36:06 2004
From: dialtone at gmail.com (Valentino Volonghi)
Date: Tue Nov  9 09:36:09 2004
Subject: [Twisted-web] Add fromContext to nevow.url and add a warning to
	fromRequest
In-Reply-To: <C82D2EBE-3268-11D9-A561-000A95864FC4@ulaluma.com>
References: <1100002805.28895.9.camel@localhost.localdomain>
	<C82D2EBE-3268-11D9-A561-000A95864FC4@ulaluma.com>
Message-ID: <c893b8530411090836581eeef6@mail.gmail.com>

On Tue, 9 Nov 2004 08:02:40 -0800, Donovan Preston <dp@ulaluma.com> wrote:

+1 too

-- 
Valentino Volonghi aka Dialtone
Now running FreeBSD 5.3-beta6
Blog: http://vvolonghi.blogspot.com
Home Page: http://xoomer.virgilio.it/dialtone/

From alex-news at comcast.net  Tue Nov  9 15:31:55 2004
From: alex-news at comcast.net (Alexander May)
Date: Tue Nov  9 15:31:45 2004
Subject: [Twisted-web] renderForms layout control and freeform errors
In-Reply-To: <200411082056.42285.gavrie@disksites.com>
Message-ID: <E1CReWd-0005f2-00@pyramid.twistedmatrix.com>

I'm trying to figure out forms.  A couple questions:
 
1) How do I control the layout of a form rendered via webform.renderForms?

(http://www.livejournal.com/users/fzzzy/ seems to indicate it's possible:
'formless.webform.renderForms() can now be provided with pattern nodes to
influence the rendering of the forms. The structure and layout of the forms
can be completely controlled')

2) If I use a disk template based form, what fields do I need to add so that
formless will correctly post error messages.  (or some alternative way to
post back the error messages)

I can't find any documentation or examples on either point.  I love twisted
and nevow, but tracing through source code every time I need to do something
new drives me nuts!  Oh how I long for a good book (or web page)...

Thanks in advance,
Alex












From mithrandi-twisted-web at mithrandi.za.net  Tue Nov  9 15:53:21 2004
From: mithrandi-twisted-web at mithrandi.za.net (Tristan Seligmann)
Date: Tue Nov  9 15:53:34 2004
Subject: [Twisted-web] renderForms layout control and freeform errors
In-Reply-To: <E1CReWd-0005f2-00@pyramid.twistedmatrix.com>
References: <E1CReWd-0005f2-00@pyramid.twistedmatrix.com>
Message-ID: <20041109225321.GC29189@mithrandi.za.net>

On Tue, Nov 09, 2004 at 17:31:55 -0500, Alexander May wrote:
> 1) How do I control the layout of a form rendered via webform.renderForms?
> 
> (http://www.livejournal.com/users/fzzzy/ seems to indicate it's possible:
> 'formless.webform.renderForms() can now be provided with pattern nodes to
> influence the rendering of the forms. The structure and layout of the forms
> can be completely controlled')
> 
> 2) If I use a disk template based form, what fields do I need to add so that
> formless will correctly post error messages.  (or some alternative way to
> post back the error messages)

Perhaps Nevow/examples/customform.* may be of interest to you?
-- 
mithrandi, i Ainil en-Balandor, a faer Ambar
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: Digital signature
Url : http://twistedmatrix.com/pipermail/twisted-web/attachments/20041110/12da28b8/attachment.bin
From dialtone at gmail.com  Tue Nov  9 16:11:13 2004
From: dialtone at gmail.com (Valentino Volonghi)
Date: Tue Nov  9 16:11:18 2004
Subject: [Twisted-web] renderForms layout control and freeform errors
In-Reply-To: <E1CReWd-0005f2-00@pyramid.twistedmatrix.com>
References: <200411082056.42285.gavrie@disksites.com>
	<E1CReWd-0005f2-00@pyramid.twistedmatrix.com>
Message-ID: <c893b8530411091511d5114a7@mail.gmail.com>

On Tue, 9 Nov 2004 17:31:55 -0500, Alexander May <alex-news@comcast.net> wrote:
> 1) How do I control the layout of a form rendered via webform.renderForms?
> 
> (http://www.livejournal.com/users/fzzzy/ seems to indicate it's possible:
> 'formless.webform.renderForms() can now be provided with pattern nodes to
> influence the rendering of the forms. The structure and layout of the forms
> can be completely controlled')
> 
> 2) If I use a disk template based form, what fields do I need to add so that
> formless will correctly post error messages.  (or some alternative way to
> post back the error messages)

There is a very complete example of patterning webForms in nevow
distribution under the name customform.tac.

If you need to change the error message (since the position in which
it should be displayed could be specified in the patterned template)
you can do that directly from the TypedInterface:
annotate.String(required=True, requiredFailMessage="Insert that string")

-- 
Valentino Volonghi aka Dialtone
Now running FreeBSD 5.3-beta6
Blog: http://vvolonghi.blogspot.com
Home Page: http://xoomer.virgilio.it/dialtone/

From alex-news at comcast.net  Tue Nov  9 20:20:39 2004
From: alex-news at comcast.net (Alexander May)
Date: Tue Nov  9 20:20:29 2004
Subject: [Twisted-web] renderForms layout control and freeform errors
In-Reply-To: <c893b8530411091511d5114a7@mail.gmail.com>
Message-ID: <E1CRj23-00087L-00@pyramid.twistedmatrix.com>

Shoot, how did I miss that? I looked at every other form example!  Thanks
and sorry the static.

Alex

 

-----Original Message-----
From: twisted-web-bounces@twistedmatrix.com
[mailto:twisted-web-bounces@twistedmatrix.com] On Behalf Of Valentino
Volonghi
Sent: Tuesday, November 09, 2004 6:11 PM
To: Discussion of twisted.web, Nevow,and Woven
Subject: Re: [Twisted-web] renderForms layout control and freeform errors

On Tue, 9 Nov 2004 17:31:55 -0500, Alexander May <alex-news@comcast.net>
wrote:
> 1) How do I control the layout of a form rendered via webform.renderForms?
> 
> (http://www.livejournal.com/users/fzzzy/ seems to indicate it's possible:
> 'formless.webform.renderForms() can now be provided with pattern nodes 
> to influence the rendering of the forms. The structure and layout of 
> the forms can be completely controlled')
> 
> 2) If I use a disk template based form, what fields do I need to add 
> so that formless will correctly post error messages.  (or some 
> alternative way to post back the error messages)

There is a very complete example of patterning webForms in nevow
distribution under the name customform.tac.

If you need to change the error message (since the position in which it
should be displayed could be specified in the patterned template) you can do
that directly from the TypedInterface:
annotate.String(required=True, requiredFailMessage="Insert that string")

--
Valentino Volonghi aka Dialtone
Now running FreeBSD 5.3-beta6
Blog: http://vvolonghi.blogspot.com
Home Page: http://xoomer.virgilio.it/dialtone/

_______________________________________________
Twisted-web mailing list
Twisted-web@twistedmatrix.com
http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web


From pyp at gmx.net  Wed Nov 10 00:53:04 2004
From: pyp at gmx.net (Mike Mueller)
Date: Wed Nov 10 00:50:27 2004
Subject: [Twisted-web] reverse proxy with nevow
In-Reply-To: <418F53EA.6060904@twistedmatrix.com>
References: <5.2.1.1.1.20041107132735.01bd6698@pop.gmx.net>
	<5.2.1.1.1.20041107132735.01bd6698@pop.gmx.net>
Message-ID: <5.2.1.1.1.20041110085118.01ba8220@pop.gmx.net>

At 13:09 08.11.2004 +0200, you wrote:

>I don't have time to carefully go through your mail, but I'd just like to
>state that there are a lot of examples of proxies in Nevow SVN, path
>/sandbox/tv. For example, /sandbox/tv/reversemonster/ contains a
>resource to use on the public server side, that automatically gives the
>correct arguments to the vhost element on the private site.
>Many of the directories contain README files that explain the motivation
>behind the code.
>

Thanks for the tip. I eventually figured it out. :-)

>_______________________________________________
>Twisted-web mailing list
>Twisted-web@twistedmatrix.com
>http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web


From sridharinfinity at gmail.com  Wed Nov 10 07:13:22 2004
From: sridharinfinity at gmail.com (Sridhar R)
Date: Wed Nov 10 07:13:33 2004
Subject: [Twisted-web] Nevow - 'connection lost' javascript alert on page
	reloads
Message-ID: <8816fcf804111006136f553d60@mail.gmail.com>

I have even tried with the HEAD revision from subversion of Nevow, but
the problem still persists!

On page reloads (on loads), I get this javascript alert
"The connection to the remote server was lost. The page may fail to
work correctly. Reloading the page may fix the problem."

Looking at liveevil.js
            if (xmlhttp.responseText) {
                connect(outputNum + 1)
                eval(xmlhttp.responseText)
            } else {
                alert('The connection to the remote server was lost.
The page may fail to work correctly. Reloading the page may fix the
problem.');
            }

xmlhttp.responseText is null !!  It is supposed to be null only
connection problems.  So isn't this a bug?

Here is the project that uses Nevow and gets the above problem
http://svn.berlios.de/viewcvs/codehack/trunk/

Nevow code is kept under
trunk/lib/codehack/server/

Service code is at
trunk/lib/codehack/server/gateway.py

.tac is here
trunk/startserver.tac

-- 
Sridhar R - http://cs.annauniv.edu/~rsridhar
Blog: http://www.livejournal.com/~sridharinfinity

From matt at pollenation.net  Wed Nov 10 13:01:12 2004
From: matt at pollenation.net (Matt Goodall)
Date: Wed Nov 10 13:01:22 2004
Subject: [Twisted-web] Nevow - 'connection lost' javascript alert on 
	page reloads
In-Reply-To: <8816fcf804111006136f553d60@mail.gmail.com>
References: <8816fcf804111006136f553d60@mail.gmail.com>
Message-ID: <24737.62.252.224.25.1100116872.squirrel@webmail.pollenation.net>


> I have even tried with the HEAD revision from subversion of Nevow, but
> the problem still persists!
>
> On page reloads (on loads), I get this javascript alert
> "The connection to the remote server was lost. The page may fail to
> work correctly. Reloading the page may fix the problem."
>
> Looking at liveevil.js
>             if (xmlhttp.responseText) {
>                 connect(outputNum + 1)
>                 eval(xmlhttp.responseText)
>             } else {
>                 alert('The connection to the remote server was lost.
> The page may fail to work correctly. Reloading the page may fix the
> problem.');
>             }
>
> xmlhttp.responseText is null !!  It is supposed to be null only
> connection problems.

In theory it is a connection problem. By leaving the current page the
browser shuts down all connections created by the page including the
liveevil connection. (You get the same message with Mozilla/Firefox by
merely hitting <Esc>.) Nevow needs a robust way of detecting when the
liveevil connection is legitimately closed as opposed to real errors, i.e.
the server disappearing.

I played around with the liveevil javascript for a couple of hours one
evening. It's easy enough to make liveevil reconnect when the
XMLHttpRequest's socket object is closed but I could not find a way to
determine the cause of the shutdown. That makes handling errors gracefully
quite difficult.

If anyone knows how to handle XMLHttpRequest errors then please post here
and we'll get a fix into Nevow.

Cheers, Matt

-- 
     __
    /  \__     Matt Goodall, Pollenation Internet Ltd
    \__/  \    w: http://www.pollenation.net
  __/  \__/    e: matt@pollenation.net
 /  \__/  \    t: +44 (0)113 2252500
 \__/  \__/
 /  \          Any views expressed are my own and do not necessarily
 \__/          reflect the views of my employer.


From sridharinfinity at gmail.com  Wed Nov 10 21:24:56 2004
From: sridharinfinity at gmail.com (Sridhar R)
Date: Wed Nov 10 21:25:04 2004
Subject: [Twisted-web] Nevow - 'connection lost' javascript alert on page
	reloads
In-Reply-To: <24737.62.252.224.25.1100116872.squirrel@webmail.pollenation.net>
References: <8816fcf804111006136f553d60@mail.gmail.com>
	<24737.62.252.224.25.1100116872.squirrel@webmail.pollenation.net>
Message-ID: <8816fcf804111020246edc5a10@mail.gmail.com>

On Wed, 10 Nov 2004 20:01:12 -0000 (GMT), Matt Goodall
<matt@pollenation.net> wrote:

> If anyone knows how to handle XMLHttpRequest errors then please post here
> and we'll get a fix into Nevow.
> 

k3mper has provided a patch.  I tried it and it works!  somebody needs
to merge this patch with HEAD.
http://divmod.org/users/roundup.twistd/nevow/issue131

And when is nevow-0.3.1? (0.3.1 with the above patch?)

-- 
Sridhar R - http://cs.annauniv.edu/~rsridhar
Blog: http://www.livejournal.com/~sridharinfinity

From lists at larswp.dk  Thu Nov 11 02:58:32 2004
From: lists at larswp.dk (Lars Woetmann Pedersen)
Date: Thu Nov 11 02:58:36 2004
Subject: [Twisted-web] getting response headers from client.getPage
Message-ID: <419337C8.6090604@larswp.dk>

hi

how do I get the responce header in printResult
the code looks like this now, the content of the page
is in data, but I also need the header to check the etag and last-modified

         d = client.getPage(myurl)
         d.addCallback(printResult)


def printResult(data):
         print 'printing result:'
         print data


Lars W.


From tv at twistedmatrix.com  Thu Nov 11 07:35:19 2004
From: tv at twistedmatrix.com (Tommi Virtanen)
Date: Thu Nov 11 07:35:53 2004
Subject: [Twisted-web] getting response headers from client.getPage
In-Reply-To: <419337C8.6090604@larswp.dk>
References: <419337C8.6090604@larswp.dk>
Message-ID: <419378A7.7010304@twistedmatrix.com>

Lars Woetmann Pedersen wrote:

> how do I get the responce header in printResult
> the code looks like this now, the content of the page
> is in data, but I also need the header to check the etag and 
> last-modified
>
>         d = client.getPage(myurl)
>         d.addCallback(printResult)
>
>
> def printResult(data):
>         print 'printing result:'
>         print data

I do not want to be rude, but honestly, I think this requires some
rudeness: ASKING QUESTIONS WITHOUT SPENDING FIVE MINUTES
ON THE PROBLEM YOURSELF DOES NOT LEAVE A GOOD IMPRESSION
OF YOU IN THE MINDS OF OTHERS.

Looking for the word "header" in twisted.web.client:

class HTTPClientFactory(protocol.ClientFactory):
    """Download a given URL.

    @type deferred: Deferred
    @ivar deferred: A Deferred that will fire when the content has
          been retrieved. Once this is fired, the ivars `status', `version',
          and `message' will be set.

    @type status: str
    @ivar status: The status of the response.

    @type version: str
    @ivar version: The version of the response.

    @type message: str
    @ivar message: The text message returned with the status.

    @type response_headers: dict
    @ivar response_headers: The headers that were specified in the
          response from the server.
    """

Okay, so the headers are in the factory after the deferred fires.
Let's see how we can get our hands on them:

def getPage(url, contextFactory=None, *args, **kwargs):
    """Download a web page as a string.

    Download a page. Return a deferred, which will callback with a
    page (as a string) or errback with a description of the error.

    See HTTPClientFactory to see what extra args can be passed.
    """
    scheme, host, port, path = _parse(url)
    factory = HTTPClientFactory(url, *args, **kwargs)
    if scheme == 'https':
        from twisted.internet import ssl
        if contextFactory is None:
            contextFactory = ssl.ClientContextFactory()
        reactor.connectSSL(host, port, factory, contextFactory)
    else:
        reactor.connectTCP(host, port, factory)
    return factory.deferred

Okay, so you can't really access the factory via getPage.
Just write a custom getPage that returns factory instead of
factory.deferred.

def myGetPage(url, contextFactory=None, *args, **kwargs):
    scheme, host, port, path = _parse(url)
    factory = HTTPClientFactory(url, *args, **kwargs)
    reactor.connectTCP(host, port, factory)
    return factory


From corydodt at twistedmatrix.com  Thu Nov 11 13:03:09 2004
From: corydodt at twistedmatrix.com (Cory Dodt)
Date: Thu Nov 11 13:05:24 2004
Subject: [Twisted-web] Custom 404, 500 pages only work with stan docFactory,
	not xml
Message-ID: <4193C57D.1060202@twistedmatrix.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

On the Wiki, I posted (quite some time ago) a working example of putting your
own 404 and 500 pages in place of the plain-jane defaults.  The example still
works, and is at:

http://divmod.org/users/wiki.twistd/nevow/moin.cgi/Custom404Page

- --

However, at the same time I wrote that, I discovered that I cannot satisfy my
own use case, which is custom error pages built with xml*, because of some bug
in how Nevow selects the page context to render.  I have tried to find a patch
for this myself, but it just isn't happening.  Too much about context is still
mysterious to me :-/

Compare the minimal example below to the wiki page above.  The wiki works,
this one does not.  When you visit OopsPage, you should see a link to take you
back to the root page.  Instead, in that spot you get an error message saying
render_lastLink can't be found.

Thanks for looking :-)

- --

from nevow import appserver, rend, loaders, tags as T, inevow
from twisted.application import service, internet


class The500Page(rend.Page):
~    __implements__ = (inevow.ICanHandleException,)
~    docFactory = loaders.xmlstr("""\
<html xmlns:n="http://nevow.com/ns/nevow/0.1">
~    <head>
~        <title>500 error</title>
~    </head>
~    <body>
~        <h1>Ouchie.  Server error.</h1>
~        <p>The server is down.</p>
~        <p>Ohhh, the  server.</p>
~        <p n:render="lastLink" />
~    </body>
</html>""")

~    def renderHTTP_exception(self, ctx, failure):
~        inevow.IRequest(ctx).setResponseCode(500)
~        self.renderHTTP(ctx)
~    def render_lastLink(ctx, data):
~        referer = inevow.IRequest(ctx).getHeader('referer')
~        if referer:
~            return T.p[T.a(href=referer)['This link'],
~                       ' will return you to the last page you were on.']
~        else:
~            return T.p['You seem to be hopelessly lost.']

the500page = The500Page()

class OopsPage(rend.Page):
~    def exception(self, ctx, data):
~        1/0 # cause an exception on purpose
~    docFactory = loaders.stan(exception)

class RootPage(rend.Page):
~    docFactory = loaders.stan(
~            T.html[T.head[T.title["Error Pages"]],
~                   T.body[T.h1["The Only Real Page"],
~                          T.a(href="oops")[
~                            "This link causes an exception!"],

~                            ]]
~                              )
~    def locateChild(self, ctx, segments):
~        ctx.remember(the500page, inevow.ICanHandleException)
~        return rend.Page.locateChild(self, ctx, segments)



application = service.Application("errorpages")
root = RootPage()
root.putChild('oops', OopsPage())
svc = internet.TCPServer(8080, appserver.NevowSite(root))
svc.setServiceParent(application)
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.1 (MingW32)
Comment: Using GnuPG with Thunderbird - http://enigmail.mozdev.org

iD8DBQFBk8V93A5SrXAiHQcRArxIAJ9Vqr0BzwGhYVSPX7axH6oOu4TpNACdGdIl
0e9KXLYrky8FhmnTJnbr424=
=P9Cq
-----END PGP SIGNATURE-----

From dp at ulaluma.com  Thu Nov 11 13:31:30 2004
From: dp at ulaluma.com (Donovan Preston)
Date: Thu Nov 11 13:31:53 2004
Subject: [Twisted-web] Nevow - 'connection lost' javascript alert on page
	reloads
In-Reply-To: <8816fcf804111020246edc5a10@mail.gmail.com>
References: <8816fcf804111006136f553d60@mail.gmail.com>
	<24737.62.252.224.25.1100116872.squirrel@webmail.pollenation.net>
	<8816fcf804111020246edc5a10@mail.gmail.com>
Message-ID: <AB959152-3420-11D9-BC3F-000A95864FC4@ulaluma.com>


On Nov 10, 2004, at 8:24 PM, Sridhar R wrote:

> On Wed, 10 Nov 2004 20:01:12 -0000 (GMT), Matt Goodall
> <matt@pollenation.net> wrote:
>
>> If anyone knows how to handle XMLHttpRequest errors then please post 
>> here
>> and we'll get a fix into Nevow.
>>
>
> k3mper has provided a patch.  I tried it and it works!  somebody needs
> to merge this patch with HEAD.
> http://divmod.org/users/roundup.twistd/nevow/issue131

Applied, thank you very much k3mper. And thank you Sridhar for testing 
it.

> And when is nevow-0.3.1? (0.3.1 with the above patch?)

I'd probably rather just release nevow 0.4 with more changes. Sometime 
in the next month would be nice. Does anyone have suggestions for what 
0.4 should have? The big thing I am planning is the use of 
zope.interfaces to get rid of all the deprecation warnings when you use 
Nevow with twisted SVN Head (and thus 2.0)

dp


From tv at twistedmatrix.com  Thu Nov 11 14:35:02 2004
From: tv at twistedmatrix.com (Tommi Virtanen)
Date: Thu Nov 11 14:35:37 2004
Subject: [Twisted-web] Nevow 0.4
In-Reply-To: <AB959152-3420-11D9-BC3F-000A95864FC4@ulaluma.com>
References: <8816fcf804111006136f553d60@mail.gmail.com>	<24737.62.252.224.25.1100116872.squirrel@webmail.pollenation.net>	<8816fcf804111020246edc5a10@mail.gmail.com>
	<AB959152-3420-11D9-BC3F-000A95864FC4@ulaluma.com>
Message-ID: <4193DB06.70201@twistedmatrix.com>

Donovan Preston wrote:

> I'd probably rather just release nevow 0.4 with more changes. Sometime 
> in the next month would be nice. Does anyone have suggestions for what 
> 0.4 should have? The big thing I am planning is the use of 
> zope.interfaces to get rid of all the deprecation warnings when you 
> use Nevow with twisted SVN Head (and thus 2.0)

My current open pet peeves:

http://divmod.org/users/roundup.twistd/nevow/issue132
[PATCH] twisted.trial.util no longer has _getDeferredResult

http://divmod.org/users/roundup.twistd/nevow/issue122
[PATCH] Guard adds a cookie with path='/', does not ever set secure.

http://divmod.org/users/roundup.twistd/nevow/issue120
Release procedure is SNAFU, e.g. no LICENSE or ChangeLog in tarball

Also, I would love to hear whether the following items from
sandbox/tv please you:

access
    Simple access control for web requests.

branchsecure
    Resource wrapper that shows different resources based on whether the
    connection was secure or not.

reversemonster
    Reverse proxy the request, assuming the other end is a
    VHostMonsterResource. Extremely easy to configure, automagic
    hostname, port and path passing.

(for some overviewish things, see sandbox/tv/trac, especially the dia file)


From corydodt at twistedmatrix.com  Thu Nov 11 14:33:48 2004
From: corydodt at twistedmatrix.com (Cory Dodt)
Date: Thu Nov 11 14:36:02 2004
Subject: [Twisted-web] [version not trashed by enigmail] Custom 404,
	500 pages ...
In-Reply-To: <4193C57D.1060202@twistedmatrix.com>
References: <4193C57D.1060202@twistedmatrix.com>
Message-ID: <4193DABC.8040003@twistedmatrix.com>

Cory Dodt wrote:
> On the Wiki, I posted (quite some time ago) a working example of putting 
> your
> own 404 and 500 pages in place of the plain-jane defaults.  The example 
> still
> works, and is at:
> 
> http://divmod.org/users/wiki.twistd/nevow/moin.cgi/Custom404Page
> 
> -=-=-
> 
> However, at the same time I wrote that, I discovered that I cannot 
> satisfy my
> own use case, which is custom error pages built with xml*, because of 
> some bug
> in how Nevow selects the page context to render.  I have tried to find a 
> patch
> for this myself, but it just isn't happening.  Too much about context is 
> still
> mysterious to me :-/
> 
> Compare the minimal example below to the wiki page above.  The wiki works,
> this one does not.  When you visit OopsPage, you should see a link to 
> take you
> back to the root page.  Instead, in that spot you get an error message 
> saying
> render_lastLink can't be found.
> 
> Thanks for looking :-)
> -=-=-

from nevow import appserver, rend, loaders, tags as T, inevow
from twisted.application import service, internet


class The500Page(rend.Page):
     __implements__ = (inevow.ICanHandleException,)
     docFactory = loaders.xmlstr("""\
<html xmlns:n="http://nevow.com/ns/nevow/0.1">
     <head>
         <title>500 error</title>
     </head>
     <body>
         <h1>Ouchie.  Server error.</h1>
         <p>The server is down.</p>
         <p>Ohhh, the  server.</p>
         <p n:render="lastLink" />
     </body>
</html>""")

     def renderHTTP_exception(self, ctx, failure):
         inevow.IRequest(ctx).setResponseCode(500)
         self.renderHTTP(ctx)
     def render_lastLink(ctx, data):
         referer = inevow.IRequest(ctx).getHeader('referer')
         if referer:
             return T.p[T.a(href=referer)['This link'],
                        ' will return you to the last page you were on.']
         else:
             return T.p['You seem to be hopelessly lost.']

the500page = The500Page()

class OopsPage(rend.Page):
     def exception(self, ctx, data):
         1/0 # cause an exception on purpose
     docFactory = loaders.stan(exception)

From matt at pollenation.net  Thu Nov 11 17:03:25 2004
From: matt at pollenation.net (Matt Goodall)
Date: Thu Nov 11 17:03:40 2004
Subject: [Twisted-web] Nevow 0.4
In-Reply-To: <AB959152-3420-11D9-BC3F-000A95864FC4@ulaluma.com>
References: <8816fcf804111006136f553d60@mail.gmail.com>
	<24737.62.252.224.25.1100116872.squirrel@webmail.pollenation.net>
	<8816fcf804111020246edc5a10@mail.gmail.com>
	<AB959152-3420-11D9-BC3F-000A95864FC4@ulaluma.com>
Message-ID: <16974.62.252.224.25.1100217805.squirrel@webmail.pollenation.net>

>> And when is nevow-0.3.1? (0.3.1 with the above patch?)
>
> I'd probably rather just release nevow 0.4 with more changes. Sometime
> in the next month would be nice. Does anyone have suggestions for what
> 0.4 should have? The big thing I am planning is the use of
> zope.interfaces to get rid of all the deprecation warnings when you use
> Nevow with twisted SVN Head (and thus 2.0)
>
> dp

On my wishlist:

  * Sort out the url module and add new deprecation warnings ;-).
  * Finish and merge the unicode forms stuff.
  * Kill the evil overloaded render method signature hack and
    simplify parameterised render and data methods.
  * Apply/fix any easy/significant issues in the tracker.
  * Documentation.

Cheers, Matt

-- 
Matt Goodall, Pollenation Internet Ltd
w: http://www.pollenation.net
e: matt@pollenation.net


From sridharinfinity at gmail.com  Thu Nov 11 20:17:27 2004
From: sridharinfinity at gmail.com (Sridhar R)
Date: Thu Nov 11 20:17:30 2004
Subject: [Twisted-web] Re: Nevow-0.4 suggestions
In-Reply-To: <AB959152-3420-11D9-BC3F-000A95864FC4@ulaluma.com>
References: <8816fcf804111006136f553d60@mail.gmail.com>
	<24737.62.252.224.25.1100116872.squirrel@webmail.pollenation.net>
	<8816fcf804111020246edc5a10@mail.gmail.com>
	<AB959152-3420-11D9-BC3F-000A95864FC4@ulaluma.com>
Message-ID: <8816fcf8041111191765c95e0a@mail.gmail.com>

On Thu, 11 Nov 2004 12:31:30 -0800, Donovan Preston <dp@ulaluma.com> wrote:
> 
> 
> On Nov 10, 2004, at 8:24 PM, Sridhar R wrote:
> 
> > And when is nevow-0.3.1? (0.3.1 with the above patch?)
> 
> I'd probably rather just release nevow 0.4 with more changes. Sometime
> in the next month would be nice. Does anyone have suggestions for what
> 0.4 should have? The big thing I am planning is the use of
> zope.interfaces to get rid of all the deprecation warnings when you use
> Nevow with twisted SVN Head (and thus 2.0)
> 

I have some suggestions.  

1. The exception stack trace sent to HTTP client is more colorful and
verbose.  May be you could use javascript to make the code segments of
each trace point collapsable/expandable (I mean collapse to see only
that *line* in stack trace and expand to see the surrounding lines)

2. Allow for multple logins (guard) from same host (This would help in
testing Nevow applications which involves multiple accounts in the
same machine).  Well, actually I am quite biased, the only URL of my
app is http://localhost:8080 (though I have different rend.Page
classes derived from common one).  May be one could have
http://localhost:8080/user1 and http://localhost:8080/user1 and so on
for different users.  Even then (I have not tested it), I am not sure
whether guard allows such authorization (cookie mess?)


-- 
Sridhar R - http://cs.annauniv.edu/~rsridhar
Blog: http://www.livejournal.com/~sridharinfinity

From tv at twistedmatrix.com  Fri Nov 12 00:16:54 2004
From: tv at twistedmatrix.com (Tommi Virtanen)
Date: Fri Nov 12 00:17:30 2004
Subject: [Twisted-web] Re: Nevow-0.4 suggestions
In-Reply-To: <8816fcf8041111191765c95e0a@mail.gmail.com>
References: <8816fcf804111006136f553d60@mail.gmail.com>	<24737.62.252.224.25.1100116872.squirrel@webmail.pollenation.net>	<8816fcf804111020246edc5a10@mail.gmail.com>	<AB959152-3420-11D9-BC3F-000A95864FC4@ulaluma.com>
	<8816fcf8041111191765c95e0a@mail.gmail.com>
Message-ID: <41946366.5030601@twistedmatrix.com>

Sridhar R wrote:

>2. Allow for multple logins (guard) from same host (This would help in
>testing Nevow applications which involves multiple accounts in the
>same machine).  Well, actually I am quite biased, the only URL of my
>app is http://localhost:8080 (though I have different rend.Page
>classes derived from common one).  May be one could have
>http://localhost:8080/user1 and http://localhost:8080/user1 and so on
>for different users.  Even then (I have not tested it), I am not sure
>whether guard allows such authorization (cookie mess?)
>  
>
Run two different instances of the browser.
Profiles with mozilla will help.


From tv at twistedmatrix.com  Fri Nov 12 00:34:59 2004
From: tv at twistedmatrix.com (Tommi Virtanen)
Date: Fri Nov 12 00:35:32 2004
Subject: [Twisted-web] Re: Nevow-0.4 suggestions
In-Reply-To: <41946366.5030601@twistedmatrix.com>
References: <8816fcf804111006136f553d60@mail.gmail.com>	<24737.62.252.224.25.1100116872.squirrel@webmail.pollenation.net>	<8816fcf804111020246edc5a10@mail.gmail.com>	<AB959152-3420-11D9-BC3F-000A95864FC4@ulaluma.com>	<8816fcf8041111191765c95e0a@mail.gmail.com>
	<41946366.5030601@twistedmatrix.com>
Message-ID: <419467A3.7000409@twistedmatrix.com>

Tommi Virtanen wrote:

>> 2. Allow for multple logins (guard) from same host (This would help in
>> testing Nevow applications which involves multiple accounts in the
>> same machine).  Well, actually I am quite biased, the only URL of my
>> app is http://localhost:8080 (though I have different rend.Page
>> classes derived from common one).  May be one could have
>> http://localhost:8080/user1 and http://localhost:8080/user1 and so on
>> for different users.  Even then (I have not tested it), I am not sure
>> whether guard allows such authorization (cookie mess?)
>
> Run two different instances of the browser.
> Profiles with mozilla will help.

Or, alternatively, deny cookies and use path-based sessions.


From pyp at gmx.net  Fri Nov 12 01:51:15 2004
From: pyp at gmx.net (Mike Mueller)
Date: Fri Nov 12 01:48:04 2004
Subject: [Twisted-web] reverse proxy with nevow
In-Reply-To: <5.2.1.1.0.20041111095544.02607c98@mail.comune.grosseto.it>
Message-ID: <5.2.1.1.1.20041112092246.01bb8640@pop.gmx.net>

At 09:57 11.11.2004 +0100, you wrote:
>Hi Mike,
>
>in just a bit I'll have to set up a reverse proxy with url rewriting.  Do 
>you mind to share your setup?  (and can I post it on the devel list of 
>OpenPortalGuard (openportalguard.sf.net))?
>
>many thanks
>-b


Here is my version.
It serves static files from subdirectories in a given directory.
The names of the subdirectories correspond to the domain names.
In the example below, this is just domain1.com but it could be more domains.
The reverse proxy part redirects all requests to domains2.com to port 8080 
on the same machine.
So instead using domain2.com:8080 you can use domain2.com directly (that is 
on port 80).

The source for my server on port 80 looks like this:

#twistedStaticServer.py
from twisted.web import vhost, static, server, proxy
from twisted.application import internet, service
import os


# use this path to put several subdirectories
# the name of each subdirectory is used as a domain name
vhostDir = '..\hosts'

root = vhost.NameVirtualHost()
dir = 'domain1.com'
# making all files in ..\hosts\domain1.com\ available
# as static pages, just put your html files there
root.addHost(dir, static.File(os.path.join(vhostDir, dir)))

# now the reverse proxy part
vhostName = 'domain2.com'
# there is another server listening at 8080
reverseProxy = proxy.ReverseProxyResource('localhost', 8080, '')
# just add it to root and tell that it is a reverseProxy
root.addHost(vhostName, reverseProxy)
application = service.Application('web')
sc = service.IServiceCollection(application)
site = server.Site(root)
i = internet.TCPServer(80, site)
i.setServiceParent(sc)

For this to work you have to have a directory ../hosts/domain1.com and of 
course put the lines
127.0.0.1       domain1.com
127.0.0.1       domain2.com
in your /etc/hosts.

The source for the reverse proxy looks like this:

#nevowProxy.py
import random
from nevow import appserver, vhost
from twisted.application import internet, service
from nevow import rend, tags
from nevow import loaders

vResource = vhost.VHostMonsterResource()

class VHostGreeter(rend.Page):
     docFactory = loaders.stan(
     tags.html[
     tags.head[ tags.title[ "Runnig as VHostMonsterResource" ]],
     tags.body[
         tags.h1(style="font-size: large")[ "This works." ]
     ]
])

root = VHostGreeter()
#just add child as nevow.vhost.VHostMonsterResource()
root.putChild("vhost", vResource)

application = service.Application('web-proxy')
sc = service.IServiceCollection(application)
site = appserver.NevowSite(root)
i = internet.TCPServer(8080, site)
i.setServiceParent(sc)

The server listens on port 8080 and can still be directly accessed via 
domain2.com:8080.
But it also works behind the static server. In this case it means the 
bowser just shows domain2.com.

That's what I wanted. You might need to adapt to your needs.


HTH,

Mike



From alex-news at comcast.net  Mon Nov 15 11:07:04 2004
From: alex-news at comcast.net (Alexander May)
Date: Mon Nov 15 11:06:52 2004
Subject: [Twisted-web] Credential questions - hide user name and password on
	login + get ip address in realm
In-Reply-To: <AB959152-3420-11D9-BC3F-000A95864FC4@ulaluma.com>
Message-ID: <E1CTlFa-00027y-00@pyramid.twistedmatrix.com>

I have imitated the login process as shown in the nevow example guarded.tac.


A couple of questions:

1) After I log in, the username and password are shown in the address bar.
Is there anyway to force the guard code to use post instead of get so that
such things are not displayed so publicly.  I tried changing the main log-in
form  to use post, but it seems there is a redirect that occurs that
prevents such a change from having the desired result.

2) I would like to check the up address that the user is logging in from to
perform some additional verification.  Is there a way to get access to this
information in Realm.requestAvatar or in CredentialsChecker.requestAvatarId,
or somewhere else where it may be incorporated into the log-in process?

Thanks,
Alex


From morgen at osafoundation.org  Mon Nov 15 15:05:54 2004
From: morgen at osafoundation.org (Morgen Sagen)
Date: Mon Nov 15 15:06:06 2004
Subject: [Twisted-web] WebDAV client library?
Message-ID: <8524E14D-3752-11D9-A0BC-000D932D019E@osafoundation.org>

I've searched the Twisted site/source but haven't seen a reference to a 
Twisted WebDAV client library.  Does this yet exist?

Thanks,
~morgen


From tv at twistedmatrix.com  Tue Nov 16 02:15:15 2004
From: tv at twistedmatrix.com (Tommi Virtanen)
Date: Tue Nov 16 02:16:12 2004
Subject: [Twisted-web] Credential questions - hide user name and password
	on	login + get ip address in realm
In-Reply-To: <E1CTlFa-00027y-00@pyramid.twistedmatrix.com>
References: <E1CTlFa-00027y-00@pyramid.twistedmatrix.com>
Message-ID: <4199C523.4000707@twistedmatrix.com>

Alexander May wrote:

>1) After I log in, the username and password are shown in the address bar.
>Is there anyway to force the guard code to use post instead of get so that
>such things are not displayed so publicly.  I tried changing the main log-in
>form  to use post, but it seems there is a redirect that occurs that
>prevents such a change from having the desired result.
>  
>
That's a bug in _your_ code. Just use POST. Guard doesn't implement the 
form.
 From guarded.tac:

            tags.form(action=guard.LOGIN_AVATAR, method='post')[

>2) I would like to check the up address that the user is logging in from to
>perform some additional verification.  Is there a way to get access to this
>information in Realm.requestAvatar or in CredentialsChecker.requestAvatarId,
>or somewhere else where it may be incorporated into the log-in process?
>  
>
Well, you can do it before or after the guard, atleast.
http://divmod.org/svn/Nevow/sandbox/tv/access


From sifu-twisted at 0xx0.net  Tue Nov 16 03:20:11 2004
From: sifu-twisted at 0xx0.net (Siegmund Fuehringer)
Date: Tue Nov 16 03:05:12 2004
Subject: [Twisted-web] dynamic nevow example-listing
Message-ID: <20041116102011.GA27887@m.0xx0.net>

hi all! 

i like the idea of nevow example listing that was written a few
hours ago. it would be cool to just run a livedemo of the examples 
somewhere like divmod.org/nevow.com. :)

but what about implementing it in a more dynamic way like:
http://www.sifu.info/exampleBrowser.tgz
than there is no need to always edit the index.html file when you add 
a new one.
it would be necessary though to place every example in its own directory 
(would be nice anyways to see which files belongs to which examples) and 
add a __init__.py with a litte metadata. a little docu for each example 
would probably also not hurt too much :)

the example implementation above is just very a crude hack (will not 
even run on windows), because i did not want to invest hours before 
i know what you think about it.


greetings - sifu

From andrea at teamsw.it  Tue Nov 16 03:37:16 2004
From: andrea at teamsw.it (Andrea Nicolini)
Date: Tue Nov 16 03:38:12 2004
Subject: [Twisted-web] Xml-Rpc server troubles
Message-ID: <1100601436l.12582l.5l@Asterix>

Hi All,

I'm trying to debug a XML-RPC server I wrote because sometimes it gets  
stuck and I don't know why.
I'm not a twisted expertise so I hope someone in this list can help me.

I use the server to give access to a MySql database via XML-RPC, the  
client are written in python and java.
The server runs fine for some days and then suddenly it hangs.
When the server hangs I can connect to the server port but when I call  
a remote method the server doesn't respond.
The server is not throwing any exception.
I'm running the server on a RH9 using Python 2.2 and Twisted 1.3.

Here's a snippet of code:


def xmlrpc_createjob(self,hash):
                tscmfuncs.call_debug(debug,foreground)
                d = self.dbpool.runInteraction(self.createjob,hash)
                return d.addCallback(self.returnData)

def createjob(self,cur,hash):
                """Method to create a new job -> returns the new job's  
id"""
                try:
                        qparam = ()
                        cur.execute('SELECT * FROM jobtable')
                        for field in cur.description:
                                f = field[0]
                                if hash.has_key(f):
                                        if type(hash[f]) == type(u''):
                                                qparam += (hash 
[f].encode('iso-8859-1'),)
                                        else:
                                                qparam += (hash[f],)
                                else:
                                        qparam += (None,)
                        cur.execute("INSERT INTO jobtable VALUES (%s,% 
s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,% 
s)",qparam)
                        cur.execute("SELECT LAST_INSERT_ID() FROM  
jobtable")
                        curid = cur.fetchone()[0]
                        cur.close()

                except Exception,err:
                        return 0
                else:
                        return curid


I don't have any idea of what can cause this behaviour and how to debug  
the server.
Any idea?

Thank you.
Bye.
-- 

Andrea Nicolini
mailto:andrea@teamsw.it
im:aser76@jabber.linux.it
http://www.teamsw.it
Team Software S.r.l.
Via Campagna 30
Cognento MO
Tel 059.343790



From dialtone at gmail.com  Tue Nov 16 05:09:11 2004
From: dialtone at gmail.com (Valentino Volonghi)
Date: Tue Nov 16 05:09:15 2004
Subject: [Twisted-web] dynamic nevow example-listing
In-Reply-To: <20041116102011.GA27887@m.0xx0.net>
References: <20041116102011.GA27887@m.0xx0.net>
Message-ID: <c893b8530411160409312eb862@mail.gmail.com>

On Tue, 16 Nov 2004 18:20:11 +0800, Siegmund Fuehringer
<sifu-twisted@0xx0.net> wrote:
> hi all!
> 
> i like the idea of nevow example listing that was written a few
> hours ago. it would be cool to just run a livedemo of the examples
> somewhere like divmod.org/nevow.com. :)
> 
> but what about implementing it in a more dynamic way like:
> http://www.sifu.info/exampleBrowser.tgz
> than there is no need to always edit the index.html file when you add
> a new one.
> it would be necessary though to place every example in its own directory
> (would be nice anyways to see which files belongs to which examples) and
> add a __init__.py with a litte metadata. a little docu for each example
> would probably also not hurt too much :)
> 
> the example implementation above is just very a crude hack (will not
> even run on windows), because i did not want to invest hours before
> i know what you think about it.

-1

This would require to add unnecessary stuff to each example, making
every user think that they need that unnecessary stuff to write new
code.

I can't see anything really bad in adding 2 lines in a file for a new example.
Although I agree it's not beautiful, It's the least intrusive for each example.

IMHO at least.

-- 
Valentino Volonghi aka Dialtone
Now running FreeBSD 5.3-beta6
Blog: http://vvolonghi.blogspot.com
Home Page: http://xoomer.virgilio.it/dialtone/

From alex-news at comcast.net  Tue Nov 16 07:42:05 2004
From: alex-news at comcast.net (Alexander May)
Date: Tue Nov 16 07:42:04 2004
Subject: [Twisted-web] Credential questions - hide user name and
	passwordon	login + get ip address in realm
In-Reply-To: <4199C523.4000707@twistedmatrix.com>
Message-ID: <E1CU4Wl-0002hU-00@pyramid.twistedmatrix.com>

> That's a bug in _your_ code. Just use POST. Guard doesn't implement the
form.
>  From guarded.tac:

>             tags.form(action=guard.LOGIN_AVATAR, method='post')[

I was working off the 0.3 examples directory which does not have
method=post.  Somewhat baffled I looked at the version in the svn trunk and
I see that the example has been updated to include method=post.  It works
(as you know); I'm glad to see the guard code handles it correctly.  Thanks.


> Well, you can do it before or after the guard, atleast.

If I parse this code correctly, you are simply pulling the ipaddress and url
out of the context passed to various resource functions and filtering on it.
I certainly could do this as well, but I would prefer to have access to it
while I have an avatar available too.  Furthermore I would like to create a
single log entry of avatar and ip-address for every log-in.  Doing it a web
page centric way strikes me as less good then doing it in a log-in centric
way.

Alex







-----Original Message-----
From: twisted-web-bounces@twistedmatrix.com
[mailto:twisted-web-bounces@twistedmatrix.com] On Behalf Of Tommi Virtanen
Sent: Tuesday, November 16, 2004 4:15 AM
To: Discussion of twisted.web, Nevow,and Woven
Subject: Re: [Twisted-web] Credential questions - hide user name and
passwordon login + get ip address in realm

Alexander May wrote:

>1) After I log in, the username and password are shown in the address bar.
>Is there anyway to force the guard code to use post instead of get so 
>that such things are not displayed so publicly.  I tried changing the 
>main log-in form  to use post, but it seems there is a redirect that 
>occurs that prevents such a change from having the desired result.
>  
>
That's a bug in _your_ code. Just use POST. Guard doesn't implement the
form.
 From guarded.tac:

            tags.form(action=guard.LOGIN_AVATAR, method='post')[

>2) I would like to check the up address that the user is logging in 
>from to perform some additional verification.  Is there a way to get 
>access to this information in Realm.requestAvatar or in 
>CredentialsChecker.requestAvatarId,
>or somewhere else where it may be incorporated into the log-in process?
>  
>
Well, you can do it before or after the guard, atleast.
http://divmod.org/svn/Nevow/sandbox/tv/access


_______________________________________________
Twisted-web mailing list
Twisted-web@twistedmatrix.com
http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web


From sifu-twisted at 0xx0.net  Tue Nov 16 08:41:37 2004
From: sifu-twisted at 0xx0.net (Siegmund Fuehringer)
Date: Tue Nov 16 08:26:08 2004
Subject: [Twisted-web] dynamic nevow example-listing
In-Reply-To: <c893b8530411160409312eb862@mail.gmail.com>
References: <20041116102011.GA27887@m.0xx0.net>
	<c893b8530411160409312eb862@mail.gmail.com>
Message-ID: <20041116154137.GB28323@m.0xx0.net>

On Tue, Nov 16, 2004 at 01:09:11PM +0100, Valentino Volonghi wrote:
> On Tue, 16 Nov 2004 18:20:11 +0800, Siegmund Fuehringer
> <sifu-twisted@0xx0.net> wrote:
> > hi all!
> > 
> > i like the idea of nevow example listing that was written a few
> > hours ago. it would be cool to just run a livedemo of the examples
> > somewhere like divmod.org/nevow.com. :)
> > 
> > but what about implementing it in a more dynamic way like:
> > http://www.sifu.info/exampleBrowser.tgz
> > than there is no need to always edit the index.html file when you add
> > a new one.
> > it would be necessary though to place every example in its own directory
> > (would be nice anyways to see which files belongs to which examples) and
> > add a __init__.py with a litte metadata. a little docu for each example
> > would probably also not hurt too much :)
> > 
> > the example implementation above is just very a crude hack (will not
> > even run on windows), because i did not want to invest hours before
> > i know what you think about it.
> 
> -1
> 
> This would require to add unnecessary stuff to each example, making
> every user think that they need that unnecessary stuff to write new
> code.

thats true... "every" user could think that they need to add an 
__init__.py :)

> 
> I can't see anything really bad in adding 2 lines in a file for a new example.
> Although I agree it's not beautiful, It's the least intrusive for each example.

that is true too...

and a really don't mind if it stays like it is now.

just one more comment:
as it is at the moment, we need to have all live examples in one 
directory, and that makes it hard to see at one glance, what files 
belongs to one example. and i also hoped to see more complicated 
examples with some sort of minitutorials to emerge.

and as soon as we put an example in a subdir, we would need 
a __init__.py anyways and also some os.chdir hacks in the example.tac to 
make filetemplates work.


bye bye - sifu

> 
> IMHO at least.
> 
> -- 
> Valentino Volonghi aka Dialtone
> Now running FreeBSD 5.3-beta6
> Blog: http://vvolonghi.blogspot.com
> Home Page: http://xoomer.virgilio.it/dialtone/
> 
> _______________________________________________
> Twisted-web mailing list
> Twisted-web@twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web

From mesozoic at polynode.com  Tue Nov 16 08:40:41 2004
From: mesozoic at polynode.com (Alex Levy)
Date: Tue Nov 16 08:41:24 2004
Subject: [Twisted-web] Re: Credential questions - hide user name and
	passwordon	login + get ip address in realm
In-Reply-To: <E1CU4Wl-0002hU-00@pyramid.twistedmatrix.com>
References: <4199C523.4000707@twistedmatrix.com>
	<E1CU4Wl-0002hU-00@pyramid.twistedmatrix.com>
Message-ID: <20041116154040.GI15808@perpetual.moxn.net>

On Tue, Nov 16, 2004 at 09:42:05AM -0500, Alexander May wrote:
> > That's a bug in _your_ code. Just use POST. Guard doesn't implement the
> form.
> >  From guarded.tac:
> 
> >             tags.form(action=guard.LOGIN_AVATAR, method='post')[
> 
> I was working off the 0.3 examples directory which does not have
> method=post.  Somewhat baffled I looked at the version in the svn trunk and
> I see that the example has been updated to include method=post.  It works
> (as you know); I'm glad to see the guard code handles it correctly.  Thanks.

Yes, that was me -- I saw, after your post, that one guard example had a
POST method, and one did not. I also updated userdb.tac.


-- 
Alex Levy
WWW: http://mesozoic.geecs.org/
 
"Never let your sense of morals prevent you from doing what is right."
 -- Salvor Hardin, Isaac Asimov's _Foundation_

From alex-news at comcast.net  Tue Nov 16 08:50:51 2004
From: alex-news at comcast.net (Alexander May)
Date: Tue Nov 16 08:50:41 2004
Subject: [Twisted-web] Credential questions - hide user name
	andpasswordon	login + get ip address in realm
In-Reply-To: <E1CU4Wl-0002hU-00@pyramid.twistedmatrix.com>
Message-ID: <E1CU5bI-0003LG-00@pyramid.twistedmatrix.com>

Also, while on I'm on the subject of guard, is there a way to set the url a
user reaches after log in?  For example if the log in form is at
http:/foo.com/, I would like the admin log in to end up at
http:/foo.com/Admin/, and the non admin log in to end up at
http:/foo.com/Home/.  Currently, both just end up at the root url.  Should
the respective resources returned in Realm:requestAvatar just do a redirect,
or is some simple way to rewrite the url?  I tried muddling with the various
path members of the request in locateChild with no success.



-----Original Message-----
From: twisted-web-bounces@twistedmatrix.com
[mailto:twisted-web-bounces@twistedmatrix.com] On Behalf Of Alexander May
Sent: Tuesday, November 16, 2004 9:42 AM
To: 'Discussion of twisted.web, Nevow,and Woven'
Subject: RE: [Twisted-web] Credential questions - hide user name
andpasswordon login + get ip address in realm

> That's a bug in _your_ code. Just use POST. Guard doesn't implement 
> the
form.
>  From guarded.tac:

>             tags.form(action=guard.LOGIN_AVATAR, method='post')[

I was working off the 0.3 examples directory which does not have
method=post.  Somewhat baffled I looked at the version in the svn trunk and
I see that the example has been updated to include method=post.  It works
(as you know); I'm glad to see the guard code handles it correctly.  Thanks.


> Well, you can do it before or after the guard, atleast.

If I parse this code correctly, you are simply pulling the ipaddress and url
out of the context passed to various resource functions and filtering on it.
I certainly could do this as well, but I would prefer to have access to it
while I have an avatar available too.  Furthermore I would like to create a
single log entry of avatar and ip-address for every log-in.  Doing it a web
page centric way strikes me as less good then doing it in a log-in centric
way.

Alex







-----Original Message-----
From: twisted-web-bounces@twistedmatrix.com
[mailto:twisted-web-bounces@twistedmatrix.com] On Behalf Of Tommi Virtanen
Sent: Tuesday, November 16, 2004 4:15 AM
To: Discussion of twisted.web, Nevow,and Woven
Subject: Re: [Twisted-web] Credential questions - hide user name and
passwordon login + get ip address in realm

Alexander May wrote:

>1) After I log in, the username and password are shown in the address bar.
>Is there anyway to force the guard code to use post instead of get so 
>that such things are not displayed so publicly.  I tried changing the 
>main log-in form  to use post, but it seems there is a redirect that 
>occurs that prevents such a change from having the desired result.
>  
>
That's a bug in _your_ code. Just use POST. Guard doesn't implement the
form.
 From guarded.tac:

            tags.form(action=guard.LOGIN_AVATAR, method='post')[

>2) I would like to check the up address that the user is logging in 
>from to perform some additional verification.  Is there a way to get 
>access to this information in Realm.requestAvatar or in 
>CredentialsChecker.requestAvatarId,
>or somewhere else where it may be incorporated into the log-in process?
>  
>
Well, you can do it before or after the guard, atleast.
http://divmod.org/svn/Nevow/sandbox/tv/access


_______________________________________________
Twisted-web mailing list
Twisted-web@twistedmatrix.com
http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web


_______________________________________________
Twisted-web mailing list
Twisted-web@twistedmatrix.com
http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web


From dp at divmod.org  Tue Nov 16 09:55:18 2004
From: dp at divmod.org (Donovan Preston)
Date: Tue Nov 16 09:55:25 2004
Subject: [Twisted-web] Credential questions - hide user name
	andpasswordon	login + get ip address in realm
In-Reply-To: <E1CU5bI-0003LG-00@pyramid.twistedmatrix.com>
References: <E1CU5bI-0003LG-00@pyramid.twistedmatrix.com>
Message-ID: <4BE2DC27-37F0-11D9-B3B8-000A95864FC4@divmod.org>


On Nov 16, 2004, at 7:50 AM, Alexander May wrote:

> Also, while on I'm on the subject of guard, is there a way to set the 
> url a
> user reaches after log in?  For example if the log in form is at
> http:/foo.com/, I would like the admin log in to end up at
> http:/foo.com/Admin/, and the non admin log in to end up at
> http:/foo.com/Home/.  Currently, both just end up at the root url.  
> Should
> the respective resources returned in Realm:requestAvatar just do a 
> redirect,
> or is some simple way to rewrite the url?  I tried muddling with the 
> various
> path members of the request in locateChild with no success.

The path segments which appear after the __login__ segment in the login 
form you generate will be used as the target of the redirect after 
login. Unfortunately this doesn't solve your problem, because you want 
to redirect based on the type of login. Perhaps the resource you return 
as / can immediately do a redirect to the appropriate URL? For example:

class Redirector:
     __implements__ = inevow.IResource,

     def __init__(self, avatar):
         self.avatar = avatar

     def calculateAppropriateRedirectURL(self):
         if self.avatar.admin: return '/Admin/'
         return '/Home/'

     def locateChild(self, ctx, segments):
         return self, ()

     def renderHTTP(self, ctx):
         
inevow.IRequest(ctx).redirect(self.calculateAppropriateRedirectURL())

Perhaps also this redirect would only happen once, and set some state 
on self indicating it happened, and then do a normal page render if the 
user visited / after the first time.

dp


From alex-news at comcast.net  Tue Nov 16 13:18:22 2004
From: alex-news at comcast.net (Alexander May)
Date: Tue Nov 16 13:18:10 2004
Subject: [Twisted-web] webform  success message?
Message-ID: <E1CU9mC-0005x0-00@pyramid.twistedmatrix.com>

When a form is submitted successfully using webform, is there a way to add a
success message to the re-rendered form output? 


From corydodt at twistedmatrix.com  Tue Nov 16 14:31:56 2004
From: corydodt at twistedmatrix.com (Cory Dodt)
Date: Tue Nov 16 14:34:25 2004
Subject: [Twisted-web] webform  success message?
In-Reply-To: <E1CU9mC-0005x0-00@pyramid.twistedmatrix.com>
References: <E1CU9mC-0005x0-00@pyramid.twistedmatrix.com>
Message-ID: <419A71CC.8010108@twistedmatrix.com>

One approach to take is like this:
<html>
   <body n:render="amICompleted">
   <div n:pattern="notCompleted">
    ... the regular form ...
   </div>
   <div n:pattern="completed">
    ... the success message ...
   </div>
   </body>
</html>

and then do a ctx.onePattern('completed') or 'notCompleted' somewhere in
render_amICompleted.  You can determine whether or not it's completed by
examining IHand(ctx), which is the return value of your autocallable.

The html above will present either one or the other, either the form or the
success message.  You can easily adapt this so you get either the
form-without-completed-message or the form-with-completed-message, I'll leave
that as an exercise to you.  The key thing is knowing about IHand.

C


Alexander May wrote:
> When a form is submitted successfully using webform, is there a way to add a
> success message to the re-rendered form output? 
> 
> 
> _______________________________________________
> Twisted-web mailing list
> Twisted-web@twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web


From teratorn at world-net.net  Tue Nov 16 14:35:50 2004
From: teratorn at world-net.net (Eric Mangold)
Date: Tue Nov 16 14:35:58 2004
Subject: [Twisted-web] Xml-Rpc server troubles
In-Reply-To: <1100601436l.12582l.5l@Asterix>
References: <1100601436l.12582l.5l@Asterix>
Message-ID: <opshkt900t6k1y1x@localhost.localdomain>

Andrea Nicolini wrote:

> Hi All,
>
> I'm trying to debug a XML-RPC server I wrote because sometimes it gets  
> stuck and I don't know why.
> I'm not a twisted expertise so I hope someone in this list can help me.
>
> I use the server to give access to a MySql database via XML-RPC, the  
> client are written in python and java.
> The server runs fine for some days and then suddenly it hangs.
> When the server hangs I can connect to the server port but when I call a  
> remote method the server doesn't respond.
> The server is not throwing any exception.
> I'm running the server on a RH9 using Python 2.2 and Twisted 1.3.
>
> Here's a snippet of code:
>
>
> def xmlrpc_createjob(self,hash):
>                 tscmfuncs.call_debug(debug,foreground)
>                 d = self.dbpool.runInteraction(self.createjob,hash)
>                 return d.addCallback(self.returnData)

Where is your Errback? If this doesn't work then you'll never know until
the Deferred gets GC'ed, if it ever does, and even then only sometimes.

Deferred's have __del__ defined to hopefully, maybe, warn the user if there
were errors that never got handled. This is of course not guarenteed to  
happen.

Always, always, add Errbacks.

>
> def createjob(self,cur,hash):
>                 """Method to create a new job -> returns the new job's  
> id"""
>                 try:
>                         qparam = ()
>                         cur.execute('SELECT * FROM jobtable')
>                         for field in cur.description:
>                                 f = field[0]
>                                 if hash.has_key(f):
>                                         if type(hash[f]) == type(u''):
>                                                 qparam += (hash 
> [f].encode('iso-8859-1'),)
>                                         else:
>                                                 qparam += (hash[f],)
>                                 else:
>                                         qparam += (None,)
>                         cur.execute("INSERT INTO jobtable VALUES (%s,% 
> s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,%s,% 
> s)",qparam)
>                         cur.execute("SELECT LAST_INSERT_ID() FROM  
> jobtable")
>                         curid = cur.fetchone()[0]
>                         cur.close()
>
>                 except Exception,err:
>                         return 0
>                 else:
>                         return curid
>
>
> I don't have any idea of what can cause this behaviour and how to debug  
> the server.
> Any idea?

I don't know much about Twisted's RDBMS stuff.  I'm assuming createjob  
gets run in a thread.
Maybe these threads are getting stuck? *shrug*.  Apparently the Deferred's  
aren't firing, but you
could have a timeout function to see if they really are getting fired but  
lost before the
result gets send back by xml-rpc.

Perhaps something like this (untested):

def xmlrpc_createjob(self,hash):
     tscmfuncs.call_debug(debug,foreground)
     d = self.dbpool.runInteraction(self.createjob,hash)
     reactor.callLater(5, checkIfDeferredFired, d)
     return d.addCallback(self.returnData)

def checkIfDeferredFired(d):
     if not d.called:
         log.msg('Deferred not fired after 5 seconds')

     #omit this if it will fill your logs too much
     else:
         log.msg('Deferred fired OK')

Good luck,
-Eric


From dp at ulaluma.com  Tue Nov 16 14:42:34 2004
From: dp at ulaluma.com (Donovan Preston)
Date: Tue Nov 16 14:42:42 2004
Subject: [Twisted-web] webform  success message?
In-Reply-To: <419A71CC.8010108@twistedmatrix.com>
References: <E1CU9mC-0005x0-00@pyramid.twistedmatrix.com>
	<419A71CC.8010108@twistedmatrix.com>
Message-ID: <6D6250B2-3818-11D9-B3B8-000A95864FC4@ulaluma.com>


On Nov 16, 2004, at 1:31 PM, Cory Dodt wrote:

> and then do a ctx.onePattern('completed') or 'notCompleted' somewhere 
> in
> render_amICompleted.  You can determine whether or not it's completed 
> by
> examining IHand(ctx), which is the return value of your autocallable.

The IHand (the return value of your autocallable) is also automatically 
displayed as a status message. In plain english, if you return a string 
from the autocallable, it'll show up as the status message.

dp


From andrea at teamsw.it  Wed Nov 17 00:39:07 2004
From: andrea at teamsw.it (Andrea Nicolini)
Date: Wed Nov 17 00:40:02 2004
Subject: [Twisted-web] Xml-Rpc server troubles
In-Reply-To: <opshkt900t6k1y1x@localhost.localdomain> (from
	teratorn@world-net.net on Tue Nov 16 22:35:50 2004)
References: <1100601436l.12582l.5l@Asterix>
	<opshkt900t6k1y1x@localhost.localdomain>
Message-ID: <1100677147l.28898l.2l@Asterix>


On 11/16/04 22:35:50, Eric Mangold wrote:

> Where is your Errback? If this doesn't work then you'll never know  
> until
> the Deferred gets GC'ed, if it ever does, and even then only  
> sometimes.
> 
> Deferred's have __del__ defined to hopefully, maybe, warn the user if  
> there
> were errors that never got handled. This is of course not guarenteed  
> to happen.
> 
> Always, always, add Errbacks.

Ok, you're right. I'll do.


> 
> I don't know much about Twisted's RDBMS stuff.  I'm assuming  
> createjob gets run in a thread.
> Maybe these threads are getting stuck? *shrug*.  Apparently the  
> Deferred's aren't firing, but you
> could have a timeout function to see if they really are getting fired  
> but lost before the
> result gets send back by xml-rpc.
> 
> Perhaps something like this (untested):
> 
> def xmlrpc_createjob(self,hash):
>     tscmfuncs.call_debug(debug,foreground)
>     d = self.dbpool.runInteraction(self.createjob,hash)
>     reactor.callLater(5, checkIfDeferredFired, d)
>     return d.addCallback(self.returnData)
> 
> def checkIfDeferredFired(d):
>     if not d.called:
>         log.msg('Deferred not fired after 5 seconds')
> 
>     #omit this if it will fill your logs too much
>     else:
>         log.msg('Deferred fired OK')
>
Thank you very much Eric.
I'll follow your advices.

-- 

Andrea Nicolini
mailto:andrea@teamsw.it
im:aser76@jabber.linux.it
http://www.teamsw.it
Team Software S.r.l.
Via Campagna 30
Cognento MO
Tel 059.343790



From alex-news at comcast.net  Wed Nov 17 10:35:52 2004
From: alex-news at comcast.net (Alexander May)
Date: Wed Nov 17 10:35:53 2004
Subject: [Twisted-web] webform  success message?
In-Reply-To: <6D6250B2-3818-11D9-B3B8-000A95864FC4@ulaluma.com>
Message-ID: <E1CUTiT-0000v4-00@pyramid.twistedmatrix.com>

The automatic display did not occur.  Is this new since the 0.3 release
(i.e. do I need to get the development version)?  Or did I just miss
something?  I have tried using webform.renderForms() both with and without
the custom form layout (given as an example in customform.tac)

Currently, I have it working as per Cory suggestion, which is fine, but
slightly less desirable.


-----Original Message-----
From: twisted-web-bounces@twistedmatrix.com
[mailto:twisted-web-bounces@twistedmatrix.com] On Behalf Of Donovan Preston
Sent: Tuesday, November 16, 2004 4:43 PM
To: Discussion of twisted.web, Nevow,and Woven
Subject: Re: [Twisted-web] webform success message?


On Nov 16, 2004, at 1:31 PM, Cory Dodt wrote:

> and then do a ctx.onePattern('completed') or 'notCompleted' somewhere 
> in render_amICompleted.  You can determine whether or not it's 
> completed by examining IHand(ctx), which is the return value of your 
> autocallable.

The IHand (the return value of your autocallable) is also automatically
displayed as a status message. In plain english, if you return a string from
the autocallable, it'll show up as the status message.

dp


_______________________________________________
Twisted-web mailing list
Twisted-web@twistedmatrix.com
http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web


From abingham at alumni.sfu.ca  Wed Nov 17 13:45:00 2004
From: abingham at alumni.sfu.ca (Aaron Bingham)
Date: Wed Nov 17 13:54:37 2004
Subject: [Twisted-web] _nevow_carryover_
In-Reply-To: <419BB648.5030408@alumni.sfu.ca>
References: <419BB648.5030408@alumni.sfu.ca>
Message-ID: <419BB84C.1080905@alumni.sfu.ca>

Hi all,

I have created some web forms.  The input is handled by formless 
(although I just use annotate.Request() at the moment), and I am using

request.setComponent(IRedirectAfterPost, "/some-path/")

to redirect after submission.  For some reason, the URL I get redirected 
to is like this:

http://localhost:8080/some-path/?_nevow_carryover_=1100440412.88

Where is that extra query argument coming from, what is it good for, and 
how do I turn it off?

I am using Nevow 0.3.

Thanks,

Aaron



From floydophone at gmail.com  Thu Nov 18 07:50:43 2004
From: floydophone at gmail.com (Peter Hunt)
Date: Thu Nov 18 07:50:47 2004
Subject: [Twisted-web] nevow.wolf
Message-ID: <6654eac4041118065017003d20@mail.gmail.com>

Hi everyone,

I've been discussing this with a few people on #twisted.web, and after
reviewing the code, I've decided it's time to show it off to a larger
audience. I've committed a new package called wolf (flow backwards).
It's available at http://www.divmod.org/svn/Nevow/sandbox/phunt/wolf/.
Download that and drop it into your site-packages.

Essentially, it lets you write web applications in a linear style
instead of writing a bunch of ugly FSMs. For example, let's say you
wanted to write a user registration system...

from nevow import wolf

# assume RegisterPage, ProfilePage, and SuccessPage are nevow Pages
# RegisterPage asks for username and desired password
# ProfilePage asks for name and age
# SuccessPage is success

regpage = wolf.callable_page(RegisterPage) # simplifies usage within wolf
profpage = wolf.callable_page(ProfilePage)
successpage = wolf.callable_page(SuccessPage)

class Example(wolf.IndexedContainer):
    def _validate_reg(self, req):
        # TODO: make sure everything is ok with the form
        return True
    def _validate_prof(self, req):
        # todo
        return True
    def _regform(self, req):
        # underscore-prefixed methods cannot be called from outside
        while True
            yield regpage(req)
            if self._validate_reg(req):
                break
    def _profform(self, req):
        while True:
            yield profpage(req)
            if self._validate_prof(req):
                break
    def index(self, req):
        # this is the whole register routine
        yield self._regform(req)
        yield self._profform(req)
        yield successpage(req)
        
    
You can connect this to a Nevow site by using:

root.addChild("childname", wolf.WolfResource(Example))

Then, you can request it by going to:
http://host/childname/
or
http://host/childname/index

Download the code, try it out. If you run Stackless, you get to use
the back button, otherwise you're stuck with not being able to go
back. There is an example.py file which is a fully working example of
a guess-the-number game.

From luc.saffre at gmx.net  Fri Nov 19 05:35:36 2004
From: luc.saffre at gmx.net (Luc Saffre)
Date: Fri Nov 19 05:36:11 2004
Subject: [Twisted-web] getting started with nevow 
Message-ID: <419DE898.60305@gmx.net>

Hello,

I am experimenting with twisted and nevow.
I have a twisted server running at http://lsaffre.dyndns.org:8088/
I am using the latest SVN snapshot of nevow.

This server has some simple .rpy scripts; they all work, except the 
nevow scripts, who produce a traceback instead. You can see the 
traceback if you look at
http://lsaffre.dyndns.org:8088/nevow2.rpy

The source of this page is taken from
http://www.divmod.org/Home/Projects/Nevow/index.html
more exactly, here is the complete source:
------------- file nevow2.rpy :
from formless.annotate import TypedInterface, Integer, String

class ISimpleMethod(TypedInterface):
    def simple(self,
               name=String(description="Your name."),
               age=Integer(description="Your age.")):
       """Simple

       Please enter your name and age.
       """

class Implementation(object):
    __implements__ = ISimpleMethod,

    def simple(self, name, age):
       print "Hello, %s, you are %s years old." % (name, age)


from nevow import rend, tags, loaders
from formless import webform

class WebForm(rend.Page):
    docFactory = loaders.stan(
       tags.html[
       tags.body[
       tags.h1["Here is the form:"],
       webform.renderForms('original')
       ]
       ])

resource = WebForm(Implementation())
---------------------

Question: what is going wrong here?

tia,
Luc

From webmaster at haustierworld.de  Fri Nov 19 06:50:03 2004
From: webmaster at haustierworld.de (webmaster@haustierworld.de)
Date: Fri Nov 19 06:50:15 2004
Subject: [Twisted-web] Cobine Twisted with PHP
Message-ID: <154647462.20041119145003@haustierworld.de>

Hi all :)

  I?m completly new to Twisted, I?ve installed it and think it is a
  good framework! Thanks for your work!

  Now I?m wondering if I could build a server with Twisted, wich
  offers information php could read.

  Is this possible?
  How has my server to look, if it offers e.g. the string "server"?
  And how could I connect to TwistedServer from PHP?

  It all should run on a LAMP system, so I don?t need the twisted
  webserver, do I?

  Pardon me, but I?m absolutly new to twisted, and I couldn?t find
  anything with PHP :(

Thank you, Bastian




From tv at twistedmatrix.com  Fri Nov 19 06:56:07 2004
From: tv at twistedmatrix.com (Tommi Virtanen)
Date: Fri Nov 19 06:56:51 2004
Subject: [Twisted-web] getting started with nevow
In-Reply-To: <419DE898.60305@gmx.net>
References: <419DE898.60305@gmx.net>
Message-ID: <419DFB77.2050306@twistedmatrix.com>

Luc Saffre wrote:

> Question: what is going wrong here?

You are using twisted.web instead of nevow.appserver.


From sridharinfinity at gmail.com  Fri Nov 19 10:12:21 2004
From: sridharinfinity at gmail.com (Sridhar R)
Date: Fri Nov 19 10:12:28 2004
Subject: [Twisted-web] Cobine Twisted with PHP
In-Reply-To: <154647462.20041119145003@haustierworld.de>
References: <154647462.20041119145003@haustierworld.de>
Message-ID: <8816fcf804111909127160343@mail.gmail.com>

On Fri, 19 Nov 2004 14:50:03 +0100, webmaster @ haustierworld. de
<webmaster@haustierworld.de> wrote:
> 
>   Pardon me, but I?m absolutly new to twisted, and I couldn?t find
>   anything with PHP :(
> 

You don't need to use PHP.  Have a look at http://nevow.com for an
effective replacement for PHP.

-- 
Sridhar R - http://cs.annauniv.edu/~rsridhar
Blog: http://www.livejournal.com/~sridharinfinity

From webmaster at haustierworld.de  Fri Nov 19 10:27:07 2004
From: webmaster at haustierworld.de (webmaster@haustierworld.de - die tier-community)
Date: Fri Nov 19 10:26:55 2004
Subject: [Twisted-web] Cobine Twisted with PHP
In-Reply-To: <8816fcf804111909127160343@mail.gmail.com>
References: <154647462.20041119145003@haustierworld.de>
	<8816fcf804111909127160343@mail.gmail.com>
Message-ID: <7317670779.20041119182707@haustierworld.de>

Hi Sridhar,

am Freitag, 19. November 2004 um 18:12 schrieben Sie:

> You don't need to use PHP.  Have a look at http://nevow.com for an
> effective replacement for PHP.

  It looks nice, but I?ve got many thousend lines of PHP code!

  I only want to try to implement a server wich I can access from PHP.
  It only should reduce load from MySQL.

Bye, Bastian


From mesozoic at polynode.com  Fri Nov 19 10:28:12 2004
From: mesozoic at polynode.com (Alex Levy)
Date: Fri Nov 19 10:28:45 2004
Subject: [Twisted-web] Re: Cobine Twisted with PHP
In-Reply-To: <8816fcf804111909127160343@mail.gmail.com>
References: <154647462.20041119145003@haustierworld.de>
	<8816fcf804111909127160343@mail.gmail.com>
Message-ID: <20041119172812.GJ4076@perpetual.moxn.net>

> On Fri, 19 Nov 2004 14:50:03 +0100, webmaster @ haustierworld. de
> <webmaster@haustierworld.de> wrote:
> > 
> >   Pardon me, but I?m absolutly new to twisted, and I couldn?t find
> >   anything with PHP :(
> > 

You can use Twisted's web server to serve PHP as a CGI; take a look at
twisted.web.twcgi.PHPScript, as well as twisted.web.static.File (for
information on how processors work).

However, this depends on what you want to do. Some PHP applications are
really designed to be run inside Apache, and there's no real benefit to
running them inside of Twisted (if you're not using any of Twisted's other
features).

On Fri, Nov 19, 2004 at 10:42:21PM +0530, Sridhar R wrote:
> You don't need to use PHP.  Have a look at http://nevow.com for an
> effective replacement for PHP.

Unless there is an existing PHP application he's trying to run, in which
case Nevow will be of very little utility. If this is a new application
being developed, however, Nevow offers a lot more flexibility.

-- 
Alex Levy
WWW: http://mesozoic.geecs.org/
 
"Never let your sense of morals prevent you from doing what is right."
 -- Salvor Hardin, Isaac Asimov's _Foundation_

From webmaster at haustierworld.de  Fri Nov 19 11:03:54 2004
From: webmaster at haustierworld.de (webmaster@haustierworld.de)
Date: Fri Nov 19 11:03:34 2004
Subject: [Twisted-web] Cobine Twisted with PHP
Message-ID: <6019878583.20041119190354@haustierworld.de>

Hi Alex

  I?ve already seen Twisted's web server.

  It isn?t exactly what I need :(

  I?m looking for something different like this:

  If a user logs in, PHP validates the values, loads infomation from
  database and posts theese information to my Twisted / Phython what
  ever script / server.
  Server keeps data in memory, does something with data and every 10
  minutes, it writes updated data in database.

  So I?m only searching for a layer between PHP / Apache / MySQL.

  PHP has something like:
  http://de.php.net/manual/de/function.msg-receive.php
  is it possible to communicate over IPC with Twisted?
  Or is there a better way to do this?

Thank you, Bastian


From mesozoic at polynode.com  Fri Nov 19 11:51:12 2004
From: mesozoic at polynode.com (Alex Levy)
Date: Fri Nov 19 11:51:50 2004
Subject: [Twisted-web] Re: Cobine Twisted with PHP
In-Reply-To: <6019878583.20041119190354@haustierworld.de>
References: <6019878583.20041119190354@haustierworld.de>
Message-ID: <20041119185112.GN4076@perpetual.moxn.net>

>   PHP has something like:
>   http://de.php.net/manual/de/function.msg-receive.php
>   is it possible to communicate over IPC with Twisted?
>   Or is there a better way to do this?

Twisted can listen to practically any network event you need it to. I would
suggest you take a detailed look at the HOWTOs for Twisted, and examine how
it can do what you want it to do, before getting into the details of
integrating it with your PHP application.

Tie your shoes before you go for a jog...

-- 
Alex Levy
WWW: http://mesozoic.geecs.org/
 
"Never let your sense of morals prevent you from doing what is right."
 -- Salvor Hardin, Isaac Asimov's _Foundation_

From rich at enflyer.com  Fri Nov 19 12:01:21 2004
From: rich at enflyer.com (Rich Cavanaugh)
Date: Fri Nov 19 12:01:29 2004
Subject: [Twisted-web] Cobine Twisted with PHP
In-Reply-To: <6019878583.20041119190354@haustierworld.de>
References: <6019878583.20041119190354@haustierworld.de>
Message-ID: <670F0BDA-3A5D-11D9-A7E8-000A95890854@enflyer.com>


On Nov 19, 2004, at 1:03 PM, webmaster@haustierworld.de wrote:

>   If a user logs in, PHP validates the values, loads infomation from
>   database and posts theese information to my Twisted / Phython what
>   ever script / server.
>   Server keeps data in memory, does something with data and every 10
>   minutes, it writes updated data in database.
>
>   So I?m only searching for a layer between PHP / Apache / MySQL.

Take a look at twisted.web.xmlrpc. You can use the XML_RPC pear library 
with it. It's all very simple to put together and should handle what 
you want to do nicely.

rich
-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 2361 bytes
Desc: not available
Url : http://twistedmatrix.com/pipermail/twisted-web/attachments/20041119/0e353893/smime.bin
From michael.mata at gaigen.net  Sun Nov 21 00:00:09 2004
From: michael.mata at gaigen.net (Michael Mata)
Date: Sun Nov 21 00:00:35 2004
Subject: [Twisted-web] LineReceiver Protocol
Message-ID: <41A03CF9.6040806@gaigen.net>

Is there a way to extend the LineReceiver protocol to take action on a 
continued, periodic basis?  Currently, the protocol only does work when 
a line is received.  However, there are times when we the script to take 
action even without waiting to receive a line.

For example, suppose a connection should be closed if it has been idle 
for more than X minutes.  However, if connection is idle, it will not be 
sending commands.  If no commands are sent, then no lines are received, 
which means there is no way to close the connection.

Another example might be a global message that needs to be sent to all 
connections.  The message would have to be stored in  message queue and 
sent only when lineReceived is called.  It would be nice if the message 
could instead be sent imediately even if the connection was currently idle.

From luc.saffre at gmx.net  Mon Nov 22 03:55:37 2004
From: luc.saffre at gmx.net (Luc Saffre)
Date: Mon Nov 22 03:56:17 2004
Subject: [Twisted-web] getting started with nevow
In-Reply-To: <419DFB77.2050306@twistedmatrix.com>
References: <419DE898.60305@gmx.net> <419DFB77.2050306@twistedmatrix.com>
Message-ID: <41A1C5A9.7040804@gmx.net>

On 19.11.2004 15:56, Tommi Virtanen wrote:

> Luc Saffre wrote:
> 
>> Question: what is going wrong here?
> 
> You are using twisted.web instead of nevow.appserver.

Yes, this seems true. I start to understand. Thank you, Tommi, for this 
hint.

Sorry if I'm sticky, but can somebody give instructions about how I must 
do to use nevow.appserver instead of twisted.web? Currently I simply run:

   mktap web --path ../www --port 8088

to create a file "web.tap", which I start as a daemon using an init.d 
script:

----------- file /etc/init.d/twistd
#!/bin/sh

case "$1" in
'start')
         cd /home/luc/twistd/run
         twistd -f web.tap
         ;;
'stop')
         cd /home/luc/twistd/run
         kill `cat twistd.pid`
         ;;
*)
         echo "Usage: $0 { start | stop }"
         ;;
esac
exit 0
----------- eof /etc/init.d/twistd


I suppose I am just overwhelmed about Twisted's complexity (I mean this 
as a compliment ;-)

Luc



From luc.saffre at gmx.net  Mon Nov 22 04:42:16 2004
From: luc.saffre at gmx.net (Luc Saffre)
Date: Mon Nov 22 04:42:51 2004
Subject: [Twisted-web] getting started with nevow
In-Reply-To: <41A1C5A9.7040804@gmx.net>
References: <419DE898.60305@gmx.net> <419DFB77.2050306@twistedmatrix.com>
	<41A1C5A9.7040804@gmx.net>
Message-ID: <41A1D098.90408@gmx.net>

On 22.11.2004 12:55, Luc Saffre wrote:

> Sorry if I'm sticky, but can somebody give instructions about how I must 
> do to use nevow.appserver instead of twisted.web? 

Once again, maybe more concretely. I tried the following:

------- file nevow_webserver.py ---
from twisted.web import static
from twisted.application import service, internet
from nevow import appserver

root = static.File('../www')
application = service.Application('MyTwistedApp')
site = appserver.NevowSite(root)
webServer = internet.TCPServer(8080, site)
webServer.setServiceParent(application)

------- eof nevow_webserver.py ---

and I can run this script, using:
   twistd -ny nevow_webserver.py

It works, but the result is not as expected: The .rpy files are rendered 
without executing them. So static.File is obviously not what I must use 
as root resource.

Question: Which root resource is used when an application has been 
automatically built using "mktap web"? Can I use the same resource as 
root for a NevowSite? Or is there an equivalent Root resource that 
serves .rpy files?

Luc

From luc.saffre at gmx.net  Mon Nov 22 06:54:23 2004
From: luc.saffre at gmx.net (Luc Saffre)
Date: Mon Nov 22 06:55:22 2004
Subject: [Twisted-web] nevow tutorial
Message-ID: <41A1EF8F.8090203@gmx.net>

Hello,

I stepped over the following great document:

   http://nevow.com/Nevow2004Tutorial.html

I think this document deserves to be more visible! Currently there is no 
link to it from http://nevow.com...

OTOH I have a problem: the examples don't work, appearently for a silly 
reason. When I start "twistd -ny EXAMPLE.tac" for any of them, I get an 
ImportError for those modules which are in the same directory (iCal, 
schedule,...).

If I start a Python shell, I can manually import these modules. It looks 
as if twistd removes "." from PYTHON_PATH, or chdirs to some other 
directory.

This happens on my machine with Python 2.3.4 and Twisted 1.2.0 on Win32

Any ideas?

Luc


From dp at ulaluma.com  Mon Nov 22 08:46:31 2004
From: dp at ulaluma.com (Donovan Preston)
Date: Mon Nov 22 08:46:44 2004
Subject: [Twisted-web] nevow tutorial
In-Reply-To: <41A1EF8F.8090203@gmx.net>
References: <41A1EF8F.8090203@gmx.net>
Message-ID: <AE80A520-3C9D-11D9-84EF-000A95864FC4@ulaluma.com>


On Nov 22, 2004, at 5:54 AM, Luc Saffre wrote:

> Hello,
>
> I stepped over the following great document:
>
>   http://nevow.com/Nevow2004Tutorial.html
>
> I think this document deserves to be more visible! Currently there is 
> no link to it from http://nevow.com...

I'm glad you like the tutorial, but the reason it isn't linked is 
because it is out of date. It was written circa 0.1, and shows some 
techniques which were workarounds for lack of functionality which is 
now present in 0.3. Thus, I think it is more confusing than it should 
be. If you would be willing to attempt to work through the tutorial and 
ask questions when things don't work or seem to be out of date, and 
perhaps update it using the answers provided, I could cut a new version 
of it and include it in 0.4, prominently linked on the website.

> OTOH I have a problem: the examples don't work, appearently for a 
> silly reason. When I start "twistd -ny EXAMPLE.tac" for any of them, I 
> get an ImportError for those modules which are in the same directory 
> (iCal, schedule,...).
>
> If I start a Python shell, I can manually import these modules. It 
> looks as if twistd removes "." from PYTHON_PATH, or chdirs to some 
> other directory.
>
> This happens on my machine with Python 2.3.4 and Twisted 1.2.0 on Win32
>
> Any ideas?

This is a bug (or feature) of twisted on windows. Basically, twistd, as 
a security precaution, removes '.' from your pythonpath if you are 
running as root. On unix, you usually don't run as root if you are 
testing (and would never deploy a configuration with needed modules 
located in '.'). On windows, the distinction is much fuzzier. I assume 
twistd removes '.' because you ARE running as "root" on windows.

The simple solution is to simply put the appropriate directory on your 
PYTHONPATH before running an example. This way, you always know 
explicitly which module you are getting, too.

Also, please at least get Twisted 1.3.0. It's been out for quite a 
while now.

dp


From mesozoic at polynode.com  Mon Nov 22 11:00:10 2004
From: mesozoic at polynode.com (Alex Levy)
Date: Mon Nov 22 11:00:51 2004
Subject: [Twisted-web] [PATCH] Are we ready for a Page.remember fix?
Message-ID: <20041122180009.GU4076@perpetual.moxn.net>

This was suggested a long time ago, and when I tried adding it, I broke
Quotient somewhat badly. From what I can tell, the problem in Quotient which
prevented Page.remember from being changed has been fixed; I'd like to see
this patch added.

Some have suggested a SiteContext as an alternative; however, I see these
two as addressing two different concerns. A SiteContext (as described in
Roundup <http://divmod.org/users/roundup.twistd/nevow/issue137>) would be
good for remembering data that are universal to a specific NevowSite
instance. However, this is not my use case.

In my case, I want my Realm to be able to remember objects that are
particular to a certain logged in user. The obvious example is an
ICurrentUser interface, which lets the resource hierarchy quickly reference
what user (if any) is logged in. I'm sure I'll come up with other uses, but
this is my current need. Doing this at the SiteContext level would (from
what I can tell) produce overlaps when more than one user is logged in.

So, are there any objections to Page.remember()? Even if it's not an elegant
solution, it works for me, and it's generic enough that I think it's worth
keeping.

-- 
Alex Levy
WWW: http://mesozoic.geecs.org/
 
"Never let your sense of morals prevent you from doing what is right."
 -- Salvor Hardin, Isaac Asimov's _Foundation_
-------------- next part --------------
Index: nevow/rend.py
===================================================================
--- nevow/rend.py       (revision 847)
+++ nevow/rend.py       (working copy)
@@ -247,7 +247,8 @@

     docFactory = None
     original = None
-
+    toremember = None
+
     def __init__(self, original=None, docFactory=None):
         if original is not None:
             self.original = original
@@ -289,16 +290,7 @@
         XXX THIS IS DEPRECATED. The page context is now passed to various
         Page apis. Remember things there instead.
         """
-        import sys
-        frame = sys._getframe()
-        done = False
-        while not done:
-            for ctx in frame.f_locals.values():
-                if isinstance(ctx, PageContext):
-                    done=True
-                    break
-            frame = frame.f_back
-        ctx.remember(obj, inter)
+        self.toremember.append((obj, inter))

     def rememberStuff(self, ctx):
         ctx.remember(self, inevow.IRenderer)
Index: nevow/context.py
===================================================================
--- nevow/context.py    (revision 847)
+++ nevow/context.py    (working copy)
@@ -235,9 +235,14 @@
     IRendererFactory
     IData
     """
-    context = property(getRequestContext)

+    def __init__(self, *args, **kw):
+        FactoryContext.__init__(self, *args, **kw)
+        if self.tag is not None and hasattr(self.tag, 'toremember'):
+            for i in self.tag.toremember:
+                self.remember(*i)

+    context = property(getRequestContext)

 # TTT: To stay here.
 NodeNotFound = stan.NodeNotFound # XXX: DeprecationWarning?

From orbitz at ezabel.com  Mon Nov 22 15:09:05 2004
From: orbitz at ezabel.com (orbitz)
Date: Mon Nov 22 15:09:17 2004
Subject: [Twisted-web] LineReceiver Protocol
In-Reply-To: <41A03CF9.6040806@gaigen.net>
References: <41A03CF9.6040806@gaigen.net>
Message-ID: <41A26381.20102@ezabel.com>

Just use reactor.callLater to have your idle check code be scheduled to 
be called to see if the conn has been idle for too long

Michael Mata wrote:

> Is there a way to extend the LineReceiver protocol to take action on a 
> continued, periodic basis?  Currently, the protocol only does work 
> when a line is received.  However, there are times when we the script 
> to take action even without waiting to receive a line.
>
> For example, suppose a connection should be closed if it has been idle 
> for more than X minutes.  However, if connection is idle, it will not 
> be sending commands.  If no commands are sent, then no lines are 
> received, which means there is no way to close the connection.
>
> Another example might be a global message that needs to be sent to all 
> connections.  The message would have to be stored in  message queue 
> and sent only when lineReceived is called.  It would be nice if the 
> message could instead be sent imediately even if the connection was 
> currently idle.
>
> _______________________________________________
> Twisted-web mailing list
> Twisted-web@twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web
>


From matt at pollenation.net  Tue Nov 23 04:37:40 2004
From: matt at pollenation.net (Matt Goodall)
Date: Tue Nov 23 04:37:45 2004
Subject: [Twisted-web] [PATCH] Are we ready for a Page.remember fix?
In-Reply-To: <20041122180009.GU4076@perpetual.moxn.net>
References: <20041122180009.GU4076@perpetual.moxn.net>
Message-ID: <34397.62.252.224.19.1101209860.squirrel@webmail.pollenation.net>


> This was suggested a long time ago, and when I tried adding it, I broke
> Quotient somewhat badly. From what I can tell, the problem in Quotient
> which
> prevented Page.remember from being changed has been fixed; I'd like to see
> this patch added.
>
> Some have suggested a SiteContext as an alternative; however, I see these
> two as addressing two different concerns. A SiteContext (as described in
> Roundup <http://divmod.org/users/roundup.twistd/nevow/issue137>) would be
> good for remembering data that are universal to a specific NevowSite
> instance. However, this is not my use case.

Yes, remembering on the site vs page have quite different uses.

>
> In my case, I want my Realm to be able to remember objects that are
> particular to a certain logged in user. The obvious example is an
> ICurrentUser interface, which lets the resource hierarchy quickly
> reference
> what user (if any) is logged in. I'm sure I'll come up with other uses,
> but
> this is my current need. Doing this at the SiteContext level would (from
> what I can tell) produce overlaps when more than one user is logged in.

This is a common usecase and definitely not something to remember in the
site's context.

I have implemented this using a resource wrapper but that is somewhat
complex for what it's actually doing.

>
> So, are there any objections to Page.remember()? Even if it's not an
> elegant
> solution, it works for me, and it's generic enough that I think it's worth
> keeping.

For some reason I've never liked Page.remember() even though I would
probably use it if it existed (and worked properly).

So, a reluctant +1 from me.

There's one problem with the patch - once the PageContext has been created
Page.remember() doesn't do anything. The Page *used* to have a context set
via a property but that's been gone for a while now. Any ideas how to fix
that?

Perhaps the solution is to change the method name to something more in
line with what it's doing, i.e. addToRemember, rememberLater, etc, and
update the docstring to explain.

Cheers, Matt

-- 
     __
    /  \__     Matt Goodall, Pollenation Internet Ltd
    \__/  \    w: http://www.pollenation.net
  __/  \__/    e: matt@pollenation.net
 /  \__/  \    t: +44 (0)113 2252500
 \__/  \__/
 /  \          Any views expressed are my own and do not necessarily
 \__/          reflect the views of my employer.


From dp at ulaluma.com  Tue Nov 23 07:56:02 2004
From: dp at ulaluma.com (Donovan Preston)
Date: Tue Nov 23 07:56:07 2004
Subject: [Twisted-web] [PATCH] Are we ready for a Page.remember fix?
In-Reply-To: <34397.62.252.224.19.1101209860.squirrel@webmail.pollenation.net>
References: <20041122180009.GU4076@perpetual.moxn.net>
	<34397.62.252.224.19.1101209860.squirrel@webmail.pollenation.net>
Message-ID: <CB780918-3D5F-11D9-9695-000A95864FC4@ulaluma.com>


On Nov 23, 2004, at 3:37 AM, Matt Goodall wrote:

>> So, are there any objections to Page.remember()? Even if it's not an
>> elegant
>> solution, it works for me, and it's generic enough that I think it's 
>> worth
>> keeping.
>
> For some reason I've never liked Page.remember() even though I would
> probably use it if it existed (and worked properly).
>
> So, a reluctant +1 from me.
>
> There's one problem with the patch - once the PageContext has been 
> created
> Page.remember() doesn't do anything. The Page *used* to have a context 
> set
> via a property but that's been gone for a while now. Any ideas how to 
> fix
> that?

If this is the only thing you don't like about it, I think it's a 
documentation issue. Here is a docstring for Page.remember which might 
help:

"""Remember an object for an interface on new PageContexts which are 
constructed around this Page. Whenever this Page is involved in object 
traversal in the future, all objects will be visible to .locate() calls 
at the level of a PageContext wrapped around this Page and all contexts 
below it.

This does not affect existing Context instances.
"""

+1.

dp


From matt at pollenation.net  Tue Nov 23 08:57:08 2004
From: matt at pollenation.net (Matt Goodall)
Date: Tue Nov 23 08:57:13 2004
Subject: [Twisted-web] [PATCH] Are we ready for a Page.remember fix?
In-Reply-To: <CB780918-3D5F-11D9-9695-000A95864FC4@ulaluma.com>
References: <20041122180009.GU4076@perpetual.moxn.net>
	<34397.62.252.224.19.1101209860.squirrel@webmail.pollenation.net>
	<CB780918-3D5F-11D9-9695-000A95864FC4@ulaluma.com>
Message-ID: <18424.62.252.224.19.1101225428.squirrel@webmail.pollenation.net>


>
> On Nov 23, 2004, at 3:37 AM, Matt Goodall wrote:
>
>>> So, are there any objections to Page.remember()? Even if it's not an
>>> elegant
>>> solution, it works for me, and it's generic enough that I think it's
>>> worth
>>> keeping.
>>
>> For some reason I've never liked Page.remember() even though I would
>> probably use it if it existed (and worked properly).
>>
>> So, a reluctant +1 from me.
>>
>> There's one problem with the patch - once the PageContext has been
>> created
>> Page.remember() doesn't do anything. The Page *used* to have a context
>> set
>> via a property but that's been gone for a while now. Any ideas how to
>> fix
>> that?
>
> If this is the only thing you don't like about it, I think it's a
> documentation issue.

Yep, exactly. The problem/limitation with the patch is just that and has
nothing to do with what I think about Page.remember.

As I said in my previous message, it's more an issue of the method name
and docstring. If you think changing just the docstring is sufficient then
I'm fine with that.

Cheers, Matt


From foom at fuhm.net  Tue Nov 23 13:51:08 2004
From: foom at fuhm.net (James Y Knight)
Date: Tue Nov 23 13:51:14 2004
Subject: [Twisted-web] [PATCH] Are we ready for a Page.remember fix?
In-Reply-To: <20041122180009.GU4076@perpetual.moxn.net>
References: <20041122180009.GU4076@perpetual.moxn.net>
Message-ID: <6675A3B1-3D91-11D9-96B0-000A95A50FB2@fuhm.net>

On Nov 22, 2004, at 1:00 PM, Alex Levy wrote:
> This was suggested a long time ago, and when I tried adding it, I broke
> Quotient somewhat badly. From what I can tell, the problem in Quotient 
> which
> prevented Page.remember from being changed has been fixed; I'd like to 
> see
> this patch added.

I'm +1 as well, which is probably unsurprising to everyone since I 
initially created the patch. So, everyone's for it, let's do it.

James


From spam at mike-warren.com  Wed Nov 24 09:51:48 2004
From: spam at mike-warren.com (Mike Warren)
Date: Wed Nov 24 09:49:05 2004
Subject: [Twisted-web] overriding resource getting with nevow+twisted
Message-ID: <E1CX0Mu-0005VD-00@meejah.homeip.net>


Greetings,

I want to invisibly remap URLs sometimes ("invisibly" to the client)
and return basically an arbitrary resource for a URL but can't figure
out how to do this within the getChild (etc.) machinery. My first
inclination was to override locateChild, since I get the context there
(and could, e.g., have an interface to get my remapped path). However,
this never appears to get called -- the only thing which gets called
on my root resource is getChildWithDefault, which is apparently being
driven by twisted.web.resource's module-level getChildWithDefault
which merely recurses the path looking for a leaf resource --
precisely what I want to prevent.

I could of course just re-assign the module-level getChildWithDefault,
but this seems wrong, somehow -- is there a better way?

(I am doing this because I want to implement aliases for some things
-- e.g. I have URLs like /article/<ID> and want those to sometimes
also be available at /some/other/url and I don't want clients to
simply be redirected to /article/<ID>, which is sort of what happens
if I just re-map the path in getPageContextForRequestContext)

(Also, I may want to return different resources depending upon user
preferences, although I'm not working on that precisely at the
moment.)

I haven't looked at web2 yet -- should I? (i.e. is this going to be
easier there?)

Thanks,

-- 
mike [at] mike [dash] warren [dot] com
<URL:http://www.mike-warren.com>
gpg --keyserver 80.71.227.37 --recv-key 579911BD
87F2 4D98 BDB0 0E90 EE2A 0CF9 1087 0884 5799 11BD

From corydodt at twistedmatrix.com  Wed Nov 24 10:53:30 2004
From: corydodt at twistedmatrix.com (Cory Dodt)
Date: Wed Nov 24 10:55:53 2004
Subject: [Twisted-web] Custom 404/500 page example.. working
Message-ID: <41A4CA9A.9020803@twistedmatrix.com>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Presented for your coding pleasure:
http://divmod.org/users/wiki.twistd/nevow/moin.cgi/Custom404Page?action=show

I believe this is a fairly common use case: You want to automatically handle
404 and 500 errors by returning a custom Page of your own design.  The example
above shows you how to do it.

The same location previously held a version that used stan.  With some help
from Donovan and James I (finally) got it working with xml templates as well.

C

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.2.1 (MingW32)
Comment: Using GnuPG with Thunderbird - http://enigmail.mozdev.org

iD8DBQFBpMqa3A5SrXAiHQcRAqK0AKCApV2k35MroB4zOX5klkzwg/1E3gCdEBXm
fW/H/m3/PFB+zLTqYX5Ki/Q=
=mKCT
-----END PGP SIGNATURE-----

From sam at SpinwardStars.com  Wed Nov 24 11:36:51 2004
From: sam at SpinwardStars.com (Samuel Reynolds)
Date: Wed Nov 24 12:57:46 2004
Subject: [Twisted-web] overriding resource getting with
  nevow+twisted
In-Reply-To: <E1CX0Mu-0005VD-00@meejah.homeip.net>
References: <E1CX0Mu-0005VD-00@meejah.homeip.net>
Message-ID: <6.1.2.0.0.20041124113028.046022e8@mail.myedl.com>

At 2004-11-24 09:51 AM -0700, you wrote:
>I could of course just re-assign the module-level getChildWithDefault,
>but this seems wrong, somehow -- is there a better way?
>
>(I am doing this because I want to implement aliases for some things
>-- e.g. I have URLs like /article/<ID> and want those to sometimes
>also be available at /some/other/url and I don't want clients to
>simply be redirected to /article/<ID>, which is sort of what happens
>if I just re-map the path in getPageContextForRequestContext)

With Nevow, the choke point is getDynamicChild:

def getDynamicChild(self, name, request):
     << CONDITIONALLY SERVE YOUR STUFF HERE >>

     # Fall through to default processing
     return super(MyRendererClass,self).getDynamicChild(name, request)

(Replace 'MyRendererClass' with your Renderer subclass, of course.)

- Sam

__________________________________________________________
Spinward Stars, LLC                        Samuel Reynolds
Software Consulting and Development           303-805-1446
http://SpinwardStars.com/            sam@SpinwardStars.com 



From dp at ulaluma.com  Wed Nov 24 14:42:40 2004
From: dp at ulaluma.com (Donovan Preston)
Date: Wed Nov 24 14:42:44 2004
Subject: [Twisted-web] overriding resource getting with nevow+twisted
In-Reply-To: <E1CX0Mu-0005VD-00@meejah.homeip.net>
References: <E1CX0Mu-0005VD-00@meejah.homeip.net>
Message-ID: <C41ABB8E-3E61-11D9-9E60-000A95864FC4@ulaluma.com>


On Nov 24, 2004, at 8:51 AM, Mike Warren wrote:

>
> Greetings,
>
> I want to invisibly remap URLs sometimes ("invisibly" to the client)
> and return basically an arbitrary resource for a URL but can't figure
> out how to do this within the getChild (etc.) machinery. My first
> inclination was to override locateChild, since I get the context there
> (and could, e.g., have an interface to get my remapped path). However,
> this never appears to get called -- the only thing which gets called
> on my root resource is getChildWithDefault, which is apparently being
> driven by twisted.web.resource's module-level getChildWithDefault
> which merely recurses the path looking for a leaf resource --
> precisely what I want to prevent.
>
> I could of course just re-assign the module-level getChildWithDefault,
> but this seems wrong, somehow -- is there a better way?
>
> (I am doing this because I want to implement aliases for some things
> -- e.g. I have URLs like /article/<ID> and want those to sometimes
> also be available at /some/other/url and I don't want clients to
> simply be redirected to /article/<ID>, which is sort of what happens
> if I just re-map the path in getPageContextForRequestContext)
>
> (Also, I may want to return different resources depending upon user
> preferences, although I'm not working on that precisely at the
> moment.)
>
> I haven't looked at web2 yet -- should I? (i.e. is this going to be
> easier there?)
>
> Thanks,

You are incorrectly using twisted.web.server.Site instead of 
nevow.appserver.NevowSite. NevowSite is the basis of what will become 
web2, yes. web2 is not yet usable.

If you are using mktap web, don't. Please look at any of the examples 
in the examples directory to see how to start a server using NevowSite.

Your use cases are absolutely, exactly what locateChild is for, so you 
were on the right track -- just heading down the wrong path ;-)

dp


From spam at mike-warren.com  Wed Nov 24 14:58:45 2004
From: spam at mike-warren.com (Mike Warren)
Date: Wed Nov 24 14:55:40 2004
Subject: [Twisted-web] overriding resource getting with nevow+twisted
In-Reply-To: <C41ABB8E-3E61-11D9-9E60-000A95864FC4@ulaluma.com>
References: <E1CX0Mu-0005VD-00@meejah.homeip.net>
	<C41ABB8E-3E61-11D9-9E60-000A95864FC4@ulaluma.com>
Message-ID: <E1CX59x-0005wV-00@meejah.homeip.net>

Donovan Preston <dp@ulaluma.com> writes:

> You are incorrectly using twisted.web.server.Site instead of
> nevow.appserver.NevowSite. NevowSite is the basis of what will become
> web2, yes. web2 is not yet usable.

Actually, I think I was being outsmarted by Nevow's adaptors for
Twisted's resource.Resource (I am using NevowSite) -- I ended up
making my own root resource which just implements inevow.IResource and
doesn't inherit from anything, which is much cleaner, too.

Thanks for the prompt replies (and Twisted!),

-- 
mike [at] mike [dash] warren [dot] com
<URL:http://www.mike-warren.com>
gpg --keyserver 80.71.227.37 --recv-key 579911BD
87F2 4D98 BDB0 0E90 EE2A 0CF9 1087 0884 5799 11BD

From foom at fuhm.net  Wed Nov 24 15:07:38 2004
From: foom at fuhm.net (James Y Knight)
Date: Wed Nov 24 15:07:41 2004
Subject: [Twisted-web] overriding resource getting with nevow+twisted
In-Reply-To: <6.1.2.0.0.20041124113028.046022e8@mail.myedl.com>
References: <E1CX0Mu-0005VD-00@meejah.homeip.net>
	<6.1.2.0.0.20041124113028.046022e8@mail.myedl.com>
Message-ID: <411D297E-3E65-11D9-96B0-000A95A50FB2@fuhm.net>

On Nov 24, 2004, at 1:36 PM, Samuel Reynolds wrote:
> With Nevow, the choke point is getDynamicChild:
>
> def getDynamicChild(self, name, request):
>     << CONDITIONALLY SERVE YOUR STUFF HERE >>
>
>     # Fall through to default processing
>     return super(MyRendererClass,self).getDynamicChild(name, request)
>
> (Replace 'MyRendererClass' with your Renderer subclass, of course.)

Untrue. That's kinda the case with twisted.web.woven, not Nevow. Of 
course even there, getDynamicChild isn't a choke-point..the "main" 
lookup function through which everything else goes is 
getChildWithDefault.

For nevow, the single lookup method is locateChild.

James


From foom at fuhm.net  Wed Nov 24 15:13:56 2004
From: foom at fuhm.net (James Y Knight)
Date: Wed Nov 24 15:13:58 2004
Subject: [Twisted-web] overriding resource getting with nevow+twisted
In-Reply-To: <6.1.2.0.0.20041124113028.046022e8@mail.myedl.com>
References: <E1CX0Mu-0005VD-00@meejah.homeip.net>
	<6.1.2.0.0.20041124113028.046022e8@mail.myedl.com>
Message-ID: <21F2987D-3E66-11D9-96B0-000A95A50FB2@fuhm.net>

On Nov 24, 2004, at 1:36 PM, Samuel Reynolds wrote:
> With Nevow, the choke point is getDynamicChild:
>
> def getDynamicChild(self, name, request):
>     << CONDITIONALLY SERVE YOUR STUFF HERE >>
>
>     # Fall through to default processing
>     return super(MyRendererClass,self).getDynamicChild(name, request)
>
> (Replace 'MyRendererClass' with your Renderer subclass, of course.)


Err, despite my earlier message, of course, getDynamicChild *was* also 
in Nevow until recently. But now it's deprecated, and also not the 
"main" method, which was and is locateChild. Sorry 'bout the confusion. 
;)

James


From sam at SpinwardStars.com  Wed Nov 24 16:39:06 2004
From: sam at SpinwardStars.com (Samuel Reynolds)
Date: Wed Nov 24 16:40:44 2004
Subject: [Twisted-web] overriding resource getting with
  nevow+twisted
In-Reply-To: <21F2987D-3E66-11D9-96B0-000A95A50FB2@fuhm.net>
References: <E1CX0Mu-0005VD-00@meejah.homeip.net>
	<6.1.2.0.0.20041124113028.046022e8@mail.myedl.com>
	<21F2987D-3E66-11D9-96B0-000A95A50FB2@fuhm.net>
Message-ID: <6.1.2.0.0.20041124163108.04701b28@mail.myedl.com>

At 2004-11-24 05:13 PM -0500, you wrote:
>On Nov 24, 2004, at 1:36 PM, Samuel Reynolds wrote:
>>With Nevow, the choke point is getDynamicChild:
>>
>>def getDynamicChild(self, name, request):
>>     << CONDITIONALLY SERVE YOUR STUFF HERE >>
>>
>>     # Fall through to default processing
>>     return super(MyRendererClass,self).getDynamicChild(name, request)
>>
>>(Replace 'MyRendererClass' with your Renderer subclass, of course.)
>
>
>Err, despite my earlier message, of course, getDynamicChild *was* also in 
>Nevow until recently. But now it's deprecated, and also not the "main" 
>method, which was and is locateChild. Sorry 'bout the confusion. ;)
>
>James

Well, then. That'll require some changes on my part
when I start to update my code to the newer nevow.
FWIW, OMM nevow.__version__=='0.1d'.

I never said getDynamicChild  was the "main" method.
Just that it was the intercept point for inserting
dynamically-selected pages.

I've tried to keep an eye on the discussion list, but
I haven't kept up-to-date on the (seemingly endless!)
changes to nevow & twisted due to other projects.
I'll have to update my copy when I have time to make
the necessary changes in my code.

- Sam

__________________________________________________________
Spinward Stars, LLC                        Samuel Reynolds
Software Consulting and Development           303-805-1446
http://SpinwardStars.com/            sam@SpinwardStars.com 



From dp at ulaluma.com  Wed Nov 24 17:20:08 2004
From: dp at ulaluma.com (Donovan Preston)
Date: Wed Nov 24 17:20:29 2004
Subject: [Twisted-web] overriding resource getting with nevow+twisted
In-Reply-To: <6.1.2.0.0.20041124163108.04701b28@mail.myedl.com>
References: <E1CX0Mu-0005VD-00@meejah.homeip.net>
	<6.1.2.0.0.20041124113028.046022e8@mail.myedl.com>
	<21F2987D-3E66-11D9-96B0-000A95A50FB2@fuhm.net>
	<6.1.2.0.0.20041124163108.04701b28@mail.myedl.com>
Message-ID: <C38BD75A-3E77-11D9-9E60-000A95864FC4@ulaluma.com>


On Nov 24, 2004, at 3:39 PM, Samuel Reynolds wrote:

>> Err, despite my earlier message, of course, getDynamicChild *was* 
>> also in Nevow until recently. But now it's deprecated, and also not 
>> the "main" method, which was and is locateChild. Sorry 'bout the 
>> confusion. ;)
>>
>> James
>
> Well, then. That'll require some changes on my part
> when I start to update my code to the newer nevow.
> FWIW, OMM nevow.__version__=='0.1d'.

getDynamicChild still works in 0.3 but you get a deprecation warning 
when it exists. It will stop working in 0.4. The replacement is named 
childFactory and the only difference is the order of the arguments, 
which was changed to be consistent with the rest of nevow:

def getDynamicChild(self, name, ctx):

def childFactory(self, ctx, name):

> I never said getDynamicChild  was the "main" method.
> Just that it was the intercept point for inserting
> dynamically-selected pages.

To recap:

locateChild is the only traversal API required by IResource. It is 
called directly by the object publisher (NevowSite).

The default locateChild implementation on nevow.rend.Page looks in two 
places:

child_*
childFactory (replaces getDynamicChild)

> I've tried to keep an eye on the discussion list, but
> I haven't kept up-to-date on the (seemingly endless!)
> changes to nevow & twisted due to other projects.
> I'll have to update my copy when I have time to make
> the necessary changes in my code.

The changes will start to slow down now. Most of the major refactorings 
which I wanted to take place have happened, so it should mostly be 
minor bugfixes and new feature additions going forward.

dp


From luc.saffre at gmx.net  Wed Nov 24 21:03:42 2004
From: luc.saffre at gmx.net (Luc Saffre)
Date: Wed Nov 24 21:04:19 2004
Subject: [Twisted-web] nevow tutorial
In-Reply-To: <AE80A520-3C9D-11D9-84EF-000A95864FC4@ulaluma.com>
References: <41A1EF8F.8090203@gmx.net>
	<AE80A520-3C9D-11D9-84EF-000A95864FC4@ulaluma.com>
Message-ID: <41A5599E.60701@gmx.net>

On 22.11.2004 17:46, Donovan Preston wrote:

> I'm glad you like the tutorial, but the reason it isn't linked is 
> because it is out of date. It was written circa 0.1, and shows some 
> techniques which were workarounds for lack of functionality which is now 
> present in 0.3. Thus, I think it is more confusing than it should be. 

"You see how important it is to have a date on *each* document?  It's 
frustrating to see how much they neglect this old rule in Internet."
   -- my father (71 years, former director of a technical library)

>> OTOH I have a problem: the examples don't work, appearently for a 
>> silly reason. When I start "twistd -ny EXAMPLE.tac" for any of them, I 
>> get an ImportError for those modules which are in the same directory 
>> (iCal, schedule,...).
>>
>> If I start a Python shell, I can manually import these modules. It 
>> looks as if twistd removes "." from PYTHON_PATH, or chdirs to some 
>> other directory.
>>
>> This happens on my machine with Python 2.3.4 and Twisted 1.2.0 on Win32
> 
> This is a bug (or feature) of twisted on windows. Basically, twistd, as 
> a security precaution, removes '.' from your pythonpath if you are 
> running as root. On unix, you usually don't run as root if you are 
> testing (and would never deploy a configuration with needed modules 
> located in '.'). On windows, the distinction is much fuzzier. I assume 
> twistd removes '.' because you ARE running as "root" on windows.
> 
> The simple solution is to simply put the appropriate directory on your 
> PYTHONPATH before running an example. This way, you always know 
> explicitly which module you are getting, too.

That's correct, thanks for these exmplanations.

It seems to me that twistd 1.3 (on windows) doesn't remove "." from 
PYTHONPATH anymore. At least I could not reproduce my problem with 
1.3.0. So for me it now works with just a "." in PYTHONPATH.

> Also, please at least get Twisted 1.3.0. It's been out for quite a while 
> now.

Done.

 > If
 > you would be willing to attempt to work through the tutorial and ask
 > questions when things don't work or seem to be out of date, and perhaps
 > update it using the answers provided, I could cut a new version of it
 > and include it in 0.4, prominently linked on the website.

The interesting thing is the set of running examples. Most important is 
(1) that they are running, and (2) that they don't use a completely 
obsolete technique. For (1) I'll try to help.


I am trying to get example4\schedule.py running:

line 8:
-from nevow import rend
+from nevow import rend, loaders

line 13:
-    docFactory = rend.htmlfile('Month.html')
+    docFactory = loaders.htmlfile('Month.html')


... and wow! (an exciting moment when you are discovering something...):
The first page displays!

Next problem: in day.py are two imports who fail:

   from nevow import formless
   from nevow import freeform

Maybe now it's better that I wait for help or comments...

Luc

From matt at pollenation.net  Thu Nov 25 04:01:32 2004
From: matt at pollenation.net (Matt Goodall)
Date: Thu Nov 25 04:01:18 2004
Subject: [Twisted-web] nevow tutorial
In-Reply-To: <41A5599E.60701@gmx.net>
References: <41A1EF8F.8090203@gmx.net>
	<AE80A520-3C9D-11D9-84EF-000A95864FC4@ulaluma.com>
	<41A5599E.60701@gmx.net>
Message-ID: <1101380492.16190.11.camel@localhost.localdomain>

On Thu, 2004-11-25 at 06:03 +0200, Luc Saffre wrote:
[...]
> I am trying to get example4\schedule.py running:
> 
> line 8:
> -from nevow import rend
> +from nevow import rend, loaders
> 
> line 13:
> -    docFactory = rend.htmlfile('Month.html')
> +    docFactory = loaders.htmlfile('Month.html')
> 
> 
> ... and wow! (an exciting moment when you are discovering something...):
> The first page displays!
> 
> Next problem: in day.py are two imports who fail:
> 
>    from nevow import formless
>    from nevow import freeform

Formless was broken out into its own package. Those imports should now
be:

    from formless import annotate
    from formless import webform

References to formless.String, formless.Text etc should then be changed
to annotate.String, annotate.Text, etc.


I've create an issue on the tracker for this,
http://divmod.org/users/roundup.twistd/nevow/issue142, so if you have
any patches (no matter how simple) it would be cool if you could submit
them there so someone can apply them to the svn repository.


Thanks for helping sort this out. In general people seem quite short of
time right now so anything to make it easier helps.


Cheers, Matt

-- 
     __
    /  \__     Matt Goodall, Pollenation Internet Ltd
    \__/  \    w: http://www.pollenation.net
  __/  \__/    e: matt@pollenation.net
 /  \__/  \    t: +44 (0)113 2252500
 \__/  \__/
 /  \          Any views expressed are my own and do not necessarily
 \__/          reflect the views of my employer.


From sridharinfinity at gmail.com  Thu Nov 25 05:04:36 2004
From: sridharinfinity at gmail.com (Sridhar R)
Date: Thu Nov 25 05:04:39 2004
Subject: [Twisted-web] Re: nevow.formless
In-Reply-To: <1101380492.16190.11.camel@localhost.localdomain>
References: <41A1EF8F.8090203@gmx.net>
	<AE80A520-3C9D-11D9-84EF-000A95864FC4@ulaluma.com>
	<41A5599E.60701@gmx.net>
	<1101380492.16190.11.camel@localhost.localdomain>
Message-ID: <8816fcf804112504041dbf1e2@mail.gmail.com>

On Thu, 25 Nov 2004 11:01:32 +0000, Matt Goodall <matt@pollenation.net> wrote:
> 
> Formless was broken out into its own package. Those imports should now
> be:
> 
>     from formless import annotate
>     from formless import webform
> 

Shouldn't this be
from nevow.formless import annotate, webform ??

Why do we need create yet another top-level package?

-- 
Sridhar R - http://cs.annauniv.edu/~rsridhar
Blog: http://www.livejournal.com/~sridharinfinity

From mwh at python.net  Thu Nov 25 05:53:39 2004
From: mwh at python.net (Michael Hudson)
Date: Thu Nov 25 06:01:24 2004
Subject: [Twisted-web] Re: overriding resource getting with nevow+twisted
References: <E1CX0Mu-0005VD-00@meejah.homeip.net>
	<C41ABB8E-3E61-11D9-9E60-000A95864FC4@ulaluma.com>
Message-ID: <2mhdnew0mk.fsf@starship.python.net>

Donovan Preston <dp@ulaluma.com> writes:

> If you are using mktap web, don't.

I realise this isn't the most appropriate place to ask the question,
but as a relative twisted newbie with no legacy concerns at all,
should I bother learning about taps?

"""
if __name__ == "__main__":
    from twisted.internet import reactor
    reactor.run()
"""

I understand.

"""
$ twistd -noy foo.tac
"""

I understand, at least enough to make it do what I want.

.taps just confuse me.

If the right answer to this is RTFM or RTFHowto, I'd appreciate being
told which :)

Cheers,
mwh

-- 
41. Some programming languages manage to absorb change, but
    withstand progress.
  -- Alan Perlis, http://www.cs.yale.edu/homes/perlis-alan/quotes.html


From matt at pollenation.net  Thu Nov 25 06:06:59 2004
From: matt at pollenation.net (Matt Goodall)
Date: Thu Nov 25 06:06:46 2004
Subject: [Twisted-web] Re: nevow.formless
In-Reply-To: <8816fcf804112504041dbf1e2@mail.gmail.com>
References: <41A1EF8F.8090203@gmx.net>
	<AE80A520-3C9D-11D9-84EF-000A95864FC4@ulaluma.com>
	<41A5599E.60701@gmx.net>
	<1101380492.16190.11.camel@localhost.localdomain>
	<8816fcf804112504041dbf1e2@mail.gmail.com>
Message-ID: <1101388019.16190.20.camel@localhost.localdomain>

On Thu, 2004-11-25 at 17:34 +0530, Sridhar R wrote:
> On Thu, 25 Nov 2004 11:01:32 +0000, Matt Goodall <matt@pollenation.net> wrote:
> > 
> > Formless was broken out into its own package. Those imports should now
> > be:
> > 
> >     from formless import annotate
> >     from formless import webform
> > 
> 
> Shouldn't this be
> from nevow.formless import annotate, webform ??

No, it should be what I typed.

> Why do we need create yet another top-level package?

Because formless is (in theory) suitable for use outside of Nevow.

Christopher Armstrong (radix) once developed a gtk version of webform
and I *think* Quotient was using formless to allow objects to be
configured via a command line interface. I'm not sure what state those
implementations are in these days though.

Cheers, Matt

-- 
     __
    /  \__     Matt Goodall, Pollenation Internet Ltd
    \__/  \    w: http://www.pollenation.net
  __/  \__/    e: matt@pollenation.net
 /  \__/  \    t: +44 (0)113 2252500
 \__/  \__/
 /  \          Any views expressed are my own and do not necessarily
 \__/          reflect the views of my employer.


From foom at fuhm.net  Thu Nov 25 09:50:29 2004
From: foom at fuhm.net (James Y Knight)
Date: Thu Nov 25 09:50:32 2004
Subject: [Twisted-web] Re: overriding resource getting with nevow+twisted
In-Reply-To: <2mhdnew0mk.fsf@starship.python.net>
References: <E1CX0Mu-0005VD-00@meejah.homeip.net>
	<C41ABB8E-3E61-11D9-9E60-000A95864FC4@ulaluma.com>
	<2mhdnew0mk.fsf@starship.python.net>
Message-ID: <1D27EEB0-3F02-11D9-96B0-000A95A50FB2@fuhm.net>

On Nov 25, 2004, at 7:53 AM, Michael Hudson wrote:
> Donovan Preston <dp@ulaluma.com> writes:
>
>> If you are using mktap web, don't.
>
> I realise this isn't the most appropriate place to ask the question,
> but as a relative twisted newbie with no legacy concerns at all,
> should I bother learning about taps?

In short: No.

James


From radeex at gmail.com  Thu Nov 25 15:26:14 2004
From: radeex at gmail.com (Christopher Armstrong)
Date: Thu Nov 25 15:26:17 2004
Subject: [Twisted-web] Re: nevow.formless
In-Reply-To: <1101388019.16190.20.camel@localhost.localdomain>
References: <41A1EF8F.8090203@gmx.net>
	<AE80A520-3C9D-11D9-84EF-000A95864FC4@ulaluma.com>
	<41A5599E.60701@gmx.net>
	<1101380492.16190.11.camel@localhost.localdomain>
	<8816fcf804112504041dbf1e2@mail.gmail.com>
	<1101388019.16190.20.camel@localhost.localdomain>
Message-ID: <60ed19d404112514266515e159@mail.gmail.com>

On Thu, 25 Nov 2004 13:06:59 +0000, Matt Goodall <matt@pollenation.net> wrote:
> Christopher Armstrong (radix) once developed a gtk version of webform
> and I *think* Quotient was using formless to allow objects to be
> configured via a command line interface. I'm not sure what state those
> implementations are in these days though.

gtk2form is certainly in no working state, but it's probably a good
starting point for writing a gtk2form for the newest APIs. I might
have a chance to work on it in the next few months, but don't bet on
it.

-- 
 Twisted | Christopher Armstrong: International Man of Twistery
  Radix  |          Release Manager,  Twisted Project
---------+            http://radix.twistedmatrix.com

From radeex at gmail.com  Thu Nov 25 16:13:39 2004
From: radeex at gmail.com (Christopher Armstrong)
Date: Thu Nov 25 16:13:55 2004
Subject: [Twisted-web] Forms in sub-page elements
Message-ID: <60ed19d40411251513141abdf7@mail.gmail.com>

Currently, I'm pretty sure that if I have a Page with a parameterized
body, and that body contains a form, that form won't work. For one,
only Pages are remembered as IConfigurableFactory. I didn't really go
beyond that in my debugging, but I guess that it's not the only
problem; since form actions are an URL-child of the
IConfigurableFactory page, then I guess it wouldn't know to delegate
the form processing to that fragment.

Does anyone have an idea about how to solve this problem? I'd like to
save the several hours it'll probably take me to figure out a
sufficient workaround.

-- 
 Twisted | Christopher Armstrong: International Man of Twistery
  Radix  |          Release Manager,  Twisted Project
---------+            http://radix.twistedmatrix.com

From dialtone at gmail.com  Thu Nov 25 16:21:22 2004
From: dialtone at gmail.com (Valentino Volonghi)
Date: Thu Nov 25 16:21:25 2004
Subject: [Twisted-web] Forms in sub-page elements
In-Reply-To: <60ed19d40411251513141abdf7@mail.gmail.com>
References: <60ed19d40411251513141abdf7@mail.gmail.com>
Message-ID: <c893b853041125152126ddb2e3@mail.gmail.com>

On Fri, 26 Nov 2004 10:13:39 +1100, Christopher Armstrong
<radeex@gmail.com> wrote:
> Currently, I'm pretty sure that if I have a Page with a parameterized
> body, and that body contains a form, that form won't work. For one,
> only Pages are remembered as IConfigurableFactory. I didn't really go
> beyond that in my debugging, but I guess that it's not the only
> problem; since form actions are an URL-child of the
> IConfigurableFactory page, then I guess it wouldn't know to delegate
> the form processing to that fragment.
> 
> Does anyone have an idea about how to solve this problem? I'd like to
> save the several hours it'll probably take me to figure out a
> sufficient workaround.

I'm pretty sure dp said that it was handled anyway.

You just need to use webform.renderForms('some_name') in the fragment.

While in the parametrized page add a:

    def configurable_some_name(self, ctx):
        return fragment_instance

and put the typedinterface implementation in the fragment.

I can be wrong since I've yet to meet this problem in weever (I
haven't implemented forms yet... which is rather funny for an internet
forum :P)

-- 
Valentino Volonghi aka Dialtone
Now running Ubuntu Linux Hoary
Blog: http://vvolonghi.blogspot.com
http://developer.berlios.de/projects/weever/

From luc.saffre at gmx.net  Fri Nov 26 07:18:47 2004
From: luc.saffre at gmx.net (Luc Saffre)
Date: Fri Nov 26 07:19:29 2004
Subject: [Twisted-web] nevow tutorial
In-Reply-To: <1101380492.16190.11.camel@localhost.localdomain>
References: <41A1EF8F.8090203@gmx.net>	<AE80A520-3C9D-11D9-84EF-000A95864FC4@ulaluma.com>	<41A5599E.60701@gmx.net>
	<1101380492.16190.11.camel@localhost.localdomain>
Message-ID: <41A73B47.2030602@gmx.net>

On 25.11.2004 13:01, Matt Goodall wrote:

> References to formless.String, formless.Text etc should then be changed
> to annotate.String, annotate.Text, etc.

It was relatively easy to get the "schedule" tutorial examples running.

In order to integrate the tutorial into the Nevow SVN tree, I created a 
new package nevow.tutorial.schedule in my working copy. Having tutorial 
examples available as nevow.tutorial.xxxx package has advantages:
- the current directory doesn't need to be in pythonpath.
- later somebody (maybe I) can write unit tests for the tutorial

Or are there any better ideas about how to integrate the tutorial into 
the Nevow SVN tree?  There is already an "examples" directory where a 
"schedule" subdirectory would fit, but then the two advantages would be 
lost...

> I've create an issue on the tracker for this,
> http://divmod.org/users/roundup.twistd/nevow/issue142, so if you have
> any patches (no matter how simple) it would be cool if you could submit
> them there so someone can apply them to the svn repository.

I registered as a user.
I could send a zip file to somebody.
I can also volunteer for maintaining the tutorial... just give me write 
access to the SVN repository.

Luc

From rednelb at chello.sk  Sat Nov 27 21:16:12 2004
From: rednelb at chello.sk (rednelb)
Date: Sat Nov 27 21:02:15 2004
Subject: [Twisted-web] Refresh browser's content?
Message-ID: <41A9510C.3010100@chello.sk>

Hi,
Please can you tell me, if it is possible with Nevow (does it require 
LivePage as well?) to force all browsers which are viewing a web page to 
reload their contents if the server changes this page? I.e., to force a 
browser to immediately refresh the page whenever it is changed on 
server. Non-regularly.
E.g. live statistics - a server collects data and visualize them by an 
image. Everytime it gets something new, it re-creates the image. And I 
would like that every user currently being on this page will see the 
change immediately.
I'll be glad for any help, hint, tip, strategy, ...
Thank you very much.

From sridharinfinity at gmail.com  Sun Nov 28 00:41:47 2004
From: sridharinfinity at gmail.com (Sridhar R)
Date: Sun Nov 28 00:41:50 2004
Subject: [Twisted-web] Refresh browser's content?
In-Reply-To: <41A9510C.3010100@chello.sk>
References: <41A9510C.3010100@chello.sk>
Message-ID: <8816fcf804112723415e0b2b65@mail.gmail.com>

On Sun, 28 Nov 2004 05:16:12 +0100, rednelb <rednelb@chello.sk> wrote:
> Hi,
> Please can you tell me, if it is possible with Nevow (does it require
> LivePage as well?) to force all browsers which are viewing a web page to

It _requires_ LiveEvil.  Just use 
mind.sendScript("window.location.reload();") then.

-- 
Sridhar R - http://cs.annauniv.edu/~rsridhar
Blog: http://www.livejournal.com/~sridharinfinity

From matt at pollenation.net  Sun Nov 28 08:35:43 2004
From: matt at pollenation.net (Matt Goodall)
Date: Sun Nov 28 08:35:48 2004
Subject: [Twisted-web] Refresh browser's content?
In-Reply-To: <8816fcf804112723415e0b2b65@mail.gmail.com>
References: <41A9510C.3010100@chello.sk>
	<8816fcf804112723415e0b2b65@mail.gmail.com>
Message-ID: <35453.62.252.224.19.1101656143.squirrel@webmail.pollenation.net>


> On Sun, 28 Nov 2004 05:16:12 +0100, rednelb <rednelb@chello.sk> wrote:
>> Hi,
>> Please can you tell me, if it is possible with Nevow (does it require
>> LivePage as well?) to force all browsers which are viewing a web page to
>
> It _requires_ LiveEvil.  Just use
> mind.sendScript("window.location.reload();") then.

The above is correct although refreshing the whole page may be like taking
an axe to the problem. Sridhar, I mean no offence by that - you answered
the question that was asked. LiveEvil is far too cool to be used to
refresh the whole page ;-).

LiveEvil actually allows you to update specific parts of the page; the
rest of the page is left unchanged. That tends to produce a much better
user experience as there is less "flicker" on the page.

The main demonstration of LiveEvil is chatola - included in the Nevow
releases (latest is 0.3). Another LiveEvil example is the incredibly dull
itsalive (.tac and .html) in sandbox/mg (available in the Nevow SVN
repository).

Hope this help.

Cheers, Matt

-- 
     __
    /  \__     Matt Goodall, Pollenation Internet Ltd
    \__/  \    w: http://www.pollenation.net
  __/  \__/    e: matt@pollenation.net
 /  \__/  \    t: +44 (0)113 2252500
 \__/  \__/
 /  \          Any views expressed are my own and do not necessarily
 \__/          reflect the views of my employer.


From sridharinfinity at gmail.com  Sun Nov 28 08:43:51 2004
From: sridharinfinity at gmail.com (Sridhar R)
Date: Sun Nov 28 08:44:02 2004
Subject: [Twisted-web] Refresh browser's content?
In-Reply-To: <35453.62.252.224.19.1101656143.squirrel@webmail.pollenation.net>
References: <41A9510C.3010100@chello.sk>
	<8816fcf804112723415e0b2b65@mail.gmail.com>
	<35453.62.252.224.19.1101656143.squirrel@webmail.pollenation.net>
Message-ID: <8816fcf804112807432e8e51a0@mail.gmail.com>

On Sun, 28 Nov 2004 15:35:43 -0000 (GMT), Matt Goodall
<matt@pollenation.net> wrote:
> 
> The above is correct although refreshing the whole page may be like taking
> an axe to the problem. Sridhar, I mean no offence by that - you answered
> the question that was asked. LiveEvil is far too cool to be used to
> refresh the whole page ;-).
> 

I agree.  But it must not be used for any large markup modifications. 
Other side-effects are difficult to save HTML to disk (at least any
mozilla plugin for this - save html from DOM)

-- 
Sridhar R - http://cs.annauniv.edu/~rsridhar
Blog: http://www.livejournal.com/~sridharinfinity

From rednelb at chello.sk  Sun Nov 28 15:19:28 2004
From: rednelb at chello.sk (rednelb)
Date: Sun Nov 28 15:05:23 2004
Subject: [Twisted-web] Refresh browser's content?
In-Reply-To: <8816fcf804112807432e8e51a0@mail.gmail.com>
References: <41A9510C.3010100@chello.sk>	<8816fcf804112723415e0b2b65@mail.gmail.com>	<35453.62.252.224.19.1101656143.squirrel@webmail.pollenation.net>
	<8816fcf804112807432e8e51a0@mail.gmail.com>
Message-ID: <41AA4EF0.9010205@chello.sk>

Sridhar R & Matt Goodall, I thank you very much!

Sridhar R wrote:

>On Sun, 28 Nov 2004 15:35:43 -0000 (GMT), Matt Goodall
><matt@pollenation.net> wrote:
>  
>
>>The above is correct although refreshing the whole page may be like taking
>>an axe to the problem. Sridhar, I mean no offence by that - you answered
>>the question that was asked. LiveEvil is far too cool to be used to
>>refresh the whole page ;-).
>>
>>    
>>
>
>I agree.  But it must not be used for any large markup modifications. 
>Other side-effects are difficult to save HTML to disk (at least any
>mozilla plugin for this - save html from DOM)
>
>  
>

From orbitz at ezabel.com  Sun Nov 28 20:34:19 2004
From: orbitz at ezabel.com (orbitz)
Date: Sun Nov 28 20:34:32 2004
Subject: [Twisted-web] Guard
Message-ID: <41AA98BB.3020201@ezabel.com>

I'm trying to write the login portion of a webapp using guard.  I 
understand the checker side of things. I'll be using a database as the 
backend, and checking against it doesn't sound hard. The issue I'm 
having though, is that my authentication depends on 3 variables. A 
username, password, and department.  I'm not sure what I have to do to 
get these 3 things into the credential in order to authenticate. Is 
there a class I have to subclass and then override a method for or what?

Thank you.

From sridharinfinity at gmail.com  Sun Nov 28 21:42:55 2004
From: sridharinfinity at gmail.com (Sridhar R)
Date: Sun Nov 28 21:42:57 2004
Subject: [Twisted-web] Guard
In-Reply-To: <41AA98BB.3020201@ezabel.com>
References: <41AA98BB.3020201@ezabel.com>
Message-ID: <8816fcf804112820427e95a1b0@mail.gmail.com>

On Sun, 28 Nov 2004 22:34:19 -0500, orbitz <orbitz@ezabel.com> wrote:
> having though, is that my authentication depends on 3 variables. A
> username, password, and department.  I'm not sure what I have to do to
> get these 3 things into the credential in order to authenticate. Is
> there a class I have to subclass and then override a method for or what?
> 

You can proceed like this.  Authenticate using username and password
and return a special avatar (assuming PB).  Then call
getAvatar(department) remote method on the avatar to get the intended
avatar.  Even if more than one guy (from different departments) had
same username and password, the getAvatar method could easily resolve
the conflict. :)

HTH

-- 
Sridhar R - http://cs.annauniv.edu/~rsridhar
Blog: http://www.livejournal.com/~sridharinfinity

From orbitz at ezabel.com  Sun Nov 28 22:24:25 2004
From: orbitz at ezabel.com (orbitz)
Date: Sun Nov 28 22:24:48 2004
Subject: [Twisted-web] Guard
In-Reply-To: <8816fcf804112820427e95a1b0@mail.gmail.com>
References: <41AA98BB.3020201@ezabel.com>
	<8816fcf804112820427e95a1b0@mail.gmail.com>
Message-ID: <41AAB289.6090700@ezabel.com>

I'm not using PB in this, and that doesn't sound like it solves the 
issue of actually giving the department to the credential checker so it 
can give a yes or no.

This is fairly nasty but I was thinking of a possible solution being to 
inherit from SessionWrapper and rewrite teh getCredentials method and 
then rebind my new class to the one in guard so it uses my class 
internally which grabs the creds I need (shouldn't guard already work 
like this except less icky, but providing a means to specify which 
credentials to use?).

I know it sounds gross but sounds like the most straight forward 
solutiont to what I need..thoughts?


Sridhar R wrote:

>On Sun, 28 Nov 2004 22:34:19 -0500, orbitz <orbitz@ezabel.com> wrote:
>  
>
>>having though, is that my authentication depends on 3 variables. A
>>username, password, and department.  I'm not sure what I have to do to
>>get these 3 things into the credential in order to authenticate. Is
>>there a class I have to subclass and then override a method for or what?
>>
>>    
>>
>
>You can proceed like this.  Authenticate using username and password
>and return a special avatar (assuming PB).  Then call
>getAvatar(department) remote method on the avatar to get the intended
>avatar.  Even if more than one guy (from different departments) had
>same username and password, the getAvatar method could easily resolve
>the conflict. :)
>
>HTH
>
>  
>


From sridharinfinity at gmail.com  Sun Nov 28 22:35:28 2004
From: sridharinfinity at gmail.com (Sridhar R)
Date: Sun Nov 28 22:35:31 2004
Subject: [Twisted-web] Guard
In-Reply-To: <41AAB289.6090700@ezabel.com>
References: <41AA98BB.3020201@ezabel.com>
	<8816fcf804112820427e95a1b0@mail.gmail.com>
	<41AAB289.6090700@ezabel.com>
Message-ID: <8816fcf804112821352ebf74e6@mail.gmail.com>

On Mon, 29 Nov 2004 00:24:25 -0500, orbitz <orbitz@ezabel.com> wrote:
> 
> I know it sounds gross but sounds like the most straight forward
> solutiont to what I need..thoughts?
> 

Never tried it but what about this
username: (username, department)  (send and receive a tuple)
password: password

-- 
Sridhar R - http://cs.annauniv.edu/~rsridhar
Blog: http://www.livejournal.com/~sridharinfinity

From orbitz at ezabel.com  Mon Nov 29 06:29:37 2004
From: orbitz at ezabel.com (orbitz)
Date: Mon Nov 29 06:30:15 2004
Subject: [Twisted-web] Guard
In-Reply-To: <8816fcf804112821352ebf74e6@mail.gmail.com>
References: <41AA98BB.3020201@ezabel.com>	<8816fcf804112820427e95a1b0@mail.gmail.com>	<41AAB289.6090700@ezabel.com>
	<8816fcf804112821352ebf74e6@mail.gmail.com>
Message-ID: <41AB2441.2020903@ezabel.com>

On second thought, I don't even need to reassign to session wrapper.  
After looking at things I realized one has to do:
appserver.NevowSite(resource=guard.SessionWrapper(limeportal))

I can just subclass it, rewrite the portions i need to, and then use 
that for the resource. I think that should work fine.


Sridhar R wrote:

>On Mon, 29 Nov 2004 00:24:25 -0500, orbitz <orbitz@ezabel.com> wrote:
>  
>
>>I know it sounds gross but sounds like the most straight forward
>>solutiont to what I need..thoughts?
>>
>>    
>>
>
>Never tried it but what about this
>username: (username, department)  (send and receive a tuple)
>password: password
>
>  
>


From jackup at gmail.com  Mon Nov 29 19:51:53 2004
From: jackup at gmail.com (Young-gue Park)
Date: Mon Nov 29 19:52:53 2004
Subject: [Twisted-web] How can i download very big size file about more than
	100M?
Message-ID: <dd87482b04112918517de4a754@mail.gmail.com>

I face some problem


"""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""
from twisted.internet import defer, reactor
from twisted.web import resource, server

import os, sys

class FileDownloadResource(resource.Resource):

     	isLeaf = 1
	fName = 'very big file size'
                path = 'some_path'

     	def render(self, request):
		d = True
		if d:
			d = "attachment"
		else:
			d = "inline"

		request.setHeader("Content-type", "application/x-msdownload");
		request.setHeader("Content-Disposition", d + "; filename=" + self.fName);
		request.setHeader("Content-Length", ' ' +
str(self.getFileSize(self.path + self.fName)));
		request.setHeader("Content-Transfer-Encoding", "binary");
		request.setHeader("Pragma", "no-cache");
		request.setHeader("Expires", "0");

		# print "entered render"
		d = defer.Deferred()
		d.addCallback(self.printResult, request)
		d.addErrback(self.printError, request)
        	return server.NOT_DONE_YET

	def printError(failure, request):
		request.write(str(failure))
		request.finish()

	def printResult(self, request):
		for line in open(self.path + self.fName, 'r'):
			request.write(line)
		request.finish()

	def getFileSize(self, file):
		size = os.path.getsize(file)
		return size

resource = FileDownloadResource()
""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""

I don't know what am i doing

please give any hint

From dp at ulaluma.com  Tue Nov 30 06:19:50 2004
From: dp at ulaluma.com (Donovan Preston)
Date: Tue Nov 30 06:20:03 2004
Subject: [Twisted-web] How can i download very big size file about more
	than 100M?
In-Reply-To: <dd87482b04112918517de4a754@mail.gmail.com>
References: <dd87482b04112918517de4a754@mail.gmail.com>
Message-ID: <83DA6D3C-42D2-11D9-9F95-000A95864FC4@ulaluma.com>


On Nov 29, 2004, at 6:51 PM, Young-gue Park wrote:

> I face some problem

Just use twisted.web.static.File. It implements the IProducer/IConsumer 
interface which allows it to incrementally send the file as the client 
demands it.

dp


From lotek at softhome.net  Tue Nov 30 13:19:00 2004
From: lotek at softhome.net (lotek@softhome.net)
Date: Tue Nov 30 13:19:07 2004
Subject: [Twisted-web] xmlrpc question
Message-ID: <courier.41ACD5B4.0000457E@softhome.net>


How can i do this in twisted? 

from SimpleXMLRPCServer import SimpleXMLRPCServer, 
SimpleXMLRPCRequestHandler 

class ExtendedXMLRPCRequestHandler(SimpleXMLRPCRequestHandler):
 def do_GET(self):
   #only allow a request for the crossdomain file
   #this can be changed to support GETs of any file if needed
   if self.path != '/crossdomain.xml':
     self.send_response(403)
     self.log_request(403)
     return 

   #open the crossdomain file and read its contents
   f = file('crossdomain.xml', 'r')
   msg = f.read()
   f.close() 

   #write the data to the socket along with valid HTTP headers
   res = 'HTTP/1.0 200 OK\r\nDate: %s\r\n\r\n%s' % \
     (self.date_time_string(),msg)
   self.wfile.write(res)
   self.log_request(200) 

class EchoClass:
 def echo(self, data):
   return data 

#create an instance of the class
s = EchoClass()
#create the server on localhost
server = SimpleXMLRPCServer(('', 8000), ExtendedXMLRPCRequestHandler)
#register the instance as a web service
server.register_instance(s)
#start accepting requests
server.serve_forever()

From teratorn at world-net.net  Tue Nov 30 17:28:33 2004
From: teratorn at world-net.net (Eric Mangold)
Date: Tue Nov 30 17:28:45 2004
Subject: [Twisted-web] xmlrpc question
In-Reply-To: <courier.41ACD5B4.0000457E@softhome.net>
References: <courier.41ACD5B4.0000457E@softhome.net>
Message-ID: <opsiazlvhg6k1y1x@localhost.localdomain>

On Tue, 30 Nov 2004 13:19:00 -0700, <lotek@softhome.net> wrote:

> How can i do this in twisted? from SimpleXMLRPCServer import  
> SimpleXMLRPCServer, SimpleXMLRPCRequestHandler class  
> ExtendedXMLRPCRequestHandler(SimpleXMLRPCRequestHandler):
>  def do_GET(self):
>    #only allow a request for the crossdomain file
>    #this can be changed to support GETs of any file if needed
>    if self.path != '/crossdomain.xml':
>      self.send_response(403)
>      self.log_request(403)
>      return    #open the crossdomain file and read its contents
>    f = file('crossdomain.xml', 'r')
>    msg = f.read()
>    f.close()    #write the data to the socket along with valid HTTP  
> headers
>    res = 'HTTP/1.0 200 OK\r\nDate: %s\r\n\r\n%s' % \
>      (self.date_time_string(),msg)
>    self.wfile.write(res)
>    self.log_request(200) class EchoClass:
>  def echo(self, data):
>    return data #create an instance of the class
> s = EchoClass()
> #create the server on localhost
> server = SimpleXMLRPCServer(('', 8000), ExtendedXMLRPCRequestHandler)
> #register the instance as a web service
> server.register_instance(s)
> #start accepting requests
> server.serve_forever()

Where did you get stuck?

-Eric

