From p.mayers at imperial.ac.uk  Wed Mar  4 17:29:57 2009
From: p.mayers at imperial.ac.uk (Phil Mayers)
Date: Wed Mar  4 17:30:45 2009
Subject: [Twisted-web] new http auth stuff
In-Reply-To: <f055221a0902271933o4107c899p8eea1c6b2d69a9d7@mail.gmail.com>
References: <49A7ED61.2050805@imperial.ac.uk>
	<f055221a0902271933o4107c899p8eea1c6b2d69a9d7@mail.gmail.com>
Message-ID: <49AF00E5.3040903@imperial.ac.uk>

David Reid wrote:
> Sounds like a bug, maybe file one with trac, http://twistedmatrix.com/trac/

Done

http://twistedmatrix.com/trac/ticket/3679

From aaron.devore at gmail.com  Thu Mar  5 12:27:16 2009
From: aaron.devore at gmail.com (Aaron DeVore)
Date: Thu Mar  5 12:27:49 2009
Subject: [Twisted-web] Separate function for relative redirects in
	HTTPClientFactory
Message-ID: <2ead2fb0903050927o4776fe8bw33dfb56f31921bd5@mail.gmail.com>

Last night I restarted my work on relative redirects in
HTTPClientFactory (Ticket #3384). What I had forgotten was how
insanely difficult it is to write the test cases, which would then be
significantly more bug prone than the code itself. The problem is that
for every possible input I need to add (1) A test_* function, (2) a
callback, (3) one or more children to the internal web server for the
test_* function to connect to.

This morning I hit on another idea: Why not separate the code in
HTTPClientFactory that does the fix into a separate function? Then
there could be one test case to make sure the code in
HTTPClientFactory works, then a single test case that contains a
series of assertEquals that test the output of the function. How does
that sound? Should I put it outside of HTTPClientFactory or inside?

Cheers!
Aaron DeVore

From dreid at dreid.org  Thu Mar  5 13:27:08 2009
From: dreid at dreid.org (David Reid)
Date: Thu Mar  5 13:27:41 2009
Subject: [Twisted-web] Separate function for relative redirects in 
	HTTPClientFactory
In-Reply-To: <2ead2fb0903050927o4776fe8bw33dfb56f31921bd5@mail.gmail.com>
References: <2ead2fb0903050927o4776fe8bw33dfb56f31921bd5@mail.gmail.com>
Message-ID: <f055221a0903051027i5b661734sde062686a0ba88ca@mail.gmail.com>

I would suggest rewriting the test cases so you don't need to use an
internal webserver.  You really just need to be able to send blobs of data
to the HTTP client that contain different response codes and Location
headers.

I believe there are already some tests in twisted.web.test.test_webclient
that do this, such as:

http://twistedmatrix.com/trac/browser/trunk/twisted/web/test/test_webclient=
.py#L172
http://twistedmatrix.com/trac/browser/trunk/twisted/web/test/test_webclient=
.py#L711

Plus there are numerous other examples in twisted of not relying on even the
loopback network interface for tests.

-David

On Thu, Mar 5, 2009 at 9:27 AM, Aaron DeVore <aaron.devore@gmail.com> wrote:

> Last night I restarted my work on relative redirects in
> HTTPClientFactory (Ticket #3384). What I had forgotten was how
> insanely difficult it is to write the test cases, which would then be
> significantly more bug prone than the code itself. The problem is that
> for every possible input I need to add (1) A test_* function, (2) a
> callback, (3) one or more children to the internal web server for the
> test_* function to connect to.
>
> This morning I hit on another idea: Why not separate the code in
> HTTPClientFactory that does the fix into a separate function? Then
> there could be one test case to make sure the code in
> HTTPClientFactory works, then a single test case that contains a
> series of assertEquals that test the output of the function. How does
> that sound? Should I put it outside of HTTPClientFactory or inside?
>
> Cheers!
> Aaron DeVore
>
> _______________________________________________
> Twisted-web mailing list
> Twisted-web@twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-web/attachments/20090305/01=
5589ae/attachment.htm
From exarkun at divmod.com  Thu Mar  5 13:50:37 2009
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Thu Mar  5 13:50:41 2009
Subject: [Twisted-web] Separate function for relative redirects in
	HTTPClientFactory
In-Reply-To: <f055221a0903051027i5b661734sde062686a0ba88ca@mail.gmail.com>
Message-ID: <20090305185037.12853.1033102621.divmod.quotient.18696@henry.divmod.com>

On Thu, 5 Mar 2009 10:27:08 -0800, David Reid <dreid@dreid.org> wrote:
>On Thu, Mar 5, 2009 at 9:27 AM, Aaron DeVore <aaron.devore@gmail.com> wrote:
>
>> Last night I restarted my work on relative redirects in
>> HTTPClientFactory (Ticket #3384). What I had forgotten was how
>> insanely difficult it is to write the test cases, which would then be
>> significantly more bug prone than the code itself. The problem is that
>> for every possible input I need to add (1) A test_* function, (2) a
>> callback, (3) one or more children to the internal web server for the
>> test_* function to connect to.
>>
>> This morning I hit on another idea: Why not separate the code in
>> HTTPClientFactory that does the fix into a separate function? Then
>> there could be one test case to make sure the code in
>> HTTPClientFactory works, then a single test case that contains a
>> series of assertEquals that test the output of the function. How does
>> that sound? Should I put it outside of HTTPClientFactory or inside?
>>
>> Cheers!
>> Aaron DeVore
>>
>
>I would suggest rewriting the test cases so you don't need to use an
>internal webserver.  You really just need to be able to send blobs of data
>to the HTTP client that contain different response codes and Location
>headers.
>
>I believe there are already some tests in twisted.web.test.test_webclient
>that do this, such as:
>
>http://twistedmatrix.com/trac/browser/trunk/twisted/web/test/test_webclient.py#L172
>http://twistedmatrix.com/trac/browser/trunk/twisted/web/test/test_webclient.py#L711
>
>Plus there are numerous other examples in twisted of not relying on even the
>loopback network interface for tests.
>

This is good advice, and it largely agrees with what Aaron was proposing,
I think.  The core idea here is to only test the code you're trying to test,
not a huge heap of other stuff.  A lot of the HTTP client tests invoke a
huge swath of Twisted Web code, and needlessly so.  Finding some way to
write new tests which only exercise the very limited set of code that the
test is actually for is definitely the way to go.

Jean-Paul

From aaron.devore at gmail.com  Thu Mar  5 13:53:23 2009
From: aaron.devore at gmail.com (Aaron DeVore)
Date: Thu Mar  5 13:53:56 2009
Subject: [Twisted-web] Separate function for relative redirects in 
	HTTPClientFactory
In-Reply-To: <f055221a0903051027i5b661734sde062686a0ba88ca@mail.gmail.com>
References: <2ead2fb0903050927o4776fe8bw33dfb56f31921bd5@mail.gmail.com>
	<f055221a0903051027i5b661734sde062686a0ba88ca@mail.gmail.com>
Message-ID: <2ead2fb0903051053pf394bd6g2f03b7a8336baf78@mail.gmail.com>

I don't think those would cover what I need. From what I can tell both
of those only test the outgoing headers from a request. The fix I'm
working on handles an invalid response from the server. The code that
I wrote would never even come close to running.

On Thu, Mar 5, 2009 at 10:27 AM, David Reid <dreid@dreid.org> wrote:
> I would suggest rewriting the test cases so you don't need to use an
> internal webserver.? You really just need to be able to send blobs of data
> to the HTTP client that contain different response codes and Location
> headers.
>
> I believe there are already some tests in twisted.web.test.test_webclient
> that do this, such as:
>
> http://twistedmatrix.com/trac/browser/trunk/twisted/web/test/test_webclient.py#L172
> http://twistedmatrix.com/trac/browser/trunk/twisted/web/test/test_webclient.py#L711
>
> Plus there are numerous other examples in twisted of not relying on even the
> loopback network interface for tests.
>
> -David
>
> On Thu, Mar 5, 2009 at 9:27 AM, Aaron DeVore <aaron.devore@gmail.com> wrote:
>>
>> Last night I restarted my work on relative redirects in
>> HTTPClientFactory (Ticket #3384). What I had forgotten was how
>> insanely difficult it is to write the test cases, which would then be
>> significantly more bug prone than the code itself. The problem is that
>> for every possible input I need to add (1) A test_* function, (2) a
>> callback, (3) one or more children to the internal web server for the
>> test_* function to connect to.
>>
>> This morning I hit on another idea: Why not separate the code in
>> HTTPClientFactory that does the fix into a separate function? Then
>> there could be one test case to make sure the code in
>> HTTPClientFactory works, then a single test case that contains a
>> series of assertEquals that test the output of the function. How does
>> that sound? Should I put it outside of HTTPClientFactory or inside?
>>
>> Cheers!
>> Aaron DeVore
>>
>> _______________________________________________
>> Twisted-web mailing list
>> Twisted-web@twistedmatrix.com
>> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web
>
>
> _______________________________________________
> Twisted-web mailing list
> Twisted-web@twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web
>
>

From aaron.devore at gmail.com  Thu Mar  5 14:16:17 2009
From: aaron.devore at gmail.com (Aaron DeVore)
Date: Thu Mar  5 14:16:23 2009
Subject: [Twisted-web] Separate function for relative redirects in 
	HTTPClientFactory
In-Reply-To: <20090305185037.12853.1033102621.divmod.quotient.18696@henry.divmod.com>
References: <f055221a0903051027i5b661734sde062686a0ba88ca@mail.gmail.com>
	<20090305185037.12853.1033102621.divmod.quotient.18696@henry.divmod.com>
Message-ID: <2ead2fb0903051116x50bbe156jec2e40a7be71a0bf@mail.gmail.com>

On Thu, Mar 5, 2009 at 10:50 AM, Jean-Paul Calderone <exarkun@divmod.com> wrote:


> This is good advice, and it largely agrees with what Aaron was proposing,
> I think. ?The core idea here is to only test the code you're trying to test,
> not a huge heap of other stuff. ?A lot of the HTTP client tests invoke a
> huge swath of Twisted Web code, and needlessly so. ?Finding some way to
> write new tests which only exercise the very limited set of code that the
> test is actually for is definitely the way to go.
>
> Jean-Paul

With a separate function (for brevity I'll just call it r2ar for this
email) there would only be a single request to check that r2ar is
called at all. The rest of the test would involve calling r2ar a few
times. As an added bonus, calls to r2ar are extremely cheap. timeit
pegs them at in the order of 10 x -5 seconds on my laptop.

-Aaron

From upadhyay at gmail.com  Sat Mar 21 11:14:01 2009
From: upadhyay at gmail.com (Amit Upadhyay)
Date: Sat Mar 28 07:03:52 2009
Subject: [Twisted-web] hi
Message-ID: <200903211514.n2LF8ren014805@mail3.webfaction.com>

U2tpcHBlZCBjb250ZW50IG9mIHR5cGUgbXVsdGlwYXJ0L2FsdGVybmF0aXZl
