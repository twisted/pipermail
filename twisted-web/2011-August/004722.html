<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] spawning a xvfb and firefox with a timeout
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20spawning%20a%20xvfb%20and%20firefox%20with%20a%20timeout&In-Reply-To=20110820210110.14538.1681657284.divmod.xquotient.5%40localhost.localdomain">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004720.html">
   <LINK REL="Next"  HREF="004723.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] spawning a xvfb and firefox with a timeout</H1>
    <B>Stephan</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20spawning%20a%20xvfb%20and%20firefox%20with%20a%20timeout&In-Reply-To=20110820210110.14538.1681657284.divmod.xquotient.5%40localhost.localdomain"
       TITLE="[Twisted-web] spawning a xvfb and firefox with a timeout">schenette at gmail.com
       </A><BR>
    <I>Mon Aug 22 05:16:21 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="004720.html">[Twisted-web] spawning a xvfb and firefox with a timeout
</A></li>
        <LI>Next message: <A HREF="004723.html">[Twisted-web] spawning a xvfb and firefox with a timeout
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4722">[ date ]</a>
              <a href="thread.html#4722">[ thread ]</a>
              <a href="subject.html#4722">[ subject ]</a>
              <a href="author.html#4722">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Jean-Paul,

adding

env=os.environ to spanProcess fixed the issue, thank you.

There is still one problem I brought up that I'm attempting to figure
out with twisted that is related to the initial question...

current status is that now with the addition of setting the env params
xvfb starts up correctly and starts up firefox.

the ProcessProtocol object that I created, has a calllater function
that kills the process after 20seconds.

the issue is that xvfb has one process id and any process it's asked
to create will cause another process to be spawned, thus another
process id, where the parent process is that of xvfb.

when I issue the kill command, xvfb does indeed die, but firefox-bin
stays around and it's parent is set to 1.

here is the ProcessProtocol code, should I be killing the parent
process differently so that the children die as well?

 33 class TimedProcessProtocol(protocol.ProcessProtocol):
 34
 35     def __init__(self, timeout):
 36         self.timeout = timeout
 37
 38     def connectionMade(self):
 39         logging.debug(&quot;connection made timeout = %d&quot;, self.timeout)
 40         @defer.inlineCallbacks
 41         def killIfAlive():
 42             logging.debug(&quot;timeout reached - killing process&quot;)
 43             try:
 44                 yield self.transport.signalProcess('TERM')
 45             except error.ProcessExitedAlready:
 46                 logging.debug(&quot;process already exited&quot;)
 47                 pass
 48
 49         d = reactor.callLater(self.timeout, killIfAlive)
 50
 51     def outReceived(self, data):
 52         logging.debug(&quot;output: %s&quot;, data)


Stephan

ps both TERM and KILL act the same way

On Sat, Aug 20, 2011 at 2:01 PM,  &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">exarkun at twistedmatrix.com</A>&gt; wrote:
&gt;<i> On 19 Aug, 04:42 am, <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">schenette at gmail.com</A> wrote:
</I>&gt;&gt;<i>I'm attempting to spawn xvfb with firefox using twisted's spawnProcess.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>I'm having two issues:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>1) when I call a normal process (not xvfb) it seems to
</I>&gt;&gt;<i>work, but when I call xvfb the process goes defunct
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>2) perhaps because it goes defunct but the timeout I set in place in
</I>&gt;&gt;<i>the processprotocol does
</I>&gt;&gt;<i>not trigger.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>==============
</I>&gt;&gt;<i>here is the code for spawning a process
</I>&gt;&gt;<i>==============
</I>&gt;&gt;<i>108 &#160; &#160; &#160; &#160; command = [&quot;/usr/bin/xvfb-run&quot;, &quot;--auto-servernum&quot;,
</I>&gt;&gt;<i>&quot;/usr/bin/firefox&quot;, &quot;-P&quot;, profile_id]
</I>&gt;&gt;<i>109 &#160; &#160; &#160; &#160; subprocess = reactor.spawnProcess(TimedProcessProtocol(20),
</I>&gt;&gt;<i>110 &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; &#160; command[0], command)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Does it make any difference if you pass on the parent's environment to
</I>&gt;<i> the xvfb-run process? &#160;Try something like spawnProcess(...,
</I>&gt;<i> env=os.environ)
</I>&gt;<i>
</I>&gt;<i> Jean-Paul
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-web mailing list
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">Twisted-web at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web</A>
</I>&gt;<i>
</I>
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004720.html">[Twisted-web] spawning a xvfb and firefox with a timeout
</A></li>
	<LI>Next message: <A HREF="004723.html">[Twisted-web] spawning a xvfb and firefox with a timeout
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4722">[ date ]</a>
              <a href="thread.html#4722">[ thread ]</a>
              <a href="subject.html#4722">[ subject ]</a>
              <a href="author.html#4722">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
