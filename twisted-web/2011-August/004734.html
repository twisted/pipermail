<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] default file creation when using	reactor.spawnProcess
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20default%20file%20creation%20when%20using%0A%09reactor.spawnProcess&In-Reply-To=CADozHMUMRGbdUN1hZuO5kJzDhXrJ95fB6F3i%3DNCvnUReMj_xNg%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004732.html">
   <LINK REL="Next"  HREF="004735.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] default file creation when using	reactor.spawnProcess</H1>
    <B>Stephan</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20default%20file%20creation%20when%20using%0A%09reactor.spawnProcess&In-Reply-To=CADozHMUMRGbdUN1hZuO5kJzDhXrJ95fB6F3i%3DNCvnUReMj_xNg%40mail.gmail.com"
       TITLE="[Twisted-web] default file creation when using	reactor.spawnProcess">schenette at gmail.com
       </A><BR>
    <I>Mon Aug 29 11:20:26 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="004732.html">[Twisted-web] default file creation when using reactor.spawnProcess
</A></li>
        <LI>Next message: <A HREF="004735.html">[Twisted-web] default file creation when using	reactor.spawnProcess
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4734">[ date ]</a>
              <a href="thread.html#4734">[ thread ]</a>
              <a href="subject.html#4734">[ subject ]</a>
              <a href="author.html#4734">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I still have the issue, but I've found out that it has something to do
with the fact that the twisted daemon isn't starting as the user I've
asked it to start as.

I know this because I dumped os.environ

145         for k,v in os.environ.items():
146             logging.debug(&quot;%s : %s&quot;, k, v)
147
148         subprocess = reactor.spawnProcess(self.pp, args[0], args,
env = os.environ, usePTY=1)


and this is what I see:

2011-08-29 08:07:58,263 DEBUG:USERNAME : root
2011-08-29 08:07:58,263 DEBUG:LANG : en_US.UTF-8
2011-08-29 08:07:58,263 DEBUG:SUDO_GID : 1000
2011-08-29 08:07:58,263 DEBUG:SHELL : /bin/bash
2011-08-29 08:07:58,263 DEBUG:SUDO_COMMAND : /etc/init.d/fireshark start
2011-08-29 08:07:58,263 DEBUG:PYTHONPATH :
2011-08-29 08:07:58,263 DEBUG:SUDO_UID : 1000
2011-08-29 08:07:58,263 DEBUG:TERM : xterm
2011-08-29 08:07:58,263 DEBUG:PATH :
/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin
2011-08-29 08:07:58,263 DEBUG:PWD : /usr/sbin
2011-08-29 08:07:58,263 DEBUG:LOGNAME : root
2011-08-29 08:07:58,264 DEBUG:USER : root
2011-08-29 08:07:58,264 DEBUG:HOME : /home/fireshark
2011-08-29 08:07:58,264 DEBUG:MAIL : /var/mail/stephan
2011-08-29 08:07:58,264 DEBUG:SUDO_USER : stephan

The daemon should be running as user fireshark, as that's what I have
it start as in the /etc/init.d/fireshark script (shown below) does
twisted follow a different convention for me to start the daemon as a
different user?

code from /etc/init.d/fireshark:

 14 PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin
 15 DAEMON=/usr/bin/twistd
 16 RUNAS=fireshark
 17 SERVICE_NAME=fireshark
 18 SERVICE_PATH=/usr/sbin/fireshark.py
 19 PIDFILE=/home/fireshark/fireshark.pid
 20 LOGFILE=/home/fireshark/fireshark.log
 21 DAEMON_OPTS=&quot;--pidfile=${PIDFILE} --logfile=${LOGFILE} --python
${SERVICE_PA    TH}&quot;
 22
 23 # Set python path so twistd can find the plugin
 24 # See: <A HREF="http://twistedmatrix.com/projects/core/documentation/howto/plugin.htm">http://twistedmatrix.com/projects/core/documentation/howto/plugin.htm</A>
   l
 25 export PYTHONPATH=$SERVICE_DIR
 26
 27 if [ ! -x $DAEMON ]; then
 28   echo &quot;ERROR: Can't execute $DAEMON.&quot;
 29   exit 1
 30 fi
 31
 32 if [ ! -x $SERVICE_PATH ]; then
 33   echo &quot;ERROR: Can't execute: $SERVICE_PATH&quot;
 34   exit 1
 35 fi
 36
 37 start_service() {
 38   echo -n &quot; * Starting $SERVICE_NAME... &quot;
 39   start-stop-daemon -Sq --chuid ${RUNAS} --group ${RUNAS} -p
$PIDFILE -x $DA    EMON -- $DAEMON_OPTS
 40   e=$?
 41   if [ $e -eq 1 ]; then
 42     echo &quot;already running&quot;
 43     return





On Sun, Aug 28, 2011 at 11:50 PM, Stephan &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">schenette at gmail.com</A>&gt; wrote:
&gt;<i> I'm attempting to move over PERL code to python code using the twisted
</I>&gt;<i> framework.
</I>&gt;<i> so far a few hiccups but this mailing list has helped me quite figure it out.
</I>&gt;<i>
</I>&gt;<i> I have a few few more hurdles, one being that since moving from Perl's
</I>&gt;<i>
</I>&gt;<i> my $cmd = &quot;xvfb-run --auto-servernum firefox -P $profile_id&quot;;
</I>&gt;<i> $pid = open2($infh, $outfh, $cmd);
</I>&gt;<i>
</I>&gt;<i> to twisted's reactor.spawnProcess:
</I>&gt;<i>
</I>&gt;<i> &#160;subprocess = reactor.spawnProcess(self.pp, args[0], args, env =
</I>&gt;<i> os.environ, usePTY=1, childFDs=None)
</I>&gt;<i>
</I>&gt;<i> when the xvfb/firefox processes create files they do so with root
</I>&gt;<i> read/write, owner no permissions and group
</I>&gt;<i> no permissions,
</I>&gt;<i>
</I>&gt;<i> using the the perl implementation the twisted daemon is run as a
</I>&gt;<i> particular user and the file creation via firefox is rw rw rw which is
</I>&gt;<i> what &#160;my goal is.
</I>&gt;<i>
</I>&gt;<i> What code would help those on the list willing to help? the daemon
</I>&gt;<i> script code in init.d?
</I>&gt;<i>
</I>&gt;<i> Thanks in advance, so far this list has been golden!
</I>&gt;<i> Stephan
</I>&gt;<i>
</I>
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004732.html">[Twisted-web] default file creation when using reactor.spawnProcess
</A></li>
	<LI>Next message: <A HREF="004735.html">[Twisted-web] default file creation when using	reactor.spawnProcess
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4734">[ date ]</a>
              <a href="thread.html#4734">[ thread ]</a>
              <a href="subject.html#4734">[ subject ]</a>
              <a href="author.html#4734">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
