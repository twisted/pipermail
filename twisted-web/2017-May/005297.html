<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] Question regarding custom contextFactory for twisted.web.client.Agent
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-web%5D%20Question%20regarding%20custom%20contextFactory%20for%0A%20twisted.web.client.Agent&In-Reply-To=%3CD4A89F99-09B0-404A-8A96-286B9E44CC67%40twistedmatrix.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="005296.html">
   <LINK REL="Next"  HREF="005298.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] Question regarding custom contextFactory for twisted.web.client.Agent</H1>
    <B>Glyph</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-web%5D%20Question%20regarding%20custom%20contextFactory%20for%0A%20twisted.web.client.Agent&In-Reply-To=%3CD4A89F99-09B0-404A-8A96-286B9E44CC67%40twistedmatrix.com%3E"
       TITLE="[Twisted-web] Question regarding custom contextFactory for twisted.web.client.Agent">glyph at twistedmatrix.com
       </A><BR>
    <I>Fri May 12 17:24:33 MDT 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="005296.html">[Twisted-web] Question regarding custom contextFactory for	twisted.web.client.Agent
</A></li>
        <LI>Next message (by thread): <A HREF="005298.html">[Twisted-web] Question regarding custom contextFactory for twisted.web.client.Agent
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5297">[ date ]</a>
              <a href="thread.html#5297">[ thread ]</a>
              <a href="subject.html#5297">[ subject ]</a>
              <a href="author.html#5297">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
&gt;<i> On May 12, 2017, at 1:56 PM, Jason Litzinger &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">jlitzingerdev at gmail.com</A>&gt; wrote:
</I>&gt;<i> 
</I>&gt;<i> Hello,
</I>&gt;<i> 
</I>&gt;<i> I have an optimization question in the realm of &quot;before I do something
</I>&gt;<i> foolish...&quot; regarding the contextFactory passed to twisted.web.client.Agent.
</I>&gt;<i> 
</I>&gt;<i> Background:
</I>&gt;<i> 
</I>&gt;<i> I have (several) twisted applications running on a Cortex-A5 system, one of
</I>&gt;<i> which interfaces with a web service using the twisted.web.client.Agent
</I>&gt;<i> API*.  The
</I>&gt;<i> problem I've observed is that requests to this web service result in a higher
</I>&gt;<i> than desired CPU load.  To understand the source of the load I isolated the
</I>&gt;<i> server interactions and profiled.
</I>&gt;<i> 
</I>&gt;<i> Investigation:
</I>&gt;<i> 
</I>&gt;<i> The profile data revealed the load in question stemmed from TLS related
</I>&gt;<i> calls, specifically optionsForClientTLS, which is called once per connection.
</I>&gt;<i> In looking (briefly) at what optionsForClientTLS does, it seemed
</I>&gt;<i> (perhaps wrongly)
</I>&gt;<i> that there was an opportunity for optimization in my specific case.
</I>&gt;<i> 
</I>&gt;<i> The optimization is to create a custom contextFactory that caches the connection
</I>&gt;<i> creator since the host is not changing.  I prototyped an implementation and the
</I>&gt;<i> load was reduced by a factor of ten.
</I>&gt;<i> 
</I>&gt;<i> Question:
</I>&gt;<i> 
</I>&gt;<i> Is it safe/sane to reuse a connection creator if the host to which I'm
</I>&gt;<i> connecting is
</I>&gt;<i> not going to change?
</I>
This sounds eminently sensible, and in fact sounds like Twisted, or Treq at least, really ought to do something like this on our end with some kind of small LRU cache, keeping the most-used N hostnames (where N defaults to some small number, say, 20).  I'm surprised to hear it is such a big optimization, but surprises like that are entirely the point of performance testing!

Nevertheless, thanks for asking!  I really wish people would ask questions about client TLS more often before doing something potentially insecure :).  In this case, the client connection creator is used to produce client connections anyway, and the connections are not shared, so there should be no worrisome mingling of state between connections.

We do host a performance test suite here: <A HREF="http://speed.twistedmatrix.com">http://speed.twistedmatrix.com</A> &lt;<A HREF="http://speed.twistedmatrix.com/">http://speed.twistedmatrix.com/</A>&gt; and the benchmarks are here <A HREF="https://github.com/twisted-infra/twisted-benchmarks">https://github.com/twisted-infra/twisted-benchmarks</A> &lt;<A HREF="https://github.com/twisted-infra/twisted-benchmarks">https://github.com/twisted-infra/twisted-benchmarks</A>&gt; if your test is not adequately represented in an existing benchmark.

-g

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://twistedmatrix.com/pipermail/twisted-web/attachments/20170512/ac64aab2/attachment.html">http://twistedmatrix.com/pipermail/twisted-web/attachments/20170512/ac64aab2/attachment.html</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="005296.html">[Twisted-web] Question regarding custom contextFactory for	twisted.web.client.Agent
</A></li>
	<LI>Next message (by thread): <A HREF="005298.html">[Twisted-web] Question regarding custom contextFactory for twisted.web.client.Agent
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5297">[ date ]</a>
              <a href="thread.html#5297">[ thread ]</a>
              <a href="subject.html#5297">[ subject ]</a>
              <a href="author.html#5297">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
