<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] Creating a hybrid server in Twisted
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Creating%20a%20hybrid%20server%20in%20Twisted&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004629.html">
   <LINK REL="Next"  HREF="004631.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] Creating a hybrid server in Twisted</H1>
    <B>David Bolen</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Creating%20a%20hybrid%20server%20in%20Twisted&In-Reply-To="
       TITLE="[Twisted-web] Creating a hybrid server in Twisted">db3l.net at gmail.com
       </A><BR>
    <I>Mon Apr  4 19:51:34 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="004629.html">[Twisted-web] Creating a hybrid server in Twisted
</A></li>
        <LI>Next message: <A HREF="004631.html">[Twisted-web] Creating a hybrid server in Twisted
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4630">[ date ]</a>
              <a href="thread.html#4630">[ thread ]</a>
              <a href="subject.html#4630">[ subject ]</a>
              <a href="author.html#4630">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Jashank Jeremy &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">jashank.jeremy at optusnet.com.au</A>&gt; writes:

&gt;<i> So I'm pretty much stuck in a rut.  I don't want to totally reinvent the
</I>&gt;<i> wheel just to be able to protocol-switch; I'd prefer to make use of
</I>&gt;<i> existing code from Twisted.  How do I hijack Twisted.Web to add protocol
</I>&gt;<i> switching?
</I>
The default HTTPFactory (of which Site is a subclass) is going to
create an HTTPChannel protocol for a new connection.  HTTPChannel is
based on LineReceiver, so lineReceived() is your hook for incoming
data.

To insert your own protocol code, you want to set the &quot;protocol&quot;
attribute of your Site (or HTTPFactory if using that directly)
instance to your own &quot;hybrid&quot; protocol class.

That protocol class needs to be able to use HTTPChannel for web
connections, so you can choose between subclassing or composition.
Subclassing is probably simpler, at least at first, since you won't
have to worry about mirroring instance parameters or attributes
getting set on your protocol instance by the factory, though
composition may perhaps keep your protocols separate more cleanly.

In your protocol's lineReceived() method, check for your flag value,
and adjust state appropriately.  Depending on the state you are in,
either pass along control to HTTPChannel.lineReceived, or just process
the data yourself.  Note that if your protocol is binary so you are
implementing rawDataReceived, you'll also want to check state and pass
along to HTTPCHannel if not in your local mode since that can be used
on web connections too.  If you're subclassing be aware that any
standard protocol method you implement might also get called on behalf
of the HTTPChannel code and not just your own protocol so always pass
along such calls if your local protocol mode isn't enabled.

HTTPChannel also includes policies.TimeoutMixin, so if you end up
switching to your own protocol, calling setTimeout(None) should
prevent it from deciding to close down your transport beneath you.  Unless
you're subclassing and you'd like the same timeout to be in effect for
your own protocol, of course.

-- David


</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004629.html">[Twisted-web] Creating a hybrid server in Twisted
</A></li>
	<LI>Next message: <A HREF="004631.html">[Twisted-web] Creating a hybrid server in Twisted
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4630">[ date ]</a>
              <a href="thread.html#4630">[ thread ]</a>
              <a href="subject.html#4630">[ subject ]</a>
              <a href="author.html#4630">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
