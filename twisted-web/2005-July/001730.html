<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] exception in formless with a few nevow examples
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20exception%20in%20formless%20with%20a%20few%20nevow%20examples&In-Reply-To=20050720001748.GA3877%40beowulf.thanes.org">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001729.html">
   <LINK REL="Next"  HREF="001731.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] exception in formless with a few nevow examples</H1>
    <B>Jp Calderone</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20exception%20in%20formless%20with%20a%20few%20nevow%20examples&In-Reply-To=20050720001748.GA3877%40beowulf.thanes.org"
       TITLE="[Twisted-web] exception in formless with a few nevow examples">exarkun at divmod.com
       </A><BR>
    <I>Tue Jul 19 20:40:39 MDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="001729.html">[Twisted-web] exception in formless with a few nevow examples
</A></li>
        <LI>Next message: <A HREF="001731.html">[Twisted-web] exception in formless with a few nevow examples
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1730">[ date ]</a>
              <a href="thread.html#1730">[ thread ]</a>
              <a href="subject.html#1730">[ subject ]</a>
              <a href="author.html#1730">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Wed, 20 Jul 2005 02:17:48 +0200, Marek Habersack &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">grendel at caudium.net</A>&gt; wrote:
&gt;<i>Hello,
</I>&gt;<i>
</I>&gt;<i>  This is my first post to the list and I'm quite a newcomer to twisted and
</I>&gt;<i>nevow, so forgive me if the issue is already known. The problem is with some
</I>&gt;<i>Nevow examples (e.g. formpost, userdb, db, customform, formbuilder - you can
</I>&gt;<i>see the problem at
</I>&gt;<i><A HREF="http://nevowexamples.adytum.us/{formpost,db,customform,formbuilder}/">http://nevowexamples.adytum.us/{formpost,db,customform,formbuilder}/</A>), the
</I>&gt;<i>following exception occurs when the samples are run:
</I>&gt;<i>
</I>&gt;<i> exceptions.NameError: global name 'cf' is not defined
</I>&gt;<i>
</I>&gt;<i>With the exception of userdb (which seems to give a slightly incorrect
</I>&gt;<i>traceback for the exception), the problem seems to originate at line 449 in
</I>&gt;<i>formless/webform.py:
</I>&gt;<i>
</I>&gt;<i>447  def formRenderer(ctx, data):
</I>&gt;<i>448      cf = ctx.locate(iformless.IConfigurableFactory)
</I>&gt;<i>449      return util.maybeDeferred(cf.locateConfigurable, ctx, configurableKey
</I>&gt;<i>450                                  ).addCallback(_formRenderIt)
</I>&gt;<i>
</I>&gt;<i>I'm not sure whether my guess is correct, but I perhaps the local 'cf'
</I>&gt;<i>variable has been garbage-collected before the _runCallbacks routine in
</I>&gt;<i>twisted/internet/defer.py calls the _formRenderIt?
</I>&gt;<i>
</I>
Objects never get garbage collected in Python until it is safe for them to be garbage collected.  When there is code relying on their existence that might yet execute, it is not safe.

The real problem is that _formRenderIt is an entirely separate function, and it thinks &quot;cf&quot; is a local, but it's totally not.  This is fixed in current svn <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">trunk at HEAD</A>, but was broken in the 0.4.1 release.

Of course, with this error fixed, the code path that can successfully execute is one that warns you that your application is written wrong.  So everything isn't /perfect/, but at least it becomes more apparent what the real problem is.

Jp

</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001729.html">[Twisted-web] exception in formless with a few nevow examples
</A></li>
	<LI>Next message: <A HREF="001731.html">[Twisted-web] exception in formless with a few nevow examples
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1730">[ date ]</a>
              <a href="thread.html#1730">[ thread ]</a>
              <a href="subject.html#1730">[ subject ]</a>
              <a href="author.html#1730">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
