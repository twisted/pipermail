<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] Sessions with LivePage?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Sessions%20with%20LivePage%3F&In-Reply-To=E4B50CF2-096A-4B1F-8D5C-98F5C040E061%40ulaluma.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001746.html">
   <LINK REL="Next"  HREF="001756.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] Sessions with LivePage?</H1>
    <B>Matt Goodall</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Sessions%20with%20LivePage%3F&In-Reply-To=E4B50CF2-096A-4B1F-8D5C-98F5C040E061%40ulaluma.com"
       TITLE="[Twisted-web] Sessions with LivePage?">matt at pollenation.net
       </A><BR>
    <I>Sat Jul 23 05:19:00 MDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="001746.html">[Twisted-web] Sessions with LivePage?
</A></li>
        <LI>Next message: <A HREF="001756.html">[Twisted-web] Sessions with LivePage?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1747">[ date ]</a>
              <a href="thread.html#1747">[ thread ]</a>
              <a href="subject.html#1747">[ subject ]</a>
              <a href="author.html#1747">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Donovan Preston wrote:
&gt;<i> 
</I>&gt;<i> On Jul 22, 2005, at 12:38 AM, Chris (FeedTagger) wrote:
</I>&gt;<i> 
</I>&gt;&gt;<i> I'm having an issue with sessions and livepage - I can't seem to get
</I>&gt;&gt;<i> the two working together. If I replace livepage.LivePage with
</I>&gt;&gt;<i> rend.Page the session works as expected... I keep refreshing and the
</I>&gt;&gt;<i> same uid appears. Why is this not the case with LivePage and how can I
</I>&gt;&gt;<i> use sessions? Neither of the examples; chatola and liveanimal use
</I>&gt;&gt;<i> sessions with livepage.
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> I don't know of any reason why there would be an issue using sessions 
</I>&gt;<i> with livepage. In fact, my &quot;Secret Project&quot; uses them. Just as an 
</I>&gt;<i> experiment, you might want to try wrapping the root resource in a 
</I>&gt;<i> nevow.guard.SessionWrapper so that you get guard's modern sessions,  not
</I>&gt;<i> the old crufty twisted-web one.
</I>
There are two problem:

1. If you expect to create a session in the middle of rendering a page
then you *must* set the buffered=True on the Page class.

    class MyPage(rend.Page):
        buffered = True
        docFactory = loader.xmlfile(...)
        def render_something(self, ctx, data):
            session = inevow.ISession(ctx)
            ...

Session are identified using a cookie. Cookies are set in the response
headers, but it's too late once any of the page content has been written.

Unfortunately, twisted.web has a bug that masks this problem. t.web
should raise an error really, but changing that now would probably break
applications (although they're arguably broken already).

2. LivePage breaks buffered anyway. LivePage overrides Page's renderHTTP
and the first thing it does is set some headers (no problem) and then
writes some content (agh!). Once that's happened, the buffered attribute
is irrelevant.

As it happens, LivePage also breaks addSlash but it's more likely that
addSlash the thing that's broken really ;-).

- Matt

-- 
     __
    /  \__     Matt Goodall, Pollenation Internet Ltd
    \__/  \    w: <A HREF="http://www.pollenation.net">http://www.pollenation.net</A>
  __/  \__/    e: <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">matt at pollenation.net</A>
 /  \__/  \    t: +44 (0)113 2252500
 \__/  \__/
 /  \	       Any views expressed are my own and do not necessarily
 \__/          reflect the views of my employer.

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001746.html">[Twisted-web] Sessions with LivePage?
</A></li>
	<LI>Next message: <A HREF="001756.html">[Twisted-web] Sessions with LivePage?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1747">[ date ]</a>
              <a href="thread.html#1747">[ thread ]</a>
              <a href="subject.html#1747">[ subject ]</a>
              <a href="author.html#1747">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
