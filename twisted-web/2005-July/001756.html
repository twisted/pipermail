<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] Sessions with LivePage?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Sessions%20with%20LivePage%3F&In-Reply-To=42E227A4.10403%40pollenation.net">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001747.html">
   <LINK REL="Next"  HREF="001757.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] Sessions with LivePage?</H1>
    <B>Chris (FeedTagger)</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Sessions%20with%20LivePage%3F&In-Reply-To=42E227A4.10403%40pollenation.net"
       TITLE="[Twisted-web] Sessions with LivePage?">chris.were at gmail.com
       </A><BR>
    <I>Sun Jul 24 20:51:10 MDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="001747.html">[Twisted-web] Sessions with LivePage?
</A></li>
        <LI>Next message: <A HREF="001757.html">[Twisted-web] Sessions with LivePage?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1756">[ date ]</a>
              <a href="thread.html#1756">[ thread ]</a>
              <a href="subject.html#1756">[ subject ]</a>
              <a href="author.html#1756">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i> &gt; I don't know of any reason why there would be an issue using sessions
</I>&gt;<i> &gt; with livepage. In fact, my &quot;Secret Project&quot; uses them. Just as an
</I>&gt;<i> &gt; experiment, you might want to try wrapping the root resource in a
</I>&gt;<i> &gt; nevow.guard.SessionWrapper so that you get guard's modern sessions,  not
</I>&gt;<i> &gt; the old crufty twisted-web one.
</I>That seemed to fix the problems - Now you've got me using guard I have
more questions ;)

How can I specify the URL to redirect to when a user logs in or logs
out? For example if i browse to /index and login, I want to be
redirected to /home. If I'm at /some-page and click logout I still
want to be at that page (not sent back to /index) - or sometimes i
will want to redirect on logout. I'm struggling to see how this is
possible at the moment.

On IRC it was suggested redirecting to the final url before logging
in, but that seems a little clumsy and just moving the problem (I also
don't know how to perform a login without using a form with
action=url.root.child(guard.LOGIN_AVATAR)). It also doesn't address
the issue of controlling the URI for logging out.

I'm working with a modified guarded.py example, but here is the portal
and Page() object I'm using (the createResource() is identical to
guarded.py)

-----------------

class MyRealm:
	&quot;&quot;&quot;A simple implementor of cred's IRealm.
		 For web, this gives us the LoggedIn page.
	&quot;&quot;&quot;
	implements(portal.IRealm)
	
	def requestAvatar(self, avatarId, mind, *interfaces):
		for iface in interfaces:
			if iface is inevow.IResource:
				# do web stuff
				if avatarId is checkers.ANONYMOUS:
					resc = Page(None)
					resc.realm = self
					return (inevow.IResource, resc, noLogout)
				else:
					resc = Page(avatarId)
					resc.realm = self
					return (inevow.IResource, resc, resc.logout)
			raise NotImplementedError(&quot;Can't support that interface.&quot;)

class Page(livepage.LivePage):
	
	def __init__(self,avatar):
		self.avatar = avatar
	
	def child_index(self,ctx):
		return IndexPage()

	def child_home(self,ctx)
		return HomePage()

	# child_xxx etc. etc.
		
	def logout(self):
		## self.original is the page's main data -- the object that was
passed in to the constructor, and
		## the object that is initially passed as the 'data' parameter to renderers
		print &quot;%s logged out!&quot; % self.original

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001747.html">[Twisted-web] Sessions with LivePage?
</A></li>
	<LI>Next message: <A HREF="001757.html">[Twisted-web] Sessions with LivePage?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1756">[ date ]</a>
              <a href="thread.html#1756">[ thread ]</a>
              <a href="subject.html#1756">[ subject ]</a>
              <a href="author.html#1756">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
