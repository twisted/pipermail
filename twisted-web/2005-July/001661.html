<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] [PATCH] Make all file extentions case-insensitive.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20%5BPATCH%5D%20Make%20all%20file%20extentions%20case-insensitive.&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001660.html">
   <LINK REL="Next"  HREF="001662.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] [PATCH] Make all file extentions case-insensitive.</H1>
    <B>Wilfredo S&#225;nchez Vega</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20%5BPATCH%5D%20Make%20all%20file%20extentions%20case-insensitive.&In-Reply-To="
       TITLE="[Twisted-web] [PATCH] Make all file extentions case-insensitive.">wsanchez at wsanchez.net
       </A><BR>
    <I>Mon Jul 11 17:48:11 MDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="001660.html">[Twisted-web] [PATCH] add content-type to error responses
</A></li>
        <LI>Next message: <A HREF="001662.html">[Twisted-web] LivePage branch complete; merged to trunk
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1661">[ date ]</a>
              <a href="thread.html#1661">[ thread ]</a>
              <a href="subject.html#1661">[ subject ]</a>
              <a href="author.html#1661">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>   The current code in static.py has a special case for Windows in  
order to deal with possible confusion in matching file extensions on  
a case-insensitive filesystem.

   That's the wrong test; a correct test would be per-filesystem, not  
per-OS.  I assume it's possible to write a case-sensitive filesystem  
on Windows (dunno, really), and there exist both case-sensitive and  
case-insensitive filesystem on a few operating systems, most  
prominently Mac OS.  (eg. They exist on Linux as well, though not as  
widely used.)

   Anyway, so the test is wrong.  Unfortunately, a correct (and not  
complicated) test isn't really obvious to anyone.

   I propose we dodge the problem by making our handling of file  
extensions (not filenames) case-insensitive, which is pretty much  
what people expect anyway: foo.TXT is the same type of file as  
foo.txt, etc.

   We simply lowercase the extensions when they are registered and  
looked up.

   This patch also gets rid of our usage of InsensitiveDict(), which  
has its detractors.

     -wsv


Index: static.py
===================================================================
--- static.py   (revision 14132)
+++ static.py   (working copy)
@@ -14,8 +14,6 @@
# Twisted Imports
from twisted.python import filepath
-from twisted.python.util import InsensitiveDict
-from twisted.python.runtime import platformType
from zope.interface import implements
dangerousPathError = http.HTTPError(responsecode.NOT_FOUND) #&quot;Invalid  
request URL.&quot;
@@ -140,7 +138,10 @@
          self.ignoredExts = list(ignoredExts)
          self.children = {}
          if processors is not None:
-            self.processors = processors
+            self.processors = dict([
+                (key.lower(), value)
+                for key, value in processors.items()
+            ])
          if indexNames is not None:
              self.indexNames = indexNames
@@ -189,12 +190,7 @@
          # Don't run processors on directories - if someone wants  
their own
          # customized directory rendering, subclass File instead.
          if fpath.isfile():
-            if platformType == &quot;win32&quot;:
-                # don't want .RPY to be different than .rpy, since that
-                # would allow source disclosure.
-                processor = InsensitiveDict(self.processors).get 
(fpath.splitext()[1])
-            else:
-                processor = self.processors.get(fpath.splitext()[1])
+            processor = self.processors.get(fpath.splitext()[1].lower 
())
              if processor:
                  return (
                      processor(fpath.path),

-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 3057 bytes
Desc: not available
Url : <A HREF="http://twistedmatrix.com/pipermail/twisted-web/attachments/20050711/05afc42c/smime.bin">http://twistedmatrix.com/pipermail/twisted-web/attachments/20050711/05afc42c/smime.bin</A>
</PRE>

























<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001660.html">[Twisted-web] [PATCH] add content-type to error responses
</A></li>
	<LI>Next message: <A HREF="001662.html">[Twisted-web] LivePage branch complete; merged to trunk
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1661">[ date ]</a>
              <a href="thread.html#1661">[ thread ]</a>
              <a href="subject.html#1661">[ subject ]</a>
              <a href="author.html#1661">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
