<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] how are solving the calls to the children in nevow?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20how%20are%20solving%20the%20calls%20to%20the%20children%20in%20nevow%3F&In-Reply-To=42CD290C.3000503%40ucd.ie">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001628.html">
   <LINK REL="Next"  HREF="001642.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] how are solving the calls to the children in nevow?</H1>
    <B>Matt Goodall</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20how%20are%20solving%20the%20calls%20to%20the%20children%20in%20nevow%3F&In-Reply-To=42CD290C.3000503%40ucd.ie"
       TITLE="[Twisted-web] how are solving the calls to the children in nevow?">matt at pollenation.net
       </A><BR>
    <I>Thu Jul  7 17:47:35 MDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="001628.html">[Twisted-web] how are solving the calls to the children in nevow?
</A></li>
        <LI>Next message: <A HREF="001642.html">[Twisted-web] how are solving the calls to the children in nevow?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1639">[ date ]</a>
              <a href="thread.html#1639">[ thread ]</a>
              <a href="subject.html#1639">[ subject ]</a>
              <a href="author.html#1639">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Alberto Trujillo wrote:

&gt;<i> Hello:
</I>&gt;<i> I have been following this example
</I>&gt;<i> &quot;<A HREF="http://nevowexamples.adytum.us/childrenhtml/&quot;to">http://nevowexamples.adytum.us/childrenhtml/&quot;to</A> know how works the
</I>&gt;<i> calls to the children with nevow, but still it's not enough clear for me.
</I>&gt;<i>
</I>&gt;<i> I even add a new child in the childFactory and some print command to
</I>&gt;<i> follow the way of the calls. Here I show you my modifications:
</I>&gt;<i>
</I>&gt;<i>    def childFactory(self, ctx, name):
</I>&gt;<i>        print &quot;NAME = &quot; + name
</I>&gt;<i>        if name in ['1', '2', '3']:
</I>&gt;<i>            return ChildPage(name)
</I>&gt;<i>        elif name == 'one':
</I>&gt;<i>            return OneRoot()
</I>&gt;<i>
</I>&gt;<i>    def locateChild(self, ctx, segments):
</I>&gt;<i>        child, remainingSegments = rend.Page.locateChild(self, ctx,
</I>&gt;<i> segments)
</I>&gt;<i>        print &quot;CHILD = &quot; + str(child) + &quot; SEGMENT = &quot; +
</I>&gt;<i> str(remainingSegments)
</I>&gt;<i>        if child:
</I>&gt;<i>            print &quot;IN THE IF&quot;
</I>&gt;<i>            return child, remainingSegments
</I>&gt;<i>
</I>&gt;<i>        return ChildPage('/'.join(segments)), []
</I>&gt;<i>
</I>&gt;<i> My question is why each time that I call to &quot;one&quot; it goes inside
</I>&gt;<i> &quot;locateChild&quot; wheter &quot;one&quot; is place in &quot;childFactory&quot;, here is a trace
</I>&gt;<i> of my server.
</I>
Only locateChild(self, context, segments) is part of the IResource API.
All the child_ and childFactory support is provided by the
rend.ChildLookupMixin class that rend.Page subclasses.

What's happening in the above code is that you have an overridden
locateChild method that calls rend.Page.locateChild.
rend.Page.locateChild does the child_ and childFactory magic and calls
your childFactory method. Your childFactory prints the NAME and returns
the child resource back to your locateChild method which then also
prints it out as CHILD.

&gt;<i>
</I>&gt;<i> 2005/07/07 13:52 IST [HTTPChannel,0,127.0.0.1] NAME = one
</I>&gt;<i> 2005/07/07 13:52 IST [HTTPChannel,0,127.0.0.1] CHILD = &lt;one.OneRoot
</I>&gt;<i> object at 0x40701eac&gt; SEGMENT = ()
</I>&gt;<i> 2005/07/07 13:52 IST [HTTPChannel,0,127.0.0.1] IN THE IF
</I>&gt;<i> 2005/07/07 13:52 IST [HTTPChannel,0,127.0.0.1] 127.0.0.1 - -
</I>&gt;<i> [07/Jul/2005:12:52:11 +0000] &quot;GET /one?id=1 HTTP/1.1&quot; 200 47
</I>&gt;<i> &quot;<A HREF="http://localhost:8080/&quot;">http://localhost:8080/&quot;</A> &quot;Mozilla/5.0 (X11; U; Linux i686; en-US;
</I>&gt;<i> rv:1.7.8) Gecko/20050517 Firefox/1.0.4 (Debian package 1.0.4-2)&quot;
</I>&gt;<i> 2005/07/07 13:52 IST [HTTPChannel,0,127.0.0.1] NAME = favicon.ico
</I>&gt;<i> 2005/07/07 13:52 IST [HTTPChannel,0,127.0.0.1] CHILD = None SEGMENT = ()
</I>&gt;<i> 2005/07/07 13:52 IST [HTTPChannel,0,127.0.0.1] 127.0.0.1 - -
</I>&gt;<i> [07/Jul/2005:12:52:11 +0000] &quot;GET /favicon.ico HTTP/1.1&quot; 200 684 &quot;-&quot;
</I>&gt;<i> &quot;Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.7.8) Gecko/20050517
</I>&gt;<i> Firefox/1.0.4 (Debian package 1.0.4-2)
</I>&gt;<i>
</I>&gt;<i> And when I return to the father, who call to childrenRoot class again,
</I>&gt;<i> and what is favicon.ico?. I show you the results here.
</I>&gt;<i>
</I>&gt;<i> 2005/07/07 13:58 IST [HTTPChannel,1,127.0.0.1] NAME = favicon.ico
</I>&gt;<i> 2005/07/07 13:58 IST [HTTPChannel,1,127.0.0.1] CHILD = None SEGMENT = ()
</I>&gt;<i> 2005/07/07 13:58 IST [HTTPChannel,1,127.0.0.1] 127.0.0.1 - -
</I>&gt;<i> [07/Jul/2005:12:58:34 +0000] &quot;GET /favicon.ico HTTP/1.1&quot; 200 684 &quot;-&quot;
</I>&gt;<i> &quot;Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.7.8) Gecko/20050517
</I>&gt;<i> Firefox/1.0.4 (Debian package 1.0.4-2)&quot;
</I>
favicon.ico is something the browsers request. It's the annoying little
icon browsers add to tabs and bookmarks. I hate it. See
&lt;<A HREF="http://en.wikipedia.org/wiki/Favicon">http://en.wikipedia.org/wiki/Favicon</A>&gt;.

&gt;<i>
</I>&gt;<i> I would like to know as well if I must to implement all these methods
</I>&gt;<i> each time that I'm working with children, and what is segments.
</I>
segments is simply a tuple of the remaining URI path segments.

A URL of <A HREF="http://localhost/foo/bar">http://localhost/foo/bar</A> has segments ('foo', 'bar'). Nevow
tries to turn those segments into child resources until there are no
more segments left. A typical sequence of events for that URL might be:

1. Nevow asks the root resource to turn 'foo' into a resource. The root
resource returns a foo resource.
2. Nevow asks the foo resource to turn 'bar' into a resource. The foo
resource returns a bar resource.
3. Nevow seems that there are all segments have been used and asks the
bar resource to render itself.

However, as you will see below the root resource could consume both
'foo' and 'bar' and return a bar resource directly.


How you choose to traverse the URI depends on what you know and need to
do ...

If you know the name of a child resource at development time and the
child resource never changes then use a child_ class attribute:

    class Page(rend.Page):
        child_css = static.File('/path/to/css')

If you know the name of a child but you need to create it in a special
way use a child_ method:

    class Page(rend.Page):
        def child_time(self, ctx):
            return TimePage(time.now())

If you don't know the name of the resource, i.e. it's a database id or
something similar, then use childFactory:

    class Page(rend.Page):
        def childFactory(self, ctx, name):
            obj = db.getObj(int(name))
            return ChildPage(obj)

Finally, if you want absolute control, i.e. to consume two URI segments
in one go, then override locateChild:

    class Page(rend.Page):
       def locateChild(self, ctx, segments):
          if segments[:2] == ('foo', 'bar'):
             return BarPage(), segments[2:]
          return rend.Page(self, ctx, segments)

Note how that example compares the first 2 segments and consumes both
'foo' and 'bar' by returning a new BarPage child and the remaining
segments - segments[2:]. Only locateChild is able to process more than
one segment at a time.

Personally, I nearly always use child_ and childFactory. I only using
locateChild for more comlpex URL traversal problems.

&gt;<i>
</I>&gt;<i> Sorry I know that are a lot of question, but I don't have access to
</I>&gt;<i> the IRC channel and I couldn't understand the information in
</I>&gt;<i> &quot;inevow.IReource&quot;. 
</I>
Hope this explains it well enough now.

Cheers, Matt

-- 
     __
    /  \__     Matt Goodall, Pollenation Internet Ltd
    \__/  \    w: <A HREF="http://www.pollenation.net">http://www.pollenation.net</A>
  __/  \__/    e: <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">matt at pollenation.net</A>
 /  \__/  \    t: +44 (0)113 2252500
 \__/  \__/
 /  \	       Any views expressed are my own and do not necessarily
 \__/          reflect the views of my employer.


</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001628.html">[Twisted-web] how are solving the calls to the children in nevow?
</A></li>
	<LI>Next message: <A HREF="001642.html">[Twisted-web] how are solving the calls to the children in nevow?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1639">[ date ]</a>
              <a href="thread.html#1639">[ thread ]</a>
              <a href="subject.html#1639">[ subject ]</a>
              <a href="author.html#1639">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
