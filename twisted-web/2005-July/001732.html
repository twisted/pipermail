<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] Freeform localisation and buttons (Was:
	Freeformdefault button label)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Freeform%20localisation%20and%20buttons%20%28Was%3A%0A%09Freeformdefault%20button%20label%29&In-Reply-To=42DC20C9.9000500%40the-moon.net">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001727.html">
   <LINK REL="Next"  HREF="001713.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] Freeform localisation and buttons (Was:
	Freeformdefault button label)</H1>
    <B>Simon Hedberg</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Freeform%20localisation%20and%20buttons%20%28Was%3A%0A%09Freeformdefault%20button%20label%29&In-Reply-To=42DC20C9.9000500%40the-moon.net"
       TITLE="[Twisted-web] Freeform localisation and buttons (Was:
	Freeformdefault button label)">simon at hedberg.net
       </A><BR>
    <I>Wed Jul 20 06:27:15 MDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="001727.html">[Twisted-web] Freeform localisation and buttons (Was: Freeform
	default button label)
</A></li>
        <LI>Next message: <A HREF="001713.html">[Twisted-web] renderInlineException - what is it for?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1732">[ date ]</a>
              <a href="thread.html#1732">[ thread ]</a>
              <a href="subject.html#1732">[ subject ]</a>
              <a href="author.html#1732">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>To follow up on this thread on button issues I want to share the
following with you. 
Since I want multiple buttons per form in my app I started digging a bit
in webform.py. I've came up with the supplied patch that makes this a
more pleasant experience by making the button renderer pick up template
patterns.
This makes buttons appear at the right place even when doing custom
layouts and also makes it possible to create patterns that use image
buttons. Have a look at the supplied example (run twistd -noy
buttonexample.py). After applying the patch the extra buttons should
appear in the right place and one of them will be in the form of the
twisted logo.

Hope this helps.
And anyone with commit access; feel free to commit the patch to trunk if
you think it's ok.

Final note: To remove the default button just exclude the form-button
slot in your custom template. In the example this is done dynamically
using a render method.

/Simon

-----Original Message-----
From: <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">twisted-web-bounces at twistedmatrix.com</A>
[mailto:<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">twisted-web-bounces at twistedmatrix.com</A>] On Behalf Of Richard Wall
Sent: den 18 juli 2005 23:36
To: Discussion of twisted.web, Nevow, and Woven
Subject: [Twisted-web] Freeform localisation and buttons (Was:
Freeformdefault button label)


On 18/07/05 19:16 Paul Reznicek wrote:
&gt;<i> I see a lot of usecases for more buttons, one I'm writing now: DB 
</I>&gt;<i> record browser/editor, where are at least
</I>&gt;<i>   [previous|next|search] + [reload|new|copy|save|delete]
</I>&gt;<i> are necessary.
</I>&gt;<i> You are right, it is possible to do this with hyperlinks,
</I>&gt;<i> but this allow users to bookmark every of this actions,
</I>&gt;<i> and to use the browser's back button with undesired effects.
</I>
Paul, you know your webapp best... but in my experience this could also
be achieved with a single submit button and supplementary hyperlinks.
Assuming that the page above is a form representing the state of a
single record...

Next / Previous - hyperlinks *because* that will allow the user to
bookmark particular pages.

Search - a submit button but associated with a separate search form.

Save - The single submit button to POST the form. Formless does an http
redirect after a successful post so the back button shouldn't be a
problem.

*Cancel - I hyperlink to the previous page or to a datagrid / index of
records. Although you didn't mention it, I think it's a good to provide
users with a way of escaping from the form.

The following would only be shown for saved records...

Reload - a hyperlink to the current resource. To discard changes made to
the data. (Although a simple &lt;input type=&quot;reset&quot;&gt; might do that

New - Hyperlink to a blank form.

Copy - Hyperlink to a form prefilled with the data of the source record,
but unsaved.

Delete - a hyperlink to a deletion confirmation page displaying the
record that is to be deleted. With a single submit button to confirm
deletion, and which http POSTs so that the deletion url cannot be
bookmarked.

&gt;<i> To extend the discussion about freeform:
</I>&gt;<i> - please also pay attention to the fact, that all labels, errors 
</I>&gt;<i> messages, tips, etc. should be easy localizable.
</I>
I've never done a foreign language site, but I can see that this would
be useful. I just tried hacking the i18n example a bit and have found
that you can use an i18n.Translator as the label, requiredFailMessage
parameters to the eg annotate.String. Have attached tgz archive of the
app. It seems really cool, but I haven't had time to figure out how to
generate the .mo files from the .po files. It would be good if that
could be done automatically when the .po files change. Maybe you'll
better understand that side of things.

&gt;<i> - error messages can vary depending on field contents: integer error 
</I>&gt;<i> is from user's point of view not a numeric error, (i.e. &quot;please enter 
</I>&gt;<i> your age as whole number&quot;)
</I>
You might get away with annotate.String(requiredFailMessage=&quot;please
enter your age as whole number&quot;)

More likely, you'll want to create your own library of formless types,
processors and renderers. For ideas see second attachement.

-- 
Richard Wall
-------------- next part --------------
A non-text attachment was scrubbed...
Name: webform.diff
Type: application/octet-stream
Size: 934 bytes
Desc: not available
Url : <A HREF="http://twistedmatrix.com/pipermail/twisted-web/attachments/20050720/bfd8eafc/webform.obj">http://twistedmatrix.com/pipermail/twisted-web/attachments/20050720/bfd8eafc/webform.obj</A>
-------------- next part --------------
#################################################################################
# Example of having more than one submit button
# Made to show the benefits of the supplied patch
# /STemplar


from zope.interface import implements

from nevow import rend
from nevow import url
from nevow import loaders
from nevow import tags as T
from nevow import inevow

from formless import annotate
from formless import webform


FORM_LAYOUT = loaders.xmlstr(&quot;&quot;&quot;&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;form xmlns:n=&quot;<A HREF="http://nevow.com/ns/nevow/0.1&quot;">http://nevow.com/ns/nevow/0.1&quot;</A> n:pattern=&quot;freeform-form&quot; enctype=&quot;multipart/form-data&quot;&gt;
  &lt;n:attr name=&quot;action&quot;&gt;&lt;n:slot name=&quot;form-action&quot;/&gt;&lt;/n:attr&gt;
  &lt;n:attr name=&quot;id&quot;&gt;&lt;n:slot name=&quot;form-id&quot;/&gt;&lt;/n:attr&gt;
  &lt;n:attr name=&quot;name&quot;&gt;&lt;n:slot name=&quot;form-name&quot;/&gt;&lt;/n:attr&gt;
  &lt;n:attr name=&quot;method&quot;&gt;post&lt;/n:attr&gt;
  &lt;p&gt;&lt;strong&gt;&lt;n:slot name=&quot;form-label&quot;/&gt;&lt;/strong&gt;&lt;/p&gt;
  &lt;p&gt;&lt;em&gt;&lt;n:slot name=&quot;form-description&quot;/&gt;&lt;/em&gt;&lt;/p&gt;
  &lt;p&gt;&lt;strong&gt;&lt;em&gt;&lt;n:slot name=&quot;form-error&quot;/&gt;&lt;/em&gt;&lt;/strong&gt;&lt;/p&gt;
    &lt;table id=&quot;form-table&quot;&gt;
        &lt;n:slot name=&quot;form-arguments&quot;/&gt;
        &lt;n:invisible n:render=&quot;formbutton&quot;&gt;
            &lt;n:slot name=&quot;form-button&quot;/&gt;
        &lt;/n:invisible&gt;
    &lt;/table&gt;
    &lt;n:invisible n:pattern=&quot;argument&quot;&gt;
       &lt;tr&gt;
           &lt;td&gt;
           &lt;n:slot name=&quot;label&quot;/&gt;
           &lt;/td&gt;
           &lt;td&gt;
           &lt;n:slot name=&quot;input&quot;/&gt;&lt;span class=&quot;freeform-error&quot;&gt;&lt;n:slot name=&quot;error&quot;/&gt;&lt;/span&gt;
           &lt;n:slot name=&quot;description&quot;/&gt;
           &lt;/td&gt;
       &lt;/tr&gt;
    &lt;/n:invisible&gt;
    &lt;n:invisible n:pattern=&quot;argument!!action2&quot;&gt;
       &lt;tr&gt;
           &lt;td&gt;
           &lt;n:slot name=&quot;label&quot;/&gt;
           &lt;/td&gt;
           &lt;td&gt;
           &lt;input type=&quot;image&quot; widht=&quot;155&quot; height=&quot;24&quot; src=&quot;<A HREF="http://twistedmatrix.com/images/header-logo.png&quot;">http://twistedmatrix.com/images/header-logo.png&quot;</A>&gt;
               &lt;n:attr name=&quot;name&quot;&gt;&lt;n:slot name=&quot;name&quot;/&gt;&lt;/n:attr&gt;
               &lt;n:attr name=&quot;value&quot;&gt;&lt;n:slot name=&quot;value&quot;/&gt;&lt;/n:attr&gt;
           &lt;/input&gt;
           &lt;n:slot name=&quot;description&quot;/&gt;
           &lt;/td&gt;
       &lt;/tr&gt;
    &lt;/n:invisible&gt;
    &lt;n:invisible n:pattern=&quot;form-button&quot;&gt;
        &lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;n:slot name=&quot;input&quot;/&gt;&lt;/td&gt;
    &lt;/n:invisible&gt;
&lt;/form&gt;
&quot;&quot;&quot;      ).load()
css = &quot;&quot;&quot;
.freeform-radio-option {margin-left:0px;}
&quot;&quot;&quot;
class Root(rend.Page):
    &quot;&quot;&quot;Render a custom and normal form for an ISomething.
    &quot;&quot;&quot;       
    addSlash = True
    _showbutton = True
    
    child_webform_css = webform.defaultCSS
    
    def render_normalForm(self, ctx, data):
        return webform.renderForms()
    
    def render_customForm(self, ctx, data):
        return webform.renderForms()[FORM_LAYOUT]
    
    def doSomething(self, ctx, **kwargs):
        if kwargs.get('defaultbutton'): #Switch the value of self._showbutton
            self._showbutton = [1,0][self._showbutton==1]
        btn = &quot;default&quot;
        if kwargs.get('action1'):
           btn = &quot;action1&quot; 
        elif kwargs.get('action2'):
           btn = &quot;action2&quot; 
        return [T.p['You clicked the %s button.'%btn],T.p['doSomething called with: %s' %kwargs]]
    
    def bind_doSomething(self, ctx):
        return [
            ( 'ctx', annotate.Context() ),
            ( 'fee', annotate.String(description=&quot;Wee!&quot;) ),
            ( 'fi', annotate.Integer(description=&quot;Tra-la-la&quot;) ),
            ( 'fo', annotate.Text() ),
            ( 'fum', annotate.String()),
            ( 'defaultbutton', annotate.Radio(choices=lambda x,y:[('Show',),('Hide',)][self._showbutton])),
            ( 'action1', annotate.Button()),
            ( 'action2', annotate.Button())]
    
    def render_formbutton(self,ctx,data):
        if self._showbutton:
            return ctx.tag
        else:
            return ''
            
    def render_hand(self, ctx, data):
        hand = inevow.IHand(ctx, default=None)
        if hand is not None:
            return ctx.tag[hand]
        return ''
        
    docFactory = loaders.stan(
        T.html[
            T.head[
                T.title['Example :: Custom Form Layout'],
                T.link(rel='stylesheet', type='text/css', href=url.here.child(&quot;webform_css&quot;)),
                T.style[css],
                ],
            T.body[T.p(render=T.directive(&quot;hand&quot;)),
                T.h1['Custom'],
                render_customForm,
                T.h1['Default'],
                render_normalForm,
                ]
            ]
        )

from twisted.application import internet, service
from nevow import appserver
application = service.Application('buttontest')
webServer = internet.TCPServer(8080, appserver.NevowSite(Root()))
webServer.setServiceParent(application)
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001727.html">[Twisted-web] Freeform localisation and buttons (Was: Freeform
	default button label)
</A></li>
	<LI>Next message: <A HREF="001713.html">[Twisted-web] renderInlineException - what is it for?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1732">[ date ]</a>
              <a href="thread.html#1732">[ thread ]</a>
              <a href="subject.html#1732">[ subject ]</a>
              <a href="author.html#1732">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
