<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] Accessing request object from a SOAPPublisher soap_
	method
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Accessing%20request%20object%20from%20a%20SOAPPublisher%20soap_%0A%09method&In-Reply-To=B3007648-63A7-4D60-AC04-9639AF84460E%40ulaluma.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001665.html">
   <LINK REL="Next"  HREF="001637.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] Accessing request object from a SOAPPublisher soap_
	method</H1>
    <B>Jonathan Blocksom</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Accessing%20request%20object%20from%20a%20SOAPPublisher%20soap_%0A%09method&In-Reply-To=B3007648-63A7-4D60-AC04-9639AF84460E%40ulaluma.com"
       TITLE="[Twisted-web] Accessing request object from a SOAPPublisher soap_
	method">jblocksom at gsti3d.com
       </A><BR>
    <I>Tue Jul 12 08:57:13 MDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="001665.html">[Twisted-web] Accessing request object from a SOAPPublisher soap_
	method
</A></li>
        <LI>Next message: <A HREF="001637.html">[Twisted-web] Turkey Questions 1-5
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1671">[ date ]</a>
              <a href="thread.html#1671">[ thread ]</a>
              <a href="subject.html#1671">[ subject ]</a>
              <a href="author.html#1671">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Thanks for the reply, I've been meaning to post a followup with what I 
wound up doing, which is along the lines of your second suggestion.

I modified the SOAPPublisher class render() method so that if the 
calling convention was keywords it added a keyword &quot;request&quot; with the 
HTTP reqeust object as the value.  I did this before the arguments from 
the message are put into the dict so that if there happened to be an 
argument named request it would still be okay (assuming you didn't want 
to look at the request object).

But thinking about the problem got me to wonder if my method really 
should have access to the request object.  It seems to me that it breaks 
the encapsulation in a fairly bad way.  I'm curious if other SOAP 
libraries in other languages give access to the HTTP requests along with 
the message.

I wound up deciding that I would have the originator of the message send 
along the information instead of trying to gather it from the header. 
The information was just the IP address of the sender (although my app 
won't work across NAT firewalls now, but that's ok).

Jonathan

Donovan Preston wrote:
&gt;<i> 
</I>&gt;<i> On Jul 7, 2005, at 10:26 AM, Jonathan Blocksom wrote:
</I>&gt;<i> 
</I>&gt;&gt;<i> Hi, I've got a SOAPPublisher class with some published methods and  I 
</I>&gt;&gt;<i> was hoping to access the HTTP request object from within.   Anybody 
</I>&gt;&gt;<i> know how to do this?
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Unfortunately it doesn't look like it. If you look at the  
</I>&gt;<i> SOAPPublisher.render method, it looks up the callable and then calls  it 
</I>&gt;<i> (indirecting through maybeDeferred). The only place the request is  
</I>&gt;<i> available is in the local namespace of render. So, you could:
</I>&gt;<i> 
</I>&gt;<i> 1) override render, stuff the request somewhere (like self), then get  
</I>&gt;<i> it out in your method; you should only do this if threads are in no  way 
</I>&gt;<i> involved. If there aren't any threads then it would be safe. Just  be 
</I>&gt;<i> sure to get it out immediately and pass around what you got out  (for 
</I>&gt;<i> example, don't return a deferred then look in self in a callback)
</I>&gt;<i> 
</I>&gt;<i> 2) use some horrible callframe hack to extract the request from the  
</I>&gt;<i> caller's frame. This would have the advantage of being threadsafe,  but 
</I>&gt;<i> you aren't using threads anyway -- right?
</I>&gt;<i> 
</I>&gt;<i> Itamar is the guy to talk to about SOAP and XMLRPC, but I guess he  
</I>&gt;<i> doesn't read this list. If you want to have a cleaner way of doing  this 
</I>&gt;<i> in the future, you should probably talk to him about it, either  on IRC 
</I>&gt;<i> or through email or something.
</I>&gt;<i> 
</I>&gt;<i> Donovan
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-web mailing list
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">Twisted-web at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web</A>
</I>&gt;<i> 
</I>

</PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001665.html">[Twisted-web] Accessing request object from a SOAPPublisher soap_
	method
</A></li>
	<LI>Next message: <A HREF="001637.html">[Twisted-web] Turkey Questions 1-5
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1671">[ date ]</a>
              <a href="thread.html#1671">[ thread ]</a>
              <a href="subject.html#1671">[ subject ]</a>
              <a href="author.html#1671">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
