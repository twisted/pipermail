<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] documentation -- Techno Turkey's fifth adventure
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20documentation%20--%20Techno%20Turkey%27s%20fifth%20adventure&In-Reply-To=20060703151807.29014.2063861995.divmod.quotient.20836%40ohm">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002758.html">
   <LINK REL="Next"  HREF="002820.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] documentation -- Techno Turkey's fifth adventure</H1>
    <B>lloyd at paisite.com</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20documentation%20--%20Techno%20Turkey%27s%20fifth%20adventure&In-Reply-To=20060703151807.29014.2063861995.divmod.quotient.20836%40ohm"
       TITLE="[Twisted-web] documentation -- Techno Turkey's fifth adventure">lloyd at paisite.com
       </A><BR>
    <I>Sat Jul 15 14:40:24 CDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="002758.html">[Twisted-web] Thoughts on documentation, wading into Twisted,
	Nevow, etc.
</A></li>
        <LI>Next message: <A HREF="002820.html">[Twisted-web] documentation -- Techno Turkey's fifth adventure
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2809">[ date ]</a>
              <a href="thread.html#2809">[ thread ]</a>
              <a href="subject.html#2809">[ subject ]</a>
              <a href="author.html#2809">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Folks,

Here's a rough first draft of Techno Turkey's latest adventure. I've tried
to capture and integrate both Valentino and Daniel's ideas, but if I've
missed or misrepresented anything, please advise.

I haven't had a chance yet to finish setting up my own Twisted development
environment, so I haven't been able to test it. In preparing to set up my
environment, however, I realized that there may be conventions in the
community (directory layout and naming, for example) that would be very
helpful for turkey's like me.

So I've left a hole in the Turkey script for a link to a page (yet to be
written) that lay's out best practices for down-loading Twisted/Nevow and
setting up a productive development environment. My thought was that we
could put this page on the Turkey site, or elsewhere in the Twisted/Nevow
docs, then I could simply link to it from whereever appropriate in Turkey
scripts.

Anybody around to help me write the page? Or, if such a page already
exists, please point me to it.

Best wishes,

Lloyd

PS: I've been reviewing current Twisted/Nevow documentation. Much much
better than I remember from last year. Nevow tutorial is excellent.

So here's... Techno Turkey


Dialtone's Resource Magic


&quot;It's magic!&quot; said Techno Turkey.

&quot;What's magic?&quot; asked Twisted Wizard Daniel.

&quot;I just type it in at the top of my browser and... shazamm... back comes
just the page I'm looking for -- could be from anywhere in the world. It's
like casting a magic spell.&quot;

&quot;It's far more magical than you think,&quot; says Twisted Wizard Daniel. &quot;Just
consider it's name: 'Uniform Resource Identifier' -- URI.&quot;

&quot;I thought it was a URL,&quot; said Turkey.

&quot;That was before people understood it's full mojo. Back then they called
it a 'Uniform Resource Locator.' But then they realized that it could be
used to identify anything in cyberspace.&quot;

&quot;Anything?&quot; asked Turkey.

&quot;Sure, anything. We use URI's to identify servers, webpages, web services,
images, sound files...&quot;

&quot;But the only thing I ever get back are webpages.&quot;

&quot;That's because that's what static HTTP webservers do. They listen for
their designated URI and return the specified HTML web page. But aided by
the right software, they can return anything of a digital nature.&quot;

Twisted Wizard Dialtone happened to be listening in.

&quot;Hey, Turkey old bird,&quot; said Daniel, &quot;Want to see my Resource magic?&quot;

&quot;The bird's computer got trashed by an electrical storm, remember,&quot; said
Daniel.

&quot;No surge protection? No backup?&quot;

&quot;Don't rub it in,&quot; said Turkey.

&quot;Never mind, here's how get back up and running again...&quot;

***************

Need link here to step-by-step load and set up instructions for Twisted and
Nevow from both Twisted/Nevow sites and Debian.

Download Twisted from: <A HREF="http://twistedmatrix.com/products/download">http://twistedmatrix.com/products/download</A>
Download Nevow from: <A HREF="http://divmod.org/trac/wiki/DivmodNevow#Download">http://divmod.org/trac/wiki/DivmodNevow#Download</A>

Debian users can get the latest alpha, rc, or release by adding the
following to their /etc/apt/sources.list:

    Woody: deb <A HREF="http://twisted.sourceforge.net/debian/woody/">http://twisted.sourceforge.net/debian/woody/</A> ./
        Sid/Sarge: deb <A HREF="http://twisted.sourceforge.net/debian/">http://twisted.sourceforge.net/debian/</A> ./

Once downloaded:

-- how to find Twisted and Nevow source directories
-- how to set up development environment
-- how to set up working directories -- user source, logs,
-- how to set up path variables
-- how to test development environment

Should be sufficiently detailed that even the slowest turkey on the farm
can implement.

Anybody up for fleshing in details for this page? I can edit, put it up on
the Turkey server, and link it into Turkey adventures.

***************

&quot;Now, create a file called ResourceMagic.py in your Twisted source
directoy, and enter the following code:&quot;


from zope.interface import implements

from nevow import inevow

##
## How does a request come to the Resource?
##
## or How to use Nevow without all the fancy automations
##

class Root(object):
    # This is a simple resource, representing the root, or top-most

    # resource of this site.  The inevow.IResource interface
    # tells us that it must implement two methods:
    # locateChild and renderHTTP.
    # locateChild is used to find children of the current resource.  It must
    # return a tuple of (resource, remaining_segments).  If no child resource
    # exists at this location, you may return nevow.rend.NotFound.&quot;
    # For more information see:
    # <A HREF="http://divmod.org/users/exarkun/nevow-doc/nevow-traversal.html">http://divmod.org/users/exarkun/nevow-doc/nevow-traversal.html</A>
    implements(inevow.IResource)

    def locateChild(self, ctx, segments):
        # This locateChild is 'stupid' since it can only work if the tree of
        # resources is static. But it will work for our simple example
        if segments[0] == '':
            # If the server is looking for the root resource segments will
be ('',)
            # then renderHTTP will be called on self
            return self, ()
        elif segments[0] == 'foo':
            # Now we received a request whose segments had in the first
position
            # the string foo like <A HREF="http://example.org/foo/baz/">http://example.org/foo/baz/</A> -&gt; ('foo',
'baz').
            # After the resource has been located we return it with the
remaining segments
            # ('baz')
            return self.foo, segments[1:]

        else:
            return None, ()

    def renderHTTP(self, ctx):
        # When the server needs to return a response to the request it
will call
        # the renderHTTP method that will return a string of what needs to
be sent.
        def renderHTTP(self, ctx):
            return &quot;&quot;&quot;&lt;html&gt;&lt;body&gt;Hello, world!&lt;br /&gt;&quot;&quot;&quot;

class Foo(object):
    implements(inevow.IResource)

    def locateChild(self, ctx, segments):
        # segments is the remaining segments returned by the root locateChild
        # see segments[1:]
        if segments[0] == 'baz':
            return self.baz, segment[1:]
        else:
            return None, ()

    def renderHTTP(self, ctx):
        return &quot;&quot;&quot;&lt;html&gt;&lt;body&gt;&lt;h1 id=&quot;heading&quot;&gt;You are in Foo&lt;/h1&gt;
        &lt;a href=&quot;./foo/baz&quot; id=&quot;baz&quot;&gt;baz&lt;/a&gt;&lt;/body&gt;&lt;/html&gt;
&quot;&quot;&quot;

class Baz(object):
    implements(inevow.IResource)
    def locateChild(self, ctx, segments):
        return None, ()
    def renderHTTP(self, ctx):
        return '&lt;html&gt;&lt;body&gt;&lt;h1 id=&quot;heading&quot;&gt;You are in
Baz&lt;/h1&gt;&lt;/body&gt;&lt;/html&gt;'

# We are adding children to the resources.
# This could also happen inside the class.
root = Root()
root.foo = Foo()
root.foo.baz = Baz()


&quot;Note,&quot; said Dialtone, &quot;That this is the IResource interface from Nevow;
not the one from twisted.web.&quot;

&quot;So now what?&quot; said Turkey.

&quot;At the end of your ResourceMagic.py source file enter:&quot;

from twisted.internet import reactor
from nevow import appserver
site = appserver.NevowSite(root)
reactor.listenTCP(8080, site)

&quot;Hey, I recognize the reactor bit from earlier adventures, &quot; said
Turkey, &quot;But what's this 'nevow?'&quot;

&quot;Nevow is a web-application construction kit written in Python. Check out
<A HREF="http://divmod.org/trac/wiki/DivmodNevow.">http://divmod.org/trac/wiki/DivmodNevow.</A> But let's keep our eye on the
ball here...

&quot;To cast the spell, just save the ResourceMagic.py file and enter at the
console prompt:&quot;

python ResourceMagic.py

&quot;Then point your browser to:&quot;

<A HREF="http://localhost:8080/">http://localhost:8080/</A>

&quot;Wait,&quot; said Turkey, &quot;Before we run it, I'm still confused by this word
'Resource.' When you say, 'Resource,' are you talking about web pages?&quot;

&quot;Could be,&quot; said Daniel. &quot;But there are many more kinds of Resources than
webpages. A Resource is anything that a URI happens to point to --
anything in cyberspace.&quot;

&quot;Well, at least,&quot; said Dialtone, &quot;Anything available through the
designated server.&quot;

&quot;Like my favorite Radiohead MP3?&quot; said Turky.

&quot;Anything that gets you through the day,&quot; said Daniel. &quot;For more info,
check out:&quot;

<A HREF="http://en.wikipedia.org/wiki/Resource_(Web">http://en.wikipedia.org/wiki/Resource_(Web</A>)

&quot;...or:&quot;

<A HREF="http://en.wikipedia.org/wiki/Representational_State_Transfer#Resources">http://en.wikipedia.org/wiki/Representational_State_Transfer#Resources</A>

&quot;OK,&quot; said Turkey, turning to Dialtone. &quot;How's this magic spell of yours
supposed to work?&quot;

&quot;Well let's run it and see...&quot;


Another way to run the code

Another way to run Dialtone's code uses the tac file approach. Replace
the lines:

from twisted.internet import reactor
from nevow import appserver
site = appserver.NevowSite(root)
reactor.listenTCP(8080, site)

with

from twisted.application import strports, service from nevow import
appserver application = service.Application('example') website =
appserver.NevowSite(root) webservice = strports.service('8080', website)
webservice.setServiceParent(application)

Now, at your browser prompt, enter:

twistd -noy myscript.tac

And point your browser to:

<A HREF="http://localhost:8080/">http://localhost:8080/</A>


Anticipated Results:

You should see a root page with &quot;Hello, world!,&quot; and a link to a child page
named &quot;foo.&quot; Any other url except the one with the child foo will result
in a 404.

If you go in the foo child you'll see a page with the content &quot;you are in
foo&quot; and a link to foo's child page baz. Any other child page will result
in a 404.

If you go in the baz child you'll see a page with the content &quot;you are in
baz.&quot; This page has no children and any other url will result in a 404.

How does it work?

Nevow is fundamentally based on the following  request processing schema:

arrives request \
--&gt; root resource \
--&gt; root.locateChild(url segments)
. child_resource.locateChild(url segments[1:])
. child_resource2.locateChild(url segments[2:])
. so forth until url segments == ()
==&gt; FOUND RIGHT RESOURCE
==&gt; RIGHT_RESOURCE.renderHTTP()  \

Where to go from here

Contrast Dialtone's code with Matt Goodall's Barebnes Dynamic Web Server in
Turkey's fourth adventure. Then review:

<A HREF="http://divmod.org/users/exarkun/nevow-doc/nevow-intro.html">http://divmod.org/users/exarkun/nevow-doc/nevow-intro.html</A>






-------------- next part --------------
A non-text attachment was scrubbed...
Name: TTResource
Type: application/octet-stream
Size: 8316 bytes
Desc: not available
Url : <A HREF="http://twistedmatrix.com/pipermail/twisted-web/attachments/20060715/a4afac78/TTResource.obj">http://twistedmatrix.com/pipermail/twisted-web/attachments/20060715/a4afac78/TTResource.obj</A>
</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002758.html">[Twisted-web] Thoughts on documentation, wading into Twisted,
	Nevow, etc.
</A></li>
	<LI>Next message: <A HREF="002820.html">[Twisted-web] documentation -- Techno Turkey's fifth adventure
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2809">[ date ]</a>
              <a href="thread.html#2809">[ thread ]</a>
              <a href="subject.html#2809">[ subject ]</a>
              <a href="author.html#2809">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
