<tt>
&lt;div&nbsp;id=&quot;RTEContent&quot;&gt;Hi&nbsp;Paul,&lt;br&gt;&nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;Thanks&nbsp;for&nbsp;your&nbsp;help.&nbsp;However&nbsp;it&nbsp;seems&nbsp;doesn't&nbsp;work.&nbsp;When&nbsp;I&nbsp;press&nbsp;Ctrl-C,&nbsp;it&nbsp;even&nbsp;doesn't&nbsp;call&nbsp;the&nbsp;stopService()&nbsp;function.&nbsp;I&nbsp;print&nbsp;a&nbsp;&quot;Hello&nbsp;World&quot;&nbsp;inside&nbsp;the&nbsp;function&nbsp;but&nbsp;it&nbsp;doesn't&nbsp;say&nbsp;hello&nbsp;to&nbsp;the&nbsp;world.&nbsp;And&nbsp;I've&nbsp;tried&nbsp;returning&nbsp;a&nbsp;Deferred&nbsp;from&nbsp;this&nbsp;function.&nbsp;However&nbsp;it&nbsp;quit&nbsp;before&nbsp;the&nbsp;callback&nbsp;is&nbsp;called.&nbsp;Can&nbsp;u&nbsp;give&nbsp;advice&nbsp;on&nbsp;this?&nbsp;Do&nbsp;u&nbsp;know&nbsp;where&nbsp;can&nbsp;I&nbsp;find&nbsp;some&nbsp;example&nbsp;about&nbsp;this?&nbsp;Thanks&nbsp;a&nbsp;lot.&lt;br&gt;&nbsp;&lt;br&gt;&nbsp;Snow&nbsp;Dragon&lt;br&gt;&lt;br&gt;&lt;b&gt;&lt;i&gt;Jean-Paul&nbsp;Calderone&nbsp;&amp;lt;exarkun@divmod.com&amp;gt;&lt;/i&gt;&lt;/b&gt;&nbsp;弧G&lt;blockquote&nbsp;class=&quot;replbq&quot;&nbsp;style=&quot;border-left:&nbsp;2px&nbsp;solid&nbsp;rgb(16,&nbsp;16,&nbsp;255);&nbsp;margin-left:&nbsp;5px;&nbsp;padding-left:&nbsp;5px;&quot;&gt;&nbsp;On&nbsp;Fri,&nbsp;2&nbsp;Dec&nbsp;2005&nbsp;12:54:48&nbsp;+0800&nbsp;(CST),&nbsp;Suet&nbsp;Lung&nbsp;Cheung&nbsp;&lt;suetlung2003&nbsp;@yahoo.com.hk=&quot;&quot;&gt;&nbsp;wrote:&lt;br&gt;&amp;gt;&nbsp;&nbsp;Hi&nbsp;everyone,&lt;br&gt;&amp;gt;&lt;br&gt;&amp;gt;&nbsp;I&nbsp;am&nbsp;writing&nbsp;a&nbsp;TCP&nbsp;server&nbsp;program&nbsp;using&nbsp;twisted.&nbsp;I&nbsp;cannot&nbsp;use&nbsp;pb&nbsp;since&nbsp;the&nbsp;client&nbsp;side&nbsp;is&nbsp;not&nbsp;in&nbsp;python.&nbsp;I&nbsp;decided&nbsp;to&nbsp;use&nbsp;twisted.application&nbsp;and&nbsp;run&nbsp;it&nbsp;as&nbsp;internet.TCPServer(...).&nbsp;My&nbsp;problem&nbsp;is&nbsp;that&nbsp;I<br>
&nbsp;want&nbsp;to&nbsp;make&nbsp;it&nbsp;save&nbsp;something&nbsp;to&nbsp;a&nbsp;database&nbsp;whenever&nbsp;a&nbsp;connection&nbsp;closed.&nbsp;I&nbsp;do&nbsp;this&nbsp;in&nbsp;returning&nbsp;a&nbsp;deferred&nbsp;under&nbsp;Protocol.connectionLost().&nbsp;I&nbsp;would&nbsp;like&nbsp;to&nbsp;make&nbsp;this&nbsp;work&nbsp;when&nbsp;the&nbsp;server&nbsp;is&nbsp;shut&nbsp;down.&nbsp;However&nbsp;when&nbsp;the&nbsp;server&nbsp;is&nbsp;down,&nbsp;it&nbsp;doesn't&nbsp;wait&nbsp;for&nbsp;the&nbsp;deferred&nbsp;to&nbsp;finish&nbsp;the&nbsp;callback&nbsp;and&nbsp;quit.&nbsp;I&nbsp;would&nbsp;like&nbsp;to&nbsp;make&nbsp;it&nbsp;save&nbsp;to&nbsp;db&nbsp;as&nbsp;normal&nbsp;but&nbsp;the&nbsp;server&nbsp;will&nbsp;wait&nbsp;for&nbsp;all&nbsp;deferred&nbsp;has&nbsp;called&nbsp;back.&nbsp;Is&nbsp;there&nbsp;anyway&nbsp;I&nbsp;can&nbsp;do&nbsp;this?&nbsp;Any&nbsp;suggestions?&nbsp;Thanks&nbsp;a&nbsp;lot&lt;br&gt;&lt;br&gt;Services&nbsp;receive&nbsp;shutdown&nbsp;notification&nbsp;via&nbsp;their&nbsp;stopService()&nbsp;method.&nbsp;The&nbsp;method&nbsp;is&nbsp;called&nbsp;all&nbsp;the&nbsp;way&nbsp;down&nbsp;the&nbsp;service&nbsp;hierarchy&nbsp;when&nbsp;a&nbsp;twistd&nbsp;process&nbsp;is&nbsp;preparing&nbsp;to&nbsp;terminate.&nbsp;If&nbsp;a&nbsp;stopService()&nbsp;method&nbsp;returns&nbsp;a&nbsp;Deferred,&nbsp;the&nbsp;Deferred&nbsp;will&nbsp;be&nbsp;allowed&nbsp;to&nbsp;fire&nbsp;before&nbsp;shutdown&nbsp;completes.&nbsp;So&nbsp;you&nbsp;probably&nbsp;want&nbsp;a&nbsp;custom&nbsp;Service&nbsp;implementation&nbsp;which&nbsp;knows&nbsp;about&nbsp;the&nbsp;Deferreds&nbsp;from&nbsp;your&nbsp;connectionLost()&nbsp;and&nbsp;can&nbsp;return&nbsp;them&nbsp;from&nbsp;stopService()&nbsp;if<br>
&nbsp;necessary.&lt;br&gt;&lt;br&gt;Jean-Paul&lt;br&gt;&lt;br&gt;_______________________________________________&lt;br&gt;Twisted-web&nbsp;mailing&nbsp;list&lt;br&gt;Twisted-web@twistedmatrix.com&lt;br&gt;http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web&lt;br&gt;&lt;/suetlung2003&gt;&lt;/blockquote&gt;&lt;br&gt;&lt;/div&gt;&lt;p&gt;_______________________________________&lt;br&gt;&nbsp;x息&nbsp;-&nbsp;Yahoo!&nbsp;Messenger&lt;br&gt;&nbsp;就算你]有上W，你的朋友仍可以留下息o你，你上Wr就能立即看到，任何f都幼呤А&lt;br&gt;&nbsp;&nbsp;http://messenger.yahoo.com.hk&nbsp;
</tt>
