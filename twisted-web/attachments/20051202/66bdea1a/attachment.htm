<tt>
&lt;div&nbsp;id=&quot;RTEContent&quot;&gt;&amp;nbsp;&nbsp;Hi&nbsp;everyone,&lt;br&gt;&nbsp;&nbsp;&lt;br&gt;&nbsp;I&nbsp;am&nbsp;writing&nbsp;a&nbsp;TCP&nbsp;server&nbsp;program&nbsp;using&nbsp;twisted.&nbsp;I&nbsp;cannot&nbsp;use&nbsp;pb&nbsp;since&nbsp;the&nbsp;client&nbsp;side&nbsp;is&nbsp;not&nbsp;in&nbsp;python.&nbsp;I&nbsp;decided&nbsp;to&nbsp;use&nbsp;twisted.application&nbsp;and&nbsp;run&nbsp;it&nbsp;as&nbsp;internet.TCPServer(...).&nbsp;My&nbsp;problem&nbsp;is&nbsp;that&nbsp;I&nbsp;want&nbsp;to&nbsp;make&nbsp;it&nbsp;save&nbsp;something&nbsp;to&nbsp;a&nbsp;database&nbsp;whenever&nbsp;a&nbsp;connection&nbsp;closed.&nbsp;I&nbsp;do&nbsp;this&nbsp;in&nbsp;returning&nbsp;a&nbsp;deferred&nbsp;under&nbsp;Protocol.connectionLost().&nbsp;I&nbsp;would&nbsp;like&nbsp;to&nbsp;make&nbsp;this&nbsp;work&nbsp;when&nbsp;the&nbsp;server&nbsp;is&nbsp;shut&nbsp;down.&nbsp;However&nbsp;when&nbsp;the&nbsp;server&nbsp;is&nbsp;down,&nbsp;it&nbsp;doesn't&nbsp;wait&nbsp;for&nbsp;the&nbsp;deferred&nbsp;to&nbsp;finish&nbsp;the&nbsp;callback&nbsp;and&nbsp;quit.&nbsp;I&nbsp;would&nbsp;like&nbsp;to&nbsp;make&nbsp;it&nbsp;save&nbsp;to&nbsp;db&nbsp;as&nbsp;normal&nbsp;but&nbsp;the&nbsp;server&nbsp;will&nbsp;wait&nbsp;for&nbsp;all&nbsp;deferred&nbsp;has&nbsp;called&nbsp;back.&amp;nbsp;&nbsp;Is&nbsp;there&nbsp;anyway&nbsp;I&nbsp;can&nbsp;do&nbsp;this?&nbsp;Any&nbsp;suggestions?&nbsp;Thanks&nbsp;a&nbsp;lot&lt;br&gt;&nbsp;&nbsp;&lt;br&gt;&nbsp;&nbsp;Snow&nbsp;Dragon&lt;/div&gt;&lt;p&gt;_______________________________________&lt;br&gt;&nbsp;x息&nbsp;-&nbsp;Yahoo!&nbsp;Messenger&lt;br&gt;&nbsp;就算你]有上W，你的朋友仍可以留下息o你，你上Wr就能立即看到，任何f都幼呤А&lt;br&gt;&nbsp;&nbsp;http://messenger.yahoo.com.hk&nbsp;
</tt>
