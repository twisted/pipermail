<tt>
&lt;html&gt;&lt;head&gt;&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html&nbsp;charset=us-ascii&quot;&gt;&lt;/head&gt;&lt;body&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;-webkit-line-break:&nbsp;after-white-space;&quot;&gt;&lt;br&gt;&lt;div&gt;&lt;div&gt;On&nbsp;Feb&nbsp;26,&nbsp;2013,&nbsp;at&nbsp;10:05&nbsp;AM,&nbsp;Peter&nbsp;Westlake&nbsp;&amp;lt;&lt;a&nbsp;href=&quot;mailto:peter.westlake@pobox.com&quot;&gt;peter.westlake@pobox.com&lt;/a&gt;&amp;gt;&nbsp;wrote:&lt;/div&gt;&lt;br&nbsp;class=&quot;Apple-interchange-newline&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&nbsp;style=&quot;letter-spacing:&nbsp;normal;&nbsp;orphans:&nbsp;auto;&nbsp;text-align:&nbsp;start;&nbsp;text-indent:&nbsp;0px;&nbsp;text-transform:&nbsp;none;&nbsp;white-space:&nbsp;normal;&nbsp;widows:&nbsp;auto;&nbsp;word-spacing:&nbsp;0px;&nbsp;-webkit-text-size-adjust:&nbsp;auto;&nbsp;-webkit-text-stroke-width:&nbsp;0px;&quot;&gt;On&nbsp;Sun,&nbsp;Jan&nbsp;6,&nbsp;2013,&nbsp;at&nbsp;20:22,&lt;span&nbsp;class=&quot;Apple-converted-space&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;a&nbsp;href=&quot;mailto:exarkun@twistedmatrix.com&quot;&gt;exarkun@twistedmatrix.com&lt;/a&gt;&lt;span&nbsp;class=&quot;Apple-converted-space&quot;&gt;&amp;nbsp;&lt;/span&gt;wrote:&lt;br&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;On&nbsp;12:48&nbsp;am,&lt;span&nbsp;class=&quot;Apple-converted-space&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;a&nbsp;href=&quot;mailto:peter.westlake@pobox.com&quot;&gt;peter.westlake@pobox.com&lt;/a&gt;&lt;span&nbsp;class=&quot;Apple-converted-space&quot;&gt;&amp;nbsp;&lt;/span&gt;wrote:&lt;br&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;On&nbsp;Fri,&nbsp;Jan&nbsp;4,&nbsp;2013,&nbsp;at&nbsp;19:58,&lt;span&nbsp;class=&quot;Apple-converted-space&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;a&nbsp;href=&quot;mailto:exarkun@twistedmatrix.com&quot;&gt;exarkun@twistedmatrix.com&lt;/a&gt;&lt;span&nbsp;class=&quot;Apple-converted-space&quot;&gt;&amp;nbsp;&lt;/span&gt;wrote:&lt;br&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;...&lt;br&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;Codespeed&nbsp;cannot&nbsp;handle&nbsp;more&nbsp;than&nbsp;one&nbsp;result&nbsp;per&nbsp;benchmark.&lt;br&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;The&nbsp;`timeit`&nbsp;module&nbsp;is&nbsp;probably&nbsp;not&nbsp;suitable&nbsp;to&nbsp;use&nbsp;to&nbsp;collect&nbsp;the&nbsp;data&lt;br&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;&lt;/blockquote&gt;.....&lt;br&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;What&nbsp;method&nbsp;would&nbsp;you&nbsp;prefer?&lt;br&gt;&lt;/blockquote&gt;&lt;br&gt;Something&nbsp;simple&nbsp;and&nbsp;accurate.&nbsp;:)&nbsp;&amp;nbsp;You&nbsp;may&nbsp;need&nbsp;to&nbsp;do&nbsp;some&nbsp;investigation&lt;span&nbsp;class=&quot;Apple-converted-space&quot;&gt;&amp;nbsp;&lt;/span&gt;&lt;br&gt;to&nbsp;determine&nbsp;the&nbsp;best&nbsp;approach.&lt;br&gt;&lt;/blockquote&gt;&lt;br&gt;1.&nbsp;This&nbsp;is&nbsp;simple:&lt;br&gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;def&nbsp;do_benchmark(content):&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;t1&nbsp;=&nbsp;time.time()&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;d&nbsp;=&nbsp;flatten(request,&nbsp;content,&nbsp;lambda&nbsp;_:&nbsp;None)&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;t2&nbsp;=&nbsp;time.time()&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;assert&nbsp;d.called&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;return&nbsp;t2&nbsp;-&nbsp;t1&lt;br&gt;&lt;br&gt;Do&nbsp;you&nbsp;think&nbsp;it's&nbsp;acceptably&nbsp;accurate?&nbsp;After&nbsp;a&nbsp;few&nbsp;million&nbsp;iterations,&lt;br&gt;the&nbsp;relative&nbsp;error&nbsp;should&nbsp;be&nbsp;pretty&nbsp;small.&lt;br&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Well&nbsp;it&nbsp;rather&nbsp;depends&nbsp;on&nbsp;the&nbsp;contents&nbsp;of&nbsp;'content',&nbsp;doesn't&nbsp;it?&nbsp;:)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;think&nbsp;we&nbsp;have&nbsp;gotten&nbsp;lost&nbsp;in&nbsp;the&nbsp;weeds&nbsp;here.&nbsp;&amp;nbsp;We&nbsp;talked&nbsp;about&nbsp;using&nbsp;benchlib.py&nbsp;initially,&nbsp;and&nbsp;then&nbsp;you&nbsp;noticed&nbsp;a&nbsp;bug,&nbsp;and&nbsp;it&nbsp;was&nbsp;mentioned&nbsp;that&nbsp;benchlib.py&nbsp;was&nbsp;mostly&nbsp;written&nbsp;for&nbsp;testing&nbsp;asynchronous&nbsp;things&nbsp;and&nbsp;didn't&nbsp;have&nbsp;good&nbsp;support&nbsp;for&nbsp;testing&nbsp;the&nbsp;simple&nbsp;case&nbsp;here,&nbsp;which&nbsp;is&nbsp;synchronous&nbsp;rendering&nbsp;of&nbsp;a&nbsp;simple&nbsp;document.&nbsp;&amp;nbsp;However,&nbsp;one&nbsp;of&nbsp;twisted.web.template's&nbsp;major&nbsp;features&nbsp;-&nbsp;arguably&nbsp;its&nbsp;reason&nbsp;for&nbsp;existing&nbsp;in&nbsp;a&nbsp;world&nbsp;that&nbsp;is&nbsp;practically&nbsp;overrun&nbsp;by&nbsp;HTML&nbsp;templating&nbsp;systems&nbsp;-&nbsp;is&nbsp;that&nbsp;it&nbsp;supports&nbsp;Deferreds.&nbsp;&amp;nbsp;So&nbsp;we'll&nbsp;want&nbsp;that&nbsp;anyway.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;right&nbsp;thing&nbsp;to&nbsp;do&nbsp;here&nbsp;would&nbsp;be&nbsp;to&nbsp;update&nbsp;benchlib&nbsp;itself&nbsp;with&nbsp;a&nbsp;few&nbsp;simple&nbsp;tools&nbsp;for&nbsp;doing&nbsp;timing&nbsp;of&nbsp;synchronous&nbsp;tasks,&nbsp;and&nbsp;possibly&nbsp;also&nbsp;to&nbsp;just&nbsp;fix&nbsp;the&nbsp;unbounded-recursion&nbsp;bug&nbsp;that&nbsp;you&nbsp;noticed,&nbsp;not&nbsp;to&nbsp;start&nbsp;building&nbsp;a&nbsp;new,&nbsp;parallel&nbsp;set&nbsp;of&nbsp;testing&nbsp;tools&nbsp;which&nbsp;use&nbsp;different&nbsp;infrastructure.&nbsp;&amp;nbsp;That&nbsp;probably&nbsp;means&nbsp;implementing&nbsp;a&nbsp;small&nbsp;subset&nbsp;of&nbsp;timeit.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&nbsp;style=&quot;letter-spacing:&nbsp;normal;&nbsp;orphans:&nbsp;auto;&nbsp;text-align:&nbsp;start;&nbsp;text-indent:&nbsp;0px;&nbsp;text-transform:&nbsp;none;&nbsp;white-space:&nbsp;normal;&nbsp;widows:&nbsp;auto;&nbsp;word-spacing:&nbsp;0px;&nbsp;-webkit-text-size-adjust:&nbsp;auto;&nbsp;-webkit-text-stroke-width:&nbsp;0px;&quot;&gt;2.&nbsp;For&nbsp;the&nbsp;choice&nbsp;of&nbsp;test&nbsp;data,&nbsp;I&nbsp;had&nbsp;a&nbsp;quick&nbsp;search&nbsp;for&nbsp;benchmarks&nbsp;from&lt;br&gt;other&nbsp;web&nbsp;frameworks.&nbsp;All&nbsp;I&nbsp;found&nbsp;was&nbsp;&quot;hello&nbsp;world&quot;&nbsp;benchmarks,&nbsp;that&lt;br&gt;test&nbsp;the&nbsp;overhead&nbsp;of&nbsp;the&nbsp;framework&nbsp;itself&nbsp;by&nbsp;rendering&nbsp;an&nbsp;empty&nbsp;page.&lt;br&gt;I'll&nbsp;include&nbsp;that,&nbsp;of&nbsp;course.&lt;br&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&quot;hello&nbsp;world&quot;&nbsp;benchmarks&nbsp;have&nbsp;problems&nbsp;because&nbsp;start-up&nbsp;overhead&nbsp;tends&nbsp;to&nbsp;dominate.&nbsp;&amp;nbsp;A&nbsp;realistic&nbsp;web&nbsp;page&nbsp;with&nbsp;some&nbsp;slots&nbsp;and&nbsp;renderers&nbsp;sprinkled&nbsp;throughout&nbsp;would&nbsp;be&nbsp;a&nbsp;lot&nbsp;better.&nbsp;&amp;nbsp;Although&nbsp;even&nbsp;better&nbsp;would&nbsp;be&nbsp;a&nbsp;couple&nbsp;of&nbsp;cases&nbsp;-&nbsp;let's&nbsp;say&nbsp;small,&nbsp;large-sync,&nbsp;and&nbsp;large-async&nbsp;-&nbsp;so&nbsp;we&nbsp;can&nbsp;see&nbsp;if&nbsp;optimizations&nbsp;for&nbsp;one&nbsp;case&nbsp;hurt&nbsp;another.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;As&nbsp;Jean-Paul&nbsp;already&nbsp;mentioned&nbsp;in&nbsp;this&nbsp;thread,&nbsp;you&nbsp;can't&nbsp;have&nbsp;more&nbsp;than&nbsp;one&nbsp;result&nbsp;per&nbsp;benchmark,&nbsp;so&nbsp;you'll&nbsp;need&nbsp;to&nbsp;choose&nbsp;a&nbsp;fixed&nbsp;number&nbsp;of&nbsp;configurations&nbsp;and&nbsp;create&nbsp;one&nbsp;benchmark&nbsp;for&nbsp;each.&lt;/div&gt;&lt;br&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&nbsp;style=&quot;letter-spacing:&nbsp;normal;&nbsp;orphans:&nbsp;auto;&nbsp;text-align:&nbsp;start;&nbsp;text-indent:&nbsp;0px;&nbsp;text-transform:&nbsp;none;&nbsp;white-space:&nbsp;normal;&nbsp;widows:&nbsp;auto;&nbsp;word-spacing:&nbsp;0px;&nbsp;-webkit-text-size-adjust:&nbsp;auto;&nbsp;-webkit-text-stroke-width:&nbsp;0px;&quot;&gt;3.&nbsp;Regarding&nbsp;option&nbsp;parsing,&nbsp;is&nbsp;there&nbsp;any&nbsp;reason&nbsp;to&nbsp;prefer&amp;nbsp;twisted.python.usage.Options&nbsp;over&nbsp;[...]&lt;/div&gt;&lt;/blockquote&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;reason&nbsp;to&nbsp;prefer&nbsp;usage.Options&nbsp;is&nbsp;consistency.&nbsp;&amp;nbsp;That's&nbsp;what&nbsp;we&nbsp;use&nbsp;on&nbsp;Twisted,&nbsp;and&nbsp;there&nbsp;is&nbsp;no&nbsp;compelling&nbsp;reason&nbsp;to&nbsp;use&nbsp;something&nbsp;else.&nbsp;&amp;nbsp;In&nbsp;any&nbsp;case,&nbsp;if&nbsp;there&nbsp;were&nbsp;a&nbsp;compelling&nbsp;reason&nbsp;to&nbsp;use&nbsp;something&nbsp;else,&nbsp;this&nbsp;wouldn't&nbsp;be&nbsp;the&nbsp;place&nbsp;to&nbsp;start;&nbsp;you&nbsp;could&nbsp;start&nbsp;a&nbsp;separate&nbsp;discussion&nbsp;about&nbsp;option&nbsp;parsing.&nbsp;&amp;nbsp;(Warning;&nbsp;a&nbsp;discussion&nbsp;about&nbsp;option&nbsp;parsing&nbsp;would&nbsp;inevitably&nbsp;be&nbsp;a&nbsp;waste&nbsp;of&nbsp;everyone's&nbsp;time&nbsp;and&nbsp;you&nbsp;should&nbsp;under&nbsp;no&nbsp;circumstances&nbsp;do&nbsp;this.)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;All&nbsp;the&nbsp;options&nbsp;that&nbsp;you&nbsp;might&nbsp;need&nbsp;to&nbsp;parse&nbsp;(well,&nbsp;all&nbsp;the&nbsp;options&nbsp;that&nbsp;you&nbsp;_can_&nbsp;parse,&nbsp;as&nbsp;far&nbsp;as&nbsp;codespeed&nbsp;is&nbsp;concerned)&nbsp;are&nbsp;already&nbsp;implemented&nbsp;by&nbsp;benchlib.py&nbsp;in&amp;nbsp;&lt;a&nbsp;href=&quot;http://launchpad.net/twisted-benchmarks&quot;&gt;http://launchpad.net/twisted-benchmarks&lt;/a&gt;,&nbsp;so&nbsp;there's&nbsp;no&nbsp;point&nbsp;in&nbsp;writing&nbsp;any&nbsp;option-parsing&nbsp;code&nbsp;for&nbsp;this&nbsp;task&nbsp;anyway.&nbsp;&amp;nbsp;The&nbsp;thing&nbsp;to&nbsp;implement&nbsp;would&nbsp;be&nbsp;a&nbsp;different&nbsp;driver()&nbsp;function&nbsp;that&nbsp;makes&nbsp;a&nbsp;few&nbsp;simple&nbsp;synchronous&nbsp;calls&nbsp;without&nbsp;running&nbsp;the&nbsp;reactor.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;-glyph&lt;/div&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
