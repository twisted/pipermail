<tt>
&lt;br&gt;&lt;br&gt;<br>
&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Tue,&nbsp;Apr&nbsp;29,&nbsp;2008&nbsp;at&nbsp;1:04&nbsp;PM,&nbsp;Jean-Paul&nbsp;Calderone&nbsp;&amp;lt;&lt;a&nbsp;href=&quot;mailto:exarkun@divmod.com&quot;&gt;exarkun@divmod.com&lt;/a&gt;&amp;gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;PADDING-LEFT:&nbsp;1ex;&nbsp;MARGIN:&nbsp;0px&nbsp;0px&nbsp;0px&nbsp;0.8ex;&nbsp;BORDER-LEFT:&nbsp;#ccc&nbsp;1px&nbsp;solid&quot;&gt;<br>
&lt;div&nbsp;class=&quot;Ih2E3d&quot;&gt;On&nbsp;Tue,&nbsp;29&nbsp;Apr&nbsp;2008&nbsp;12:39:16&nbsp;+0200,&nbsp;Harald&nbsp;Blåtand&nbsp;&amp;lt;&lt;a&nbsp;href=&quot;mailto:kozneb@gmail.com&quot;&nbsp;target=&quot;_blank&quot;&gt;kozneb@gmail.com&lt;/a&gt;&amp;gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;PADDING-LEFT:&nbsp;1ex;&nbsp;MARGIN:&nbsp;0px;&nbsp;BORDER-LEFT:&nbsp;#ccc&nbsp;1px&nbsp;solid&quot;&gt;Hi,&lt;br&gt;&lt;br&gt;I&amp;#39;m&nbsp;using&nbsp;Nevow&nbsp;&lt;a&nbsp;href=&quot;http://0.9.31./&quot;&nbsp;target=&quot;_blank&quot;&gt;0.9.31.&lt;/a&gt;&nbsp;Have&nbsp;been&nbsp;struggling&nbsp;with&nbsp;catching&nbsp;the&lt;br&gt;<br>
onbeforeunload&nbsp;event&nbsp;for&nbsp;a&nbsp;couple&nbsp;of&nbsp;days.&nbsp;From&nbsp;the&nbsp;JS&nbsp;code&nbsp;in&lt;br&gt;Athena/__init__.js,&nbsp;it&nbsp;looks&nbsp;like&nbsp;the&nbsp;events&nbsp;&amp;#39;onkeypress&amp;#39;&nbsp;and&lt;br&gt;&amp;#39;onbeforeunload&amp;#39;&nbsp;are&nbsp;handled&nbsp;pretty&nbsp;automatically;&nbsp;and&nbsp;by&nbsp;adding&nbsp;alerts&nbsp;to&lt;br&gt;<br>
their&nbsp;methods,&nbsp;I&nbsp;can&nbsp;verify&nbsp;that&nbsp;both&nbsp;are&nbsp;caught&nbsp;fine&nbsp;on&nbsp;Firefox.&lt;br&gt;&lt;br&gt;However,&nbsp;on&nbsp;Internet&nbsp;Explorer&nbsp;-&nbsp;v&nbsp;6.0.2800&nbsp;on&nbsp;W2000,&nbsp;and&nbsp;7.0.6000&nbsp;on&nbsp;Vista&lt;br&gt;-&nbsp;neither&nbsp;of&nbsp;these&nbsp;2&nbsp;events&nbsp;is&nbsp;trapped.&lt;br&gt;Does&nbsp;anybody&nbsp;know&nbsp;whether&nbsp;this&nbsp;is&nbsp;a&nbsp;known&nbsp;problem&nbsp;with&nbsp;Athena&nbsp;on&nbsp;IE?&lt;br&gt;<br>
&lt;br&gt;&lt;/blockquote&gt;&lt;br&gt;&lt;/div&gt;I&amp;#39;m&nbsp;not&nbsp;sure&nbsp;what&nbsp;might&nbsp;be&nbsp;going&nbsp;on&nbsp;here.&nbsp;&amp;nbsp;I&nbsp;can&nbsp;tell&nbsp;you&nbsp;that&nbsp;I&amp;#39;ve&nbsp;never&lt;br&gt;tested&nbsp;Athena&nbsp;on&nbsp;either&nbsp;of&nbsp;those&nbsp;platforms,&nbsp;though.&nbsp;<br>
&lt;div&nbsp;class=&quot;Ih2E3d&quot;&gt;&lt;br&gt;&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;PADDING-LEFT:&nbsp;1ex;&nbsp;MARGIN:&nbsp;0px;&nbsp;BORDER-LEFT:&nbsp;#ccc&nbsp;1px&nbsp;solid&quot;&gt;(A&nbsp;further&nbsp;observation&nbsp;-&nbsp;the&nbsp;Athena&nbsp;test&nbsp;files&nbsp;TestInit.js&nbsp;and&nbsp;TestWidget.js&lt;br&gt;both&nbsp;appear&nbsp;to&nbsp;have&nbsp;tests&nbsp;for&nbsp;onbeforeunload.&nbsp;Now,&nbsp;when&nbsp;I&nbsp;do&nbsp;&amp;#39;nit&lt;br&gt;<br>
--port=9876&nbsp;nevow&amp;#39;&nbsp;and&nbsp;press&nbsp;&amp;quot;Run&nbsp;Tests&amp;quot;&nbsp;in&nbsp;the&nbsp;browser,&nbsp;these&nbsp;files&nbsp;do&nbsp;not&lt;br&gt;seem&nbsp;to&nbsp;run.&nbsp;I&nbsp;don&amp;#39;t&nbsp;understand&nbsp;too&nbsp;much&nbsp;of&nbsp;the&nbsp;interactive&nbsp;unit&nbsp;tests&nbsp;yet,&lt;br&gt;but&nbsp;I&nbsp;get&nbsp;a&nbsp;feeling&nbsp;that&nbsp;file&nbsp;livetest_athena.py&nbsp;would&nbsp;need&nbsp;to&nbsp;have&nbsp;a&nbsp;line&lt;br&gt;<br>
like&nbsp;&amp;quot;jsClass&nbsp;=&nbsp;u&amp;#39;Nevow.Test..&amp;quot;&nbsp;for&nbsp;these&nbsp;2&nbsp;files&nbsp;to&nbsp;be&nbsp;found&nbsp;and&nbsp;executed,&lt;br&gt;and&nbsp;it&nbsp;doesn&amp;#39;t.)&lt;br&gt;&lt;/blockquote&gt;&lt;br&gt;&lt;/div&gt;When&nbsp;I&nbsp;run&nbsp;`nit&nbsp;nevow´&nbsp;and&nbsp;click&nbsp;the&nbsp;`Run&nbsp;Tests´&nbsp;button,&nbsp;I&nbsp;see&nbsp;59&nbsp;tests&lt;br&gt;run&nbsp;and&nbsp;succeed.&nbsp;&amp;nbsp;This&nbsp;using&nbsp;Firefox&nbsp;1.5&nbsp;on&nbsp;Ubuntu&nbsp;6.06.&lt;br&gt;<br>
&lt;br&gt;You&nbsp;might&nbsp;be&nbsp;confusing&nbsp;nits&nbsp;with&nbsp;JavaScript&nbsp;unit&nbsp;tests.&nbsp;&amp;nbsp;nits&nbsp;are&nbsp;defined&lt;br&gt;by&nbsp;livetest_*.py&nbsp;files&nbsp;and&nbsp;whatever&nbsp;JavaScript&nbsp;the&nbsp;`jsClass´&nbsp;attributes&nbsp;in&lt;br&gt;them&nbsp;point&nbsp;to.&nbsp;&amp;nbsp;Much&nbsp;(perhaps&nbsp;not,&nbsp;there&amp;#39;s&nbsp;a&nbsp;bit&nbsp;of&nbsp;mixing)&nbsp;of&nbsp;the&nbsp;code&nbsp;in&lt;br&gt;<br>
the&nbsp;Nevow.Test&nbsp;JavaScript&nbsp;package&nbsp;(defined&nbsp;by&nbsp;Nevow/nevow/js/Nevow/Test/)&lt;br&gt;is&nbsp;for&nbsp;JavaScript&nbsp;unit&nbsp;tests.&nbsp;&amp;nbsp;These&nbsp;are&nbsp;run&nbsp;using&nbsp;the&nbsp;stand-alone&nbsp;spider-&lt;br&gt;monkey&nbsp;interpreter;&nbsp;they&nbsp;don&amp;#39;t&nbsp;run&nbsp;in&nbsp;a&nbsp;browser.&lt;br&gt;&lt;br&gt;Nevow/nevow/js/Nevow/Athena/Tests/__init__.js&nbsp;has&nbsp;most&nbsp;of&nbsp;the&nbsp;code&nbsp;for&nbsp;the&lt;br&gt;<br>
Nevow&nbsp;nits.&lt;br&gt;&lt;/blockquote&gt;<br>
&lt;div&gt;&amp;nbsp;&lt;/div&gt;<br>
&lt;div&gt;Thanks&nbsp;for&nbsp;your&nbsp;reply&nbsp;Jean-Paul,&lt;/div&gt;<br>
&lt;div&gt;&amp;nbsp;&lt;/div&gt;<br>
&lt;div&gt;Yep,&nbsp;on&nbsp;Firefox&nbsp;I&nbsp;too&nbsp;see&nbsp;59&nbsp;tests&nbsp;succeed.&nbsp;With&nbsp;IE&nbsp;on&nbsp;Vista,&nbsp;58.&nbsp;(Although&nbsp;I&nbsp;don&amp;#39;t&nbsp;_think_&nbsp;it&amp;#39;s&nbsp;to&nbsp;do&nbsp;with&nbsp;the&nbsp;current&nbsp;problem&nbsp;-&lt;/div&gt;<br>
&lt;div&gt;&amp;nbsp;&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;test-failure&quot;&gt;Nevow.Athena.Tests.DynamicWidgetInstantiation.test_nonXHTMLWidgetReturn&lt;pre&gt;Failed&nbsp;to&nbsp;discover&nbsp;node&nbsp;with&nbsp;id&nbsp;value&nbsp;athena:52&nbsp;beneath&nbsp;[object]&nbsp;(programmer&nbsp;error).<br>
undefined<br>
&lt;/pre&gt;&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;test-success&quot;&gt;Nevow.Athena.Tests.DynamicWidgetInstantiation.test_invalidRemoveChildWidget&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;test-success&quot;&gt;(not&nbsp;sure&nbsp;which&nbsp;one&nbsp;of&nbsp;the&nbsp;tests&nbsp;the&nbsp;err&nbsp;msg&nbsp;relates&nbsp;to)&nbsp;.)&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;test-success&quot;&gt;&amp;nbsp;&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;test-success&quot;&gt;Unfortunately,&nbsp;our&nbsp;Corporate&nbsp;Standard&nbsp;is&nbsp;IE,&nbsp;and&nbsp;we&amp;#39;re&nbsp;going&nbsp;from&nbsp;W2000&nbsp;to&nbsp;Vista&nbsp;for&nbsp;70K&nbsp;users&nbsp;soon&nbsp;:-(&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;test-success&quot;&gt;&amp;nbsp;&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;test-success&quot;&gt;&amp;nbsp;&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;test-success&quot;&gt;Anyway&nbsp;-&nbsp;might&nbsp;IE&amp;#39;s&nbsp;failure&nbsp;with&nbsp;&amp;#39;onbeforeunload&amp;#39;&nbsp;explain&nbsp;why&nbsp;I&amp;#39;m&nbsp;having&nbsp;trouble&nbsp;refreshing&nbsp;an&nbsp;Athena&nbsp;page?&nbsp;(Because&nbsp;the&nbsp;server&nbsp;doesn&amp;#39;t&nbsp;get&nbsp;any&nbsp;sendCloseMessage()&nbsp;?)&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;test-success&quot;&gt;&amp;nbsp;&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;test-success&quot;&gt;&amp;nbsp;&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;test-success&quot;&gt;Hmm..&nbsp;we&nbsp;can&amp;#39;t&nbsp;be&nbsp;alone&nbsp;in&nbsp;the&nbsp;world&nbsp;using&nbsp;IE,&nbsp;or&nbsp;M$&nbsp;wouldn&amp;#39;t&nbsp;be&nbsp;so&nbsp;big...&nbsp;:-)&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;test-success&quot;&gt;&amp;nbsp;&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;test-success&quot;&gt;Regards,&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;test-success&quot;&gt;Harald&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;test-success&quot;&gt;&amp;nbsp;&lt;/div&gt;<br>
&lt;div&nbsp;class=&quot;test-success&quot;&gt;&amp;nbsp;&lt;/div&gt;&lt;/div&gt;
</tt>
