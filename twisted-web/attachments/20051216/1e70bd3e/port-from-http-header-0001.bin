Index: /home/richard/lib/Twisted/trunk/twisted/web/server.py
===================================================================
--- /home/richard/lib/Twisted/trunk/twisted/web/server.py	(revision 15339)
+++ /home/richard/lib/Twisted/trunk/twisted/web/server.py	(working copy)
@@ -342,11 +342,17 @@
         return self.session
 
     def _prePathURL(self, prepath):
-        port = self.getHost().port
         if self.isSecure():
             default = 443
         else:
             default = 80
+            
+        hostheader = self.getHeader('host')
+        if hostheader:
+            port = int(dict(zip(('hostname', 'port'), hostheader.split(":"))).get('port', default))
+        else:
+            port = self.getHost().port
+            
         if port == default:
             hostport = ''
         else:
