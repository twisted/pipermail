Index: appserver.py
===================================================================
--- appserver.py	(revision 390)
+++ appserver.py	(working copy)
@@ -96,6 +96,14 @@
         self.write("</body></html>")
         return None
 
+
+    def prePathURL(self):
+        url = server.Request.prePathURL(self)
+        receivedFrom = self.received_headers.get('x-forwarded-from')
+        if receivedFrom is not None:
+            url = url.replace(self.received_headers['host'], receivedFrom)
+        return url
+    
     def process(self):
         # extra request parsing
         if self.method == 'POST':
