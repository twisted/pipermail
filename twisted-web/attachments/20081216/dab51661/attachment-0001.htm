<tt>
&lt;br&gt;&lt;br&gt;&lt;div&nbsp;class=&quot;gmail_quote&quot;&gt;On&nbsp;Tue,&nbsp;Dec&nbsp;16,&nbsp;2008&nbsp;at&nbsp;2:20&nbsp;PM,&nbsp;Jean-Paul&nbsp;Calderone&nbsp;&lt;span&nbsp;dir=&quot;ltr&quot;&gt;&amp;lt;&lt;a&nbsp;href=&quot;mailto:exarkun@divmod.com&quot;&gt;exarkun@divmod.com&lt;/a&gt;&amp;gt;&lt;/span&gt;&nbsp;wrote:&lt;br&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;<br>
&lt;div&gt;&lt;div&gt;&lt;/div&gt;&lt;div&nbsp;class=&quot;Wj3C7c&quot;&gt;On&nbsp;Tue,&nbsp;16&nbsp;Dec&nbsp;2008&nbsp;05:31:45&nbsp;+0200,&nbsp;Radu&nbsp;Dragusin&nbsp;&amp;lt;&lt;a&nbsp;href=&quot;mailto:radudragusin@gmail.com&quot;&nbsp;target=&quot;_blank&quot;&gt;radudragusin@gmail.com&lt;/a&gt;&amp;gt;&nbsp;wrote:&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;<br>
I&nbsp;have&nbsp;a&nbsp;HTTP&nbsp;Proxy&nbsp;made&nbsp;with&nbsp;twisted.web&nbsp;and&nbsp;want&nbsp;to&nbsp;change&nbsp;the&nbsp;request&lt;br&gt;<br>
that&nbsp;the&nbsp;browser&nbsp;sends&nbsp;to&nbsp;the&nbsp;Proxy&nbsp;such&nbsp;that&nbsp;I&nbsp;erase&nbsp;the&nbsp;value&nbsp;of&nbsp;the&lt;br&gt;<br>
&amp;#39;accept-encoding&amp;#39;&nbsp;key&nbsp;from&nbsp;&amp;#39;gzip,deflate&amp;#39;&nbsp;to&nbsp;&amp;#39;&nbsp;&amp;#39;.&lt;br&gt;<br>
&lt;br&gt;<br>
I&nbsp;use&nbsp;the&nbsp;example&nbsp;from&nbsp;the&nbsp;Tisted&nbsp;Book:&lt;br&gt;<br>
&lt;br&gt;<br>
By&nbsp;adding&nbsp;the&nbsp;overriden&nbsp;process&nbsp;method&nbsp;in&nbsp;WordCountProxyRequest&nbsp;I&nbsp;can&nbsp;get&lt;br&gt;<br>
the&nbsp;request&nbsp;header&nbsp;but&nbsp;have&nbsp;found&nbsp;no&nbsp;way&nbsp;to&nbsp;set&nbsp;a&nbsp;key,&nbsp;value&nbsp;pair.&lt;br&gt;<br>
I&nbsp;want&nbsp;make&nbsp;the&nbsp;server&nbsp;think&nbsp;that&nbsp;the&nbsp;browser&nbsp;does&nbsp;not&nbsp;support&nbsp;gzip&nbsp;because&lt;br&gt;<br>
twisted&nbsp;seems&nbsp;to&nbsp;not&nbsp;support&nbsp;gzip&nbsp;as&nbsp;the&nbsp;response&nbsp;from&nbsp;&lt;a&nbsp;href=&quot;http://www.google.com&quot;&nbsp;target=&quot;_blank&quot;&gt;www.google.com&lt;/a&gt;&nbsp;and&lt;br&gt;<br>
many&nbsp;(but&nbsp;not&nbsp;all)&nbsp;sites&nbsp;appears&nbsp;still&nbsp;encoded.&nbsp;&lt;a&nbsp;href=&quot;http://www.dpreview.com&quot;&nbsp;target=&quot;_blank&quot;&gt;www.dpreview.com&lt;/a&gt;&nbsp;seems&nbsp;not&lt;br&gt;<br>
to&nbsp;gzip&nbsp;the&nbsp;response,&nbsp;and&nbsp;so&nbsp;the&nbsp;resonse&nbsp;is&nbsp;processed&nbsp;correctly.&lt;br&gt;<br>
&lt;br&gt;<br>
What&nbsp;can&nbsp;I&nbsp;do&nbsp;to&nbsp;either&nbsp;correctly&nbsp;decode&nbsp;gzip&nbsp;responses&nbsp;or&nbsp;modify&nbsp;the&lt;br&gt;<br>
&amp;#39;accept-encoding&amp;#39;&nbsp;value&nbsp;to&nbsp;nothing&nbsp;so&nbsp;the&nbsp;server&nbsp;does&nbsp;not&nbsp;compress&nbsp;the&lt;br&gt;<br>
response?&lt;br&gt;<br>
&lt;br&gt;<br>
Thank&nbsp;you!&lt;br&gt;<br>
*Example&nbsp;4-8.&nbsp;wordcountproxy.py*&lt;br&gt;<br>
&lt;br&gt;<br>
import&nbsp;sgmllib,&nbsp;re&lt;br&gt;<br>
from&nbsp;twisted.web&nbsp;import&nbsp;proxy,&nbsp;http&lt;br&gt;<br>
import&nbsp;sys&lt;br&gt;<br>
from&nbsp;twisted.python&nbsp;import&nbsp;log&lt;br&gt;<br>
log.startLogging(sys.stdout)&lt;br&gt;<br>
&lt;br&gt;<br>
WEB_PORT&nbsp;=&nbsp;8000&lt;br&gt;<br>
PROXY_PORT&nbsp;=&nbsp;8001&lt;br&gt;<br>
&lt;br&gt;<br>
class&nbsp;WordParser(sgmllib.SGMLParser):&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;def&nbsp;__init__(self):&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;sgmllib.SGMLParser.__init__(self)&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self.chardata&nbsp;=&nbsp;[]&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self.inBody&nbsp;=&nbsp;False&lt;br&gt;<br>
&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;def&nbsp;start_body(self,&nbsp;attrs):&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self.inBody&nbsp;=&nbsp;True&lt;br&gt;<br>
&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;def&nbsp;end_body(self):&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self.inBody&nbsp;=&nbsp;False&lt;br&gt;<br>
&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;def&nbsp;handle_data(self,&nbsp;data):&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;if&nbsp;self.inBody:&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self.chardata.append(data)&lt;br&gt;<br>
&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;def&nbsp;getWords(self):&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;#&nbsp;extract&nbsp;words&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;wordFinder&nbsp;=&nbsp;re.compile(r&amp;#39;\w*&amp;#39;)&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;words&nbsp;=&nbsp;wordFinder.findall(&amp;quot;&amp;quot;.join(self.chardata))&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;words&nbsp;=&nbsp;filter(lambda&nbsp;word:&nbsp;word.strip(&nbsp;),&nbsp;words)&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;print&nbsp;&amp;quot;WORDS&nbsp;ARE&amp;quot;,&nbsp;words&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;return&nbsp;words&lt;br&gt;<br>
&lt;br&gt;<br>
class&nbsp;WordCounter(object):&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;ignoredWords&nbsp;=&nbsp;&amp;quot;the&nbsp;a&nbsp;of&nbsp;in&nbsp;from&nbsp;to&nbsp;this&nbsp;that&nbsp;and&nbsp;or&nbsp;but&nbsp;is&nbsp;was&nbsp;be&lt;br&gt;<br>
can&nbsp;could&nbsp;i&nbsp;you&nbsp;they&nbsp;we&nbsp;at&amp;quot;.split(&nbsp;)&lt;br&gt;<br>
&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;def&nbsp;__init__(self):&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self.words&nbsp;=&nbsp;{}&lt;br&gt;<br>
&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;def&nbsp;addWords(self,&nbsp;words):&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;for&nbsp;word&nbsp;in&nbsp;words:&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;word&nbsp;=&nbsp;word.lower(&nbsp;)&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;if&nbsp;not&nbsp;word&nbsp;in&nbsp;self.ignoredWords:&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;currentCount&nbsp;=&nbsp;self.words.get(word,&nbsp;0)&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self.words[word]&nbsp;=&nbsp;currentCount&nbsp;+&nbsp;1&lt;br&gt;<br>
&lt;br&gt;<br>
class&nbsp;WordCountProxyClient(proxy.ProxyClient):&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;def&nbsp;handleHeader(self,&nbsp;key,&nbsp;value):&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;proxy.ProxyClient.handleHeader(self,&nbsp;key,&nbsp;value)&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;&lt;/div&gt;&lt;/div&gt;<br>
How&nbsp;about&nbsp;skipping&nbsp;it&nbsp;here?&lt;div&gt;&lt;div&gt;&amp;nbsp;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&amp;nbsp;&lt;/div&gt;&lt;div&gt;If&nbsp;I&nbsp;use&nbsp;here&nbsp;the&nbsp;following:&lt;br&gt;&lt;br&gt;print&nbsp;&amp;quot;[&amp;quot;,&nbsp;key,&nbsp;&amp;quot;:&amp;quot;,&nbsp;value,&amp;quot;]&amp;quot;&lt;br&gt;&lt;br&gt;I&nbsp;get:&lt;br&gt;2008-12-16&nbsp;15:37:21+0200&nbsp;[WordCountProxyClient,client]&nbsp;[&nbsp;Cache-Control&nbsp;:&nbsp;no-cache,&nbsp;no-store,&nbsp;max-age=0,&nbsp;must-revalidate&nbsp;]&lt;br&gt;<br>
<br>
2008-12-16&nbsp;15:37:21+0200&nbsp;[WordCountProxyClient,client]&nbsp;[&nbsp;Pragma&nbsp;:&nbsp;no-cache&nbsp;]&lt;br&gt;2008-12-16&nbsp;15:37:21+0200&nbsp;[WordCountProxyClient,client]&nbsp;[&nbsp;Expires&nbsp;:&nbsp;Fri,&nbsp;01&nbsp;Jan&nbsp;1990&nbsp;00:00:00&nbsp;GMT&nbsp;]&lt;br&gt;2008-12-16&nbsp;15:37:21+0200&nbsp;[WordCountProxyClient,client]&nbsp;[&nbsp;Date&nbsp;:&nbsp;Tue,&nbsp;16&nbsp;Dec&nbsp;2008&nbsp;13:37:21&nbsp;GMT&nbsp;]&lt;br&gt;<br>
<br>
2008-12-16&nbsp;15:37:21+0200&nbsp;[WordCountProxyClient,client]&nbsp;[&nbsp;Content-Type&nbsp;:&nbsp;text/javascript;&nbsp;charset=UTF-8&nbsp;]&lt;br&gt;2008-12-16<br>
15:37:21+0200&nbsp;[WordCountProxyClient,client]&nbsp;[&nbsp;Set-Cookie&nbsp;:<br>
GMAIL_STAT_3492=EXPIRED;&nbsp;Expires=Mon,&nbsp;15-Dec-2008&nbsp;13:37:21&nbsp;GMT;&nbsp;Path=/a/&lt;a&nbsp;href=&quot;http://dragusin.ro/&quot;&nbsp;target=&quot;_blank&quot;&gt;dragusin.ro&lt;/a&gt;&nbsp;]&lt;br&gt;<br>
2008-12-16&nbsp;15:37:21+0200&nbsp;[WordCountProxyClient,client]&nbsp;[&nbsp;Set-Cookie&nbsp;:<br>
GMAIL_IMP=EXPIRED;&nbsp;Expires=Mon,&nbsp;15-Dec-2008&nbsp;13:37:21&nbsp;GMT;&nbsp;Path=/a/&lt;a&nbsp;href=&quot;http://dragusin.ro/&quot;&nbsp;target=&quot;_blank&quot;&gt;dragusin.ro&lt;/a&gt;&nbsp;]&lt;br&gt;2008-12-16&nbsp;15:37:21+0200&nbsp;[WordCountProxyClient,client]&nbsp;[&nbsp;Content-Encoding&nbsp;:&nbsp;gzip&nbsp;]&lt;br&gt;<br>
2008-12-16&nbsp;15:37:21+0200&nbsp;[WordCountProxyClient,client]&nbsp;[&nbsp;X-Content-Type-Options&nbsp;:&nbsp;nosniff&nbsp;]&lt;br&gt;2008-12-16&nbsp;15:37:21+0200&nbsp;[WordCountProxyClient,client]&nbsp;[&nbsp;Content-Length&nbsp;:&nbsp;14340&nbsp;]&lt;br&gt;2008-12-16&nbsp;15:37:21+0200&nbsp;[WordCountProxyClient,client]&nbsp;[&nbsp;Server&nbsp;:&nbsp;GFE/1.3&nbsp;]&lt;br&gt;<br>
<br>
2008-12-16&nbsp;15:37:21+0200&nbsp;[WordCountProxyClient,client]&nbsp;[&nbsp;Connection&nbsp;:&nbsp;Close&nbsp;]&lt;br&gt;2008-12-16&nbsp;15:37:22+0200&nbsp;[WordCountProxyClient,client]&nbsp;[&nbsp;Cache-Control&nbsp;:&nbsp;private,&nbsp;max-age=0&nbsp;]&lt;br&gt;2008-12-16&nbsp;15:37:22+0200&nbsp;[WordCountProxyClient,client]&nbsp;[&nbsp;Date&nbsp;:&nbsp;Tue,&nbsp;16&nbsp;Dec&nbsp;2008&nbsp;13:37:21&nbsp;GMT&nbsp;]&lt;br&gt;<br>
<br>
2008-12-16&nbsp;15:37:22+0200&nbsp;[WordCountProxyClient,client]&nbsp;[&nbsp;Expires&nbsp;:&nbsp;-1&nbsp;]&lt;br&gt;2008-12-16&nbsp;15:37:22+0200&nbsp;[WordCountProxyClient,client]&nbsp;[&nbsp;Content-Type&nbsp;:&nbsp;text/html;&nbsp;charset=UTF-8&nbsp;]&lt;br&gt;2008-12-16&nbsp;15:37:22+0200&nbsp;[WordCountProxyClient,client]&nbsp;[&nbsp;Content-Encoding&nbsp;:&nbsp;gzip&nbsp;]&lt;br&gt;<br>
<br>
2008-12-16&nbsp;15:37:22+0200&nbsp;[WordCountProxyClient,client]&nbsp;[&nbsp;Server&nbsp;:&nbsp;gws&nbsp;]&lt;br&gt;2008-12-16&nbsp;15:37:22+0200&nbsp;[WordCountProxyClient,client]&nbsp;[&nbsp;Content-Length&nbsp;:&nbsp;2597&nbsp;]&lt;br&gt;2008-12-16&nbsp;15:37:22+0200&nbsp;[WordCountProxyClient,client]&nbsp;[&nbsp;Connection&nbsp;:&nbsp;Close&nbsp;]&lt;br&gt;<br>
<br>
&lt;br&gt;So&nbsp;that&nbsp;is&nbsp;the&nbsp;response&nbsp;header.&lt;br&gt;I&nbsp;need&nbsp;to&nbsp;override&nbsp;the&nbsp;request&nbsp;header,&nbsp;the&nbsp;one&nbsp;that&nbsp;the&nbsp;browser&nbsp;sends&nbsp;to&nbsp;the&nbsp;proxy&nbsp;server.&nbsp;&lt;br&gt;See&nbsp;below:&lt;br&gt;&amp;nbsp;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;<br>
&lt;div&gt;&lt;div&nbsp;class=&quot;Wj3C7c&quot;&gt;&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;if&nbsp;key.lower(&nbsp;)&nbsp;==&nbsp;&amp;quot;content-type&amp;quot;:&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;if&nbsp;value.split(&amp;#39;;&amp;#39;)[0]&nbsp;==&nbsp;&amp;#39;text/html&amp;#39;:&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self.parser&nbsp;=&nbsp;WordParser(&nbsp;)&lt;br&gt;<br>
&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;def&nbsp;handleResponsePart(self,&nbsp;data):&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;proxy.ProxyClient.handleResponsePart(self,&nbsp;data)&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;if&nbsp;hasattr(self,&nbsp;&amp;#39;parser&amp;#39;):&nbsp;self.parser.feed(data)&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;def&nbsp;handleResponseEnd(self):&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;proxy.ProxyClient.handleResponseEnd(self)&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;if&nbsp;hasattr(self,&nbsp;&amp;#39;parser&amp;#39;):&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self.parser.close(&nbsp;)&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self.father.wordCounter.addWords(self.parser.getWords(&nbsp;))&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;del(self.parser)&lt;br&gt;<br>
&lt;br&gt;<br>
class&nbsp;WordCountProxyClientFactory(proxy.ProxyClientFactory):&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;def&nbsp;buildProtocol(self,&nbsp;addr):&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;client&nbsp;=&nbsp;proxy.ProxyClientFactory.buildProtocol(self,&nbsp;addr)&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;#&nbsp;upgrade&nbsp;proxy.proxyClient&nbsp;object&nbsp;to&nbsp;WordCountProxyClient&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;client.__class__&nbsp;=&nbsp;WordCountProxyClient&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;return&nbsp;client&lt;br&gt;<br>
&lt;br&gt;<br>
class&nbsp;WordCountProxyRequest(proxy.ProxyRequest):&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;protocols&nbsp;=&nbsp;{&amp;#39;http&amp;#39;:&nbsp;WordCountProxyClientFactory}&lt;br&gt;<br>
&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;def&nbsp;__init__(self,&nbsp;wordCounter,&nbsp;*args):&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self.wordCounter&nbsp;=&nbsp;wordCounter&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;proxy.ProxyRequest.__init__(self,&nbsp;*args)&lt;br&gt;<br>
&lt;br&gt;<br>
*&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;def&nbsp;process(self):&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;proxy.ProxyRequest.process(self)&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;print&nbsp;&amp;quot;received_headers&amp;quot;,&nbsp;proxy.ProxyRequest.getAllHeaders(self)*&amp;nbsp;&lt;/blockquote&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;the&nbsp;print&nbsp;above&nbsp;prints:&lt;br&gt;&amp;nbsp;&lt;br&gt;received_headers:&nbsp;{&amp;#39;accept-language&amp;#39;:<br>
&amp;#39;en-us,en;q=0.5&amp;#39;,&nbsp;&amp;#39;accept-encoding&amp;#39;:&nbsp;&amp;#39;gzip,deflate&amp;#39;,&nbsp;&amp;#39;keep-alive&amp;#39;:<br>
&amp;#39;300&amp;#39;,&nbsp;&amp;#39;accept&amp;#39;:&nbsp;&amp;#39;text/html,application/xhtml+&lt;div&gt;xml,application/xml;q=0.9,*/*;q=0.8&amp;#39;,<br>
&amp;#39;user-agent&amp;#39;:&nbsp;&amp;#39;Mozilla/5.0&nbsp;(X11;&nbsp;U;&nbsp;Linux&nbsp;i686;&nbsp;en-US;&nbsp;rv:1.9.0.4)<br>
Gecko/2008111318&nbsp;Ubuntu/8.10&nbsp;(intrepid)&nbsp;Firefox/3.0.4&amp;#39;,<br>
&amp;#39;accept-charset&amp;#39;:&nbsp;&amp;#39;ISO-8859-1,utf-8;q=0.7,*;q=0.7&amp;#39;,&nbsp;&amp;#39;host&amp;#39;:&nbsp;&amp;#39;&lt;a&nbsp;href=&quot;http://www.google.com/&quot;&nbsp;target=&quot;_blank&quot;&gt;www.google.com&lt;/a&gt;&amp;#39;,&nbsp;&amp;#39;cookie&amp;#39;:&nbsp;&amp;#39;PREF=ID=cfb3eb179de0c1e6:LD=en:NR=100:CR=2:TM=1228315308:LM=1229032156:GM=1:S=ImAuEufbnV6S7BAz;&nbsp;NID=17=lOVMiFLculcrfN-zUO7xxFTTUFzqQqaHOFHcG_BDmYFX8QKYbMoo7GrDoYH-8ASPBlVijG_Hstp7HSDQ_8WQexHPjwz6g_7ZVpBhwmh3vkKuO3jpf9dnzrnWthcW1mGh;&nbsp;S=photos_html=6ScUGfd699g4Xuuh0FeizA;&nbsp;TZ=-120&amp;#39;,&nbsp;&amp;#39;cache-control&amp;#39;:&nbsp;&amp;#39;max-age=0&amp;#39;,&nbsp;&amp;#39;proxy-connection&amp;#39;:&nbsp;&amp;#39;keep-alive&amp;#39;}&lt;br&gt;<br>
<br>
&lt;br&gt;these&nbsp;are&nbsp;the&nbsp;values&nbsp;I&nbsp;want&nbsp;to&nbsp;modify,&nbsp;the&nbsp;&amp;#39;accept-encoding&amp;#39;,&nbsp;to&nbsp;be&nbsp;specific.&nbsp;How&nbsp;can&nbsp;I&nbsp;do&nbsp;it?&lt;br&gt;&lt;br&gt;Thank&nbsp;you!&lt;br&gt;&lt;/div&gt;&lt;br&gt;&amp;nbsp;&lt;/div&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;<br>
&lt;div&gt;&lt;div&nbsp;class=&quot;Wj3C7c&quot;&gt;&lt;blockquote&nbsp;class=&quot;gmail_quote&quot;&nbsp;style=&quot;border-left:&nbsp;1px&nbsp;solid&nbsp;rgb(204,&nbsp;204,&nbsp;204);&nbsp;margin:&nbsp;0pt&nbsp;0pt&nbsp;0pt&nbsp;0.8ex;&nbsp;padding-left:&nbsp;1ex;&quot;&gt;class&nbsp;WordCountProxy(proxy.Proxy):&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;def&nbsp;__init__(self,&nbsp;wordCounter):&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self.wordCounter&nbsp;=&nbsp;wordCounter&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;proxy.Proxy.__init__(self)&lt;br&gt;<br>
&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;def&nbsp;requestFactory(self,&nbsp;*args):&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;return&nbsp;WordCountProxyRequest(self.wordCounter,&nbsp;*args)&lt;br&gt;<br>
&lt;br&gt;<br>
class&nbsp;WordCountProxyFactory(http.HTTPFactory):&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;def&nbsp;__init__(self,&nbsp;wordCounter):&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self.wordCounter&nbsp;=&nbsp;wordCounter&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;http.HTTPFactory.__init__(self)&lt;br&gt;<br>
&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;def&nbsp;buildProtocol(self,&nbsp;addr):&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;protocol&nbsp;=&nbsp;WordCountProxy(self.wordCounter)&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;return&nbsp;protocol&lt;br&gt;<br>
&lt;br&gt;<br>
#&nbsp;classes&nbsp;for&nbsp;web&nbsp;reporting&nbsp;interface&lt;br&gt;<br>
class&nbsp;WebReportRequest(http.Request):&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;def&nbsp;__init__(self,&nbsp;wordCounter,&nbsp;*args):&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self.wordCounter&nbsp;=&nbsp;wordCounter&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;http.Request.__init__(self,&nbsp;*args)&lt;br&gt;<br>
&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;def&nbsp;process(self):&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self.setHeader(&amp;quot;Content-Type&amp;quot;,&nbsp;&amp;quot;text/html&amp;quot;)&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;words&nbsp;=&nbsp;self.wordCounter.words.items(&nbsp;)&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;words.sort(lambda&nbsp;(w1,&nbsp;c1),&nbsp;(w2,&nbsp;c2):&nbsp;cmp(c2,&nbsp;c1))&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;for&nbsp;word,&nbsp;count&nbsp;in&nbsp;words:&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self.write(&amp;quot;&amp;lt;li&amp;gt;%s&nbsp;%s&amp;lt;/li&amp;gt;&amp;quot;&nbsp;%&nbsp;(word,&nbsp;count))&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self.finish(&nbsp;)&lt;br&gt;<br>
&lt;br&gt;<br>
class&nbsp;WebReportChannel(http.HTTPChannel):&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;def&nbsp;__init__(self,&nbsp;wordCounter):&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self.wordCounter&nbsp;=&nbsp;wordCounter&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;http.HTTPChannel.__init__(self)&lt;br&gt;<br>
&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;def&nbsp;requestFactory(self,&nbsp;*args):&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;return&nbsp;WebReportRequest(self.wordCounter,&nbsp;*args)&lt;br&gt;<br>
&lt;br&gt;<br>
class&nbsp;WebReportFactory(http.HTTPFactory):&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;def&nbsp;__init__(self,&nbsp;wordCounter):&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;self.wordCounter&nbsp;=&nbsp;wordCounter&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;http.HTTPFactory.__init__(self)&lt;br&gt;<br>
&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;def&nbsp;buildProtocol(self,&nbsp;addr):&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;&amp;nbsp;&nbsp;return&nbsp;WebReportChannel(self.wordCounter)&lt;br&gt;<br>
&lt;br&gt;<br>
if&nbsp;__name__&nbsp;==&nbsp;&amp;quot;__main__&amp;quot;:&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;from&nbsp;twisted.internet&nbsp;import&nbsp;reactor&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;counter&nbsp;=&nbsp;WordCounter(&nbsp;)&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;prox&nbsp;=&nbsp;WordCountProxyFactory(counter)&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;reactor.listenTCP(PROXY_PORT,&nbsp;prox)&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;reactor.listenTCP(WEB_PORT,&nbsp;WebReportFactory(counter))&lt;br&gt;<br>
&nbsp;&amp;nbsp;&nbsp;reactor.run(&nbsp;)&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;br&gt;<br>
&lt;/blockquote&gt;<br>
&lt;br&gt;&lt;/div&gt;&lt;/div&gt;<br>
Jean-Paul&lt;br&gt;<br>
&lt;br&gt;<br>
_______________________________________________&lt;br&gt;<br>
Twisted-web&nbsp;mailing&nbsp;list&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;mailto:Twisted-web@twistedmatrix.com&quot;&nbsp;target=&quot;_blank&quot;&gt;Twisted-web@twistedmatrix.com&lt;/a&gt;&lt;br&gt;<br>
&lt;a&nbsp;href=&quot;http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web&quot;&nbsp;target=&quot;_blank&quot;&gt;http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web&lt;/a&gt;&lt;br&gt;<br>
&lt;/blockquote&gt;&lt;/div&gt;&lt;br&gt;&lt;br&nbsp;clear=&quot;all&quot;&gt;&lt;br&gt;--&nbsp;&lt;br&gt;Radu&lt;br&gt;<br>

</tt>
