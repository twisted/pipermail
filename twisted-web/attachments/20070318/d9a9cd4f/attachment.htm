<tt>
Hi,&lt;br&gt;&lt;br&gt;I&nbsp;am&nbsp;using&nbsp;web2&nbsp;to&nbsp;run&nbsp;a&nbsp;cherrypy&nbsp;server&nbsp;at&nbsp;the&nbsp;root&nbsp;of&nbsp;the&nbsp;site&nbsp;using&nbsp;WSGI.&lt;br&gt;&lt;br&gt;I&amp;#39;ve&nbsp;got&nbsp;a&nbsp;nearly&nbsp;working&nbsp;set&nbsp;up,&nbsp;the&nbsp;only&nbsp;problem&nbsp;is&nbsp;that&nbsp;when&nbsp;a&nbsp;request&nbsp;comes&nbsp;in&nbsp;for&nbsp;the&nbsp;root&nbsp;of&nbsp;the&nbsp;site,&nbsp;it&nbsp;gets&nbsp;redirected<br>
&lt;br&gt;back&nbsp;to&nbsp;itself:&lt;br&gt;%&nbsp;curl&nbsp;&lt;a&nbsp;href=&quot;http://localhost:8080&quot;&gt;http://localhost:8080&lt;/a&gt;&lt;br&gt;This&nbsp;resource&nbsp;resides&nbsp;temporarily&nbsp;at&nbsp;&amp;lt;a&nbsp;href=&amp;#39;&lt;a&nbsp;href=&quot;http://localhost:8080/&amp;#39;&quot;&gt;http://localhost:8080/&amp;#39;&lt;/a&gt;&amp;gt;&lt;a&nbsp;href=&quot;http://localhost:8080/&quot;&gt;<br>
http://localhost:8080/&lt;/a&gt;&amp;lt;/a&amp;gt;&lt;br&gt;&lt;br&gt;Intriguingly,&nbsp;if&nbsp;I&nbsp;request&nbsp;locations&nbsp;below&nbsp;the&nbsp;root,&nbsp;things&nbsp;work&nbsp;more&nbsp;OK:&lt;br&gt;%&nbsp;curl&nbsp;&lt;a&nbsp;href=&quot;http://localhost:8080/test/index&quot;&gt;http://localhost:8080/test/index&lt;/a&gt;&lt;br&gt;&lt;br&gt;then&nbsp;it&nbsp;works&nbsp;OK,&nbsp;even&nbsp;though&nbsp;I&nbsp;am&nbsp;registering&nbsp;the&nbsp;cherrypy&nbsp;at&nbsp;the&nbsp;root&nbsp;of&nbsp;the&nbsp;site.<br>
&lt;br&gt;&lt;br&gt;I&amp;#39;ve&nbsp;experimented,&nbsp;and&nbsp;if&nbsp;I&nbsp;register&nbsp;the&nbsp;cherrypy&nbsp;site&nbsp;in&nbsp;a&nbsp;subdir,&nbsp;everything&nbsp;works&nbsp;normally&nbsp;as&nbsp;expected!&lt;br&gt;&lt;br&gt;Here&amp;#39;s&nbsp;the&nbsp;code&nbsp;that&nbsp;puts&nbsp;it&nbsp;at&nbsp;the&nbsp;root&nbsp;of&nbsp;the&nbsp;site.&amp;nbsp;&nbsp;I&amp;#39;ve&nbsp;tested&nbsp;this&nbsp;code&nbsp;with&nbsp;a&nbsp;basic&nbsp;WSGI&nbsp;app,<br>
&lt;br&gt;and&nbsp;it&nbsp;works&nbsp;OK.&amp;nbsp;&nbsp;Only&nbsp;cherrypy&nbsp;seems&nbsp;to&nbsp;have&nbsp;this&nbsp;problem.&amp;nbsp;&nbsp;One&nbsp;clue&nbsp;is&nbsp;that&nbsp;the&nbsp;logger&nbsp;shows&lt;br&gt;that&nbsp;the&nbsp;URL&nbsp;being&nbsp;requested&nbsp;is&nbsp;&amp;#39;//&amp;#39;&nbsp;instead&nbsp;of&nbsp;&amp;#39;/&amp;#39;:&lt;br&gt;&lt;br&gt;2007-03-18&nbsp;19:07:02-0700&nbsp;[HTTPChannel,6,&lt;a&nbsp;href=&quot;http://127.0.0.1&quot;&gt;<br>
127.0.0.1&lt;/a&gt;]&nbsp;&lt;a&nbsp;href=&quot;http://127.0.0.1&quot;&gt;127.0.0.1&lt;/a&gt;&nbsp;-&nbsp;-&nbsp;[18/Mar/2007:19:07:02]&nbsp;&amp;quot;GET&nbsp;//&nbsp;HTTP/1.1&amp;quot;&nbsp;302&nbsp;97&nbsp;&amp;quot;&amp;quot;&nbsp;&amp;quot;curl/7.15.1&nbsp;(i686-suse-linux)&nbsp;libcurl/7.15.1&nbsp;OpenSSL/0.9.8a&nbsp;zlib/1.2.3&nbsp;libidn/0.6.0&amp;quot;<br>
&lt;br&gt;&lt;br&gt;Here&amp;#39;s&nbsp;the&nbsp;nearly&nbsp;working&nbsp;test&nbsp;example:&lt;br&gt;&lt;br&gt;&lt;br&gt;from&nbsp;twisted.application&nbsp;import&nbsp;service,&nbsp;strports&lt;br&gt;from&nbsp;twisted.web2&nbsp;import&nbsp;server,&nbsp;channel&lt;br&gt;from&nbsp;twisted.web2&nbsp;import&nbsp;log&lt;br&gt;from&nbsp;twisted.web2&nbsp;import&nbsp;wsgi<br>
&lt;br&gt;from&nbsp;twisted.web2.wsgi&nbsp;import&nbsp;WSGIResource&lt;br&gt;from&nbsp;cherrypy._cpwsgi&nbsp;import&nbsp;wsgiApp&lt;br&gt;import&nbsp;cherrypy&lt;br&gt;&lt;br&gt;##&nbsp;Basic&nbsp;cherrypy&nbsp;index&nbsp;object&nbsp;that&nbsp;dumps&nbsp;the&nbsp;WSGI&nbsp;environment&lt;br&gt;class&nbsp;Root(object):&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;@cherrypy.expose<br>
&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;def&nbsp;index(self):&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;s&nbsp;=&nbsp;[]&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;for&nbsp;key&nbsp;in&nbsp;cherrypy.request.wsgi_environ:&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;s.append(&amp;quot;%s=%s&amp;lt;br/&amp;gt;&amp;quot;&nbsp;%&nbsp;(key,&nbsp;cherrypy.request.wsgi_environ[key]))&lt;br&gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;return&nbsp;&amp;quot;&amp;quot;.join(s)<br>
&lt;br&gt;&lt;br&gt;##&nbsp;Run&nbsp;this&nbsp;site&nbsp;using&nbsp;&amp;quot;twistd&nbsp;-noy&amp;quot;&lt;br&gt;if&nbsp;__name__&nbsp;==&nbsp;&amp;#39;__builtin__&amp;#39;:&lt;br&gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;##&nbsp;Create&nbsp;an&nbsp;instance&nbsp;of&nbsp;the&nbsp;root&nbsp;object&nbsp;and&nbsp;mount&nbsp;it&nbsp;at&nbsp;/&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;r&nbsp;=&nbsp;Root()&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;cherrypy.tree.mount(r,&nbsp;&amp;#39;/&amp;#39;)<br>
&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;wsgi&nbsp;=&nbsp;wsgi.WSGIResource(wsgiApp)&lt;br&gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;##&nbsp;Set&nbsp;up&nbsp;the&nbsp;cherrypy&nbsp;environment&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;cherrypy.config.update({&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;#39;server.environment&amp;#39;:&amp;#39;production&amp;#39;,&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&amp;#39;server.socketHost&amp;#39;:&amp;#39;<br>
&lt;a&nbsp;href=&quot;http://127.0.0.1&quot;&gt;127.0.0.1&lt;/a&gt;&amp;#39;,&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;})&lt;br&gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;##&nbsp;Start&nbsp;the&nbsp;cherrypy&nbsp;server;&nbsp;don&amp;#39;t&nbsp;actually&nbsp;run&nbsp;an&nbsp;HTTP&nbsp;server,&nbsp;though&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;cherrypy.server.start(initOnly=True,&nbsp;serverClass=None)&lt;br&gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;##&nbsp;Setup&nbsp;default&nbsp;common&nbsp;access&nbsp;logging<br>
&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;res&nbsp;=&nbsp;log.LogWrapperResource(wsgi)&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;log.DefaultCommonAccessLoggingObserver().start()&lt;br&gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;#&nbsp;Create&nbsp;twisted&nbsp;web2&nbsp;site&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;site&nbsp;=&nbsp;server.Site(res)&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;application&nbsp;=&nbsp;service.Application(&amp;quot;demo&amp;quot;)<br>
&lt;br&gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;##&nbsp;Launch&nbsp;the&nbsp;HTTP&nbsp;site&nbsp;at&nbsp;port&nbsp;8080&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;s&nbsp;=&nbsp;strports.service(&amp;#39;tcp:8080&amp;#39;,&nbsp;channel.HTTPFactory(site))&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;s.setServiceParent(application)&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&nbsp;&lt;br&gt;&lt;br&gt;<br>

</tt>
