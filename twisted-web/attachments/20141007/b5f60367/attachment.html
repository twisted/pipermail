<tt>
&lt;html&gt;&lt;head&gt;&lt;meta&nbsp;http-equiv=&quot;Content-Type&quot;&nbsp;content=&quot;text/html&nbsp;charset=us-ascii&quot;&gt;&lt;/head&gt;&lt;body&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-webkit-nbsp-mode:&nbsp;space;&nbsp;-webkit-line-break:&nbsp;after-white-space;&quot;&gt;&lt;br&gt;&lt;div&gt;&lt;div&gt;On&nbsp;Oct&nbsp;6,&nbsp;2014,&nbsp;at&nbsp;7:55&nbsp;AM,&nbsp;Carl&nbsp;Waldbieser&nbsp;&lt;&lt;a&nbsp;href=&quot;mailto:cwaldbieser@gmail.com&quot;&gt;cwaldbieser@gmail.com&lt;/a&gt;&gt;&nbsp;wrote:&lt;/div&gt;&lt;br&nbsp;class=&quot;Apple-interchange-newline&quot;&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&gt;I&nbsp;have&nbsp;a&nbsp;couple&nbsp;projects&nbsp;I&nbsp;am&nbsp;working&nbsp;on&nbsp;where&nbsp;I&nbsp;would&nbsp;like&nbsp;to&nbsp;make&nbsp;HTTPS&nbsp;requests&nbsp;using&nbsp;Twisted.&nbsp;&nbsp;I&nbsp;reviewed&nbsp;the&nbsp;articles&nbsp;&quot;Using&nbsp;TLS&nbsp;in&nbsp;Twisted&quot;&nbsp;[1]&nbsp;and&nbsp;&quot;Using&nbsp;the&nbsp;Twisted&nbsp;Web&nbsp;Client&quot;&nbsp;(section&nbsp;&quot;HTTP&nbsp;over&nbsp;SSL&quot;)&nbsp;[2].&nbsp;&nbsp;It&nbsp;seems&nbsp;like&nbsp;various&nbsp;options&nbsp;exist&nbsp;that&nbsp;will&nbsp;allow&nbsp;me&nbsp;to&nbsp;make&nbsp;HTTPS&nbsp;requests&nbsp;using&nbsp;the&nbsp;CA&nbsp;certs&nbsp;bundled&nbsp;on&nbsp;the&nbsp;client&nbsp;OS.&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Thank&nbsp;you&nbsp;for&nbsp;diligently&nbsp;studying&nbsp;all&nbsp;of&nbsp;our&nbsp;existing&nbsp;documentation&nbsp;on&nbsp;the&nbsp;subject.&nbsp;&nbsp;I&nbsp;apologize&nbsp;for&nbsp;its&nbsp;deficiencies.&nbsp;&nbsp;This&nbsp;API&nbsp;has&nbsp;grown&nbsp;in&nbsp;fits&nbsp;and&nbsp;starts&nbsp;over&nbsp;the&nbsp;last&nbsp;decade&nbsp;or&nbsp;so&nbsp;and&nbsp;it&nbsp;has&nbsp;not&nbsp;ended&nbsp;in&nbsp;the&nbsp;most&nbsp;consistent&nbsp;shape.&nbsp;&nbsp;Hopefully&nbsp;we&nbsp;can&nbsp;improve&nbsp;this&nbsp;based&nbsp;on&nbsp;your&nbsp;feedback&nbsp;for&nbsp;the&nbsp;next&nbsp;release.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;I&nbsp;would&nbsp;like&nbsp;to&nbsp;be&nbsp;able&nbsp;to&nbsp;tell&nbsp;my&nbsp;HTTPS&nbsp;clients&nbsp;to&nbsp;accept&nbsp;specific&nbsp;*internal*&nbsp;CA&nbsp;certificates&nbsp;*in&nbsp;addition*&nbsp;to&nbsp;the&nbsp;certificates&nbsp;provided&nbsp;by&nbsp;the&nbsp;OS.&nbsp;&nbsp;Initially,&nbsp;I&nbsp;thought&nbsp;this&nbsp;might&nbsp;be&nbsp;possible&nbsp;by&nbsp;passing&nbsp;a&nbsp;custom&nbsp;t.w.c.BrowserLikePolicyForHTTPS&nbsp;to&nbsp;the&nbsp;t.w.c.Agent&nbsp;as&nbsp;its&nbsp;`contextFactory`&nbsp;argument.&nbsp;I&nbsp;wasn't&nbsp;quite&nbsp;sure&nbsp;how&nbsp;to&nbsp;go&nbsp;about&nbsp;doing&nbsp;this,&nbsp;so&nbsp;I&nbsp;got&nbsp;some&nbsp;advice&nbsp;on&nbsp;StackOverflow&nbsp;[3].&nbsp;With&nbsp;some&nbsp;slight&nbsp;modifications&nbsp;to&nbsp;the&nbsp;solution&nbsp;presented&nbsp;there,&nbsp;I&nbsp;was&nbsp;able&nbsp;to&nbsp;create&nbsp;a&nbsp;custom&nbsp;Trust&nbsp;Root&nbsp;that&nbsp;accepted&nbsp;a&nbsp;list&nbsp;of&nbsp;paths&nbsp;to&nbsp;CA&nbsp;cert&nbsp;files&nbsp;in&nbsp;PEM&nbsp;format&nbsp;that&nbsp;I&nbsp;wanted&nbsp;to&nbsp;add&nbsp;to&nbsp;the&nbsp;client.&nbsp;The&nbsp;custom&nbsp;trust&nbsp;root&nbsp;is&nbsp;passed&nbsp;to&nbsp;the&nbsp;BrowserLikePolicyForHTTPS.&nbsp;The&nbsp;policy&nbsp;is&nbsp;passed&nbsp;to&nbsp;the&nbsp;Agent.&lt;br&gt;&lt;br&gt;The&nbsp;one&nbsp;hitch&nbsp;is&nbsp;that&nbsp;the&nbsp;IOpenSSLTrustRoot&nbsp;interface&nbsp;upon&nbsp;which&nbsp;my&nbsp;custom&nbsp;trust&nbsp;root&nbsp;is&nbsp;based&nbsp;is&nbsp;located&nbsp;in&nbsp;`twisted.internet._sslverify`[4],&nbsp;which&nbsp;if&nbsp;I&nbsp;understand&nbsp;correctly,&nbsp;is&nbsp;a&nbsp;private&nbsp;module&nbsp;and&nbsp;not&nbsp;supposed&nbsp;to&nbsp;be&nbsp;used&nbsp;as&nbsp;an&nbsp;API.&nbsp;&nbsp;Is&nbsp;there&nbsp;a&nbsp;*supported*&nbsp;way&nbsp;to&nbsp;specify&nbsp;*additional*&nbsp;CA&nbsp;certs&nbsp;to&nbsp;use&nbsp;during&nbsp;SSL&nbsp;verification&nbsp;when&nbsp;making&nbsp;HTTPS&nbsp;requests&nbsp;using&nbsp;Twisted?&nbsp;If&nbsp;so,&nbsp;what&nbsp;is&nbsp;the&nbsp;recommended&nbsp;method?&lt;br&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Well,&nbsp;the&nbsp;&quot;good&quot;&nbsp;news&nbsp;is,&nbsp;on&nbsp;OS&nbsp;X,&nbsp;if&nbsp;you're&nbsp;using&nbsp;the&nbsp;bundled&nbsp;system&nbsp;OpenSSL,&nbsp;you&nbsp;can't&nbsp;turn&nbsp;this&nbsp;behavior&nbsp;&lt;i&gt;off&lt;/i&gt;:&nbsp;&lt;&lt;a&nbsp;href=&quot;https://hynek.me/articles/apple-openssl-verification-surprises/&quot;&gt;https://hynek.me/articles/apple-openssl-verification-surprises/&lt;/a&gt;&gt;.&nbsp;&nbsp;Although&nbsp;we&nbsp;may&nbsp;eventually&nbsp;ship&nbsp;a&nbsp;mitigation&nbsp;for&nbsp;this&nbsp;vulnerability&nbsp;in&nbsp;Twisted,&nbsp;so&nbsp;probably&nbsp;best&nbsp;not&nbsp;to&nbsp;rely&nbsp;on&nbsp;that&nbsp;long-term&nbsp;:).&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;bad&nbsp;news&nbsp;is&nbsp;that,&nbsp;no,&nbsp;we&nbsp;really&nbsp;had&nbsp;two&nbsp;use-cases&nbsp;in&nbsp;mind&nbsp;here;&nbsp;either:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;ol&nbsp;class=&quot;MailOutline&quot;&gt;&lt;li&gt;your&nbsp;software&nbsp;is&nbsp;trusting&nbsp;the&nbsp;trust&nbsp;cartel&nbsp;as&nbsp;specified&nbsp;by&nbsp;the&nbsp;operating&nbsp;system&nbsp;vendor&nbsp;and/or&nbsp;the&nbsp;user,&nbsp;and&nbsp;your&nbsp;software&nbsp;is&nbsp;opting&nbsp;out&nbsp;of&nbsp;any&nbsp;trust&nbsp;configuration,&nbsp;or&lt;/li&gt;&lt;li&gt;your&nbsp;software&nbsp;has&nbsp;a&nbsp;specific&nbsp;understanding&nbsp;of&nbsp;its&nbsp;trust&nbsp;root&nbsp;and&nbsp;is&nbsp;specifying&nbsp;it&nbsp;explicitly,&nbsp;because&nbsp;it&nbsp;knows&nbsp;who&nbsp;it&nbsp;expects&nbsp;the&nbsp;peer&nbsp;to&nbsp;be&nbsp;signed&nbsp;by&lt;/li&gt;&lt;/ol&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;So&nbsp;while&nbsp;your&nbsp;use-case&nbsp;&lt;i&gt;sort&nbsp;of&lt;/i&gt;&nbsp;makes&nbsp;sense&nbsp;to&nbsp;me,&nbsp;it&nbsp;didn't&nbsp;come&nbsp;up&nbsp;in&nbsp;the&nbsp;last&nbsp;round&nbsp;of&nbsp;SSL&nbsp;enhancements&nbsp;and&nbsp;there's&nbsp;no&nbsp;straightforward&nbsp;way&nbsp;to&nbsp;go&nbsp;about&nbsp;this.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;However,&nbsp;it&nbsp;should&nbsp;nevertheless&nbsp;be&nbsp;possible&nbsp;to&nbsp;do&nbsp;it&nbsp;without&nbsp;delving&nbsp;into&nbsp;the&nbsp;private&nbsp;API.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;If&nbsp;you&nbsp;write&nbsp;your&nbsp;own&nbsp;IOpenSSLClientConnectionCreator,&nbsp;like&nbsp;this:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;blockquote&nbsp;style=&quot;margin:&nbsp;0&nbsp;0&nbsp;0&nbsp;40px;&nbsp;border:&nbsp;none;&nbsp;padding:&nbsp;0px;&quot;&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;&lt;div&gt;from&nbsp;twisted.internet.interfaces&nbsp;import&nbsp;IOpenSSLClientConnectionCreator&lt;/div&gt;&lt;div&gt;from&nbsp;twisted.python.components&nbsp;import&nbsp;proxyForInterface&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;class&nbsp;AddExtraTrustRoots(proxyForInterface(IOpenSSLClientConnectionCreator)):&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;__init__(self,&nbsp;extraTrustRoots,&nbsp;original):&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;self._extraTrustRoots&nbsp;=&nbsp;extraTrustRoots&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;super(AddExtraTrustRoots,&nbsp;self).__init__(original)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;clientConnectionForTLS(self,&nbsp;tlsProtocol):&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;connection&nbsp;=&nbsp;(super(AddExtraTrustRoots,&nbsp;self)&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.clientConnectionForTLS(tlsProtocol))&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cert_store&nbsp;=&nbsp;connection.get_context().get_cert_store()&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;for&nbsp;cert&nbsp;in&nbsp;self._extraTrustRoots:&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cert_store.add_cert(cert)&lt;/div&gt;&lt;div&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;connection&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;you&nbsp;can&nbsp;delegate&nbsp;to&nbsp;the&nbsp;pyOpenSSL&nbsp;API&nbsp;for&nbsp;manipulating&nbsp;the&nbsp;trust&nbsp;settings&nbsp;of&nbsp;the&nbsp;connection,&nbsp;although&nbsp;Twisted&nbsp;will&nbsp;not&nbsp;provide&nbsp;a&nbsp;high-level&nbsp;wrapper&nbsp;for&nbsp;this.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;You&nbsp;can&nbsp;then&nbsp;use&nbsp;the&nbsp;above&nbsp;wrapper&nbsp;like:&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;blockquote&nbsp;style=&quot;margin:&nbsp;0&nbsp;0&nbsp;0&nbsp;40px;&nbsp;border:&nbsp;none;&nbsp;padding:&nbsp;0px;&quot;&gt;&lt;div&gt;options&nbsp;=&nbsp;AddExtraTrustRoots([OpenSSL.crypto.load_certificate(OpenSSL.crypto.FILETYPE_PEM,&nbsp;&quot;...&quot;),&nbsp;...],&nbsp;optionsForClientTLS(u&quot;&lt;a&nbsp;href=&quot;http://google.com&quot;&gt;google.com&lt;/a&gt;&quot;))&lt;/div&gt;&lt;/blockquote&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;haven't&nbsp;tested&nbsp;this,&nbsp;let&nbsp;me&nbsp;know&nbsp;if&nbsp;I've&nbsp;overlooked&nbsp;something&nbsp;terrible&nbsp;:).&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;Another&nbsp;related&nbsp;concept&nbsp;that&nbsp;was&nbsp;not&nbsp;clear&nbsp;to&nbsp;me&nbsp;is&nbsp;how&nbsp;one&nbsp;might&nbsp;specify&nbsp;the&nbsp;SSL&nbsp;method&nbsp;(e.g.&nbsp;SSLv23_METHOD,&nbsp;SSLv3_METHOD,&nbsp;etc.)&nbsp;when&nbsp;making&nbsp;the&nbsp;request.&nbsp;Is&nbsp;there&nbsp;some&nbsp;recommended&nbsp;way&nbsp;to&nbsp;pass&nbsp;options&nbsp;to&nbsp;indicate&nbsp;the&nbsp;SSL&nbsp;method&nbsp;that&nbsp;ought&nbsp;to&nbsp;be&nbsp;used?&lt;/div&gt;&lt;/blockquote&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;The&nbsp;default&nbsp;configuration&nbsp;allows&nbsp;for&nbsp;TLSv1.0,&nbsp;TLSv1.1,&nbsp;and&nbsp;TLSv1.2&nbsp;(insofar&nbsp;as&nbsp;those&nbsp;versions&nbsp;are&nbsp;supported&nbsp;by&nbsp;your&nbsp;OpenSSL).&nbsp;&nbsp;Do&nbsp;you&nbsp;really,&nbsp;really,&nbsp;really&nbsp;need&nbsp;to&nbsp;support&nbsp;worse&nbsp;protocol&nbsp;versions&nbsp;than&nbsp;that?&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;You&nbsp;don't&nbsp;actually&nbsp;want&nbsp;to&nbsp;change&nbsp;the&nbsp;&quot;method&quot;,&nbsp;as&nbsp;&quot;method&quot;&nbsp;is&nbsp;a&nbsp;bizarre&nbsp;fiction&nbsp;of&nbsp;the&nbsp;OpenSSL&nbsp;API&nbsp;and&nbsp;is&nbsp;not&nbsp;actually&nbsp;how&nbsp;the&nbsp;protocol&nbsp;works;&nbsp;SSLv23_METHOD&nbsp;is&nbsp;the&nbsp;only&nbsp;&quot;method&quot;&nbsp;that&nbsp;allows&nbsp;protocol&nbsp;version&nbsp;negotiation,&nbsp;so&nbsp;you&nbsp;always&nbsp;want&nbsp;to&nbsp;start&nbsp;there&nbsp;and&nbsp;then&nbsp;set/unset&nbsp;the&nbsp;appropriate&nbsp;OP_NO_*&nbsp;options&nbsp;for&nbsp;the&nbsp;protocol&nbsp;versions&nbsp;you&nbsp;want&nbsp;to&nbsp;exclude.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;This&nbsp;is&nbsp;all&nbsp;pretty&nbsp;tedious&nbsp;and&nbsp;gross&nbsp;so&nbsp;if&nbsp;you're&nbsp;sure&nbsp;you&nbsp;want&nbsp;to&nbsp;do&nbsp;it&nbsp;I&nbsp;will&nbsp;describe&nbsp;how&nbsp;in&nbsp;the&nbsp;next&nbsp;reply&nbsp;:).&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;blockquote&nbsp;type=&quot;cite&quot;&gt;&lt;div&nbsp;dir=&quot;ltr&quot;&gt;&lt;div&nbsp;style=&quot;&quot;&gt;Any&nbsp;guidance&nbsp;would&nbsp;be&nbsp;appreciated.&lt;/div&gt;&lt;/div&gt;&lt;/blockquote&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;hope&nbsp;that&nbsp;this&nbsp;was&nbsp;sufficient!&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;-glyph&lt;/div&gt;&lt;br&gt;&lt;/body&gt;&lt;/html&gt;
</tt>
