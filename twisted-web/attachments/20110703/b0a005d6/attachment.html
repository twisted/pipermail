<tt>
I&nbsp;have&nbsp;some&nbsp;progress&nbsp;on&nbsp;the&nbsp;request&nbsp;timeout.&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;I&nbsp;have&nbsp;something&nbsp;that&nbsp;seems&nbsp;to&nbsp;work.&nbsp;But&nbsp;I&nbsp;am&nbsp;sure&nbsp;I&nbsp;have&nbsp;got&nbsp;something&nbsp;wrong..&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;This&nbsp;is&nbsp;a&nbsp;copy&nbsp;of&nbsp;the&nbsp;response.py&nbsp;example&nbsp;with&nbsp;some&nbsp;additions&nbsp;to&nbsp;deal&nbsp;with&nbsp;request&nbsp;timeouts.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;Any&nbsp;chance&nbsp;that&nbsp;someone&nbsp;could&nbsp;take&nbsp;a&nbsp;look&nbsp;and&nbsp;let&nbsp;me&nbsp;know&nbsp;where&nbsp;I&nbsp;have&nbsp;gone&nbsp;wrong.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;#!/usr/bin/env&nbsp;python&lt;/div&gt;&lt;div&gt;#&nbsp;-*-&nbsp;coding:&nbsp;UTF-8&nbsp;-*-&lt;/div&gt;&lt;div&gt;from&nbsp;pprint&nbsp;import&nbsp;pformat&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;from&nbsp;twisted.internet&nbsp;import&nbsp;reactor&lt;/div&gt;&lt;div&gt;from&nbsp;twisted.internet.defer&nbsp;import&nbsp;Deferred&lt;/div&gt;&lt;div&gt;from&nbsp;twisted.internet.protocol&nbsp;import&nbsp;Protocol&lt;/div&gt;&lt;div&gt;from&nbsp;twisted.web.client&nbsp;import&nbsp;Agent&lt;/div&gt;&lt;div&gt;<br>
from&nbsp;twisted.web.http_headers&nbsp;import&nbsp;Headers&lt;/div&gt;&lt;div&gt;import&nbsp;urllib&lt;/div&gt;&lt;div&gt;import&nbsp;time&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;class&nbsp;BeginningPrinter(Protocol):&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;def&nbsp;__init__(self,&nbsp;finished):&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;self.finished&nbsp;=&nbsp;finished&lt;/div&gt;<br>
&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;self.remaining&nbsp;=&nbsp;1024&nbsp;*&nbsp;10&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;def&nbsp;dataReceived(self,&nbsp;bytes):&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;if&nbsp;self.remaining:&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;display&nbsp;=&nbsp;bytes[:self.remaining]&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;print&nbsp;&amp;#39;Some&nbsp;data&nbsp;received:&amp;#39;,&nbsp;bytes,&nbsp;&amp;#39;no&nbsp;bytes&amp;#39;,&nbsp;len(bytes)&lt;/div&gt;<br>
&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;print&nbsp;display&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;self.remaining&nbsp;-=&nbsp;len(display)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;def&nbsp;connectionLost(self,&nbsp;reason):&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;print&nbsp;&amp;#39;Finished&nbsp;receiving&nbsp;body:&amp;#39;,&nbsp;reason.getErrorMessage()&lt;/div&gt;<br>
&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;self.finished.callback(None)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;def&nbsp;do_cancel(d):&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;print&nbsp;&amp;#39;got&nbsp;do&nbsp;cancel&amp;#39;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;d._canceller(d)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;from&nbsp;stringprod_resp&nbsp;import&nbsp;StringProducer&lt;/div&gt;<br>
&lt;div&gt;my_data&nbsp;=&nbsp;[&amp;#39;fred&amp;#39;,&amp;#39;ted&amp;#39;,&amp;#39;red&amp;#39;,&amp;#39;fred&amp;#39;]&lt;/div&gt;&lt;div&gt;for&nbsp;c,&nbsp;a&nbsp;in&nbsp;enumerate(my_data):&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;if&nbsp;c&nbsp;&amp;gt;&nbsp;2:&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;time.sleep(10)&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;agent&nbsp;=&nbsp;Agent(reactor)&lt;/div&gt;&lt;div&gt;<br>
 &nbsp; &nbsp;#postdata&nbsp;=&nbsp;urllib.urlencode({&amp;#39;Username&amp;#39;&nbsp;:&nbsp;&amp;#39;nsp05682&amp;#39;,&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;#&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&amp;#39;Password&amp;#39;&nbsp;:&nbsp;&amp;#39;rocs345&amp;#39;,&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;#&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&amp;#39;Action&amp;#39;&nbsp;:&nbsp;&amp;#39;CheckCredits&amp;#39;})&lt;/div&gt;<br>
&lt;div&gt; &nbsp; &nbsp;postdata&nbsp;=&nbsp;urllib.urlencode({&amp;#39;the-field&amp;#39;&nbsp;:&nbsp;a})&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;body&nbsp;=&nbsp;StringProducer(postdata)&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;print&nbsp;&amp;#39;body&amp;#39;,&nbsp;body&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;d&nbsp;=&nbsp;agent.request(&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;&amp;#39;POST&amp;#39;,&lt;/div&gt;<br>
&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;&amp;#39;&lt;a&nbsp;href=&quot;http://www.johna.com/test&quot;&gt;http://www.johna.com/test&lt;/a&gt;&amp;#39;,&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;Headers({&amp;#39;User-Agent&amp;#39;:&nbsp;[&amp;#39;Twisted&nbsp;Web&nbsp;Client&amp;#39;],&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;Accept-Encoding&amp;#39;:[&amp;#39;identity&amp;#39;],&lt;/div&gt;<br>
&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &amp;#39;Content-Type&amp;#39;:[&amp;#39;application/x-www-form-urlencoded&amp;#39;]}),&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;body)&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;#&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&amp;#39;Content-Length&amp;#39;:[str(len(postdata))],&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;<br>
&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;def&nbsp;cbRequest(response):&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;print&nbsp;&amp;#39;Response&nbsp;version:&amp;#39;,&nbsp;response.version&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;print&nbsp;&amp;#39;Response&nbsp;code:&amp;#39;,&nbsp;response.code&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;print&nbsp;&amp;#39;Response&nbsp;phrase:&amp;#39;,&nbsp;response.phrase&lt;/div&gt;<br>
&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;print&nbsp;&amp;#39;Response&nbsp;headers:&amp;#39;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;print&nbsp;pformat(list(response.headers.getAllRawHeaders()))&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;finished&nbsp;=&nbsp;Deferred()&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;print&nbsp;&amp;#39;response&nbsp;deliverbody&amp;#39;,response.deliverBody&lt;/div&gt;<br>
&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;response.deliverBody(BeginningPrinter(finished))&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;return&nbsp;finished&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;d.addCallback(cbRequest)&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;#reactor.callLater(10,&nbsp;check_timeout,d)&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;#j&nbsp;=&nbsp;dir(d)&lt;/div&gt;&lt;div&gt;<br>
 &nbsp; &nbsp;#print&nbsp;&amp;#39;later&amp;#39;,&nbsp;j&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;#print&nbsp;&amp;#39;fff&nbsp;cancel&amp;#39;,&nbsp;d.cancel&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;#print&nbsp;&amp;#39;fff&nbsp;canceller&amp;#39;,&nbsp;d._canceller&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;#k&nbsp;=&nbsp;dir(agent.request)&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;#print&nbsp;&amp;#39;kkk&amp;#39;,&nbsp;k&lt;/div&gt;<br>
&lt;div&gt; &nbsp; &nbsp;#print&nbsp;&amp;#39;reacotcallater&amp;#39;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;#if&nbsp;a&nbsp;==&nbsp;&amp;#39;fred&amp;#39;:&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;#&nbsp; &nbsp; print&nbsp;&amp;#39;cancel&nbsp;&amp;#39;,&nbsp;a&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;no_response&nbsp;=&nbsp;reactor.callLater(40,&nbsp;do_cancel,&nbsp;d)&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;#d.cancel()&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;def&nbsp;got_error(o):&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;print&nbsp;&amp;#39;got&nbsp;error&amp;#39;,&nbsp;str(o)&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;reason&nbsp;=&nbsp;dir(o)&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;print&nbsp;&amp;#39;got&nbsp;reason&amp;#39;,&nbsp;o.getErrorMessage&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;def&nbsp;cbShutdown(ignored,&nbsp;no_response):&lt;/div&gt;<br>
&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;print&nbsp;&amp;#39;got&nbsp;finish&nbsp;ignored&amp;#39;,&nbsp;ignored&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;#print&nbsp;&amp;#39;no&nbsp;rsposne&amp;#39;,&nbsp;no_response&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;norep&nbsp;=&nbsp;dir(no_response)&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;#print&nbsp;&amp;#39;kkk&amp;#39;,&nbsp;norep&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;if&nbsp;no_response.cancelled:&lt;/div&gt;<br>
&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;print&nbsp;&amp;#39;already&nbsp;cancelled&amp;#39;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp;else:&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;print&nbsp;&amp;#39;not&nbsp;cancelled&amp;#39;&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;no_response.cancel()&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;no_response&nbsp;=&nbsp;None&lt;/div&gt;&lt;div&gt;<br>
 &nbsp; &nbsp; &nbsp; &nbsp;#reactor.stop()&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;d.addCallback(cbShutdown,&nbsp;no_response)&lt;/div&gt;&lt;div&gt; &nbsp; &nbsp;d.addErrback(got_error)&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;reactor.run()&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;<br>

</tt>
