from zope.interface import implements

from twisted.application.service import IServiceMaker
from twisted.application import internet
from twisted.plugin import IPlugin
from twisted.python import usage

from meteo import meteoFactory

class Options(usage.Options):
	optParameters = [	['port', 'p', 80, 'The port number to listen on.'],
						['ipv4_address', '4', None, 'The IPv4 address to listen on.'],
						['ipv6_address', '6', None, 'The IPv6 address to listen on.']]

class MeteoServiceMaker(object):
	implements(IServiceMaker, IPlugin)
	tapname = 'meteo'
	description = 'A web application for the meteo package'
	options = Options
	
	def makeService(self, options):
		"""
		Constructs a TCP server from a factory defined in meteo.py
		"""
		return internet.TCPServer(	int(options['port'], 
									interface=options['ipv4_address'],
									meteoFactory())				

serviceMaker = MeteoServiceMaker()
