<tt>
&lt;HTML&gt;&lt;BODY&nbsp;style=&quot;word-wrap:&nbsp;break-word;&nbsp;-khtml-nbsp-mode:&nbsp;space;&nbsp;-khtml-line-break:&nbsp;after-white-space;&nbsp;&quot;&gt;&lt;BR&gt;&lt;DIV&gt;&lt;DIV&gt;On&nbsp;Oct&nbsp;19,&nbsp;2005,&nbsp;at&nbsp;4:39&nbsp;PM,&nbsp;David&nbsp;Remahl&nbsp;wrote:&lt;/DIV&gt;&lt;BLOCKQUOTE&nbsp;type=&quot;cite&quot;&gt;&lt;DIV&gt;I'm&nbsp;not&nbsp;familiar&nbsp;with&nbsp;web2.vhost.VHostURIRewrite,&nbsp;but&nbsp;will&nbsp;check&nbsp;it&nbsp;out...&quot;Configuration&nbsp;time&quot;,&nbsp;you&nbsp;say.&nbsp;I&nbsp;assume&nbsp;that&nbsp;means&nbsp;at&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;handling&nbsp;of&nbsp;a&nbsp;request,&nbsp;not&nbsp;when&nbsp;the&nbsp;application&nbsp;is&nbsp;set&nbsp;up&nbsp;and&nbsp;configured?&nbsp;If&nbsp;so,&nbsp;that&nbsp;sounds&nbsp;like&nbsp;a&nbsp;good&nbsp;solution&nbsp;in&nbsp;many&nbsp;cases.&lt;/DIV&gt;&lt;/BLOCKQUOTE&gt;&lt;DIV&gt;&lt;BR&nbsp;class=&quot;khtml-block-placeholder&quot;&gt;&lt;/DIV&gt;&lt;DIV&gt;In&nbsp;fact&nbsp;configuration&nbsp;time&nbsp;does&nbsp;mean&nbsp;in&nbsp;the&nbsp;.tac. &nbsp;You&nbsp;create&nbsp;a&nbsp;vhost.VHostURIRewrite&nbsp;resource&nbsp;like&nbsp;so:&lt;/DIV&gt;&lt;DIV&gt;&lt;BR&nbsp;class=&quot;khtml-block-placeholder&quot;&gt;&lt;/DIV&gt;&lt;DIV&gt; &nbsp; root&nbsp;=&nbsp;vhost.VHostURIRewrite(uri='&lt;A&nbsp;href=&quot;http://host&quot;&gt;http://host&lt;/A&gt;:port/path',&nbsp;resource=realrootresource)&lt;/DIV&gt;&lt;DIV&gt; &nbsp; server.Site(root)&lt;/DIV&gt;&lt;DIV&gt;&lt;BR&nbsp;class=&quot;khtml-block-placeholder&quot;&gt;&lt;/DIV&gt;&lt;DIV&gt;There&nbsp;is&nbsp;also&nbsp;a&nbsp;AutoVHostURIRewrite&nbsp;which&nbsp;makes&nbsp;use&nbsp;of&nbsp;x-app-scheme,&nbsp;x-forwarded-host,&nbsp;x-app-location,&nbsp;and&nbsp;x-forwarded-for&nbsp;headers&nbsp;to&nbsp;determine&nbsp;the&nbsp;real&nbsp;hostname&nbsp;port&nbsp;path&nbsp;etc&nbsp;and&nbsp;also&nbsp;the&nbsp;client&nbsp;ip&nbsp;address. &nbsp;I'm&nbsp;fairly&nbsp;sure&nbsp;this&nbsp;isn't&nbsp;vulnerable&nbsp;to&nbsp;a&nbsp;similar&nbsp;attack&nbsp;as&nbsp;VHostMonsterResource&nbsp;but&nbsp;I&nbsp;haven't&nbsp;done&nbsp;an&nbsp;extensive&nbsp;audit&nbsp;of&nbsp;that&nbsp;particular&nbsp;code.  &lt;/DIV&gt;&lt;BR&gt;&lt;BLOCKQUOTE&nbsp;type=&quot;cite&quot;&gt;&lt;DIV&gt;Only&nbsp;allowing&nbsp;a&nbsp;single&nbsp;&quot;invocation&quot;&nbsp;of&nbsp;the&nbsp;monster&nbsp;resource&nbsp;is&nbsp;insufficient&nbsp;in&nbsp;certain&nbsp;situations,&nbsp;namely&nbsp;when&nbsp;&lt;A&nbsp;href=&quot;http://internalserver:1234&quot;&gt;http://internalserver:1234&lt;/A&gt;/&nbsp;is&nbsp;accessible&nbsp;from&nbsp;the&nbsp;outside&nbsp;and&nbsp;not&nbsp;_exclusively_&nbsp;by&nbsp;the&nbsp;reverse&nbsp;proxy.&nbsp;This&nbsp;might&nbsp;also&nbsp;be&nbsp;a&nbsp;problem&nbsp;with&nbsp;the&nbsp;VHostURIRewrite&nbsp;approach?&lt;/DIV&gt;&lt;/BLOCKQUOTE&gt;&lt;BR&gt;&lt;/DIV&gt;&lt;DIV&gt;It&nbsp;would&nbsp;be&nbsp;a&nbsp;problem&nbsp;with&nbsp;AutoVHostURIRewrite&nbsp;but&nbsp;not&nbsp;a&nbsp;problem&nbsp;with&nbsp;VHostURIRewrite,&nbsp;because&nbsp;VHostURIRewrite&nbsp;would&nbsp;mangle&nbsp;the&nbsp;request&nbsp;unconditionally&nbsp;and&nbsp;if&nbsp;the&nbsp;client&nbsp;clicked&nbsp;an&nbsp;absolute&nbsp;link&nbsp;would&nbsp;end&nbsp;up&nbsp;at&nbsp;the&nbsp;proper&nbsp;location&nbsp;anyway. &nbsp; This&nbsp;unconditional&nbsp;mangling&nbsp;might&nbsp;have&nbsp;other&nbsp;implications&nbsp;if&nbsp;internalserver:1234&nbsp;is&nbsp;accessible&nbsp;from&nbsp;outside&nbsp;but&nbsp;in&nbsp;my&nbsp;opinion&nbsp;that's&nbsp;just&nbsp;more&nbsp;of&nbsp;a&nbsp;reason&nbsp;to&nbsp;not&nbsp;have&nbsp;that&nbsp;kind&nbsp;of&nbsp;configuration.&lt;/DIV&gt;&lt;DIV&gt;&lt;BR&nbsp;class=&quot;khtml-block-placeholder&quot;&gt;&lt;/DIV&gt;&lt;DIV&gt;-David&lt;/DIV&gt;&lt;FONT&nbsp;class=&quot;Apple-style-span&quot;&nbsp;color=&quot;#0000DD&quot;&gt;&lt;/FONT&gt;&lt;/BODY&gt;&lt;/HTML&gt;
</tt>
