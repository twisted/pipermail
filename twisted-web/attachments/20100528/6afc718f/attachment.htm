<tt>
hi!&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;i&amp;#39;m&nbsp;currently&nbsp;writing&nbsp;a&nbsp;reverse&nbsp;proxy&nbsp;with&nbsp;twisted&nbsp;and&nbsp;i&amp;#39;ve&nbsp;a&nbsp;problem&nbsp;with&nbsp;a&nbsp;deferred &lt;/div&gt;&lt;div&gt;function&nbsp;in&nbsp;my&nbsp;handleHeader&nbsp;method.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;the&nbsp;code&nbsp;looks&nbsp;simplified&nbsp;like&nbsp;this:&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;div&gt;class&nbsp;MyProxyClient(proxy.ProxyClient):&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;@defer.inlineCallbacks&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;def&nbsp;handleHeader(self,&nbsp;key,&nbsp;value):&lt;/div&gt;<br>
&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;if&nbsp;key.lower()&nbsp;==&nbsp;&amp;#39;location&amp;#39;:&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;clientCreator&nbsp;=&nbsp;protocol.ClientCreator(reactor,&nbsp;Redis,&nbsp;db=3)&lt;/div&gt;<br>
&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;redis&nbsp;=&nbsp;yield&nbsp;clientCreator.connectTCP(&amp;quot;localhost&amp;quot;,&nbsp;6379)&lt;/div&gt;&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;value&nbsp;=&nbsp;yield&nbsp;redis.get(&amp;#39;myproxy:hashcode:%s&amp;#39;&nbsp;%&nbsp;value)&lt;/div&gt;<br>
&lt;div&gt;&lt;span&nbsp;class=&quot;Apple-tab-span&quot;&nbsp;style=&quot;white-space:pre&quot;&gt;&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&nbsp&lt;/span&gt;proxy.ProxyClient.handleHeader(self,key,value)&lt;/div&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&nbsp;clear=&quot;all&quot;&gt;as&nbsp;the&nbsp;handleHeader&nbsp;caller&nbsp;doesn&amp;#39;t&nbsp;wait&nbsp;for&nbsp;a&nbsp;deferred&nbsp;to&nbsp;finish,&nbsp;the&nbsp;location&nbsp;header&nbsp;is &lt;/div&gt;<br>
&lt;div&gt;added&nbsp;after&nbsp;handleResponseEnd&nbsp;is&nbsp;already&nbsp;called&nbsp;and&nbsp;therefore&nbsp;never&nbsp;makes&nbsp;it&nbsp;to&nbsp;the&nbsp;client.&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;is&nbsp;there&nbsp;a&nbsp;way&nbsp;to&nbsp;convert&nbsp;the&nbsp;non-blocking&nbsp;redis&nbsp;call&nbsp;to&nbsp;a&nbsp;blocking&nbsp;redis&nbsp;call?&lt;/div&gt;&lt;div&gt;i&nbsp;know&nbsp;that&nbsp;there&amp;#39;s&nbsp;a&nbsp;blocking&nbsp;client&nbsp;library&nbsp;for&nbsp;redis&nbsp;but&nbsp;i&amp;#39;d&nbsp;rather&nbsp;use&nbsp;only txredis&nbsp;if&nbsp;possible.&lt;/div&gt;<br>
&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;regards,&lt;/div&gt;&lt;div&gt;  stefan&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;&lt;br&gt;--&nbsp;&lt;br&gt;Stefan&nbsp;Grosz&nbsp;&amp;lt;&lt;a&nbsp;href=&quot;mailto:stefan@grosz.at&quot;&gt;stefan@grosz.at&lt;/a&gt;&amp;gt;&lt;br&gt;Stadtausstellungs-,&nbsp;Gemeindeausstellungs-,&nbsp;Stadtinformations-&nbsp;und&nbsp;Gemeindeinformationsplanungs&nbsp;GmbH&lt;br&gt;<br>
A-1100&nbsp;Wien,&nbsp;Buchengasse&nbsp;42&lt;br&gt;Mobil:&nbsp;+43&nbsp;650&nbsp;2643435&lt;br&gt;Fax:&nbsp;+43&nbsp;7243&nbsp;57435&lt;br&gt;&lt;br&gt;&lt;a&nbsp;href=&quot;http://www.stadtausstellung.at&quot;&gt;http://www.stadtausstellung.at&lt;/a&gt;&lt;br&gt;&lt;br&gt;<br>
&lt;/div&gt;<br>

</tt>
