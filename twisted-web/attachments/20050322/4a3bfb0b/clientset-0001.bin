from twisted.internet import reactor
from nevow import loaders
from nevow import rend
from nevow import tags as T
from nevow import liveevil

choices = [[0,1,2], [3,4,5], [6,7,8]]

def setOptions(client, text):
    client.set("target", T.xml(liveevil.flatten([T.option[s] for s in choices[int(text)]])))

myhandler = liveevil.handler(setOptions,
                             "node.options[node.selectedIndex].text")

class Page(rend.Page):
    """Example of using stan to render a page.
    """
    addSlash = True
    docFactory = loaders.stan(
        T.html[
            T.head[
                liveevil.glue,
                T.title['client.set test'],
                ],
            T.body[
                T.select(onchange=myhandler)[
                  [T.option[str(i)] for i in range(3)]
                ],
                T.select(id="target"),
            ]
        ]
      )

reactor.listenTCP(8080, liveevil.LiveSite(Page()))
reactor.run()