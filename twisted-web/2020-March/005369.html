<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] Converting endpoints.serverFromString to TLS_v3
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-web%5D%20Converting%20endpoints.serverFromString%20to%20TLS_v3&In-Reply-To=%3CA0E8DFCA-2A50-45CF-9921-64EB08992DC8%40twistedmatrix.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="005368.html">
   
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] Converting endpoints.serverFromString to TLS_v3</H1>
    <B>Glyph</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-web%5D%20Converting%20endpoints.serverFromString%20to%20TLS_v3&In-Reply-To=%3CA0E8DFCA-2A50-45CF-9921-64EB08992DC8%40twistedmatrix.com%3E"
       TITLE="[Twisted-web] Converting endpoints.serverFromString to TLS_v3">glyph at twistedmatrix.com
       </A><BR>
    <I>Sun Mar 29 16:29:00 MDT 2020</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="005368.html">[Twisted-web] Converting endpoints.serverFromString to TLS_v3
</A></li>
        
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5369">[ date ]</a>
              <a href="thread.html#5369">[ thread ]</a>
              <a href="subject.html#5369">[ subject ]</a>
              <a href="author.html#5369">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>For what it's worth, the implementation of wrapServerTLS is fairly straightforward; you can see it here: <A HREF="https://github.com/glyph/txsni/blob/5014c141a7acef63e20fcf6c36fa07f0cd754ce1/txsni/tlsendpoint.py#L3-L12">https://github.com/glyph/txsni/blob/5014c141a7acef63e20fcf6c36fa07f0cd754ce1/txsni/tlsendpoint.py#L3-L12</A> &lt;<A HREF="https://github.com/glyph/txsni/blob/5014c141a7acef63e20fcf6c36fa07f0cd754ce1/txsni/tlsendpoint.py#L3-L12">https://github.com/glyph/txsni/blob/5014c141a7acef63e20fcf6c36fa07f0cd754ce1/txsni/tlsendpoint.py#L3-L12</A>&gt;

We just need someone to write up some nice docstrings, update the docs, test cases, etc so we can integrate this into Twisted.

Once we've got that, we can quickly begin the process of eliminating SSL4ServerEndpoint.  (We should not add an SSL6ServerEndpoint, as that would be as much or more work than adding wrapServerTLS, and a worse implementation strategy.)

-glyph

&gt;<i> On Mar 28, 2020, at 4:47 PM, Tom Most &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">twm at freecog.net</A>&gt; wrote:
</I>&gt;<i> 
</I>&gt;<i> Hi Axel,
</I>&gt;<i> 
</I>&gt;<i> I don't know offhand how to produce a string that does what you want, but it will probably be much easier to instantiate the endpoint classes directly.
</I>&gt;<i> 
</I>&gt;<i> <A HREF="https://twistedmatrix.com/documents/current/api/twisted.internet.endpoints.SSL4ServerEndpoint.html">https://twistedmatrix.com/documents/current/api/twisted.internet.endpoints.SSL4ServerEndpoint.html</A> &lt;<A HREF="https://twistedmatrix.com/documents/current/api/twisted.internet.endpoints.SSL4ServerEndpoint.html">https://twistedmatrix.com/documents/current/api/twisted.internet.endpoints.SSL4ServerEndpoint.html</A>&gt;
</I>&gt;<i> 
</I>&gt;<i> I think we're missing a SSL6ServerEndpoint, unfortunately.
</I>&gt;<i> 
</I>&gt;<i> Also unfortunately, SSL4ServerEndpoint is an old-style API (it uses reactor.listenSSL underneath). It takes an IOpenSSLContextFactory that can customize the OpenSSL context arbitrarily.
</I>&gt;<i> 
</I>&gt;<i> The new API, used by the ssl: client string syntax, is wrapClientTLS &lt;<A HREF="https://twistedmatrix.com/documents/current/api/twisted.internet.endpoints.html#wrapClientTLS">https://twistedmatrix.com/documents/current/api/twisted.internet.endpoints.html#wrapClientTLS</A>&gt;. We don't have a wrapServerTLS yet, but it's definitely something we should have, if you're interested in adding it. You'd wrap that around TCP4ServerEndpoint and TCP6ServerEndpoint.
</I>&gt;<i> 
</I>&gt;<i> ---Tom
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> On Thu, Mar 26, 2020, at 12:24 PM, Axel Rau wrote:
</I>&gt;&gt;<i> Hi,
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> how can I convert the plugin code below to recent security level, to TLSv3, dhparams and extraCertChain ?
</I>&gt;&gt;<i> Is OCSP stapling available in Twisted meanwhile?
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Thanks, Axel
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i>     def makeService(self, options):
</I>&gt;&gt;<i>         &quot;&quot;&quot;
</I>&gt;&gt;<i>         makeService() returns an IService.
</I>&gt;&gt;<i>         twisted.internet.application.MultiService[1] is an IService that
</I>&gt;&gt;<i>         composes other services (it's an IServiceCollection).
</I>&gt;&gt;<i>         &quot;&quot;&quot;
</I>&gt;&gt;<i>         ipv4_server = endpoints.serverFromString(
</I>&gt;&gt;<i>             reactor, 'ssl:{}:privateKey={}:certKey={}:interface={}'.format(
</I>&gt;&gt;<i>                 options['port'],
</I>&gt;&gt;<i>                 endpoints.quoteStringArgument(options['cert_path']),
</I>&gt;&gt;<i>                 endpoints.quoteStringArgument(options['key_path']),
</I>&gt;&gt;<i>                 options['ipv4_address']))
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i>         ipv6_server = endpoints.serverFromString(
</I>&gt;&gt;<i>             reactor, 'ssl:{}:privateKey={}:certKey={}:interface={}'.format(
</I>&gt;&gt;<i>                 options['port'],
</I>&gt;&gt;<i>                 endpoints.quoteStringArgument(options['cert_path']),
</I>&gt;&gt;<i>                 endpoints.quoteStringArgument(options['key_path']),
</I>&gt;&gt;<i>                 endpoints.quoteStringArgument(options['ipv6_address'])))
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i>         ipv4 = internet.StreamServerEndpointService(ipv4_server, meteo_factory)
</I>&gt;&gt;<i>         ipv6 = internet.StreamServerEndpointService(ipv6_server, meteo_factory)
</I>&gt;&gt;<i>         root = MultiService()
</I>&gt;&gt;<i>         ipv4.setServiceParent(root)
</I>&gt;&gt;<i>         ipv6.setServiceParent(root)
</I>&gt;&gt;<i>         return root
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> serviceMaker = MeteoServiceMaker()
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> ---
</I>&gt;&gt;<i> PGP-Key: CDE74120  â˜€  computing @ chaos claudius
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> _______________________________________________
</I>&gt;&gt;<i> Twisted-web mailing list
</I>&gt;&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">Twisted-web at twistedmatrix.com</A> &lt;mailto:<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">Twisted-web at twistedmatrix.com</A>&gt;
</I>&gt;&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web</A> &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web</A>&gt;
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> Attachments:
</I>&gt;&gt;<i> signature.asc
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-web mailing list
</I>&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">Twisted-web at twistedmatrix.com</A> &lt;mailto:<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">Twisted-web at twistedmatrix.com</A>&gt;
</I>&gt;<i> <A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web</A> &lt;<A HREF="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web</A>&gt;
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-web/attachments/20200329/d160d341/attachment.htm&gt;
</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="005368.html">[Twisted-web] Converting endpoints.serverFromString to TLS_v3
</A></li>
	
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5369">[ date ]</a>
              <a href="thread.html#5369">[ thread ]</a>
              <a href="subject.html#5369">[ subject ]</a>
              <a href="author.html#5369">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
