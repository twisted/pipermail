<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] Log out on guard login.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Log%20out%20on%20guard%20login.&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001127.html">
   <LINK REL="Next"  HREF="001129.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] Log out on guard login.</H1>
    <B>Jonathan Lange</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Log%20out%20on%20guard%20login.&In-Reply-To="
       TITLE="[Twisted-web] Log out on guard login.">jml at mumak.net
       </A><BR>
    <I>Mon Jan 31 17:29:08 MST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="001127.html">[Twisted-web] various formless types
</A></li>
        <LI>Next message: <A HREF="001129.html">[Twisted-web] Log out on guard login.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1128">[ date ]</a>
              <a href="thread.html#1128">[ thread ]</a>
              <a href="subject.html#1128">[ subject ]</a>
              <a href="author.html#1128">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

We recently had some problems with the ISession hanging around even after a new login. Also IE has had some weird behaviour: when you login in with one set of credentials, hit back, then log in again (with incorrect credentials), you are still logged in with your original (correct) credentials.

To work around this, we've monkey-patched guard to logout and expire the session on login.

Below is a patch that adds this change to nevow SVN.

Known problems: 
- line 295 calls portal.login straight-up, and so this patch doesn't help with certain http auth cases.
- I may be doing weird evil wrong stuff with context, mostly because I don't understand it.

cheers,
jml


Index: nevow/guard.py
===================================================================
--- nevow/guard.py      (revision 1123)
+++ nevow/guard.py      (working copy)
@@ -362,6 +362,11 @@
         return UsernamePassword(username, password)

     def login(self, request, session, credentials, segments, anonymous=False):
+        session.portalLogout(self.portal)
+        from twisted.python import context
+        ctxSession = inevow.ISession(context, None)
+        if ctxSession:
+            ctxSession.expire()
         mind = self.mindFactory(request, credentials)
         session.mind = mind
         return self.portal.login(credentials, mind, self.credInterface).addCallback(

</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001127.html">[Twisted-web] various formless types
</A></li>
	<LI>Next message: <A HREF="001129.html">[Twisted-web] Log out on guard login.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1128">[ date ]</a>
              <a href="thread.html#1128">[ thread ]</a>
              <a href="subject.html#1128">[ subject ]</a>
              <a href="author.html#1128">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
