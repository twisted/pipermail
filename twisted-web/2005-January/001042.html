<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] Rendering after posts
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Rendering%20after%20posts&In-Reply-To=613490500501141704484730fa%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001041.html">
   <LINK REL="Next"  HREF="001047.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] Rendering after posts</H1>
    <B>Donovan Preston</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Rendering%20after%20posts&In-Reply-To=613490500501141704484730fa%40mail.gmail.com"
       TITLE="[Twisted-web] Rendering after posts">dp at ulaluma.com
       </A><BR>
    <I>Fri Jan 14 20:09:03 MST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="001041.html">[Twisted-web] Rendering after posts
</A></li>
        <LI>Next message: <A HREF="001047.html">[Twisted-web] Sample code to run twisted web server
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1042">[ date ]</a>
              <a href="thread.html#1042">[ thread ]</a>
              <a href="subject.html#1042">[ subject ]</a>
              <a href="author.html#1042">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On Jan 14, 2005, at 5:04 PM, Michael Wilson wrote:

&gt;<i> In all the examples I've seen, the &quot;way&quot; to render a page after a post
</I>&gt;<i> appears to be to set a redirect:
</I>&gt;<i>
</I>&gt;<i>         request.setComponent(iformless.IRedirectAfterPost, &quot;/&quot;)
</I>&gt;<i>
</I>&gt;<i> (from examples/userdb.tac)
</I>&gt;<i>
</I>&gt;<i> If I want to include some additional variables in the redirected page,
</I>&gt;<i> it seems like that's implemented by passing parameters on the redirect
</I>&gt;<i> in the URL.
</I>&gt;<i>
</I>&gt;<i> Is there another way to render another page after a post, WITHOUT
</I>&gt;<i> using redirect? (I've tried setting docfactory again, or returning
</I>&gt;<i> another instance of rend.Page, but those don't seem to work.
</I>
The thing you return from the autocallable is available as IHand(ctx) 
during the redirected-to web request. The generally accepted way of 
rendering a different page upon redirect is to return it and then do 
something like this in your base class:

def locateChild(self, ctx, segments):
     renderAfterPost = IHand(ctx, None)
     if compy.implements(renderAfterPost, IResource):
         return renderAfterPost, ()
         ## If you just want to render the thing returned from the 
autocallable without
         ## doing any further url traversal, return () as the segments 
and renderAfterPost
         ## will be used to render this request.
         ... call the superclass ...

This results in servers whose page contents change depending on whether 
a form was posted recently, which I don't particularily like. Another 
way to do it would be to reserve a special url of the site for 
rendering &quot;after post status&quot; pages. In your autocallable, set 
IRedirectAfterPost to some url which never changes, like &quot;/hand&quot;. Then, 
make the following Page available from that url (probably by setting 
the child_hand class attribute to an instance of the following class, 
on your root page):

class HandPage(object):
     def locateChild(self, ctx, segments):
         return NotFound

     def renderHTTP(self, ctx, segments):
         renderAfterPost = IHand(ctx, None)
         if compy.implements(renderAfterPost, IResource):
             return renderAfterPost.renderHTTP(ctx)
         return &quot;No hand to render.&quot;

Since people generally seem to want to be able to do this, even though 
formless was designed to be rest-style and this trick doesn't really 
fit, I will probably be putting the first trick directly into 
rend.Page. This way, returning a Page from any autocallable would Just 
Work, even if it means that page will only render in that way on the 
first redirect after the form post.

(BTW, the above technique still does a redirect, even though you'd 
explicitly asked for a way to do this without redirecting -- I'll think 
about whether returning a Page from an autocallable should result in 
the posted-to URL rendering that Page, or the original, redirected-to 
URL rendering that Page)

dp


</PRE>







<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001041.html">[Twisted-web] Rendering after posts
</A></li>
	<LI>Next message: <A HREF="001047.html">[Twisted-web] Sample code to run twisted web server
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1042">[ date ]</a>
              <a href="thread.html#1042">[ thread ]</a>
              <a href="subject.html#1042">[ subject ]</a>
              <a href="author.html#1042">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
