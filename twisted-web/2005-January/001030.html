<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] Re: /__logout__ doesn't expire the session
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Re%3A%20/__logout__%20doesn%27t%20expire%20the%20session&In-Reply-To=20050113234441.GC13434%40localhost.localdomain">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001028.html">
   <LINK REL="Next"  HREF="001032.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] Re: /__logout__ doesn't expire the session</H1>
    <B>Alex Levy</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Re%3A%20/__logout__%20doesn%27t%20expire%20the%20session&In-Reply-To=20050113234441.GC13434%40localhost.localdomain"
       TITLE="[Twisted-web] Re: /__logout__ doesn't expire the session">mesozoic at polynode.com
       </A><BR>
    <I>Fri Jan 14 09:26:30 MST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="001028.html">[Twisted-web] Re: /__logout__ doesn't expire the session
</A></li>
        <LI>Next message: <A HREF="001032.html">[Twisted-web] Re: /__logout__ doesn't expire the session
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1030">[ date ]</a>
              <a href="thread.html#1030">[ thread ]</a>
              <a href="subject.html#1030">[ subject ]</a>
              <a href="author.html#1030">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Andrew Bennetts wrote:
&gt;<i> On Thu, Jan 13, 2005 at 04:12:22PM -0500, Alex Levy wrote:
</I>&gt;&gt;<i>Maybe this could be in an example somewhere, because I (for one) can't 
</I>&gt;&gt;<i>figure out how to do it. How do you access the session from the logout 
</I>&gt;&gt;<i>function? It isn't called with any parameters, and from what I can tell 
</I>&gt;&gt;<i>about IRealm implementors, the requestAvatar method -- whence the logout 
</I>&gt;&gt;<i>function is returned -- doesn't have access to the session either.
</I>&gt;<i> 
</I>&gt;<i> I'm no cred expert, but isn't this is what the mind is for?
</I>
Yes, you're right; good call. I'd forgotten about that part.

So, I've attached an example that should allow you to define code that 
runs on logout, and also has full access to the session. I've tested it 
(briefly), so if anyone has any better ideas, they are more than welcome 
to share.

Andrea, this should address your needs. Does anyone else think we should 
make this (or, better yet, a cleaned-up version of it) part of the Nevow 
examples?

-- 
Alex Levy
WWW: <A HREF="http://mesozoic.geecs.org">http://mesozoic.geecs.org</A>

&quot;Never let your sense of morals prevent you from doing what is right.&quot;
  -- Salvor Hardin, Isaac Asimov's _Foundation_
-------------- next part --------------
from twisted.application import strports
from twisted.application.service import Application
from twisted.cred.checkers import AllowAnonymousAccess
from twisted.cred.portal import Portal, IRealm
from twisted.cred.credentials import IAnonymous

from nevow import appserver
from nevow import guard
from nevow.inevow import IResource

class Mind:
	def __init__(self, request, credentials):
		self.request = request
		self.credentials = credentials

class MyRealm:
	__implements__ = IRealm,
	
	def requestAvatar(self, avatar_id, mind, *interfaces):
		if IResource in interfaces:
			return (
				IResource, 
				None, # This should be whatever resource you use
				self.createLogout(avatar_id, mind)
				)
		raise NotImplementedError
			
	def createLogout(self, avatar_id, mind):
		def logout():
			# This will be a nevow.guard.GuardSession instance
			session = mind.request.getSession()
			print 'Logging out for', session
		return logout

application = Application('MySite')
portal = Portal(MyRealm())
portal.registerChecker(AllowAnonymousAccess(), IAnonymous)
guarded = guard.SessionWrapper(portal, mindFactory=Mind)
site = appserver.NevowSite(resource=guarded)
svc = strports.service('tcp:8080', site)
svc.setServiceParent(application)
</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001028.html">[Twisted-web] Re: /__logout__ doesn't expire the session
</A></li>
	<LI>Next message: <A HREF="001032.html">[Twisted-web] Re: /__logout__ doesn't expire the session
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1030">[ date ]</a>
              <a href="thread.html#1030">[ thread ]</a>
              <a href="subject.html#1030">[ subject ]</a>
              <a href="author.html#1030">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
