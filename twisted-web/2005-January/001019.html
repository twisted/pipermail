<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] /__logout__ doesn't expire the session
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20/__logout__%20doesn%27t%20expire%20the%20session&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001012.html">
   <LINK REL="Next"  HREF="001021.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] /__logout__ doesn't expire the session</H1>
    <B>Andrea Arcangeli</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20/__logout__%20doesn%27t%20expire%20the%20session&In-Reply-To="
       TITLE="[Twisted-web] /__logout__ doesn't expire the session">andrea at cpushare.com
       </A><BR>
    <I>Wed Jan 12 19:21:28 MST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="001012.html">[Twisted-web] Nevow and Authentication
</A></li>
        <LI>Next message: <A HREF="001021.html">[Twisted-web] /__logout__ doesn't expire the session
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1019">[ date ]</a>
              <a href="thread.html#1019">[ thread ]</a>
              <a href="subject.html#1019">[ subject ]</a>
              <a href="author.html#1019">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Because of subject, any data structure linked to the user is still
visible to the webserver if the user explicitly types /__logout__ in the
URL. That doesn't seem very safe behaviour.

The userdb/ in the example directory does this to workaround it:

    def logout(self, request):
        request.getSession().expire()
        request.setComponent(iformless.IRedirectAfterPost, &quot;/&quot;+guard.LOGOUT_AVATAR)

but that workaround is insecure, since the user can type __logout__ by
himself (if he knows the nevow code at least) and logout without
clearing the session.

This problem would have caused a (very minor) security issue to me, but
it might have more serious implications in other apps.

So I'd suggest to expire the session automatically in the __logout__
avatar so that a new fresh (anonymous) session will have to be allocated
after logout.

The last fix I posted isn't applied yet, so I append it again.

My debug code now runs as I expected (i.e. the session is regenerated
after logout and I don't need to expire it by hand anymore insecurely
like userdb does).

Please apply thanks!

Index: nevow/rend.py
===================================================================
--- nevow/rend.py	(revision 1069)
+++ nevow/rend.py	(working copy)
@@ -127,7 +127,8 @@
             ctx.remember(request, inevow.IRequest)
             cf = iformless.IConfigurableFactory(self)
             c = cf.locateConfigurable(ctx, configurableName)
-            return self.webFormPost(request, self, c, ctx, bindingName, request.args)
+            if c:
+                return self.webFormPost(request, self, c, ctx, bindingName, request.args)
         return NotFound
 
 
Index: nevow/guard.py
===================================================================
--- nevow/guard.py	(revision 1069)
+++ nevow/guard.py	(working copy)
@@ -348,7 +348,7 @@
         if segments and segments[0] == LOGIN_AVATAR:
             return self.login(request, s, self.getCredentials(request), segments[1:])
         elif segments and segments[0] == LOGOUT_AVATAR:
-            s.portalLogout(self.portal)
+            s.expire()
             return urlToChild(request, *segments[1:]), ()
         else:
             r = s.resourceForPortal(self.portal)

</PRE>







<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001012.html">[Twisted-web] Nevow and Authentication
</A></li>
	<LI>Next message: <A HREF="001021.html">[Twisted-web] /__logout__ doesn't expire the session
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1019">[ date ]</a>
              <a href="thread.html#1019">[ thread ]</a>
              <a href="subject.html#1019">[ subject ]</a>
              <a href="author.html#1019">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
