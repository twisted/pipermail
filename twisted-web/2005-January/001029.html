<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] /freeform_post!!random causes exceptions
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20/freeform_post%21%21random%20causes%20exceptions&In-Reply-To=20050110170340.GY4597%40dualathlon.random">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001016.html">
   <LINK REL="Next"  HREF="001033.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] /freeform_post!!random causes exceptions</H1>
    <B>J Turner</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20/freeform_post%21%21random%20causes%20exceptions&In-Reply-To=20050110170340.GY4597%40dualathlon.random"
       TITLE="[Twisted-web] /freeform_post!!random causes exceptions">jamwt-twistedlist at jamwt.com
       </A><BR>
    <I>Thu Jan 13 12:32:51 MST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="001016.html">[Twisted-web] /freeform_post!!random causes exceptions
</A></li>
        <LI>Next message: <A HREF="001033.html">[Twisted-web] /freeform_post!!random causes exceptions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1029">[ date ]</a>
              <a href="thread.html#1029">[ thread ]</a>
              <a href="subject.html#1029">[ subject ]</a>
              <a href="author.html#1029">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Mon, Jan 10, 2005 at 06:03:40PM +0100, Andrea Arcangeli wrote:
&gt;<i> I
</I>&gt;<i> don't know about the postgres and the other bits you mention (so far I
</I>&gt;<i> tried pgasync but it's not working correctly and its interface is
</I>&gt;<i> inefficient since it requires duplicating lots of code so at the very
</I>&gt;<i> least that needs fixing, while psycopg2 rocks).
</I>
What does that mean?  How is the interface inefficient?  How do you have
to duplicate lots of code?  I'm not disagreeing, I'm trying to draw out
more concrete criticism.

Before you answer, you should know that I've released quite a few versions
recently enchancing the api/workflow area.  In the latest version, full
queuing happens.  So this is ok:

--- 
conn = pgasync.connect(**DBARGS)
cursor = conn.cursor()
cursor.execute(&quot;insert into ....&quot; ,{&quot;blah&quot;  : &quot;toast&quot;})
conn.commit()
cursor.release()
---

No callbacks required.  Everything queued, including commands issued
before the *real* connection is made.  Only add a callback when you care
about the outcome.  (or to add an errBack, etc).

Also, I added a connection.exFetch()

---
pgasync.connect(**DBARGS).exFetch(&quot;select ...&quot;).addCallback(lambda rows:
print rows)
---

1 line of code.

Sure, it's still kinda clunky, but that's basically DB API/SQL.  There's
not too much noise up above not related to DB API that (to my knowledge)
all the sync libraries have to deal with as well.

But feel free to offer suggestions, I'm all about improving this.

&gt;<i> Another misconception of pgasync is that it's not true a connection is
</I>&gt;<i> not expensive. If using ssl on a remote box connection handshake is very
</I>&gt;<i> expensive both for cpu and RTT delays, infact it may be more expensive
</I>&gt;<i> than the query itself (especially if run through the internet with bad
</I>&gt;<i> rtt). So pooling the connections is generally a good thing (even with
</I>&gt;<i> pgasync where doing it locally doesn't require clone() and normally
</I>&gt;<i> nobody uses ssl locally ;).
</I>
I'm not sure if you know this, but pgasync *does* pool connection.  

pgasync removes connections from the pool when they've been unused for &gt;
30 seconds.  If you have a connection that's gone unused for more than
30 seconds, I doubt the sub-second overhead of connecting is a big deal.

If the pooling needs to be more sophisticated than this, that's
certainly something I'm open to.

When all is said and done, pgasync has, in every test I've tried, shown
to be *much* faster than adbapi/threads/synclib in an async environment
under heavy load. 

Thanks for the input,

 - jamwt

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001016.html">[Twisted-web] /freeform_post!!random causes exceptions
</A></li>
	<LI>Next message: <A HREF="001033.html">[Twisted-web] /freeform_post!!random causes exceptions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1029">[ date ]</a>
              <a href="thread.html#1029">[ thread ]</a>
              <a href="subject.html#1029">[ subject ]</a>
              <a href="author.html#1029">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
