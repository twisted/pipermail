<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] pgasync (was: /freeform_post!!random causes
	exceptions)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20pgasync%20%28was%3A%20/freeform_post%21%21random%20causes%0A%09exceptions%29&In-Reply-To=20050118194052.GA17626%40count.jamwt.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001056.html">
   <LINK REL="Next"  HREF="001055.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] pgasync (was: /freeform_post!!random causes
	exceptions)</H1>
    <B>Andrea Arcangeli</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20pgasync%20%28was%3A%20/freeform_post%21%21random%20causes%0A%09exceptions%29&In-Reply-To=20050118194052.GA17626%40count.jamwt.com"
       TITLE="[Twisted-web] pgasync (was: /freeform_post!!random causes
	exceptions)">andrea at cpushare.com
       </A><BR>
    <I>Tue Jan 18 17:00:08 MST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="001056.html">[Twisted-web] pgasync (was: /freeform_post!!random causes
	exceptions)
</A></li>
        <LI>Next message: <A HREF="001055.html">[Twisted-web] VHostMonsterResource for url-context instead of
	subdomain
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1053">[ date ]</a>
              <a href="thread.html#1053">[ thread ]</a>
              <a href="subject.html#1053">[ subject ]</a>
              <a href="author.html#1053">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Tue, Jan 18, 2005 at 01:40:52PM -0600, J Turner wrote:
&gt;<i> DB API is the API used by all the synchronous modules, which probably
</I>&gt;<i> represent 99.9% of the python database code out there.  There are two
</I>&gt;<i> schools of thought on this one:
</I>
I was suggesting to do both at the same time ;).

&gt;<i> runInteraction takes a function as an argument.  Traditionally,
</I>&gt;<i> this function was always run in a thread, so you could be free to, for
</I>&gt;<i> example, make a blocking call using urllib.urlopen or something.  While
</I>&gt;<i> pgasync could call the function that runInteraction passes to it, that
</I>&gt;<i> function could *not* block.
</I>&gt;<i> 
</I>&gt;<i> pgasync doesn't make a thread pool, and it won't (ever) run anything on a
</I>&gt;<i> thread.  That was the principal goal when I started the project: Twisted
</I>&gt;<i> is async, so I want it all async.
</I>
Good point, and perfectly clear, but it's not my problem, I'm not doing
blocking calls at all in the runInteraction. So if you make a wrapper
I'll be able to swap it.  Just place a big fat warning that no blocking
call should ever happen in the callback executed by runInteraction.

The only reason I'm using runInteraction at all, is to have access to
the cursor and to extract the description too, so I can do a careless
select * that then generates an hash, and I don't need to change a thing
in the query code if I modify the DB, all I get is a new field in the
hash (actually in the class, because the hash is passed in input to a
class that does setattr on itself depending on the hash contents).

I didn't get what you mean about problems with transactions.

I thought all runOperation are transacted automatically, so if I'm
doing:

	UPDATE ... ;
	UPDATE ... ;

it's like if they both run inside a:

	BEGIN;
	UPDATE ... ;
	UPDATE ... ;
	COMMIT;

atomic block. If I'm wrong, it means I've already a problem. I'm
depending on read committed guarnatees of pgsql for my code, and it must
definitely run inside a transaction (not like if I'm executing each
command in the psql shell without a BEGIN/COMMIT block around it).

If I'm wrong, it must be still possible to fix it without having to use
runInteraction every time, isn't it? adbapi executes a .commit every
time internally, that made me think I was safe.

Thanks for the help!

</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001056.html">[Twisted-web] pgasync (was: /freeform_post!!random causes
	exceptions)
</A></li>
	<LI>Next message: <A HREF="001055.html">[Twisted-web] VHostMonsterResource for url-context instead of
	subdomain
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1053">[ date ]</a>
              <a href="thread.html#1053">[ thread ]</a>
              <a href="subject.html#1053">[ subject ]</a>
              <a href="author.html#1053">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
