<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] Nevow error with unicode localization in
	appserver.py
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Nevow%20error%20with%20unicode%20localization%20in%0A%09appserver.py&In-Reply-To=41F96FF9.2060704%40ivsn.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001098.html">
   <LINK REL="Next"  HREF="001104.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] Nevow error with unicode localization in
	appserver.py</H1>
    <B>James Y Knight</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Nevow%20error%20with%20unicode%20localization%20in%0A%09appserver.py&In-Reply-To=41F96FF9.2060704%40ivsn.com"
       TITLE="[Twisted-web] Nevow error with unicode localization in
	appserver.py">foom at fuhm.net
       </A><BR>
    <I>Fri Jan 28 09:15:35 MST 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="001098.html">[Twisted-web] Nevow error with unicode localization in appserver.py
</A></li>
        <LI>Next message: <A HREF="001104.html">[Twisted-web] Nevow error with unicode localization
	in	appserver.py
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1102">[ date ]</a>
              <a href="thread.html#1102">[ thread ]</a>
              <a href="subject.html#1102">[ subject ]</a>
              <a href="author.html#1102">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Jan 27, 2005, at 5:49 PM, Paul Reznicek wrote:
&gt;<i> Below suggested patches to omit broken output, if unicode
</I>&gt;<i> is returned instead of string.
</I>&gt;<i> Problem occurred during localization with gettext, see this
</I>&gt;<i> sample code:
</I>
&gt;<i> Necessary patch:
</I>&gt;<i> ===================================================================
</I>&gt;<i> --- appserver.py (Revision 1126)
</I>&gt;<i> +++ appserver.py (local)
</I>&gt;<i> @@ -170,6 +170,9 @@
</I>&gt;<i>          if isinstance(html, str):
</I>&gt;<i>              self.write(html)
</I>&gt;<i>              server.Request.finish(self)
</I>&gt;<i> +        elif isinstance(html, unicode):
</I>&gt;<i> +            self.write(html.encode('utf8'))
</I>&gt;<i> +            server.Request.finish(self)
</I>&gt;<i>          elif html is errorMarker:
</I>&gt;<i>              ## Error webpage has already been rendered and finish 
</I>&gt;<i> called
</I>&gt;<i>              pass
</I>
No. HTTP talks bytes, not characters. If you use the nevow rendering 
stuff, you get automatic encoding of characters into bytes via the 
UTF-8 encoding, but if you're going to override renderHTTP and return 
your own data, it should be a byte string.

appserver is really part of the HTTP server, not nevow (even though it 
is in the nevow package at the moment), and thus ought not know or care 
anything about what kind of data you are sending. It could be html in 
UTF-8, html in ISO8859-1, jpeg images, anything.

James


</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001098.html">[Twisted-web] Nevow error with unicode localization in appserver.py
</A></li>
	<LI>Next message: <A HREF="001104.html">[Twisted-web] Nevow error with unicode localization
	in	appserver.py
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1102">[ date ]</a>
              <a href="thread.html#1102">[ thread ]</a>
              <a href="subject.html#1102">[ subject ]</a>
              <a href="author.html#1102">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
