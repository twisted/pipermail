<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] Does twisted-web 12.01 support proxing HTTPS with	ProxyAgent ?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Does%20twisted-web%2012.01%20support%20proxing%20HTTPS%20with%0A%09ProxyAgent%20%3F&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004970.html">
   <LINK REL="Next"  HREF="004972.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] Does twisted-web 12.01 support proxing HTTPS with	ProxyAgent ?</H1>
    <B>Geoff Metselaar</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Does%20twisted-web%2012.01%20support%20proxing%20HTTPS%20with%0A%09ProxyAgent%20%3F&In-Reply-To="
       TITLE="[Twisted-web] Does twisted-web 12.01 support proxing HTTPS with	ProxyAgent ?">geoff.metselaar at gmail.com
       </A><BR>
    <I>Thu Dec 13 12:16:55 EST 2012</I>
    <P><UL>
        <LI>Previous message: <A HREF="004970.html">[Twisted-web] Disable fingerprint
</A></li>
        <LI>Next message: <A HREF="004972.html">[Twisted-web] (no subject)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4971">[ date ]</a>
              <a href="thread.html#4971">[ thread ]</a>
              <a href="subject.html#4971">[ subject ]</a>
              <a href="author.html#4971">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello

The code suggests it does - but I can't get it to work.

class ProxyAgent(_AgentBase):
    &quot;&quot;&quot;
    An HTTP agent able to cross HTTP proxies.

    @ivar _proxyEndpoint: The endpoint used to connect to the proxy.

    @since: 11.1
    &quot;&quot;&quot;

    def __init__(self, endpoint, reactor=None, pool=None):
        if reactor is None:
            from twisted.internet import reactor
        _AgentBase.__init__(self, reactor, pool)
        self._proxyEndpoint = endpoint


    def request(self, method, uri, headers=None, bodyProducer=None):
        &quot;&quot;&quot;
        Issue a new request via the configured proxy.
        &quot;&quot;&quot;
        # Cache *all* connections under the same key, since we are only
        # connecting to a single destination, the proxy:
        key = (&quot;http-proxy&quot;, self._proxyEndpoint)

        # To support proxying HTTPS via CONNECT, we will use key
        # (&quot;http-proxy-CONNECT&quot;, scheme, host, port), and an endpoint that
        # wraps _proxyEndpoint with an additional callback to do the
CONNECT.
        return self._requestWithEndpoint(key, self._proxyEndpoint, method,
                                         _parse(uri), headers, bodyProducer,
                                         uri)


The &quot;Using a http proxy&quot; -
<A HREF="http://twistedmatrix.com/documents/current/web/howto/client.html">http://twistedmatrix.com/documents/current/web/howto/client.html</A>  works,
provided the target url is http ( not https as shown in the example ).
I'm attempting to adapt this example to confirm https proxing is possible

from twisted.python.log import err
from twisted.web.client import ProxyAgent
from twisted.internet import reactor
from twisted.internet.endpoints import TCP4ClientEndpoint

def display(response):
    print &quot;Received response&quot;
    print response

def main():
    endpoint = TCP4ClientEndpoint(reactor, &quot;localhost&quot;, 8000)
    agent = ProxyAgent(endpoint)
    d = agent.request(&quot;GET&quot;, &quot;<A HREF="https://example.com/&quot;">https://example.com/&quot;</A>)
    d.addCallbacks(display, err)
    d.addCallback(lambda ignored: reactor.stop())
    reactor.run()

if __name__ == &quot;__main__&quot;:
    main()

I've tried changing the endpoint to SSL4ClientEndpoint without success.

Any help, much appreciated
- G
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://twistedmatrix.com/pipermail/twisted-web/attachments/20121213/6e6ed40e/attachment.htm">http://twistedmatrix.com/pipermail/twisted-web/attachments/20121213/6e6ed40e/attachment.htm</A> 
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004970.html">[Twisted-web] Disable fingerprint
</A></li>
	<LI>Next message: <A HREF="004972.html">[Twisted-web] (no subject)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4971">[ date ]</a>
              <a href="thread.html#4971">[ thread ]</a>
              <a href="subject.html#4971">[ subject ]</a>
              <a href="author.html#4971">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
