<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] Socket timeout in web2 (lost socket)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Socket%20timeout%20in%20web2%20%28lost%20socket%29&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003595.html">
   <LINK REL="Next"  HREF="003597.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] Socket timeout in web2 (lost socket)</H1>
    <B>Ashish Jha</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Socket%20timeout%20in%20web2%20%28lost%20socket%29&In-Reply-To="
       TITLE="[Twisted-web] Socket timeout in web2 (lost socket)">ashish.jha at gmail.com
       </A><BR>
    <I>Tue Jan  8 02:45:45 EST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="003595.html">[Twisted-web] Divmod Nevow 0.9.29
</A></li>
        <LI>Next message: <A HREF="003597.html">[Twisted-web] HTTP basic auth
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3596">[ date ]</a>
              <a href="thread.html#3596">[ thread ]</a>
              <a href="subject.html#3596">[ subject ]</a>
              <a href="author.html#3596">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I have a HTTP connection where the client has died, and twisted.web2
is getting stuck waiting for data. Can anyone tell me how to
timeout this case?

Details:

- client connects to server to perform a POST (XMLRPC in this case)
- twisted accepts connection, hands off to twisted.web2
- twisted.web2 wsgi handler runs wsgi app in a thread
- wsgi app tries to read the full body, based on Content-Length
- client dies before sending all the data
    (crashes or disconnects without TCP connection being closed)
- wsgi app thread is stuck forever in read()

Traceback:
  .......
  File &quot;D:\LabManager-Jan-07-2\src\wsgi\XMLRPCServer.py&quot;, line 98, in
__call__
    data =3D environ['wsgi.input'].read(length)
  File &quot;D:\LabManager-Jan-07-2\src\twisted\web2\wsgi.py&quot;, line 66, in read
    return callInReactor(self.stream.readExactly, size)
  File &quot;D:\LabManager-Jan-07-2\src\twisted\web2\wsgi.py&quot;, line 48, in
callInReactor
    result =3D queue.get()
  File &quot;D:\LabManager-Jan-07-2\python24\lib\Queue.py&quot;, line 119, in get
    self.not_empty.wait()
  File &quot;D:\LabManager-Jan-07-2\Python24\lib\threading.py&quot;, line 203, in wait
    waiter.acquire()

The function self.stream.readExactly is BufferedStream.readExactly
(wsgi.py, line 987).

However, it's not clear how to fix this up, since there seems to be
another class in the middle i.e. _NotifyingProducerStream (and
it's base class ProducerStream)

Does anyone have any example code for this, or can you give me a rough
guide on how to implement this?

(I am using Python 2.4.3, Twisted 2.4.0, and Twisted.Web2 0.2.0)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://twistedmatrix.com/pipermail/twisted-web/attachments/20080108/b0=">http://twistedmatrix.com/pipermail/twisted-web/attachments/20080108/b0=</A>
799561/attachment.htm
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003595.html">[Twisted-web] Divmod Nevow 0.9.29
</A></li>
	<LI>Next message: <A HREF="003597.html">[Twisted-web] HTTP basic auth
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3596">[ date ]</a>
              <a href="thread.html#3596">[ thread ]</a>
              <a href="subject.html#3596">[ subject ]</a>
              <a href="author.html#3596">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
