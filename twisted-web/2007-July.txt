From general at eepatents.com  Mon Jul  2 18:21:13 2007
From: general at eepatents.com (Ed Suominen)
Date: Mon Jul  2 18:21:25 2007
Subject: [Twisted-web] Web2 and Half-Baked Reinvention of Wheels
Message-ID: <46897A59.6090809@eepatents.com>

I have been debugging an odd problem that apparently is arising in
web2.stream.FileStream. One thing I noticed while poring over the source
is that its read() method will try to instantiate SendfileBuffer if you
try to use its sendfile option. However, there's no reference To such a
class anywhere in the module or anywhere else in the Twisted source
tree, for that matter. I understand that sendfile isn't supported, but
it's horrible coding practice to let that just sit there in the source.

As requested by Dialtone, and to borrow liberally from what he wrote in
an IRC chat with me today, web2.stream code is pretty badly tested and
someone should do something about it. (I would also add that it is
pretty badly documented, but that problem is widespread in Twisted's
source, despite my ranting about it for years and offering bounties for
people to contribute docstrings.)

Dialtone says that there are numerous other problems about streams. He
says, and I wholeheartedly agree, that they are mostly a substitution
for something that already exists in twisted, namely Producer/Consumer.
(Please guys, stop chasing butterflies and direct your considerable
talents toward improving what already works!) Dialtone says that glyph
once wrote a replacement for the CompundStream using Producer/Consumer
paradigm; instead of streams, we could use functions that combine
different producers or consumers.

I can't believe that the world's greatest networking platform *still*
doesn't have an adequately supported HTTP server!

Best regards, Ed


From ldanielburr at mac.com  Mon Jul  2 18:57:27 2007
From: ldanielburr at mac.com (L. Daniel Burr)
Date: Mon Jul  2 18:58:31 2007
Subject: [Twisted-web] Web2 and Half-Baked Reinvention of Wheels
In-Reply-To: <46897A59.6090809@eepatents.com>
References: <46897A59.6090809@eepatents.com>
Message-ID: <op.tuu0p1kg3oj628@l-daniel-burrs-computer.local>

Hi Ed,

On Mon, 02 Jul 2007 17:21:13 -0500, Ed Suominen <general@eepatents.com>  
wrote:

> I have been debugging an odd problem that apparently is arising in
> web2.stream.FileStream. One thing I noticed while poring over the source
> is that its read() method will try to instantiate SendfileBuffer if you
> try to use its sendfile option. However, there's no reference To such a
> class anywhere in the module or anywhere else in the Twisted source
> tree, for that matter. I understand that sendfile isn't supported, but
> it's horrible coding practice to let that just sit there in the source.
>

I know you are a regular in these parts, but isn't your tone a trifle
accusatory?  I can't speak for any of the core devs, but posts like
this don't tend to motivate people to fix code; rather, I find they
tend to lead to people like myself responding about the tone of the
post ;)

> As requested by Dialtone, and to borrow liberally from what he wrote in
> an IRC chat with me today, web2.stream code is pretty badly tested and
> someone should do something about it. (I would also add that it is
> pretty badly documented, but that problem is widespread in Twisted's
> source, despite my ranting about it for years and offering bounties for
> people to contribute docstrings.)
>

OK, I'll grant that it is a shame nobody has taken you up on the
bounties, but are you really surprised that "ranting about it for
years" hasn't produced much of a result?

> Dialtone says that there are numerous other problems about streams. He
> says, and I wholeheartedly agree, that they are mostly a substitution
> for something that already exists in twisted, namely Producer/Consumer.
> (Please guys, stop chasing butterflies and direct your considerable
> talents toward improving what already works!) Dialtone says that glyph
> once wrote a replacement for the CompundStream using Producer/Consumer
> paradigm; instead of streams, we could use functions that combine
> different producers or consumers.
>

Right, I vaguely recall a sandbox module, called consprod.py, which
was supposed to be a brief sketch of how to implement HTTP in the
consumer/producer vein.  It definitely wasn't a replacement, just a
proof of concept, with no tests or docs.

What is it that makes you think that twisted devs are, as you put
it, "chasing butterflies"?  Specifically, what code should the
twisted devs be improving instead of web2?

> I can't believe that the world's greatest networking platform *still*
> doesn't have an adequately supported HTTP server!
>

This is overly dramatic, to be sure.  The supported HTTP server is
twisted.web, and it receives bugfixes when needed.  There is a
mega-ticket describing what needs to be done in order for web2
to fully replace twisted.web.  That this work hasn't been completed
has to do with developer priorities, and the fact that twisted.web,
along with nevow, is perfectly adequate for all sorts of production
websites, and has been for some time.

I know you've produced plenty of code yourself, so I'm really curious
as to why you'd adopt such a confrontational tone, when you must
realize that such tactics seldom produce the result you desire.

L. Daniel Burr

From dreid at dreid.org  Mon Jul  2 23:06:50 2007
From: dreid at dreid.org (David Reid)
Date: Mon Jul  2 23:07:03 2007
Subject: [Twisted-web] Web2 and Half-Baked Reinvention of Wheels
In-Reply-To: <46897A59.6090809@eepatents.com>
References: <46897A59.6090809@eepatents.com>
Message-ID: <ED556A19-46C7-4EBC-B10D-7B3553DAA17D@dreid.org>


On Jul 2, 2007, at 3:21 PM, Ed Suominen wrote:

> I have been debugging an odd problem that apparently is arising in
> web2.stream.FileStream. One thing I noticed while poring over the  
> source
> is that its read() method will try to instantiate SendfileBuffer if  
> you
> try to use its sendfile option. However, there's no reference To  
> such a
> class anywhere in the module or anywhere else in the Twisted source
> tree, for that matter. I understand that sendfile isn't supported, but
> it's horrible coding practice to let that just sit there in the  
> source.

There is a bug, please feel free to contribute a patch.  For a while  
now web2 has been kind of a solitary effort, and I just don't have  
the energy right now, but I will gladly review and apply a patch.

>
> As requested by Dialtone, and to borrow liberally from what he  
> wrote in
> an IRC chat with me today, web2.stream code is pretty badly tested and
> someone should do something about it. (I would also add that it is
> pretty badly documented, but that problem is widespread in Twisted's
> source, despite my ranting about it for years and offering bounties  
> for
> people to contribute docstrings.)

It is conceptually pretty bad, and counter to existing abstractions  
in Twisted.  I believe there is a bug about this, and even a branch  
that foom started, I do not know the status of this branch, nor the  
quality of the code that lies within it.  Feel free to review the  
branch, and post your findings in the associated ticket.

>
> Dialtone says that there are numerous other problems about streams. He
> says, and I wholeheartedly agree, that they are mostly a substitution
> for something that already exists in twisted, namely Producer/ 
> Consumer.
> (Please guys, stop chasing butterflies and direct your considerable
> talents toward improving what already works!) Dialtone says that glyph
> once wrote a replacement for the CompundStream using Producer/Consumer
> paradigm; instead of streams, we could use functions that combine
> different producers or consumers.

Right, that would be awesome and I fully support completely replacing  
streams with something based on the more traditional Producer/ 
Consumer model.

> I can't believe that the world's greatest networking platform *still*
> doesn't have an adequately supported HTTP server!

I'm sorry.  Despite much interest in web programming (in the python  
community,) there is a definite lack of interest in writing a proper  
HTTP server.  I really do love working on web2, and I'm sorry I  
haven't been able to give it the attention it deserves, but such is  
life.  I would welcome any contribution you're willing to make  
(though I am probably unable to directly accept a financial  
contribution.)

-David

From glyph at divmod.com  Tue Jul  3 15:52:06 2007
From: glyph at divmod.com (glyph@divmod.com)
Date: Tue Jul  3 15:52:11 2007
Subject: [Twisted-web] Web2 and Half-Baked Reinvention of Wheels
In-Reply-To: <ED556A19-46C7-4EBC-B10D-7B3553DAA17D@dreid.org>
References: <46897A59.6090809@eepatents.com>
	<ED556A19-46C7-4EBC-B10D-7B3553DAA17D@dreid.org>
Message-ID: <20070703195206.8429.409573462.divmod.xquotient.672@joule.divmod.com>

T24gMDM6MDYgYW0sIGRyZWlkQGRyZWlkLm9yZyB3cm90ZToKPk9uIEp1bCAyLCAyMDA3LCBhdCAz
OjIxIFBNLCBFZCBTdW9taW5lbiB3cm90ZToKPj5JIGhhdmUgYmVlbiBkZWJ1Z2dpbmcgYW4gb2Rk
IHByb2JsZW0gdGhhdCBhcHBhcmVudGx5IGlzIGFyaXNpbmcgaW4KPj53ZWIyLnN0cmVhbS5GaWxl
U3RyZWFtLiAoLi4uKQoKPlRoZXJlIGlzIGEgYnVnLCBwbGVhc2UgZmVlbCBmcmVlIHRvIGNvbnRy
aWJ1dGUgYSBwYXRjaC4KCiAgICBodHRwOi8vdHdpc3RlZG1hdHJpeC5jb20vdHJhYy90aWNrZXQv
MjI5Ngo+PkFzIHJlcXVlc3RlZCBieSBEaWFsdG9uZSwgYW5kIHRvIGJvcnJvdyBsaWJlcmFsbHkg
ZnJvbSB3aGF0IGhlICB3cm90ZSAKPj5pbgo+PmFuIElSQyBjaGF0IHdpdGggbWUgdG9kYXksIHdl
YjIuc3RyZWFtIGNvZGUgaXMgcHJldHR5IGJhZGx5IHRlc3RlZCAKPj4oLi4uKQoKPkl0IGlzIGNv
bmNlcHR1YWxseSBwcmV0dHkgYmFkLCBhbmQgY291bnRlciB0byBleGlzdGluZyBhYnN0cmFjdGlv
bnMgIGluIAo+VHdpc3RlZC4gIEkgYmVsaWV2ZSB0aGVyZSBpcyBhIGJ1ZyBhYm91dCB0aGlzLCAo
Li4uKQoKICAgIGh0dHA6Ly90d2lzdGVkbWF0cml4LmNvbS90cmFjL3RpY2tldC8xOTM3Cj4+SSBj
YW4ndCBiZWxpZXZlIHRoYXQgdGhlIHdvcmxkJ3MgZ3JlYXRlc3QgbmV0d29ya2luZyBwbGF0Zm9y
bSAqc3RpbGwqCj4+ZG9lc24ndCBoYXZlIGFuIGFkZXF1YXRlbHkgc3VwcG9ydGVkIEhUVFAgc2Vy
dmVyIQoKICAgIGh0dHA6Ly90d2lzdGVkbWF0cml4LmNvbS90cmFjL21pbGVzdG9uZS9XZWIyLUdv
bGQtTWFzdGVyCj5JJ20gc29ycnkuCgpXaGlsZSB0aGlzIGlzIHVuZm9ydHVuYXRlLCBJIGRvbid0
IHRoaW5rIHRoYXQgdGhlcmUncyByZWFsbHkgYW55IHJlYXNvbiAKdG8gYXBvbG9naXplLiAgVGhp
cyBpcyBhIHZvbHVudGVlciBlZmZvcnQgYWxsIGFyb3VuZCwgYW5kIGl0J3MgYXMgbXVjaCAKbXkg
ZmF1bHQgKGFuZCBFZCdzKSB0aGF0IHN1Y2ggYSBzZXJ2ZXIgZG9lc24ndCBleGlzdC4KCkluIGZh
Y3QsIERhdmlkLCBpZiB0aGVyZSBhcmUgYW55IHBlb3BsZSB3aG9zZSBmYXVsdCBpdCAqaXNuJ3Qq
LCBpdCB3b3VsZCAKYmUgeW91IGFuZCBkaWFsdG9uZS4gIFRoYW5rIHlvdSBmb3IgeW91ciBzdXN0
YWluZWQgKGFsYmVpdCBpbnRlcm1pdHRlbnQpIAplZmZvcnRzIHRvIGdldCB0aGlzIGRvbmUuICAo
T2YgY291cnNlLCB0aGUgYmVhcnMgYW5kIEkgcmVzZXJ2ZSB0aGUgcmlnaHQgCnRvIGhhc3NsZSB5
b3UgbWVyY2lsZXNzbHkgdG8gY29tcGxldGUgaXQuKQoKQXMgSSd2ZSBhbm5vdGF0ZWQgaGVyZSwg
dGhlIGlzc3VlcyB0aGF0IEVkIG91dGxpbmVkIGluIGhpcyBlbWFpbCBhcmUgCnByZS1leGlzdGlu
Zywgd2l0aCB0aWNrZXRzIGRlc2NyaWJpbmcgdGhlbS4KCklmIGFueW9uZSBvdXQgdGhlcmUgc2hh
cmVzIGhpcyBmcnVzdHJhdGlvbiBhbmQgd291bGQgbGlrZSB0byBoZWxwIHVzIAphbG9uZyB0b3dh
cmRzIGEgc3VwcG9ydGVkIHdlYjIgcmVsZWFzZSwgb3IgYW55IG90aGVyIHBhcnQgb2YgVHdpc3Rl
ZCBmb3IgCnRoYXQgbWF0dGVyLCBqdXN0IGhhdmUgYSBsb29rIGF0IHRoZSBUd2lzdGVkIHRyYWNr
ZXIgYW5kIHN0ZWFsIGEgdGlja2V0IApmcm9tIHNvbWUgb2YgdGhlIG9idmlvdXNseSBvdmVyY29t
bWl0dGVkIGFuZCBvdmVyd29ya2VkIG1haW50YWluZXJzLiAKVGhlIG1pbGVzdG9uZSBsaW5rIEkg
cG9zdGVkIGlzIHRoZSBiZXN0IHN0YXJ0IGZvciB3ZWIyLgoKTWFueSBvZiB0aG9zZSB0aWNrZXRz
IGFyZSB1bmRlcnNwZWNpZmllZCwgYnV0IGRvbid0IGxldCB0aGF0IHN0b3AgeW91LiAKSWYgeW91
IGZpbmQgYSB0aWNrZXQgdGhhdCB5b3UgdGhpbmsgc291bmRzIGludGVyZXN0aW5nIGJ1dCB5b3Ug
ZG9uJ3QgCnVuZGVyc3RhbmQgaG93IHRvIHByb2NlZWQgb24gaXQsIGZlZWwgZnJlZSB0byBjb21t
ZW50IGFuZCBhc2sgZm9yIApjbGFyaWZpY2F0aW9uIC0gaXQgaXMgb2Z0ZW4gZmFyIGVhc2llciBm
b3IgYSBtYWludGFpbmVyIHRvIHJlc3BvbmQgdG8gYSAKcHJvbXB0IGZvciBzb21lIGFuc3dlcnMg
dG8gcXVlc3Rpb25zIHRoYW4gdG8gZHJpdmUgdGVzdHMsIGRvY3VtZW50YXRpb24sIAphbmQgY29k
ZSBhbGwgdGhlIHdheSB0aHJvdWdoIHRoZSByZXZpZXcgcHJvY2Vzcy4KLS0tLS0tLS0tLS0tLS0g
bmV4dCBwYXJ0IC0tLS0tLS0tLS0tLS0tCkFuIEhUTUwgYXR0YWNobWVudCB3YXMgc2NydWJiZWQu
Li4KVVJMOiBodHRwOi8vdHdpc3RlZG1hdHJpeC5jb20vcGlwZXJtYWlsL3R3aXN0ZWQtd2ViL2F0
dGFjaG1lbnRzLzIwMDcwNzAzL2RhNTMwYjRmL2F0dGFjaG1lbnQuaHRtCg==
From dialtone at divmod.com  Tue Jul  3 19:47:37 2007
From: dialtone at divmod.com (Valentino Volonghi aka Dialtone)
Date: Tue Jul  3 19:47:40 2007
Subject: [Twisted-web] Web2 and Half-Baked Reinvention of Wheels
In-Reply-To: <20070703195206.8429.409573462.divmod.xquotient.672@joule.divmod.com>
Message-ID: <20070703234737.4947.985866688.divmod.quotient.6597@ohm>

On Tue, 03 Jul 2007 19:52:06 -0000, glyph@divmod.com wrote:

>If anyone out there shares his frustration and would like to help us along 
>towards a supported web2 release, or any other part of Twisted for that 
>matter, just have a look at the Twisted tracker and steal a ticket from some 
>of the obviously overcommitted and overworked maintainers. The milestone 
>link I posted is the best start for web2.

I'm already fixing some bugs with the current code as part of the SoC,
and I've currently fixed 4 or 5 of them (the last one waiting for
review in branch 1895). I'm currently starting, or I'm hoping to
start, work on no-stream-1937 branch...

>Many of those tickets are underspecified, but don't let that stop you. If 
>you find a ticket that you think sounds interesting but you don't understand 
>how to proceed on it, feel free to comment and ask for clarification - it is 
>often far easier for a maintainer to respond to a prompt for some answers to 
>questions than to drive tests, documentation, and code all the way through 
>the review process.

Since you kindly offered for clarifications:

I see one problem with the current IConsumer/IProducer API and it's
returning deferreds when a producer finished its job.

The current IConsumer API uses registerProducer() but doesn't allow to
return anything from the method, and in fact this is what the
transport does. Unfortunately it would be useful to deal with the
finish event of producing to a consumer for many reasons, like you
don't know in advance when the produced content will finish.

In Twisted this problem was solved, partially, by FileSender which uses
a beginFileTransfer(fobj, consumer) method to return a deferred that
fires at the end of the file object. Unfortunately this is not really
a reliable method since it's not part of the IProducer interface and
any producer might use whatever method they like and, worst of all,
I'd anyway need to rewrite or add a method to FileSender because I can't
really use beginFileTransfer() for a MemoryBufferProducer() object.

One of the needs is the chance to chain Producers/Consumers to do
input filtering and output filtering. While the first could also be
avoided (meaning that the current implementation is good enough IMHO),
output filtering is actually pretty cool to have since it allows the
user to dynamically add behavior to a request's response like it's
currently done.

Taking from JP's consumer-sketch.py code:

def _chain(hook, chainedElements):
    assert len(chainedElements) >= 2
    elements = iter(chainedElements)
    producer = elements.next()

    if isinstance(producer, Deferred):
        producer = yield producer

    for ele in elements:
        if isinstance(ele, Deferred):
            ele = yield ele
        finishedProducing = hook(producer, ele)
        producer = ele
    yield finishedProducing
_chain = defgen(_chain)

def forwardHook(producer, consumer):
    return producer.produceTo(consumer)

def chainOneWay(*x):
    """
    chainOneWay(producer,[chainedElement1,...,chainedElementN],consumer)->Deferred

    Connect a producer to a consumer/producer to a consumer/producer to a ... ETC

    For example::

        a = FileSender('filename')
        b = GzipCompressor()
        c = ChunkEncoder()
        d = TCPTransport()

        finished = chainOneWay(a, b, c, d)
        def cbSentChunkedGzippedFile(ign):
            print 'Yaaaaaaaaaaaaay'
            d.loseConnection()
        finished.addCallback(cbSentChunkedGzippedFile)

    Will do the obvious thing.
    """
    return _chain(forwardHook, x)

This would be a really cool way to solve the problem and would also
present a pretty clean and simple API.

My question then is: how should I proceed? Clearly using this new API
is hard because everything else uses the current one, but the current
one lacks a fairly important functionality. Providing adapter in web2
for current producer/consumer stuff might seem overkill and not very
clean but might be a solution. Introducing this new API in Twisted
would be a nightmare. Is there any way to implement this using the
current IProducer/IConsumer API? I seek advice and some code examples
if anyone is willing to spend his mind on the problem a bit.

From magnus at spotify.com  Thu Jul  5 05:23:26 2007
From: magnus at spotify.com (Magnus Hult)
Date: Thu Jul  5 05:23:33 2007
Subject: [Twisted-web] Extremely slow POST request?
Message-ID: <71e31fe60707050223m5d1384c1k72daf1a4a9ae9bf3@mail.gmail.com>

Hi,

I have a simple resource that selects rows from a database and returns
the answer as some kind of XML:

class Bounces(resource.Resource):
    def render(self, request):
        request.setHeader('Content-Type', 'text/xml')
        bounces = Bounce.table.select(Bounce.c.id.in_(*request.args['id']))
        return as_xml(bounces)

In an application set up like

root = resource.Resource()
root.putChild('bounces', Bounces())
site = server.Site(root)
from twisted.application import service, strports
application = service.Application("bounceinfo")
s = strports.service('tcp:8090', site)
s.setServiceParent(application)

A GET request to /bounces?id=...&id=... with a few ids finishes in no
time (like 0.04 seconds), but the exact same request as a POST (with
the parameters as urlencoded form data) takes over two seconds (!).
Any ideas why?

Best regards,
Magnus

From magnus at spotify.com  Thu Jul  5 07:53:37 2007
From: magnus at spotify.com (Magnus Hult)
Date: Thu Jul  5 07:53:42 2007
Subject: [Twisted-web] Re: Extremely slow POST request?
In-Reply-To: <71e31fe60707050223m5d1384c1k72daf1a4a9ae9bf3@mail.gmail.com>
References: <71e31fe60707050223m5d1384c1k72daf1a4a9ae9bf3@mail.gmail.com>
Message-ID: <71e31fe60707050453i1f91c5bfg873c6022a15f182@mail.gmail.com>

On 7/5/07, Magnus Hult <magnus@spotify.com> wrote:
> Hi,
>
> I have a simple resource that selects rows from a database and returns
> the answer as some kind of XML:
> [...]
> A GET request to /bounces?id=...&id=... with a few ids finishes in no
> time (like 0.04 seconds), but the exact same request as a POST (with
> the parameters as urlencoded form data) takes over two seconds (!).

When POSTDATA is 1024 bytes, the request finishes in notime, with 1025
bytes, it takes two seconds... Still have no idea why, though.

From magnus at spotify.com  Thu Jul  5 08:08:38 2007
From: magnus at spotify.com (Magnus Hult)
Date: Thu Jul  5 08:08:44 2007
Subject: [Twisted-web] Re: Extremely slow POST request?
In-Reply-To: <71e31fe60707050453i1f91c5bfg873c6022a15f182@mail.gmail.com>
References: <71e31fe60707050223m5d1384c1k72daf1a4a9ae9bf3@mail.gmail.com>
	<71e31fe60707050453i1f91c5bfg873c6022a15f182@mail.gmail.com>
Message-ID: <71e31fe60707050508w2e8f2ff0pca3fdbec8271062c@mail.gmail.com>

On 7/5/07, Magnus Hult <magnus@spotify.com> wrote:
> On 7/5/07, Magnus Hult <magnus@spotify.com> wrote:
> > Hi,
> >
> > I have a simple resource that selects rows from a database and returns
> > the answer as some kind of XML:
> > [...]
> > A GET request to /bounces?id=...&id=... with a few ids finishes in no
> > time (like 0.04 seconds), but the exact same request as a POST (with
> > the parameters as urlencoded form data) takes over two seconds (!).
>
> When POSTDATA is 1024 bytes, the request finishes in notime, with 1025
> bytes, it takes two seconds... Still have no idea why, though.

Sorry people, it seems to be a problem with curl rather than with
twisted [http://osdir.com/ml/php.tcphp/2006-12/msg00007.html].

From daniel.cuesta at iavante.es  Fri Jul  6 03:03:34 2007
From: daniel.cuesta at iavante.es (Daniel de la Cuesta)
Date: Fri Jul  6 03:04:41 2007
Subject: [Twisted-web] Use nevow:pattern and nevow:attr to render a list of
	options.
Message-ID: <468DE946.1020302@iavante.es>

An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-web/attachments/20070706/454ff064/attachment.htm
From moe at divmod.com  Fri Jul  6 03:24:51 2007
From: moe at divmod.com (Moe Aboulkheir)
Date: Fri Jul  6 03:24:53 2007
Subject: [Twisted-web] Use nevow:pattern and nevow:attr to render a list of
In-Reply-To: <468DE946.1020302@iavante.es>
Message-ID: <20070706072451.4947.1094387853.divmod.quotient.7782@ohm>

<option nevow:pattern="option">
  <nevow:attr name="value"><nevow:slot name="value" /></nevow:attr>
  <nevow:slot name="label" />
</option>

You can then do pattern.fillSlots('value', '1').fillSlots('label', 'Option 1') to get to something that'll serialize to <option value="1">Option 1</option>.

From daniel.cuesta at iavante.es  Fri Jul  6 05:15:55 2007
From: daniel.cuesta at iavante.es (Daniel de la Cuesta)
Date: Fri Jul  6 05:17:01 2007
Subject: [Twisted-web] Use nevow:pattern and nevow:attr to render a list of
In-Reply-To: <20070706072451.4947.1094387853.divmod.quotient.7782@ohm>
References: <20070706072451.4947.1094387853.divmod.quotient.7782@ohm>
Message-ID: <468E084B.1030601@iavante.es>

An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-web/attachments/20070706/71a4b166/attachment.htm
From matt at pollenation.net  Fri Jul  6 05:23:44 2007
From: matt at pollenation.net (Matt Goodall)
Date: Fri Jul  6 05:24:10 2007
Subject: [Twisted-web] Use nevow:pattern and nevow:attr to render a list of
In-Reply-To: <468E084B.1030601@iavante.es>
References: <20070706072451.4947.1094387853.divmod.quotient.7782@ohm>
	<468E084B.1030601@iavante.es>
Message-ID: <468E0A20.9020800@pollenation.net>

Daniel de la Cuesta wrote:
> Following your instructions I have done:
> 
>   <select>
>     <div nevow:render="formats">
>       <option nevow:pattern="option">
>         <nevow:attr name="value"><nevow:slot name="value" /></nevow:attr>
>         <nevow:slot name="label" />
>       </option>
>     </div>
>   </select>
> 
> On the other side I have:
> 
>     def render_formats(self, ctx, data):        
> 
>         for k,v in mydict.iteritems():
              pattern = ctx.tag.onePattern("option")
>             pattern.fillSlots('value', v).fillSlots('label', k)
> 
> But I cannot acces the pattern variable, what am I doing wrong?

pattern = ctx.tag.onePattern("option")

> 
> 
> Moe Aboulkheir escribi?:
>> <option nevow:pattern="option">
>>  <nevow:attr name="value"><nevow:slot name="value" /></nevow:attr>
>>  <nevow:slot name="label" />
>> </option>
>>
>> You can then do pattern.fillSlots('value', '1').fillSlots('label',
>> 'Option 1') to get to something that'll serialize to <option
>> value="1">Option 1</option>.
>>
>> _______________________________________________
>> Twisted-web mailing list
>> Twisted-web@twistedmatrix.com
>> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web
>>
> 
> 
> -- 
> 
> *Daniel de la Cuesta Navarrete*
> *T?cnico de Desarrollo de Software*
> 
> FUNDACI?N IAVANTE
> daniel.cuesta@iavantefundacion.com
> Tel. 951 015 300
> 
> 
> Este correo electr?nico y, en su caso, cualquier fichero anexo, contiene
> informaci?n confidencial exclusivamente dirigida a su(s)
> destinatario(s). Toda copia o divulgaci?n deber? ser autorizada por IAVANTE.
> 
> This e-mail and any attachments are confidential and exclusively
> directed to its adressee(s). Any copy or distribution will have to be
> authorized by IAVANTE.
> 
> 
> 
> ------------------------------------------------------------------------
> 
> _______________________________________________
> Twisted-web mailing list
> Twisted-web@twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web

-- 
Matt Goodall, Pollenation Internet Ltd
Technology House, 237 Lidgett Lane, Leeds LS17 6QR
Registered No 4382123
A member of the Brunswick MCL Group of Companies
w: http://www.pollenation.net/
e: matt@pollenation.net
t: +44 113 2252500

From daniel.cuesta at iavante.es  Fri Jul  6 05:51:31 2007
From: daniel.cuesta at iavante.es (Daniel de la Cuesta)
Date: Fri Jul  6 05:52:35 2007
Subject: [Twisted-web] Use nevow:pattern and nevow:attr to render a list of
In-Reply-To: <468E084B.1030601@iavante.es>
References: <20070706072451.4947.1094387853.divmod.quotient.7782@ohm>
	<468E084B.1030601@iavante.es>
Message-ID: <468E10A3.3060509@iavante.es>

An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-web/attachments/20070706/c3710c2d/attachment.htm
From exarkun at divmod.com  Fri Jul  6 06:02:34 2007
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Fri Jul  6 06:02:47 2007
Subject: [Twisted-web] Use nevow:pattern and nevow:attr to render a list of
In-Reply-To: <468E10A3.3060509@iavante.es>
Message-ID: <20070706100234.4947.627471677.divmod.quotient.7832@ohm>

Your code loads the pattern and then drops it on the floor.  Beyond that, your
render method returns None, meaning the tag with the render directive is removed
from the output and replaced with the "big red None" you see.

When you create a pattern, you have to put it somewhere in order for it to
matter.  This means returning it from a render method, adding it as a child
to a tag in the output, or filling a slot with it.

And when you write a render method, it needs to return something.  Whatever it
returns will be used in place of the tag which had the render directive.

Jean-Paul

From p.mayers at imperial.ac.uk  Fri Jul  6 06:22:11 2007
From: p.mayers at imperial.ac.uk (Phil Mayers)
Date: Fri Jul  6 06:22:47 2007
Subject: [Twisted-web] Use nevow:pattern and nevow:attr to render a list of
In-Reply-To: <468E084B.1030601@iavante.es>
References: <20070706072451.4947.1094387853.divmod.quotient.7782@ohm>
	<468E084B.1030601@iavante.es>
Message-ID: <1183717331.3293.29.camel@localhost.localdomain>

On Fri, 2007-07-06 at 11:15 +0200, Daniel de la Cuesta wrote:
> Following your instructions I have done:
> 
>   <select>
>     <div nevow:render="formats">
>       <option nevow:pattern="option">
>         <nevow:attr name="value"><nevow:slot
> name="value" /></nevow:attr>
>         <nevow:slot name="label" />
>       </option>
>     </div>
>   </select>
> 
> On the other side I have:
> 
>     def render_formats(self, ctx, data):         
> 
>         for k,v in mydict.iteritems():
>             pattern.fillSlots('value', v).fillSlots('label', k)
> 
> But I cannot acces the pattern variable, what am I doing wrong?


do this:

the_div = ctx.tag

# when called, this will return option tags
option_generator = the_div.patternGenerator('option')

for k,v in mydict.items():
    # man an option tag
    an_option = option_generator()
    # set the variables
    an_option.fillSlots('value', v).fillSlots('label', k)
    # put it inside the div
    the_div[an_option]

return the_div

HTH


From daniel.cuesta at iavante.es  Fri Jul  6 06:43:23 2007
From: daniel.cuesta at iavante.es (Daniel de la Cuesta)
Date: Fri Jul  6 06:44:30 2007
Subject: [Twisted-web] Use nevow:pattern and nevow:attr to render a list of
In-Reply-To: <1183717331.3293.29.camel@localhost.localdomain>
References: <20070706072451.4947.1094387853.divmod.quotient.7782@ohm>	<468E084B.1030601@iavante.es>
	<1183717331.3293.29.camel@localhost.localdomain>
Message-ID: <468E1CCB.6060808@iavante.es>

An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-web/attachments/20070706/af144f92/attachment-0001.htm
From garyjefferson123 at gmail.com  Wed Jul 11 00:48:43 2007
From: garyjefferson123 at gmail.com (gary jefferson)
Date: Wed Jul 11 00:48:52 2007
Subject: [Twisted-web] http client and multipart/related
Message-ID: <62ad745a0707102148y72cb1542x414879bd4629294c@mail.gmail.com>

I'd like to use multipart/related to send multiple files to an http
client, where the client is written with twisted.

Any tips?  I'd like to just subclass web.client.HTTPDownloader.  Is
that the best route?  Is this going to be harder than it looks?

Thanks,
Gary

From akrherz at iastate.edu  Wed Jul 11 13:01:00 2007
From: akrherz at iastate.edu (Daryl Herzmann)
Date: Wed Jul 11 13:01:17 2007
Subject: [Twisted-web] Live DataGrid example?
Message-ID: <alpine.LRH.0.999.0707111130520.3774@akrherz-laptop.agron.iastate.edu>

Greetings,

I've got a twisted app that collects weather observations from various TCP 
streams and maintains a crude dictionary of most recent observations from 
the sensor network.  I would like to present this information on an AJAX 
web page and have it update as new observations are received.

Are there any twisted examples of doing something like this?

TIA,
   daryl

From ian.rees at bcm.edu  Wed Jul 11 13:52:57 2007
From: ian.rees at bcm.edu (Ian Rees)
Date: Wed Jul 11 13:53:57 2007
Subject: [Twisted-web] Live DataGrid example?
In-Reply-To: <alpine.LRH.0.999.0707111130520.3774@akrherz-laptop.agron.iastate.edu>
References: <alpine.LRH.0.999.0707111130520.3774@akrherz-laptop.agron.iastate.edu>
Message-ID: <990A65F9-4294-4680-B81F-BC4B8DBC7172@bcm.edu>

There are examples of how to use XMLRPC in t.web in the docs.

http://twistedmatrix.com/projects/web/documentation/howto/xmlrpc.html

If you need a javascript XMLRPC marshaller/unmarshaller, I have one  
cobbled together (why isn't this part of the javascript built in  
library???). Let me know if you'd like it. My own web app heavily  
utilizes XMLRPC.

ian


On Jul 11, 2007, at 12:01 PM, Daryl Herzmann wrote:

> Greetings,
>
> I've got a twisted app that collects weather observations from  
> various TCP streams and maintains a crude dictionary of most recent  
> observations from the sensor network.  I would like to present this  
> information on an AJAX web page and have it update as new  
> observations are received.
>
> Are there any twisted examples of doing something like this?
>
> TIA,
>   daryl
>
> _______________________________________________
> Twisted-web mailing list
> Twisted-web@twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web


From exarkun at divmod.com  Wed Jul 11 15:41:10 2007
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Wed Jul 11 15:41:13 2007
Subject: [Twisted-web] Live DataGrid example?
In-Reply-To: <alpine.LRH.0.999.0707111130520.3774@akrherz-laptop.agron.iastate.edu>
Message-ID: <20070711194110.4947.1672404636.divmod.quotient.10501@ohm>

On Wed, 11 Jul 2007 12:01:00 -0500 (CDT), Daryl Herzmann <akrherz@iastate.edu> wrote:
>Greetings,
>
>I've got a twisted app that collects weather observations from various TCP 
>streams and maintains a crude dictionary of most recent observations from 
>the sensor network.  I would like to present this information on an AJAX web 
>page and have it update as new observations are received.
>
>Are there any twisted examples of doing something like this?

Nevow Athena offers this kind of functionality:

http://divmod.org/trac/wiki/DivmodNevow/Athena

Jean-Paul

From dav at securme.net  Wed Jul 11 22:13:15 2007
From: dav at securme.net (Dav Clark)
Date: Wed Jul 11 22:13:20 2007
Subject: [Twisted-web] Chatola broken / bug in Athena?
Message-ID: <4BDFE9A9-0EE6-45C4-B89E-0CF2E29812A5@securme.net>

I've looked a lot at chatola, and it's been a really good learning  
experience.  But, chatola, as shipped is broke - at least on firefox  
2 on OS X.

The problem occurs because athena is not correctly escaping quotes in  
the filled stan templates.   So, if any of your messages contain  
single quotes, you get a javascript error.  Also - any use of the  
change nick or change topic automatically includes single quotes into  
a message string, and thus breaks when interpreted as javascript.

A stupid simple fix is to simply change the %r interpolation on lines  
90 and 98 of chatola.py to something like %s:

             self.content(changer, 'changed the topic to %r.' %  
(topic, )))

becomes

             self.content(changer, 'changed the topic to %s.' %  
(topic, )))

or even

             self.content(changer, 'changed the topic to "%s"' %  
(topic, )))

Now at least, you're not breaking automatically whenver changing  
topic or nickname.

And then I could write custom code to properly escape the quotes in  
the stan template.  But this violates some cental ideas that at least  
some of you have - namely that you don't want the application  
developer escaping quotes.  And I assume if I do this, it could  
easily break in the future.

I can explain in greater detail, but am throwing this out as is so  
that it's not too long to read ;)  I can also send a code snippet if  
you don't want to use the chatola code.

Dav Clark
917-544-8408





Dav Clark
917-544-8408



-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-web/attachments/20070711/6ca85dd5/attachment.htm
From exarkun at divmod.com  Wed Jul 11 22:26:24 2007
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Wed Jul 11 22:26:28 2007
Subject: [Twisted-web] Chatola broken / bug in Athena?
In-Reply-To: <4BDFE9A9-0EE6-45C4-B89E-0CF2E29812A5@securme.net>
Message-ID: <20070712022624.4947.1105604844.divmod.quotient.10585@ohm>

On Wed, 11 Jul 2007 22:13:15 -0400, Dav Clark <dav@securme.net> wrote:
>I've looked a lot at chatola, and it's been a really good learning 
>experience.  But, chatola, as shipped is broke - at least on firefox  2 on 
>OS X.

Mmmhh.  Chatola doesn't use Athena. :)  The bug you're describing is
one of the major reasons for the shift away from nevow.livepage to
nevow.athena.  Unfortunately, there isn't an example as complex as
Chatola based on Athena in the examples directory, and some of the
Athena examples which are there have other problems.

So the main take-away - Chatola isn't a good example of current best
practices for pushing messages to a browser.

Jean-Paul

From dav at securme.net  Wed Jul 11 22:40:11 2007
From: dav at securme.net (dav@securme.net)
Date: Wed Jul 11 22:40:14 2007
Subject: [Twisted-web] Chatola broken / bug in Athena?
In-Reply-To: <20070712022624.4947.1105604844.divmod.quotient.10585@ohm>
References: <20070712022624.4947.1105604844.divmod.quotient.10585@ohm>
Message-ID: <1184208011.11604.1199734737@webmail.messagingengine.com>

That's actually very useful... maybe it would be good to say something
to this effect on the Athena page?  (or maybe it already does ;)

I'll see what I can do to slap together something like chatola with
Athena.  Maybe y'all will like that more than my athena tutorial
refactoring suggestion...

Cheers,
Dav

On Wed, 11 Jul 2007 22:26:24 -0400, "Jean-Paul Calderone"
<exarkun@divmod.com> said:

> Mmmhh.  Chatola doesn't use Athena. :)  The bug you're describing is
> one of the major reasons for the shift away from nevow.livepage to
> nevow.athena.  Unfortunately, there isn't an example as complex as
> Chatola based on Athena in the examples directory, and some of the
> Athena examples which are there have other problems.
> 
> So the main take-away - Chatola isn't a good example of current best
> practices for pushing messages to a browser.
> 
> Jean-Paul
> 
> _______________________________________________
> Twisted-web mailing list
> Twisted-web@twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web
-- 
Dav Clark
www.eCult.org
917-544-8408


From glyph at divmod.com  Thu Jul 12 00:58:30 2007
From: glyph at divmod.com (glyph@divmod.com)
Date: Thu Jul 12 00:58:34 2007
Subject: [Twisted-web] Chatola broken / bug in Athena?
In-Reply-To: <1184208011.11604.1199734737@webmail.messagingengine.com>
References: <20070712022624.4947.1105604844.divmod.quotient.10585@ohm>
	<1184208011.11604.1199734737@webmail.messagingengine.com>
Message-ID: <20070712045830.26384.1376437679.divmod.xquotient.695@joule.divmod.com>

On 02:40 am, dav@securme.net wrote:
>That's actually very useful... maybe it would be good to say something
>to this effect on the Athena page?  (or maybe it already does ;)

Any updates you would like to make to the athena and nevow wiki pages 
would be appreciated.  They are sorely in need of some maintenance, 
whether they mention this *particular* fact or not :).
>I'll see what I can do to slap together something like chatola with
>Athena.  Maybe y'all will like that more than my athena tutorial
>refactoring suggestion...

An actual, complete, simple, detailed, correct, up-to-date example of an 
Athena project, especially one that actually shows off its power like a 
chat demo, would be ***HIGHLY*** appreciated.

(Maybe while you're at it you could update the athena-widget twistd 
plugin to be able to render more than one LivePage...)

From wthie at thiengineering.ch  Thu Jul 12 02:43:00 2007
From: wthie at thiengineering.ch (Werner Thie)
Date: Thu Jul 12 02:43:09 2007
Subject: [Twisted-web] Live DataGrid example?
In-Reply-To: <alpine.LRH.0.999.0707111130520.3774@akrherz-laptop.agron.iastate.edu>
References: <alpine.LRH.0.999.0707111130520.3774@akrherz-laptop.agron.iastate.edu>
Message-ID: <4695CD74.6090205@thiengineering.ch>

Hi

The attached little demo should do the trick, it's no datagrid but four =

buttons, data is coming in via a serial port but it does exactly what =

you asked for, its free and even has some comments in the code...

HTH, Werner

Daryl Herzmann wrote:
> Greetings,
> =

> I've got a twisted app that collects weather observations from various =

> TCP streams and maintains a crude dictionary of most recent observations =

> from the sensor network.  I would like to present this information on an =

> AJAX web page and have it update as new observations are received.
> =

> Are there any twisted examples of doing something like this?
> =

> TIA,
>   daryl
> =

> _______________________________________________
> Twisted-web mailing list
> Twisted-web@twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web
-------------- next part --------------
A non-text attachment was scrubbed...
Name: sps.zip
Type: application/x-zip-compressed
Size: 5221 bytes
Desc: not available
Url : http://twistedmatrix.com/pipermail/twisted-web/attachments/20070712/d=
14575ff/sps-0001.bin
From marian.schubert at gmail.com  Thu Jul 12 10:49:27 2007
From: marian.schubert at gmail.com (Marian Schubert)
Date: Thu Jul 12 10:49:34 2007
Subject: [Twisted-web] Use nevow:pattern and nevow:attr to render a list
	of options.
In-Reply-To: <468DE946.1020302@iavante.es>
References: <468DE946.1020302@iavante.es>
Message-ID: <a0839b890707120749o3d6dd13fw553dad9f1e80c5e5@mail.gmail.com>

Hi,

it should work like this:

<option n:pattern="item" n:render="option">
  <n:attr name="value"><n:slot name="value" /></n:attr>
  Option 1
</option>

and in option renderer use context.fillSlots('value', ...)

cu,
Maio

On 7/6/07, Daniel de la Cuesta <daniel.cuesta@iavante.es> wrote:
>
>    Hi,
>
>  I am using Divmod Nevow to render html pages.
>
>  I want to produce this html dinamically using the templates mechanism:
>
>  <select>
>      <option value=1>Option 1</option>
>      <option value=2>Option 2</option>
>      ....
>  </select>
>
>  I have used the nevow:pattern tag to render all the "option" tags but I
> don't know how to add the "value" atribute to each "option".
>
>  How can I do that using templates?
>
>  Thak you.
>
> --
>
>
> Daniel de la Cuesta Navarrete
>  T?cnico de Desarrollo de Software
>
> FUNDACI?N IAVANTE
>  daniel.cuesta@iavantefundacion.com
>  Tel. 951 015 300
>
>
> Este correo electr?nico y, en su caso, cualquier fichero anexo, contiene
> informaci?n confidencial exclusivamente dirigida a su(s) destinatario(s).
> Toda copia o divulgaci?n deber? ser autorizada por IAVANTE.
>
> This e-mail and any attachments are confidential and exclusively directed to
> its adressee(s). Any copy or distribution will have to be authorized by
> IAVANTE.
>
> _______________________________________________
> Twisted-web mailing list
> Twisted-web@twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web
>
>
From iacovou at gmail.com  Fri Jul 13 08:32:39 2007
From: iacovou at gmail.com (kgi)
Date: Fri Jul 13 08:32:48 2007
Subject: [Twisted-web] Chatola broken / bug in Athena?
In-Reply-To: <20070712045830.26384.1376437679.divmod.xquotient.695@joule.divmod.com>
References: <20070712022624.4947.1105604844.divmod.quotient.10585@ohm>
	<1184208011.11604.1199734737@webmail.messagingengine.com>
	<20070712045830.26384.1376437679.divmod.xquotient.695@joule.divmod.com>
Message-ID: <200707131532.39736.iacovou@gmail.com>

On Thursday 12 July 2007 07:58:30 glyph@divmod.com wrote:
> Any updates you would like to make to the athena and nevow wiki pages
> would be appreciated.  They are sorely in need of some maintenance,
> whether they mention this *particular* fact or not :).

Glyph, I thought I'd mention that I spent a few hours yesterday and today 
creating a few new introductory Nevow pages on trac:

  http://divmod.org/trac/wiki/DivmodNevow/Tutorial
  http://divmod.org/trac/wiki/DivmodNevow/TutorialTwo
  http://divmod.org/trac/wiki/DivmodNevow/TutorialThree
  http://divmod.org/trac/wiki/DivmodNevow/TutorialFour
  http://divmod.org/trac/wiki/DivmodNevow/TutorialFive
  http://divmod.org/trac/wiki/DivmodNevow/TutorialSix

I know the names aren't inspired, but I guess the content can always be moved 
later.

The motivation was really that whenever I haven't done any Nevow for a while I 
often find that I've forgotten how to do a particular basic thing; I wanted a 
set of clean, small pages to get me back up to speed.

I thought I might as well go the extra mile and make it simpler with complete 
cut-and-pasteable, runnable examples. The emphasis is therefore on working 
code with a quick summary of "things to note" at the bottom.

One of the things I found when I was originally learning about Nevow is that 
the documentation tended to focus on the "Oooh! Cool Features!" aspect before 
the basics had even been covered.

For example, the document nevow-intro.txt talks about XML on-disk templates, 
data/render methods, Stan, formless, webform and Athena. Now, I'm not saying 
that it's a worthless document; far from it: it's a valuable reference, but 
it doesn't live up to what it's billed as: "An introductory guide covering 
Nevow basics".

I'd like some feedback on the style and the level at which it's pitched. I'd 
also like to know if there are some techniques that are plain wrong in modern 
Nevow. If it's generally liked, I'll try and do some more on Nevow and a few 
on Athena.

Lastly, I've got a few questions that popped up while I was writing these 
pages:

1. Is it possible to have a root resource that has an overridden locateChild() 
method AND can render its own content?

If I examine the segments for ('',) to trap the '/' URL and return self from 
locateChild(), then locateChild() simply gets called again and recursion sets 
in (in other words, self.docFactory is never examined).

If I examine the segments for ('',) and return *another( page object, that is 
mostly satisfactory, but I still need another class definition;

I found a mention somewhere that defining 'child_()' somewhere would handle 
the '/' resource. However, that would only work if I didn't override 
locateChild(), since it's locateChild() that actually does all the child 
lookups, in which case I'd lose the flexibility of locateChild().

2. What is the blessed, current, best way of performing a URL redirect? I have 
found several methods on the ML and in the codebase and I'd like a definitive 
answer.

Cheers,

Ricky



From jaclists at mailbolt.com  Fri Jul 13 12:22:13 2007
From: jaclists at mailbolt.com (Jim Crowell)
Date: Fri Jul 13 12:22:17 2007
Subject: [Twisted-web] Re: Nevow tutorials
In-Reply-To: <E1I9NYr-00041d-8u@cube.twistedmatrix.com>
References: <E1I9NYr-00041d-8u@cube.twistedmatrix.com>
Message-ID: <1184343733.21888.1200030023@webmail.messagingengine.com>


> Message: 1
> Date: Fri, 13 Jul 2007 15:32:39 +0300
> From: kgi <iacovou@gmail.com>
> Subject: Re: [Twisted-web] Chatola broken / bug in Athena?
> 
> Glyph, I thought I'd mention that I spent a few hours yesterday and today 
> creating a few new introductory Nevow pages on trac:
> 

Very nice. Just one thing: in tutorials 3 & later, how about passing the
name to the SubPage and rendering it?

-Jim C.

From iacovou at gmail.com  Fri Jul 13 12:48:52 2007
From: iacovou at gmail.com (kgi)
Date: Fri Jul 13 12:49:16 2007
Subject: [Twisted-web] Re: Nevow tutorials
In-Reply-To: <1184343733.21888.1200030023@webmail.messagingengine.com>
References: <E1I9NYr-00041d-8u@cube.twistedmatrix.com>
	<1184343733.21888.1200030023@webmail.messagingengine.com>
Message-ID: <200707131948.53584.iacovou@gmail.com>

On Friday 13 July 2007 19:22:13 Jim Crowell wrote:
> > Message: 1
> > Date: Fri, 13 Jul 2007 15:32:39 +0300
> > From: kgi <iacovou@gmail.com>
> > Subject: Re: [Twisted-web] Chatola broken / bug in Athena?
> >
> > Glyph, I thought I'd mention that I spent a few hours yesterday and today
> > creating a few new introductory Nevow pages on trac:
>
> Very nice. Just one thing: in tutorials 3 & later, how about passing the
> name to the SubPage and rendering it?
>

Thanks!

I thought about that but decided that that would be rushing things. After all, 
by page 3 the reader has only just moved on from returning bare HTML from 
renderHTTP(). I wanted tutorials three and four to be more about building the 
structure than the content.

However, I'm not dogmatic about this: if anyone else chimes in to agree with 
you, I'll take than as an overwhelming vote and consider my arm well and 
truly twisted :-)

Ricky

From alpha04 at netvigator.com  Sun Jul 15 16:27:30 2007
From: alpha04 at netvigator.com (Andrey)
Date: Sun Jul 15 16:28:11 2007
Subject: [Twisted-web] mysql connect raise error although reconnect=true
Message-ID: <f7e007$344$1@sea.gmane.org>

hello

i have an xmlrpc daemon running and uses mysql for authorization. I noticed 
that the connection will timeout after a period of time.

After investigated in the api, i found the cp_reconnect switch

adbapi.ConnectionPool(DB_DRIVER,cp_reconnect=True, **DB_ARGS)

however, my problem is, although the deamon will reconnect to mysql, it did 
raise an error and turn down the first login attempt before automatically 
reconnect the timeouted connection

I wonder if this is normal and this switch is intented to raise error before 
reconnect?

thanks

Andrey k. 




From exarkun at divmod.com  Sun Jul 15 17:11:06 2007
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Sun Jul 15 17:11:10 2007
Subject: [Twisted-web] mysql connect raise error although reconnect=true
In-Reply-To: <f7e007$344$1@sea.gmane.org>
Message-ID: <20070715211106.4947.1777435181.divmod.quotient.11828@ohm>

On Sun, 15 Jul 2007 13:27:30 -0700, Andrey <alpha04@netvigator.com> wrote:
>hello
>
>i have an xmlrpc daemon running and uses mysql for authorization. I noticed
>that the connection will timeout after a period of time.
>
>After investigated in the api, i found the cp_reconnect switch
>
>adbapi.ConnectionPool(DB_DRIVER,cp_reconnect=True, **DB_ARGS)
>
>however, my problem is, although the deamon will reconnect to mysql, it did
>raise an error and turn down the first login attempt before automatically
>reconnect the timeouted connection
>
>I wonder if this is normal and this switch is intented to raise error before
>reconnect?

Yes.  The exception must be propagated to application code, since there is
no general way to determine if the statement which caused the exception was
executed by the server or not.  The application needs to know the exception
occurred so that it can make a decision about whether to re-executed the
failed statement or not.

Jean-Paul

From iacovou at gmail.com  Mon Jul 16 06:51:24 2007
From: iacovou at gmail.com (kgi)
Date: Mon Jul 16 06:51:36 2007
Subject: [Twisted-web] Cannot redirect to a SessionWrapper-wrapped page
	(example code included)
Message-ID: <200707161351.24394.iacovou@gmail.com>


Hi all.

I've got the following setup on a nevow site (actually, it's an Athena site, 
but I suspect that's incidental):

  - I want the initial visit to the root to be redirected to a named location
    on the same site (that is, http://foo.com/ => http://foo.com/bar);

  - I want the named location to present a login page using 
    guard.SessionWrapper and twisted.cred;

  - Once authenticated, the application proper is available at the name
    location.

At the moment, I've got the following situtation:

  - Publishing the DummyPage() at the root works.
  - Publishing the LivePage() without the SessionWrapper at the root works[1].
  - Publishing the LivePage with the SessionWrapper at the root works.
  - Redirecting to the DummyPage() works.
  - Redirecting to the LivePage without the SessionWrapper works.
  - However, redirecting to the LivePage with the SessionWrapper seems to get
    into some sort of loop.

[1] Where "publishing at the root" means, "passing the resource to 
appserver.NevowSite()" on line 157-ish

The cred and guard stuff is more or less lifted from nevow/examples/guarded.py

Specifically, Firefox 2.0.0.3 (at least, that's what it reports; it's the 
latest version on Ubuntu Feisty) says:

"""
The page isn't redirecting properly

Firefox has detected that the server is redirecting the request for this 
address in a way that will never complete.

    *   This problem can sometimes be caused by disabling or refusing to       
        accept cookies.
"""

(It is set up to accept all cookies).

Internet Explorer 6 (ies4linux) simply says that the site is unavailable, but 
I can see from the server side logs that it is hitting the server multiple 
times, in the same way as FF.

The server prints out something like this (I'm editing, because it's quite 
verbose):

"GET / HTTP/1.1"

"GET /foopage HTTP/1.1"

"GET /foopage/__session_key__ae8692cb175716b50ba92a316f586f97 HTTP/1.1"

"GET /foopage?__start_session__=1 HTTP/1.1"

"GET /foopage/__session_key__9237e1a6dcd263df40dc3f6357167474?__start_session__=1 
HTTP/1.1"

"GET /foopage?__start_session__=1 HTTP/1.1"

"GET /foopage/__session_key__6e06ee432ba04231e1b1e887d024f04c?__start_session__=1 
HTTP/1.1"

...

[repeated about 10 times in total]

...

[delay]

expired session ae8692cb175716b50ba92a316f586f97
expired session 9237e1a6dcd263df40dc3f6357167474
[repeated about 10 times in total]

I've attached a single-file example of the problem.

Can anyone spot what I'm doing wrong?

Regards,

Ricky

-------------- next part --------------
A non-text attachment was scrubbed...
Name: redirectToGuard.py
Type: application/x-python
Size: 4697 bytes
Desc: not available
Url : http://twistedmatrix.com/pipermail/twisted-web/attachments/20070716/729b2a5a/redirectToGuard.bin
From glyph at divmod.com  Mon Jul 16 10:11:25 2007
From: glyph at divmod.com (glyph@divmod.com)
Date: Mon Jul 16 10:11:29 2007
Subject: [Twisted-web] Cannot redirect to a SessionWrapper-wrapped page
	(example code included)
In-Reply-To: <200707161351.24394.iacovou@gmail.com>
References: <200707161351.24394.iacovou@gmail.com>
Message-ID: <20070716141125.26384.848779426.divmod.xquotient.821@joule.divmod.com>

On 10:51 am, iacovou@gmail.com wrote:
>Specifically, Firefox 2.0.0.3 (at least, that's what it reports; it's 
>the
>latest version on Ubuntu Feisty) says:
>
>"""
>The page isn't redirecting properly

The guard wrapper is being re-created on every hit in the child_foopage 
method.  So, the session storage is getting re-created on every hit, 
which means that your session isn't being stored anywhere that the 
resource can access it.  So each time the browser hits it, it tries to 
recreate its session.

Put the guard wrapper somewhere persistent so that it will be the *same* 
guard wrapper accessed on subsequent hits, and it will work.

From iacovou at gmail.com  Mon Jul 16 11:01:14 2007
From: iacovou at gmail.com (kgi)
Date: Mon Jul 16 11:01:36 2007
Subject: [Twisted-web] Cannot redirect to a SessionWrapper-wrapped page
	(example code included)
In-Reply-To: <20070716141125.26384.848779426.divmod.xquotient.821@joule.divmod.com>
References: <200707161351.24394.iacovou@gmail.com>
	<20070716141125.26384.848779426.divmod.xquotient.821@joule.divmod.com>
Message-ID: <200707161801.15022.iacovou@gmail.com>

On Monday 16 July 2007 17:11:25 glyph@divmod.com wrote:
> The guard wrapper is being re-created on every hit in the child_foopage
> method.  So, the session storage is getting re-created on every hit,
> which means that your session isn't being stored anywhere that the
> resource can access it.  So each time the browser hits it, it tries to
> recreate its session.
>
> Put the guard wrapper somewhere persistent so that it will be the *same*
> guard wrapper accessed on subsequent hits, and it will work.

Yes, that's it; thanks Glyph.

Actually, while we're on the subject, there's one more oddity. It's not 
terribly important for reasons I'll describe below, but it's still something 
that confuses me.

If I patch the file in my previous attachment to create and reuse a single 
persistent guard wrapper, like this:

class TopLevel ( rend.Page ):

    def __init__ ( self ):
        rend.Page.__init__ ( self )
	self.gresource = createGuardedResource()

    [...]

    def child_foopage ( self, ctx ):
        return self.gresource

... then the looping disappears BUT I get the "cannot render livepage more 
than once" error. The way to overcome this seems to be to uncomment 
the "child_()" method in FooPage():

    def child_ ( self, ctx ):
        return FooPage()

... so that any attempt to access the path of the LivePage afresh will get a 
new instance of the page. I want this behaviour anyway, because I don't want 
browser refreshes to throw up an error.

However, I'm confused as to why this error would occur the FIRST time I access 
the LivePage after GuardWrapper authentication. As far as I can tell, I've 
just rendered the page once.

Regards,

Ricky

From nmilkovits at gmail.com  Mon Jul 16 14:14:01 2007
From: nmilkovits at gmail.com (Nicholas Milkovits)
Date: Mon Jul 16 14:14:05 2007
Subject: [Twisted-web] Using twisted.protocols.sip
Message-ID: <71a75690707161114y339764aeuf11af520377fb7dd@mail.gmail.com>

Hi,

I've been working with osip and eXosip for a few weeks now but I would like
to be able to prototype features for UACs and UASs a bit faster.  Is there
any decent examples (tutorials, implementations, etc.) of using the twisted
sip protocol implementation? I've read through the API docs but it always
helps to take a look at a simple example to figure out what is needed.

Thanks in advance,
Nick Milkovits
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-web/attachments/20070716/52=
d9b164/attachment.htm
From daniel.cuesta at iavante.es  Wed Jul 18 07:43:43 2007
From: daniel.cuesta at iavante.es (Daniel de la Cuesta)
Date: Wed Jul 18 07:44:50 2007
Subject: [Twisted-web] Send large files via POST, SOAP, XML-RPC, etc.
Message-ID: <469DFCEF.1000902@iavante.es>

An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-web/attachments/20070718/8ad51f62/attachment.htm
From iacovou at gmail.com  Wed Jul 18 09:45:18 2007
From: iacovou at gmail.com (kgi)
Date: Wed Jul 18 09:45:27 2007
Subject: [Twisted-web] Passing events to (Athena) event handlers.
Message-ID: <200707181645.18215.iacovou@gmail.com>


Hi all.

In the thread entitled "How to insert an Athena event handler using Stan?" in 
October and November 2006, Jean-Paul Calderone said:

"""
The issue with the handler you showed me is most likely that the handler
thinks its first argument is an event, but it is actually a node.  There is
no way to access the event object right now, but I have been considering
just passing it as the next argument.
"""

and:

"""
[Though] this may shortly change to

  function doFoo(self, node, event)

(which is completely backwards compatible, of course, due to the magic of
javascript sucking so much).
"""

I've just hit this particular issue. Up until now all my events have been 
heavily node-based (e.g. tabbing out of a field, submitting a form, etc), 
where you can generally get away with just having access to the node the even 
happened on.

However, not having access to the event itself renders handlers for events 
like 'onkeyup' almost useless, unless you register them with the top-level 
document (like the Nevow.Athena._checkEscape() works), and as far as I can 
tell it makes implementing certain things like drag and drop much more 
difficult.

Is there a branch with experimental support for this?

If not, I've been digging around in where I think the relevant code is, 
namely:

  Nevow/nevow/athena.py line 1062:

_handlerFormat = "return 
Nevow.Athena.Widget.handleEvent(this, %(event)s, %(handler)s);"

and:

  Nevow/nevow/js/Divmod/Runtime/__init__.js line 963:

The Javascript looks like:

Nevow.Athena.Widget.handleEvent = function handleEvent(node, eventName, 
handlerName) {
    var widget = Nevow.Athena.Widget.get(node);
    var method = widget[handlerName];
    var result = false;
    if (method === undefined) {
        Divmod.msg("Undefined event handler: " + handlerName);
    } else {
        result = Nevow.Athena.Widget.dispatchEvent(
            widget, eventName, handlerName,
            function() {
                return method.call(widget, node);
            });
    }
    return result;
};

It looks like:

  1. Adding an event argument to the handler format in the Python
     (I don't think that _rewriteEventHandlerToAttribute() needs
     modification);
  2. Adding the corresponding 'event' argument to handleEvent() in the JS;
  3. Adding IE hacks (using window.event instead of event, etc) to
     the start of handleEvent();
  4. Adding the event to the list of arguments of method.call()
     within the anonymous function passed as the fourth argument to
     dispatchEvent()

would achieve this, and as JP pointed out, this should be backwards
compatible, as no extant JS handler functions should be declaring additional 
arguments.

Note that within dispatchEvent() itself the callable is invoked as 
callable.call(widget), but it looks like the 'widget' argument is ignored 
entirely by the anonymous function, which contains its own method call with 
its own "closure-y" arguments. Because of this I reckon dispatchEvent() needs 
no modification whatsoever.

Would a patch posted as a trac ticket be acceptable? I searched trac 
for 'event' and couldn't find anything resembling this. What would the unit 
test requirements be for a change like this be?

Thanks,

Ricky

From glyph at divmod.com  Wed Jul 18 15:08:33 2007
From: glyph at divmod.com (glyph@divmod.com)
Date: Wed Jul 18 15:08:37 2007
Subject: [Twisted-web] Passing events to (Athena) event handlers.
In-Reply-To: <200707181645.18215.iacovou@gmail.com>
References: <200707181645.18215.iacovou@gmail.com>
Message-ID: <20070718190833.26384.932443664.divmod.xquotient.920@joule.divmod.com>


On 01:45 pm, iacovou@gmail.com wrote:
>Would a patch posted as a trac ticket be acceptable? I searched trac
>for 'event' and couldn't find anything resembling this. What would the 
>unit
>test requirements be for a change like this be?

While I'm not sure I read this message thoroughly enough to be sure, I 
think it sounds okay.  Definitely putting a patch on a trac ticket is 
the right way to get started.

You may have noticed JavaScript unit tests lying around in our various 
codebases.  A good example of some pretty thorough unit testing is in 
Mantissa.Test.TestRegionModel.  You'd need to add coverage for your 
event handler stuff that used these tests and ran under trial.

Some other test examples, that will be even closer to the feature you 
are trying to implement, are in 
Nevow.Test.TestWidget.WidgetTests.test_connectDOMEvent*.

From p.mayers at imperial.ac.uk  Thu Jul 19 19:03:33 2007
From: p.mayers at imperial.ac.uk (Phil Mayers)
Date: Thu Jul 19 19:04:12 2007
Subject: [Twisted-web] simple guard question
Message-ID: <1184886213.2532.1.camel@localhost.localdomain>

How does one get the username for a given request? Bearing in mind that
a guard sessions username may have been gathered via an HTML form and
not be present on subsequent requests.


From exarkun at divmod.com  Thu Jul 19 19:15:15 2007
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Thu Jul 19 19:15:17 2007
Subject: [Twisted-web] simple guard question
In-Reply-To: <1184886213.2532.1.camel@localhost.localdomain>
Message-ID: <20070719231515.4947.1680325877.divmod.quotient.13594@ohm>

On Fri, 20 Jul 2007 00:03:33 +0100, Phil Mayers <p.mayers@imperial.ac.uk> wrote:
>How does one get the username for a given request? Bearing in mind that
>a guard sessions username may have been gathered via an HTML form and
>not be present on subsequent requests.
>

What is a username?  What if the HTML form presents a CAPTCHA image as a
challenge instead of a username/password login?

The IResource which is responding to a request (either by satisfying a
locateChild call or a renderHTTP call) _is_ the user.  For requirements
beyond that (and they should be few and far between), you have to impose
a limit on exactly what kind of authentication your code will work with
and supply a realm which will create avatars (IResource providers) with
whatever additional information you need them to have (eg, an HTTP auth
username, or the username field of an HTML form, or the CN field of an
SSL certificate, or whatever).

Jean-Paul

From p.mayers at imperial.ac.uk  Thu Jul 19 20:05:49 2007
From: p.mayers at imperial.ac.uk (Phil Mayers)
Date: Thu Jul 19 20:06:29 2007
Subject: [Twisted-web] simple guard question
In-Reply-To: <20070719231515.4947.1680325877.divmod.quotient.13594@ohm>
References: <20070719231515.4947.1680325877.divmod.quotient.13594@ohm>
Message-ID: <1184889949.2532.34.camel@localhost.localdomain>

On Thu, 2007-07-19 at 19:15 -0400, Jean-Paul Calderone wrote:
> On Fri, 20 Jul 2007 00:03:33 +0100, Phil Mayers <p.mayers@imperial.ac.uk> wrote:
> >How does one get the username for a given request? Bearing in mind that
> >a guard sessions username may have been gathered via an HTML form and
> >not be present on subsequent requests.
> >
> 
> What is a username?  What if the HTML form presents a CAPTCHA image as a
> challenge instead of a username/password login?

The username is the avatarId, which is always a string and always
present, is it not?

Anyway, never mind - I get the idea - the page is the avatar and should
be acting on the users behalf. I don't *agree* with the idea, but I get
it.

I think I'll just override the nevow traversal mechanism with something
more to my liking on, and attach my principal "object" (which *I* think
is the avatar, not the web page) to the request during locateChild on
the root object.

Thanks for the rapid reply.

Cheers,
Phil


From glyph at divmod.com  Fri Jul 20 00:40:17 2007
From: glyph at divmod.com (glyph@divmod.com)
Date: Fri Jul 20 00:40:22 2007
Subject: [Twisted-web] simple guard question
In-Reply-To: <1184889949.2532.34.camel@localhost.localdomain>
References: <20070719231515.4947.1680325877.divmod.quotient.13594@ohm>
	<1184889949.2532.34.camel@localhost.localdomain>
Message-ID: <20070720044017.26384.647086221.divmod.xquotient.1050@joule.divmod.com>

On 12:05 am, p.mayers@imperial.ac.uk wrote:
>On Thu, 2007-07-19 at 19:15 -0400, Jean-Paul Calderone wrote:
>>On Fri, 20 Jul 2007 00:03:33 +0100, Phil Mayers 
>><p.mayers@imperial.ac.uk> wrote:
>> >How does one get the username for a given request? Bearing in mind 
>>that
>> >a guard sessions username may have been gathered via an HTML form and
>> >not be present on subsequent requests.
>> >
>>
>>What is a username?  What if the HTML form presents a CAPTCHA image as 
>>a
>>challenge instead of a username/password login?
>
>The username is the avatarId, which is always a string and always
>present, is it not?

No, we use the term "avatarId" on purpose, to distinguish from other 
common ideas about "username".  It doesn't necessarily match any 
significant input to your system, nor any particularly interesting data 
on the back-end.  It will be a string, but it might end up just being 
the str() of an integer primary key in a database somewhere.

The fact that this differing from the visibly obvious "username" is so 
rarely is unfortunately confusing, and treating it as a username is a 
convenience that many, many deployments can count on, but should not be 
a core assumption of Twisted Web or Nevow.
>Anyway, never mind - I get the idea - the page is the avatar and should
>be acting on the users behalf. I don't *agree* with the idea, but I get
>it.

This is certainly a controversial idea, and one that is frequently 
criticised, often in this manner.  Although I don't *agree* with the 
criticism, I don't object to it ;).  Its design rationale should be 
better documented, and for that I apologize.

However, although you may want a "user object" that is different than 
the page -- and in that case the top-level page should probably wrap 
that object -- the term "avatar" has a specific meaning.  To be an 
avatar for HTTP, you must implement IResource.

You can disagree about whether this is the most generally useful design, 
but it *is* the specific design to which the jargon term "avatar" refers 
in the context of cred.  Trying to re-define it so that it doesn't mean 
that makes an already confusing topic even more difficult to discuss. 
So please don't.

From p.mayers at imperial.ac.uk  Fri Jul 20 05:05:59 2007
From: p.mayers at imperial.ac.uk (Phil Mayers)
Date: Fri Jul 20 05:06:38 2007
Subject: [Twisted-web] simple guard question
In-Reply-To: <20070720044017.26384.647086221.divmod.xquotient.1050@joule.divmod.com>
References: <20070719231515.4947.1680325877.divmod.quotient.13594@ohm>
	<1184889949.2532.34.camel@localhost.localdomain>
	<20070720044017.26384.647086221.divmod.xquotient.1050@joule.divmod.com>
Message-ID: <1184922359.3256.20.camel@localhost.localdomain>


> This is certainly a controversial idea, and one that is frequently 
> criticised, often in this manner.  Although I don't *agree* with the 
> criticism, I don't object to it ;).  Its design rationale should be 
> better documented, and for that I apologize.

Grin.

There's no need to apologise - Twisted is a fantastic (free) system, and
better documented than a whole lot of APIs I've had the (mis)fortune to
use over the years.

> 
> However, although you may want a "user object" that is different than 
> the page -- and in that case the top-level page should probably wrap 
> that object -- the term "avatar" has a specific meaning.  To be an 
> avatar for HTTP, you must implement IResource.
> 
> You can disagree about whether this is the most generally useful design, 
> but it *is* the specific design to which the jargon term "avatar" refers 
> in the context of cred.  Trying to re-define it so that it doesn't mean 
> that makes an already confusing topic even more difficult to discuss. 
> So please don't.

That was not my intention, and if you feel I've made a confusing
statement then I'm sorry - let it be purged from the internets!

By way of explanation regarding the basis of my thinking; the majority
of the large web-app work I've done to this point is on Zope. It of
course has the basic architecture of a tree of object instances. It
would be unusual (to the best of my, admittedly not encyclopedic,
knowledge) to spawn new instances of the entire page/object hierarchy
when a user logs in. Instead the object-publisher walks the same tree,
applying both zopes inbuilt permissions and making the user info
available to pages/code on the request object.

It's a model I like (along with a lot of other things about Zope, offset
by some things I despise) and will have to give some thought as to
whether to emulate or move away from.


From glyph at divmod.com  Fri Jul 20 12:21:22 2007
From: glyph at divmod.com (glyph@divmod.com)
Date: Fri Jul 20 12:21:26 2007
Subject: [Twisted-web] simple guard question
In-Reply-To: <1184922359.3256.20.camel@localhost.localdomain>
References: <20070719231515.4947.1680325877.divmod.quotient.13594@ohm>
	<1184889949.2532.34.camel@localhost.localdomain>
	<20070720044017.26384.647086221.divmod.xquotient.1050@joule.divmod.com>
	<1184922359.3256.20.camel@localhost.localdomain>
Message-ID: <20070720162122.26384.601261176.divmod.xquotient.1233@joule.divmod.com>

On 09:05 am, p.mayers@imperial.ac.uk wrote:
>There's no need to apologise - Twisted is a fantastic (free) system, 
>and
>better documented than a whole lot of APIs I've had the (mis)fortune to
>use over the years.

Thank you :)
>>You can disagree about whether this is the most generally useful 
>>design,
>>but it *is* the specific design to which the jargon term "avatar" 
>>refers
>>in the context of cred.  Trying to re-define it so that it doesn't 
>>mean
>>that makes an already confusing topic even more difficult to discuss.
>>So please don't.
>
>That was not my intention, and if you feel I've made a confusing
>statement then I'm sorry - let it be purged from the internets!

I'll go get the memory hole.
>By way of explanation regarding the basis of my thinking; the majority
>of the large web-app work I've done to this point is on Zope. It of
>course has the basic architecture of a tree of object instances. It
>would be unusual (to the best of my, admittedly not encyclopedic,
>knowledge) to spawn new instances of the entire page/object hierarchy
>when a user logs in. Instead the object-publisher walks the same tree,
>applying both zopes inbuilt permissions and making the user info
>available to pages/code on the request object.

The key thing to realize about Twisted's resources is that they are 
"light".  They are very small objects that just implement a few methods. 
By contrast - Zope, and lots of other traditional web frameworks, have 
resources that are "heavy" - you need to back them with an object in a 
database, a file on disk, or some other similar construct.

These two models don't have to be an either-or proposition.  The 
IResource-as-avatar design is, to my mind, the most flexible way to 
implement differing authenticated content, but one often does not want 
to make use of all that flexibility.  It is certainly a "design pattern" 
in web-based Twisted apps to have an underlying common resource 
hierarchy that the authenticated hierarchy is a lightweight "overlay" 
onto.

In other words, the IResource avatar is *how* you implement 
authentication, it is not necessarily *what* you implement for an 
authenticated system.  It is lower-level than the resource hierarchy 
that Zope provides.  However, I think it's an important level of the 
infrastructure to be able to plug in to: I'm not sure if Zope does this, 
but there are certainly plenty of web-based systems that *require* you 
to present exactly the same hierarchy of objects (or files, or scripts), 
albeit with perhaps different behavior, to different users.
>It's a model I like (along with a lot of other things about Zope, 
>offset
>by some things I despise) and will have to give some thought as to
>whether to emulate or move away from.

You might have a look at the resource hierarchy in the Divmod 
application server, Mantissa, and see how that maps to your 
expectations.  (It may be a bit under-documented, so feel free to ask 
questions if something is not obvious.)

From dialtone at divmod.com  Fri Jul 20 14:57:21 2007
From: dialtone at divmod.com (Valentino Volonghi aka Dialtone)
Date: Fri Jul 20 14:57:25 2007
Subject: [Twisted-web] simple guard question
In-Reply-To: <20070720162122.26384.601261176.divmod.xquotient.1233@joule.divmod.com>
Message-ID: <20070720185721.4947.1460449241.divmod.quotient.13878@ohm>

On Fri, 20 Jul 2007 16:21:22 -0000, glyph@divmod.com wrote:
>>It's a model I like (along with a lot of other things about Zope, offset
>>by some things I despise) and will have to give some thought as to
>>whether to emulate or move away from.
>
>You might have a look at the resource hierarchy in the Divmod application 
>server, Mantissa, and see how that maps to your expectations.  (It may be a 
>bit under-documented, so feel free to ask questions if something is not 
>obvious.)

Same goes for my pseudo-framework: http://hg.stiq.it/starter/ which is actually
inspired by Mantissa in its architecture.

From sbc at my-place.biz  Sat Jul 21 05:36:18 2007
From: sbc at my-place.biz (=?ISO-8859-1?Q?S=F8ren_Bach_Christiansen?=)
Date: Sat Jul 21 05:36:19 2007
Subject: [Twisted-web] Problem with twisted web and adbapi
Message-ID: <9C4906F4-D639-4EB5-84A9-C063FDC6A2B4@my-place.biz>

Hi all

I am a new user to the Twisted framework so this might be a trivial  
question, but here goes..

Im trying to use the Web module and adbapi module to create a (rest)  
webservice but I am having problems
using the adbapi. As fare as I could figure out, the runInteraction  
call spawns a new thread and executes the sql in that, and the  
render_GET  handler is then returning right away -bummer. I need the  
adbapi for its db pool but dont need it to be "blocking" so that I  
can return the result of the db interaction as xml.

Hope you guys can help me out or give me some pointers if I am doing  
this the wrong way.


Regards
   S?ren

----- Code ----
from twisted.web import server
from twisted.internet import reactor
from twisted.enterprise import adbapi
from xml.dom.minidom import Document

class Simple(Resource):
     isLeaf=True
     def __init__(self,opt):
         Resource.__init__(self)
         self.opt=opt

     def render_GET(self,request):
         doc=Document()
	self.opt.dbpool.runInteraction(self._getUserList,doc)
         print "returning result"
	return doc.toprettyxml(indent="  ")

     def _getUserList(self,txn,doc):
         txn.execute("SELECT UserName FROM User ")
         res = txn.fetchall()
         if (res):
             for row in res:
                 print row
         	usr=doc.createElement("user")
         	usr.setAttribute("name","%s" % (row[0] ))

class options:
     pass

if __name__ == '__main__':
     options.dbpool= adbapi.ConnectionPool("MySQLdb",  
host='localhost',db='TrackingPresentation',
                                    user='web', passwd='tingogsager')
     site = server.Site(Simple(options))
     reactor.listenTCP(8888,site)
     reactor.run()

------ Code ------



From christian.simms at gmail.com  Sat Jul 21 09:34:40 2007
From: christian.simms at gmail.com (Christian Simms)
Date: Sat Jul 21 09:34:44 2007
Subject: [Twisted-web] Problem with twisted web and adbapi
In-Reply-To: <9C4906F4-D639-4EB5-84A9-C063FDC6A2B4@my-place.biz>
References: <9C4906F4-D639-4EB5-84A9-C063FDC6A2B4@my-place.biz>
Message-ID: <cd8fa6f90707210634j1d72e47as97372da716e605b9@mail.gmail.com>

On 7/21/07, S=F8ren Bach Christiansen <sbc@my-place.biz> wrote:
>
> Hi all
>
> I am a new user to the Twisted framework so this might be a trivial
> question, but here goes..
>
> Im trying to use the Web module and adbapi module to create a (rest)
> webservice but I am having problems
> using the adbapi. As fare as I could figure out, the runInteraction
> call spawns a new thread and executes the sql in that, and the
> render_GET  handler is then returning right away -bummer. I need the
> adbapi for its db pool but dont need it to be "blocking" so that I
> can return the result of the db interaction as xml.
>
> Hope you guys can help me out or give me some pointers if I am doing
> this the wrong way.
>
>
> Regards
>    S=F8ren
>
> ----- Code ----
> from twisted.web import server
> from twisted.internet import reactor
> from twisted.enterprise import adbapi
> from xml.dom.minidom import Document
>
> class Simple(Resource):
>      isLeaf=3DTrue
>      def __init__(self,opt):
>          Resource.__init__(self)
>          self.opt=3Dopt
>
>      def render_GET(self,request):
>          doc=3DDocument()
>         self.opt.dbpool.runInteraction(self._getUserList,doc)
>          print "returning result"
>         return doc.toprettyxml(indent=3D"  ")
>
>      def _getUserList(self,txn,doc):
>          txn.execute("SELECT UserName FROM User ")
>          res =3D txn.fetchall()
>          if (res):
>              for row in res:
>                  print row
>                 usr=3Ddoc.createElement("user")
>                 usr.setAttribute("name","%s" % (row[0] ))
>
> class options:
>      pass
>
> if __name__ =3D=3D '__main__':
>      options.dbpool=3D adbapi.ConnectionPool("MySQLdb",
> host=3D'localhost',db=3D'TrackingPresentation',
>                                     user=3D'web', passwd=3D'tingogsager')
>      site =3D server.Site(Simple(options))
>      reactor.listenTCP(8888,site)
>      reactor.run()
>
> ------ Code ------
>
>
>
> _______________________________________________
> Twisted-web mailing list
> Twisted-web@twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web
>

You did all the hard work already.  The only thing you need to do is connect
the database query to the render_GET rendering method's output. You want to
take the Deferred that ruInteraction returns (yes it runs in a separate
thread async), add a callback to it that converts the xml to a string
(called cb below), then return that Deferrred in render_GET.  Here's
untested code:

     def render_GET(self,request):
         doc=3DDocument()
         def cb(PARAM_NOT_USED):
             print "returning result"
             return doc.toprettyxml(indent=3D"  ")
         return self.opt.dbpool.runInteraction
(self._getUserList,doc).addCallback(cb)

If I was writing this code, I would probably have _getUserList create and
return the doc, in which case the code would look like this:

     def render_GET(self,request):
         def cb(doc):  # now doc is passed to the callback from _getUserList
             print "returning result"
             return doc.toprettyxml(indent=3D"  ")
         return self.opt.dbpool.runInteraction
(self._getUserList).addCallback(cb)

Cheers,
Christian
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-web/attachments/20070721/dc=
1cddfc/attachment.htm
From sbc at my-place.biz  Sat Jul 21 10:22:00 2007
From: sbc at my-place.biz (=?ISO-8859-1?Q?S=F8ren_Bach_Christiansen?=)
Date: Sat Jul 21 10:22:13 2007
Subject: [Twisted-web] Problem with twisted web and adbapi
In-Reply-To: <cd8fa6f90707210634j1d72e47as97372da716e605b9@mail.gmail.com>
References: <9C4906F4-D639-4EB5-84A9-C063FDC6A2B4@my-place.biz>
	<cd8fa6f90707210634j1d72e47as97372da716e605b9@mail.gmail.com>
Message-ID: <D9722901-7D59-4A40-9A3F-BBBF7936F892@my-place.biz>

Thanks for the response Christian. Unfortunately im still not quite  =

there yet. took you advice and change the code to read:

----- Snip ----
     def render_GET(self,request):
         def cb(text):
             print text ### This text looks like it should
             return text
	return self.opt.dbpool.runInteraction(self._getUserList).addCallback =

(cb)

     def _getUserList(self,txn):
         doc=3DDocument()
         camp=3D doc.createElement("userlist")
         doc.appendChild(camp)
         txn.execute("SELECT UserName FROM User ")
         res =3D txn.fetchall()
         if (res):
             for row in res:
         	usr=3Ddoc.createElement("user")
                 camp.appendChild(usr)
         	usr.setAttribute("name","%s" % (row[0] ))
         return doc.toprettyxml(indent=3D" ")
----- Snip ----

But still think the problem is basically the same as before. The  =

runInteraction returns a Defered object that I
now add a callback function to. But the addCallback(cb) returns right  =

away and the return value is still  the Defered object. So the  =

webserver gives an error saying something like:

Request did not return a string
Request:
<GET / HTTP/1.1>

Resource:
<__main__.Simple instance at 0x1208878>

Value:
<Deferred at 0x124cfa8>


Later when the _getUserList() returns the Defered object calles the cb =

() function and i get a printout with the wanted result.

So I think my problem is that I whant to *wait* for the result from  =

the db query before the render_GET() returns.

/S=F8ren


On Jul 21, 2007, at 15:34 , Christian Simms wrote:

> On 7/21/07, S=F8ren Bach Christiansen <sbc@my-place.biz> wrote:
> Hi all
>
> I am a new user to the Twisted framework so this might be a trivial
> question, but here goes..
>
> Im trying to use the Web module and adbapi module to create a (rest)
> webservice but I am having problems
> using the adbapi. As fare as I could figure out, the runInteraction
> call spawns a new thread and executes the sql in that, and the
> render_GET  handler is then returning right away -bummer. I need the
> adbapi for its db pool but dont need it to be "blocking" so that I
> can return the result of the db interaction as xml.
>
> Hope you guys can help me out or give me some pointers if I am doing
> this the wrong way.
>
>
> Regards
>    S=F8ren
>
> ----- Code ----
> from twisted.web import server
> from twisted.internet import reactor
> from twisted.enterprise import adbapi
> from xml.dom.minidom import Document
>
> class Simple(Resource):
>      isLeaf=3DTrue
>      def __init__(self,opt):
>          Resource.__init__(self)
>          self.opt=3Dopt
>
>      def render_GET(self,request):
>          doc=3DDocument()
>         self.opt.dbpool.runInteraction(self._getUserList,doc)
>          print "returning result"
>         return doc.toprettyxml(indent=3D"  ")
>
>      def _getUserList(self,txn,doc):
>          txn.execute("SELECT UserName FROM User ")
>          res =3D txn.fetchall()
>          if (res):
>              for row in res:
>                  print row
>                 usr=3Ddoc.createElement("user")
>                 usr.setAttribute("name","%s" % (row[0] ))
>
> class options:
>      pass
>
> if __name__ =3D=3D '__main__':
>      options.dbpool=3D adbapi.ConnectionPool("MySQLdb",
> host=3D'localhost',db=3D'TrackingPresentation',
>                                     user=3D'web', passwd=3D'tingogsager')
>      site =3D server.Site(Simple(options))
>      reactor.listenTCP(8888,site)
>      reactor.run()
>
> ------ Code ------
>
>
>
> _______________________________________________
> Twisted-web mailing list
> Twisted-web@twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web
>
> You did all the hard work already.  The only thing you need to do  =

> is connect the database query to the render_GET rendering method's  =

> output. You want to take the Deferred that ruInteraction returns  =

> (yes it runs in a separate thread async), add a callback to it that  =

> converts the xml to a string (called cb below), then return that  =

> Deferrred in render_GET.  Here's untested code:
>
>      def render_GET(self,request):
>          doc=3DDocument()
>          def cb(PARAM_NOT_USED):
>              print "returning result"
>              return doc.toprettyxml(indent=3D"  ")
>          return self.opt.dbpool.runInteraction =

> (self._getUserList,doc).addCallback(cb)
>
> If I was writing this code, I would probably have _getUserList  =

> create and return the doc, in which case the code would look like  =

> this:
>
>      def render_GET(self,request):
>          def cb(doc):  # now doc is passed to the callback from  =

> _getUserList
>              print "returning result"
>              return doc.toprettyxml(indent=3D"  ")
>          return self.opt.dbpool.runInteraction =

> (self._getUserList).addCallback(cb)
>
> Cheers,
> Christian
>
> _______________________________________________
> Twisted-web mailing list
> Twisted-web@twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-web/attachments/20070721/19=
eababc/attachment-0001.htm
From p.mayers at imperial.ac.uk  Sat Jul 21 10:56:35 2007
From: p.mayers at imperial.ac.uk (Phil Mayers)
Date: Sat Jul 21 10:57:13 2007
Subject: [Twisted-web] Problem with twisted web and adbapi
In-Reply-To: <D9722901-7D59-4A40-9A3F-BBBF7936F892@my-place.biz>
References: <9C4906F4-D639-4EB5-84A9-C063FDC6A2B4@my-place.biz>
	<cd8fa6f90707210634j1d72e47as97372da716e605b9@mail.gmail.com>
	<D9722901-7D59-4A40-9A3F-BBBF7936F892@my-place.biz>
Message-ID: <1185029795.8519.2.camel@localhost.localdomain>


> 
> Request did not return a string
> Request:
> <GET / HTTP/1.1>
> 
> 
> Resource:
> <__main__.Simple instance at 0x1208878>
> 
> 
> Value:
> <Deferred at 0x124cfa8>
> 
> 
> 
> 
> Later when the _getUserList() returns the Defered object calles the
> cb() function and i get a printout with the wanted result.
> 
> 
> So I think my problem is that I whant to *wait* for the result from
> the db query before the render_GET() returns.

No, you definitely don't wait - that defeats the entire point of using
an event-driven system.

See:

http://twistedmatrix.com/documents/current/api/twisted.web.resource.IResource.html

Basically:

def render_GET(self, request):
    def cb(data):
        request.write(data)
    # note, we add our callback to the deferred then discard it
    self.opt.dbpool.runInteraction(blah).addCallback(cb)
    # we *return* a special value
    return server.NOT_DONE_YET


HTH

> 


From p.mayers at imperial.ac.uk  Sat Jul 21 10:58:01 2007
From: p.mayers at imperial.ac.uk (Phil Mayers)
Date: Sat Jul 21 10:58:36 2007
Subject: [Twisted-web] Problem with twisted web and adbapi
In-Reply-To: <1185029795.8519.2.camel@localhost.localdomain>
References: <9C4906F4-D639-4EB5-84A9-C063FDC6A2B4@my-place.biz>
	<cd8fa6f90707210634j1d72e47as97372da716e605b9@mail.gmail.com>
	<D9722901-7D59-4A40-9A3F-BBBF7936F892@my-place.biz>
	<1185029795.8519.2.camel@localhost.localdomain>
Message-ID: <1185029882.8519.6.camel@localhost.localdomain>

Oops, sorry that should be:

def render_GET(self, request):
    def cb(data):
        request.write(data)
        request.finish()

    # note, we add our callback to the deferred then discard it
    self.opt.dbpool.runInteraction(blah).addCallback(cb)

    # we *return* a special value
    return server.NOT_DONE_YET


From sbc at my-place.biz  Sat Jul 21 11:08:07 2007
From: sbc at my-place.biz (=?ISO-8859-1?Q?S=F8ren_Bach_Christiansen?=)
Date: Sat Jul 21 11:08:09 2007
Subject: [Twisted-web] Problem with twisted web and adbapi
In-Reply-To: <1185029882.8519.6.camel@localhost.localdomain>
References: <9C4906F4-D639-4EB5-84A9-C063FDC6A2B4@my-place.biz>
	<cd8fa6f90707210634j1d72e47as97372da716e605b9@mail.gmail.com>
	<D9722901-7D59-4A40-9A3F-BBBF7936F892@my-place.biz>
	<1185029795.8519.2.camel@localhost.localdomain>
	<1185029882.8519.6.camel@localhost.localdomain>
Message-ID: <FA394DD1-504C-4517-A70B-5A599B661B62@my-place.biz>

Now it makes sense, specially liked the NOT.DONE.YET variable :) Hole  
thing worked like a charm, thanks a million

/S?ren


On Jul 21, 2007, at 16:58 , Phil Mayers wrote:

> Oops, sorry that should be:
>
> def render_GET(self, request):
>     def cb(data):
>         request.write(data)
>         request.finish()
>
>     # note, we add our callback to the deferred then discard it
>     self.opt.dbpool.runInteraction(blah).addCallback(cb)
>
>     # we *return* a special value
>     return server.NOT_DONE_YET
>
>
> _______________________________________________
> Twisted-web mailing list
> Twisted-web@twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web


From manlio_perillo at libero.it  Sun Jul 22 08:44:18 2007
From: manlio_perillo at libero.it (Manlio Perillo)
Date: Sun Jul 22 08:44:59 2007
Subject: [Twisted-web] twisted.web.client and HEAD
Message-ID: <46A35122.10008@libero.it>

Hi all.

I'm using Twisted 2.4 on Debian Etch.

It seems that twisted.web.client does not handle well HEAD commands.

If I do a getPage(url, method='HEAD') I get an exception:
twisted.web.client.PartialDownloadError: 200 OK


Is this a bug or a feature (since web.client is for page retrivial)?


Thanks  Manlio Perillo

From exarkun at divmod.com  Sun Jul 22 11:35:49 2007
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Sun Jul 22 11:35:54 2007
Subject: [Twisted-web] twisted.web.client and HEAD
In-Reply-To: <46A35122.10008@libero.it>
Message-ID: <20070722153549.4947.1602544134.divmod.quotient.14327@ohm>

On Sun, 22 Jul 2007 14:44:18 +0200, Manlio Perillo <manlio_perillo@libero.it> wrote:
>Hi all.
>
>I'm using Twisted 2.4 on Debian Etch.
>
>It seems that twisted.web.client does not handle well HEAD commands.
>
>If I do a getPage(url, method='HEAD') I get an exception:
>twisted.web.client.PartialDownloadError: 200 OK
>
>
>Is this a bug or a feature (since web.client is for page retrivial)?
>

What would you like it to do?

Jean-Paul

From manlio_perillo at libero.it  Sun Jul 22 12:36:27 2007
From: manlio_perillo at libero.it (Manlio Perillo)
Date: Sun Jul 22 12:37:03 2007
Subject: [Twisted-web] twisted.web.client and HEAD
In-Reply-To: <20070722153549.4947.1602544134.divmod.quotient.14327@ohm>
References: <20070722153549.4947.1602544134.divmod.quotient.14327@ohm>
Message-ID: <46A3878B.5080405@libero.it>

Jean-Paul Calderone ha scritto:
> On Sun, 22 Jul 2007 14:44:18 +0200, Manlio Perillo 
> <manlio_perillo@libero.it> wrote:
>> Hi all.
>>
>> I'm using Twisted 2.4 on Debian Etch.
>>
>> It seems that twisted.web.client does not handle well HEAD commands.
>>
>> If I do a getPage(url, method='HEAD') I get an exception:
>> twisted.web.client.PartialDownloadError: 200 OK
>>
>>
>> Is this a bug or a feature (since web.client is for page retrivial)?
>>
> 
> What would you like it to do?
> 

It (getPage) should not raise an exception, but simply return the empty 
string.


> Jean-Paul

Regards   Manlio Perillo

From exarkun at divmod.com  Sun Jul 22 13:49:45 2007
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Sun Jul 22 13:49:47 2007
Subject: [Twisted-web] twisted.web.client and HEAD
In-Reply-To: <46A3878B.5080405@libero.it>
Message-ID: <20070722174945.4947.387428788.divmod.quotient.14341@ohm>

On Sun, 22 Jul 2007 18:36:27 +0200, Manlio Perillo <manlio_perillo@libero.it> wrote:
>Jean-Paul Calderone ha scritto:
>>On Sun, 22 Jul 2007 14:44:18 +0200, Manlio Perillo 
>><manlio_perillo@libero.it> wrote:
>>>Hi all.
>>>
>>>I'm using Twisted 2.4 on Debian Etch.
>>>
>>>It seems that twisted.web.client does not handle well HEAD commands.
>>>
>>>If I do a getPage(url, method='HEAD') I get an exception:
>>>twisted.web.client.PartialDownloadError: 200 OK
>>>
>>>
>>>Is this a bug or a feature (since web.client is for page retrivial)?
>>
>>What would you like it to do?
>
>It (getPage) should not raise an exception, but simply return the empty 
>string.

That sounds reasonable.  Care to work up a patch?

Jean-Paul

From manlio_perillo at libero.it  Sun Jul 22 16:10:56 2007
From: manlio_perillo at libero.it (Manlio Perillo)
Date: Sun Jul 22 16:11:32 2007
Subject: [Twisted-web] twisted.web.client and HEAD
In-Reply-To: <20070722174945.4947.387428788.divmod.quotient.14341@ohm>
References: <20070722174945.4947.387428788.divmod.quotient.14341@ohm>
Message-ID: <46A3B9D0.3010402@libero.it>

Jean-Paul Calderone ha scritto:
> On Sun, 22 Jul 2007 18:36:27 +0200, Manlio Perillo 
> <manlio_perillo@libero.it> wrote:
>> Jean-Paul Calderone ha scritto:
>>> On Sun, 22 Jul 2007 14:44:18 +0200, Manlio Perillo 
>>> <manlio_perillo@libero.it> wrote:
>>>> Hi all.
>>>>
>>>> I'm using Twisted 2.4 on Debian Etch.
>>>>
>>>> It seems that twisted.web.client does not handle well HEAD commands.
>>>>
>>>> If I do a getPage(url, method='HEAD') I get an exception:
>>>> twisted.web.client.PartialDownloadError: 200 OK
>>>>
>>>>
>>>> Is this a bug or a feature (since web.client is for page retrivial)?
>>>
>>> What would you like it to do?
>>
>> It (getPage) should not raise an exception, but simply return the 
>> empty string.
> 
> That sounds reasonable.  Care to work up a patch?
> 

Ok.
I have found another possible bug.
getPage does not checks that the URI scheme is http.


> Jean-Paul


Regards  Manlio Perillo

From sbc at my-place.biz  Mon Jul 23 12:38:14 2007
From: sbc at my-place.biz (=?ISO-8859-1?Q?S=F8ren_Bach_Christiansen?=)
Date: Mon Jul 23 12:38:18 2007
Subject: [Twisted-web] how to implement render_POST?
Message-ID: <C029DE1C-98BD-49C0-B718-AF2BCFDB1814@my-place.biz>

Dos anyone have and example how to implement the different render  
function in web. Im trying to implement a REST service and I now have  
to use the render_POST.


My render_POST function looks like this:


     def render_POST(self,request):
         print request.received_headers
         print request.content.readlines()
         print request
         return "<html></html>"

but the only output i see is:

{'content-length': '134', 'content-type': 'application/x-www-form- 
urlencoded', 'host': 'sbcmac.local:8081', 'user-agent': 'Python- 
urllib/1.16'}
[]
<POST /User HTTP/1.0>


I wonder why I cant see the data I am posting. Can any of you guys  
see what im doing wrong???

ps. if anyone have a link to some example code, showing how to  
implement render_POST, render_PUT and render_DELETE I would be very  
happy


##### Client POST test code
import urllib
import sys
url = "http://sbcmac.local:8081/User"
param={'xml': """<userlist><user ContactName="Soren Bach  
Christinansen" ID="1"  UserName="sbc"/></userlist>"""}
if __name__ == '__main__':
     try:
         doc=urllib.urlencode(param)
         remote = urllib.urlopen(url,doc)
     except:
         sys.exit()


/S?ren



From maarten at treewalker.org  Mon Jul 23 12:49:31 2007
From: maarten at treewalker.org (Maarten ter Huurne)
Date: Mon Jul 23 12:49:51 2007
Subject: [Twisted-web] how to implement render_POST?
In-Reply-To: <C029DE1C-98BD-49C0-B718-AF2BCFDB1814@my-place.biz>
References: <C029DE1C-98BD-49C0-B718-AF2BCFDB1814@my-place.biz>
Message-ID: <200707231849.37102.maarten@treewalker.org>

On Monday 23 July 2007, S?ren Bach Christiansen wrote:

> I wonder why I cant see the data I am posting. Can any of you guys
> see what im doing wrong???

You can access the data through "request.args", just like it works for GET 
requests.

Bye,
		Maarten
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: This is a digitally signed message part.
Url : http://twistedmatrix.com/pipermail/twisted-web/attachments/20070723/2eaee4a8/attachment.pgp
From sbc at my-place.biz  Mon Jul 23 13:13:29 2007
From: sbc at my-place.biz (=?ISO-8859-1?Q?S=F8ren_Bach_Christiansen?=)
Date: Mon Jul 23 13:13:35 2007
Subject: [Twisted-web] how to implement render_POST?
In-Reply-To: <200707231849.37102.maarten@treewalker.org>
References: <C029DE1C-98BD-49C0-B718-AF2BCFDB1814@my-place.biz>
	<200707231849.37102.maarten@treewalker.org>
Message-ID: <DE8F4BD9-1553-433F-B4A5-2B9EFF9B844B@my-place.biz>

Thanks, dont know how I missed that one.
/S?ren


On Jul 23, 2007, at 18:49 , Maarten ter Huurne wrote:

> On Monday 23 July 2007, S?ren Bach Christiansen wrote:
>
>> I wonder why I cant see the data I am posting. Can any of you guys
>> see what im doing wrong???
>
> You can access the data through "request.args", just like it works  
> for GET
> requests.
>
> Bye,
> 		Maarten
> _______________________________________________
> Twisted-web mailing list
> Twisted-web@twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web


From iacovou at gmail.com  Tue Jul 24 06:42:36 2007
From: iacovou at gmail.com (kgi)
Date: Tue Jul 24 06:42:43 2007
Subject: [Twisted-web] Adding Athena JS handlers in render methods?
Message-ID: <200707241342.36712.iacovou@gmail.com>


Hi all.

I hit something earlier today that has me stumped. It might be a case of 
programming blindness, but on the other hand I might just be trying to do 
something that isn't supported.

Up until now, I've been adding Athena event handlers directly in the 
docFactory's stan. However, I needed to add something with an Athena event 
handler that needs data from an asynchronous external source, so I added data 
and render methods.

These normally Just Work, in the case of "vanilla" XHTML, but the Athena 
handlers don't seem to be processed by _rewriteEventHandlerToAttribute().

In other words, instead of a proper event handler being inserted into the 
XHTML, like so:

<a href="#" onclick="return Nevow.Athena.Widget.handleEvent(this, 
&quot;onclick&quot;, &quot;onclick&quot;);">Click Me 0</a>

a tag like this appears:

<a href="#"><athena:handler handler="onclick" 
event="onclick"></athena:handler>Click Me 1</a>

Here's some sample code to illustrate this. It's not a complete example in 
that there's no JS code to be invoked when you click on the first link, but 
it's runnable enough that you can load the page and view the page source.

The first link, "Click Me 0", has correct event handlers inserted.
The second and third links ("Click Me 1" and "Click Me 2") both have incorrect 
event handlers inserted. One of them simply returns a piece of stan, the 
other also makes a supposedly asynchronous call.

Am I trying to do something unsupported, or is this a bug?

Thanks,

Ricky

==

from twisted.internet import defer

from nevow import athena
from nevow import loaders
from nevow import flat
from nevow import tags as T
from nevow.page   import renderer

_js = athena.handler ( event = 'onclick', handler = 'onclick' )

class MyElement ( athena.LiveElement ):

    docFactory = loaders.stan (
        T.div ( render = T.directive ( 'liveElement' ) ) [
          T.a ( href = '#' ) [ _js, "Click Me 0" ],
          T.br,
          T.div ( render = T.directive ( 'someStan1' ) ),
          T.br,
          T.div ( render = T.directive ( 'someStan2' ) ),
          ]
    )


    def someStan1 ( self, context, name ):
        return T.a ( href = '#' ) [ _js, "Click Me 1" ]
    renderer ( someStan1 )


    def someStan2 ( self, context, name ):
        def _cb ( r ):
            return T.a ( href = '#' ) [ _js, r ]
        d = self._getData()
        d.addCallback ( _cb )
        return d
    renderer ( someStan2 )


    def _getData ( self ):
        return defer.succeed ( "Click Me 2")




class MyPage ( athena.LivePage ):

    docFactory = loaders.stan (
        T.html [ T.head ( render = T.directive ( "liveglue" ) ),
                 T.body [ T.div ( render = T.directive ( "myelement" ) ) ],
                 ] )


    def render_myelement ( self, request, tag ):
        e = MyElement()
        e.setFragmentParent ( self )
        return e


######################################################################

from twisted.application import service, internet
from nevow        import appserver

port = 7060

application  = service.Application ( "example" )
res          = MyPage()
site         = appserver.NevowSite ( res )
webService   = internet.TCPServer ( port, site )
webService.setServiceParent ( application )

From phil at bubblehouse.org  Tue Jul 24 11:35:34 2007
From: phil at bubblehouse.org (Phil Christensen)
Date: Tue Jul 24 11:35:59 2007
Subject: [Twisted-web] twistd and web2 weirdness
Message-ID: <375F480C-A3A8-4497-8E0B-8B58A7DCE6EB@bubblehouse.org>

I'm totally confounded on this one. For some reason, when using  
twistd, web2 cannot be found by the interpreter. (I'm running Twisted  
SVN HEAD on pythonmac's Python 2.4 on Mac OS X.)

For example, I've got the following code in a file called twisted.py


     from twisted.web2 import server, channel, static, wsgi

     def handler(env, start_response):
     	pass

     # This part gets run when you run this file via: "twistd -noy  
modu/web/twisted.py"
     root = wsgi.WSGIResource(handler)
     site = server.Site(root)

     # Start up the server
     from twisted.application import service, strports
     application = service.Application("web2")
     s = strports.service('tcp:8888', channel.HTTPFactory(site))
     s.setServiceParent(application)


When running it (with twistd -noy twisted.py), I get:


     Traceback (most recent call last):
       File "/Library/Frameworks/Python.framework/Versions/Current/ 
bin/twistd", line 20, in ?
         from twisted.scripts.twistd import run
       File "/Users/phil/Desktop/twisted.py", line 1, in ?
         from twisted.web2 import server, channel, static, wsgi
     ImportError: No module named web2


This is a standard Twisted installation using `python setup.py  
install`, and web2 is clearly in my site-packages directory:


     optimus:~ phil$ ls -la /Library/Frameworks/Python.framework/ 
Versions/2.4/lib/python2.4/site-packages/twisted/web2
     total 1272
     drwxr-xr-x   54 root  admin   1836 Jul 24 10:54 .
     drwxr-xr-x   36 root  admin   1224 Jul 24 10:54 ..
     -rw-r--r--    1 root  admin    254 Jun 29  2006 __init__.py
     -rw-r--r--    1 root  admin    371 Jul 24 10:54 __init__.pyc
     ...
     ...


Even stranger is that twistd doesn't seem to have any problems  
finding/loading the web2 plugin


     optimus:~ phil$ twistd
     Usage: twistd [options]
     ...
     ...
     ...
     Commands:
         web2             An HTTP/1.1 web server that can serve from  
a filesystem or
                          application resource.
     ...
     ...
     ...


And when running the exact interpreter path specified in twistd,  
there are no problems either:


     optimus:~ phil$ which twistd
     /Library/Frameworks/Python.framework/Versions/Current/bin/twistd

     optimus:~ phil$ head -n 1 /Library/Frameworks/Python.framework/ 
Versions/Current/bin/twistd
     #!/Library/Frameworks/Python.framework/Versions/2.4/Resources/ 
Python.app/Contents/MacOS/Python

     optimus:~ phil$ /Library/Frameworks/Python.framework/Versions/ 
2.4/Resources/Python.app/Contents/MacOS/Python
     Python 2.4.3 (#1, Apr  7 2006, 10:54:33)
     [GCC 4.0.1 (Apple Computer, Inc. build 5250)] on darwin
     Type "help", "copyright", "credits" or "license" for more  
information.
     >>> from twisted.web2 import server
     >>>


I had this same issue on my other development machine, also a Mac,  
but I assumed it was some kind of configuration issue with that  
machine in particular.

Has anyone had a similar experience? Any help in this matter would be  
appreciated.

-phil

From ldanielburr at mac.com  Tue Jul 24 12:18:00 2007
From: ldanielburr at mac.com (L. Daniel Burr)
Date: Tue Jul 24 12:19:51 2007
Subject: [Twisted-web] twistd and web2 weirdness
In-Reply-To: <375F480C-A3A8-4497-8E0B-8B58A7DCE6EB@bubblehouse.org>
References: <375F480C-A3A8-4497-8E0B-8B58A7DCE6EB@bubblehouse.org>
Message-ID: <op.tvy8waty3oj628@ops044.texturallc.net>

Hi Phil,

On Tue, 24 Jul 2007 10:35:34 -0500, Phil Christensen  
<phil@bubblehouse.org> wrote:

> I'm totally confounded on this one. For some reason, when using twistd,  
> web2 cannot be found by the interpreter. (I'm running Twisted SVN HEAD  
> on pythonmac's Python 2.4 on Mac OS X.)
>
> For example, I've got the following code in a file called twisted.py

Bzzzt!  Owie!  Don't do that.  The topmost package in the twisted
codebase is named "twisted".  You've shadowed that package with a
module of your own.

Try renaming your file to something else, and I'll bet things
start working for you.

Hope this helps,

L. Daniel Burr

From phil at bubblehouse.org  Tue Jul 24 13:08:57 2007
From: phil at bubblehouse.org (Phil Christensen)
Date: Tue Jul 24 13:09:02 2007
Subject: [Twisted-web] twistd and web2 weirdness
In-Reply-To: <op.tvy8waty3oj628@ops044.texturallc.net>
References: <375F480C-A3A8-4497-8E0B-8B58A7DCE6EB@bubblehouse.org>
	<op.tvy8waty3oj628@ops044.texturallc.net>
Message-ID: <464E1D9D-5262-48D5-A969-AC35091791CB@bubblehouse.org>

On Jul 24, 2007, at 12:18 PM, L. Daniel Burr wrote:

> Hi Phil,
>
> On Tue, 24 Jul 2007 10:35:34 -0500, Phil Christensen  
> <phil@bubblehouse.org> wrote:
>
>> I'm totally confounded on this one. For some reason, when using  
>> twistd, web2 cannot be found by the interpreter. (I'm running  
>> Twisted SVN HEAD on pythonmac's Python 2.4 on Mac OS X.)
>>
>> For example, I've got the following code in a file called twisted.py
>
> Bzzzt!  Owie!  Don't do that.  The topmost package in the twisted
> codebase is named "twisted".  You've shadowed that package with a
> module of your own.
>
> Try renaming your file to something else, and I'll bet things
> start working for you.

Thanks for the fast reply, but unfortunately that's not the problem.  
'twisted.py' was just the example minimum file i was using to  
describe the problem, although I clearly should have used something  
else.

Also, I'm pretty sure twistd's -y param simply loads this as a file  
(hence the ability to name it with a .tac file).

My actual app file is called 'twserver.py'. I did try renaming the  
example file I created before sending my previous email, but alas, no  
success.

-phil

From phil at bubblehouse.org  Tue Jul 24 13:12:06 2007
From: phil at bubblehouse.org (Phil Christensen)
Date: Tue Jul 24 13:12:12 2007
Subject: [Twisted-web] twistd and web2 weirdness
In-Reply-To: <464E1D9D-5262-48D5-A969-AC35091791CB@bubblehouse.org>
References: <375F480C-A3A8-4497-8E0B-8B58A7DCE6EB@bubblehouse.org>
	<op.tvy8waty3oj628@ops044.texturallc.net>
	<464E1D9D-5262-48D5-A969-AC35091791CB@bubblehouse.org>
Message-ID: <7F0A1C67-079E-447C-B3BB-B2874DB9AD68@bubblehouse.org>

On Jul 24, 2007, at 1:08 PM, Phil Christensen wrote:

> On Jul 24, 2007, at 12:18 PM, L. Daniel Burr wrote:
>> Bzzzt!  Owie!  Don't do that.  The topmost package in the twisted
>> codebase is named "twisted".  You've shadowed that package with a
>> module of your own.
>>
>> Try renaming your file to something else, and I'll bet things
>> start working for you.
>
> Thanks for the fast reply, but unfortunately that's not the  
> problem. 'twisted.py' was just the example minimum file i was using  
> to describe the problem, although I clearly should have used  
> something else.
>
> Also, I'm pretty sure twistd's -y param simply loads this as a file  
> (hence the ability to name it with a .tac file).

Ah, but you meant that if the current directory is in my path, this  
would clobber the twisted package. Sorry about that. Fortunately,  
it's neither named 'twisted' or in my path ;-).

-phil

From phil at bubblehouse.org  Tue Jul 24 13:15:17 2007
From: phil at bubblehouse.org (Phil Christensen)
Date: Tue Jul 24 13:15:23 2007
Subject: [Twisted-web] twistd and web2 weirdness
In-Reply-To: <7F0A1C67-079E-447C-B3BB-B2874DB9AD68@bubblehouse.org>
References: <375F480C-A3A8-4497-8E0B-8B58A7DCE6EB@bubblehouse.org>
	<op.tvy8waty3oj628@ops044.texturallc.net>
	<464E1D9D-5262-48D5-A969-AC35091791CB@bubblehouse.org>
	<7F0A1C67-079E-447C-B3BB-B2874DB9AD68@bubblehouse.org>
Message-ID: <97707732-2ED3-4405-98E4-29C6736ECE72@bubblehouse.org>


On Jul 24, 2007, at 1:12 PM, Phil Christensen wrote:

> On Jul 24, 2007, at 1:08 PM, Phil Christensen wrote:
>
>> On Jul 24, 2007, at 12:18 PM, L. Daniel Burr wrote:
>>> Bzzzt!  Owie!  Don't do that.  The topmost package in the twisted
>>> codebase is named "twisted".  You've shadowed that package with a
>>> module of your own.
>>>
>>> Try renaming your file to something else, and I'll bet things
>>> start working for you.
>>
>> Thanks for the fast reply, but unfortunately that's not the  
>> problem. 'twisted.py' was just the example minimum file i was  
>> using to describe the problem, although I clearly should have used  
>> something else.
>>
>> Also, I'm pretty sure twistd's -y param simply loads this as a  
>> file (hence the ability to name it with a .tac file).
>
> Ah, but you meant that if the current directory is in my path, this  
> would clobber the twisted package. Sorry about that. Fortunately,  
> it's neither named 'twisted' or in my path ;-).


Ah, but a leftover twisted.pyc file is!

Thanks so much, Daniel! Strange things are no longer afoot at the  
Circle K.

-phil

From ldanielburr at mac.com  Tue Jul 24 13:21:38 2007
From: ldanielburr at mac.com (L. Daniel Burr)
Date: Tue Jul 24 13:23:54 2007
Subject: [Twisted-web] twistd and web2 weirdness
In-Reply-To: <97707732-2ED3-4405-98E4-29C6736ECE72@bubblehouse.org>
References: <375F480C-A3A8-4497-8E0B-8B58A7DCE6EB@bubblehouse.org>
	<op.tvy8waty3oj628@ops044.texturallc.net>
	<464E1D9D-5262-48D5-A969-AC35091791CB@bubblehouse.org>
	<7F0A1C67-079E-447C-B3BB-B2874DB9AD68@bubblehouse.org>
	<97707732-2ED3-4405-98E4-29C6736ECE72@bubblehouse.org>
Message-ID: <op.tvzbucyk3oj628@ops044.texturallc.net>

Hi Phil,

On Tue, 24 Jul 2007 12:15:17 -0500, Phil Christensen  
<phil@bubblehouse.org> wrote:

>>> On Jul 24, 2007, at 12:18 PM, L. Daniel Burr wrote:
>>>> Bzzzt!  Owie!  Don't do that.  The topmost package in the twisted
>>>> codebase is named "twisted".  You've shadowed that package with a
>>>> module of your own.
>>>>
>>>> Try renaming your file to something else, and I'll bet things
>>>> start working for you.

[some further explanation of the problem, investigations, etc.]

>
>
> Ah, but a leftover twisted.pyc file is!
>
> Thanks so much, Daniel! Strange things are no longer afoot at the Circle  
> K.
>

You're welcome.  I think everyone has been bitten by some variant of
this problem at one time or another, and it certainly does cause
some head-scratching the first time you experience it.

L. Daniel Burr

From tarjei at nu.no  Tue Jul 24 14:10:13 2007
From: tarjei at nu.no (tarjei)
Date: Tue Jul 24 14:10:49 2007
Subject: [Twisted-web] Creating contexts for Unit Tests
Message-ID: <46A64085.3070300@nu.no>

Hi, I've run into a problem related to testing my application.

I'm trying to create a test for a method that should return a redirect
to another page:
     def return_upload_success(self, ctx):
         """
         File is uploaded, everyone is happy. We show the results :-)
         """
         self.request = inevow.IRequest(ctx)
         self.request.setComponent(iformless.IRedirectAfterPost, "/view/"
+ self.file.get_basename() )
         return self.request

To test this method I write a unittest that tries to create a context
object:

     def test_return_upload_success(self):
         self.page.context = PageContext(None,
remembrances={inevow.ICurrentSegments: ('rrr'),
inevow.IRemainingSegments: ()})
         ret = self.page.return_upload_success("sqlrsult")


The problem is that when I run this I get a typeerror:
TypeError: ('Could not adapt', PageContext(tag=None,
remembrances={<InterfaceClass nevow.inevow.ICurrentSegments>: 'rrr',
<InterfaceClass nevow.inevow.IRemainingSegments>: ()}), <InterfaceClass
nevow.inevow.IRequest>)

Does anyone have an idea on how I should set up my test?

Kind regards,
Tarjei


From karnaugh at karnaugh.za.net  Tue Jul 24 14:57:56 2007
From: karnaugh at karnaugh.za.net (Colin Alston)
Date: Tue Jul 24 14:58:10 2007
Subject: [Twisted-web] Creating contexts for Unit Tests
In-Reply-To: <46A64085.3070300@nu.no>
References: <46A64085.3070300@nu.no>
Message-ID: <46A64BB4.7010703@karnaugh.za.net>

On 24/07/2007 20:10 tarjei wrote:
> Hi, I've run into a problem related to testing my application.
> 

I can't quite understand why you're setting page.context. What I do is 
this..

ctx = context.WebContext(tag=page)
ctx.remember(testutil.AccumulatingFakeRequest())

Hope this helps in any way...

-- 
Colin Alston ~ http://www.karnaugh.za.net/
"To the world you may be one person, to one person you may be the 
world" ~ Rachel Ann Nunes.

Terms and conditions: http://www.karnaugh.za.net/email.rpy

From manlio_perillo at libero.it  Tue Jul 24 16:05:48 2007
From: manlio_perillo at libero.it (Manlio Perillo)
Date: Tue Jul 24 16:06:26 2007
Subject: [Twisted-web] twisted.web.client and HEAD
In-Reply-To: <20070722174945.4947.387428788.divmod.quotient.14341@ohm>
References: <20070722174945.4947.387428788.divmod.quotient.14341@ohm>
Message-ID: <46A65B9C.3030301@libero.it>

Jean-Paul Calderone ha scritto:
> On Sun, 22 Jul 2007 18:36:27 +0200, Manlio Perillo 
> <manlio_perillo@libero.it> wrote:
>> Jean-Paul Calderone ha scritto:
>>> On Sun, 22 Jul 2007 14:44:18 +0200, Manlio Perillo 
>>> <manlio_perillo@libero.it> wrote:
>>>> Hi all.
>>>>
>>>> I'm using Twisted 2.4 on Debian Etch.
>>>>
>>>> It seems that twisted.web.client does not handle well HEAD commands.
>>>>
>>>> If I do a getPage(url, method='HEAD') I get an exception:
>>>> twisted.web.client.PartialDownloadError: 200 OK
>>>>
>>>>
>>>> Is this a bug or a feature (since web.client is for page retrivial)?
>>>
>>> What would you like it to do?
>>
>> It (getPage) should not raise an exception, but simply return the 
>> empty string.
> 
> That sounds reasonable.  Care to work up a patch?
> 

Done: http://twistedmatrix.com/trac/ticket/2750



Regards  Manlio Perillo

From tarjei at nu.no  Wed Jul 25 06:49:29 2007
From: tarjei at nu.no (tarjei)
Date: Wed Jul 25 06:50:05 2007
Subject: [Twisted-web] Creating contexts for Unit Tests
In-Reply-To: <46A64BB4.7010703@karnaugh.za.net>
References: <46A64085.3070300@nu.no> <46A64BB4.7010703@karnaugh.za.net>
Message-ID: <46A72AB9.4030105@nu.no>

Colin Alston wrote:
> On 24/07/2007 20:10 tarjei wrote:
>> Hi, I've run into a problem related to testing my application.
>>
>
> I can't quite understand why you're setting page.context. What I do is
> this..
Because the method I'm testing does not get context as a parameter in
the first place :-)

>
> ctx = context.WebContext(tag=page)
> ctx.remember(testutil.AccumulatingFakeRequest()) 

> Hope this helps in any way...
It did, I wasn't aware of testutil. It seems that my Nevow version
(0.9.0) was a bit old as well.

Thanks a lot. I'll see if I can add this to the Nevow faq (does it exist?)

BTW: Should new apps be written in conformance with this document:

http://divmod.org/trac/wiki/DivmodNevow/ContextRemoval
?

Regards,
Tarjei


>


From phil at bubblehouse.org  Thu Jul 26 15:10:38 2007
From: phil at bubblehouse.org (Phil Christensen)
Date: Thu Jul 26 15:10:45 2007
Subject: [Twisted-web] twisted.web wsgi support
Message-ID: <4C56960C-4A85-412E-9A39-91BF3850CB68@bubblehouse.org>

I had need of WSGI support on twisted.web, so I put together the  
attached module.

I'd like to contribute this back to the project, of course, but I  
need some guidance on how I should proceed.

The attached module is just a proof of concept at this point; I  
haven't written any unit tests or documentation, but the bigger issue  
I'd like to discuss is how to remove the dependency on twisted.web2.

Since I generally run directly out of SVN HEAD, the web2 dependency  
isn't a big deal for me. However, removing this dependency would  
require a great deal of duplication of effort. In the end, the only  
real changes required were tweaks to  
twisted.web2.twcgi.createSGIEnvironment() and corresponding changes  
to twisted.web2.wsgi.WSGIHandler, as well as a twisted.web-compliant  
WSGIResource implementation.

I guess my goal here is to start a dialog about the best way to go  
forward. I've duplicated this email and attachment in a ticket at:

	http://twistedmatrix.com/trac/ticket/2753

Your input is appreciated,

-phil

From phil at bubblehouse.org  Fri Jul 27 11:42:37 2007
From: phil at bubblehouse.org (Phil Christensen)
Date: Fri Jul 27 11:42:47 2007
Subject: [Twisted-web] wsgi thread synchronization
Message-ID: <B63731D3-8EA1-4C49-B45F-F6CE1805E515@bubblehouse.org>

I'm crossposting because although my use case is in web, this is more  
of a question about dealing with threads in twisted. I have a decent  
academic understanding of threads, but I've never really used them in  
Python or Twisted.

I've just moved from a mod_python WSGI container running on prefork  
apache2 to a container running on twisted.web, and I realized that I  
now have threading considerations I didn't before.

Since my potential synchronization problems are actually quite few,  
I've been getting by just by using threading.BoundedSemaphore to  
manage a couple of thread-sensitive areas of the web app. However, I  
already have a dependency on Twisted core, so it occurs to me that  
there are probably nicer, twistier ways of doing this.

For example, I have a section of code like:


     host_tree = {}
     host_tree_lock = threading.BoundedSemaphore

     def get_application(env):
         global host_tree, host_tree_lock

         host = env.get('HTTP_HOST', env['SERVER_NAME'])

         host_tree_lock.acquire()

         if not(host in host_tree):
             _load_plugins(env)

         host_node = host_tree[host]

         if not(host_node.has_path(env['REQUEST_URI'])):
             _load_plugins(env)

         app = host_node.get_data_at(env['REQUEST_URI'])

         host_tree_lock.release()

         return app


The only variable shared between threads is the `host_tree` global  
(the `env` variable is the WSGI environment, which is unique per  
thread, and the resulting `app` object is immutable). This works for  
me and is sufficient for my needs, but I'd appreciate a sanity check  
from anyone with some thread karma to spare.

Thanks again,

-phil

From radix at twistedmatrix.com  Fri Jul 27 11:49:37 2007
From: radix at twistedmatrix.com (Christopher Armstrong)
Date: Fri Jul 27 11:49:43 2007
Subject: [Twisted-web] wsgi thread synchronization
In-Reply-To: <B63731D3-8EA1-4C49-B45F-F6CE1805E515@bubblehouse.org>
References: <B63731D3-8EA1-4C49-B45F-F6CE1805E515@bubblehouse.org>
Message-ID: <60ed19d40707270849p531417adxc06ed63b922071a7@mail.gmail.com>

On 7/27/07, Phil Christensen <phil@bubblehouse.org> wrote:

>      host_tree = {}
>      host_tree_lock = threading.BoundedSemaphore
>
>      def get_application(env):
>          global host_tree, host_tree_lock
>
>          host = env.get('HTTP_HOST', env['SERVER_NAME'])
>
>          host_tree_lock.acquire()

[bunch of stuff]

>          host_tree_lock.release()
>
>          return app

> The only variable shared between threads is the `host_tree` global
> (the `env` variable is the WSGI environment, which is unique per
> thread, and the resulting `app` object is immutable). This works for
> me and is sufficient for my needs, but I'd appreciate a sanity check
> from anyone with some thread karma to spare.

The most immediately obvious problem is that you're not protecting
yourself from an error in the code between the acquire and the
release. You'll want to start a try: block immediately after the
acquire and move the release into a finally: block.

-- 
Christopher Armstrong
International Man of Twistery
http://radix.twistedmatrix.com/
http://twistedmatrix.com/
http://canonical.com/

From phil at bubblehouse.org  Fri Jul 27 17:25:44 2007
From: phil at bubblehouse.org (Phil Christensen)
Date: Fri Jul 27 17:25:50 2007
Subject: [Twisted-web] what happens when browsers close the connection?
Message-ID: <2723EA27-0433-45A7-BE46-C9C2B2AFFFD9@bubblehouse.org>

Sorry to be so noisy lately, but I've run into another strange  
problem with web2.wsgi, or more likely, my understanding of it.

I'm seeing issues when the browser connection is closed uncleanly,  
particularly when doing a "fast reload" and clicking the reload  
before the first request/response has completed.

My specific issue is that when this happens, if I'm in the middle of  
a MySQL query (which in my app, I usually am), subsequent calls to  
<Cursor>.execute() are failing because the previous resultset was  
never freed.

This is only an issue when using web2 (or my custom twisted.web wsgi  
layer, which still uses web2's wsgi.WSGIHandler class). Apache/ 
mod_python seems to allow each request to continue to completion  
behind the scenes, although it makes up for it by crashing horribly  
in other ways.

What I'd like to know is what exactly happens when a browser closes a  
connection? Is there any possibility that the lost connection event  
has some implications further up the call chain? Could any of this  
somehow stop or kill the thread created in WSGIResource.renderHTTP()?

-phil

From exarkun at divmod.com  Mon Jul 30 10:22:46 2007
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Mon Jul 30 10:22:53 2007
Subject: [Twisted-web] what happens when browsers close the connection?
In-Reply-To: <2723EA27-0433-45A7-BE46-C9C2B2AFFFD9@bubblehouse.org>
Message-ID: <20070730142246.4947.1547658682.divmod.quotient.16650@ohm>

On Fri, 27 Jul 2007 17:25:44 -0400, Phil Christensen <phil@bubblehouse.org> wrote:
>Sorry to be so noisy lately, but I've run into another strange  problem with 
>web2.wsgi, or more likely, my understanding of it.
>
>I'm seeing issues when the browser connection is closed uncleanly, 
>particularly when doing a "fast reload" and clicking the reload  before the 
>first request/response has completed.
>
>My specific issue is that when this happens, if I'm in the middle of  a 
>MySQL query (which in my app, I usually am), subsequent calls to 
><Cursor>.execute() are failing because the previous resultset was  never 
>freed.
>
>This is only an issue when using web2 (or my custom twisted.web wsgi  layer, 
>which still uses web2's wsgi.WSGIHandler class). Apache/ mod_python seems to 
>allow each request to continue to completion  behind the scenes, although it 
>makes up for it by crashing horribly  in other ways.
>
>What I'd like to know is what exactly happens when a browser closes a 
>connection? Is there any possibility that the lost connection event  has 
>some implications further up the call chain? Could any of this  somehow stop 
>or kill the thread created in WSGIResource.renderHTTP()?

When the browser closes the connection, the server will eventually be
notified that the TCP socket is closed.  This translates into a call to
connectionLost on the HTTP protocol implementation.  This in turns stops
any producer which is registered and tells the request that the connection
was lost.  By default, I think the request ignores this notification.  WSGI
is probably implemented as a producer, though.  So, the producer for the
application which was run to service the request will stop producing.  This
most likely means it will not iterate the iterator the application returned
anymore.  It cannot interrupt or otherwise terminate the thread the WSGI
application is running in, though (since this is not an operation supported
by Python threads).  It has to wait for the application to produce one more
piece of output, then it can exit the loop.

So, it is indeed entirely possible for only part of a WSGI application to
run, if the browser disappears before it finishes running.

Jean-Paul

From exarkun at divmod.com  Mon Jul 30 10:25:43 2007
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Mon Jul 30 10:25:45 2007
Subject: [Twisted-web] Adding Athena JS handlers in render methods?
In-Reply-To: <200707241342.36712.iacovou@gmail.com>
Message-ID: <20070730142543.4947.229535084.divmod.quotient.16652@ohm>

On Tue, 24 Jul 2007 13:42:36 +0300, kgi <iacovou@gmail.com> wrote:
>
>Hi all.
>
>I hit something earlier today that has me stumped. It might be a case of
>programming blindness, but on the other hand I might just be trying to do
>something that isn't supported.
>
>Up until now, I've been adding Athena event handlers directly in the
>docFactory's stan. However, I needed to add something with an Athena event
>handler that needs data from an asynchronous external source, so I added data
>and render methods.
>
> [snip - event handlers in stan returned by render/data methods don't work]
>
>Am I trying to do something unsupported, or is this a bug?
>

It's unsupported.  What you can do instead is to put the event handlers into
the template (stan or xhtml) as patterns.  This will result in them being
rewritten properly.  Your render and data methods will thus be able to load
them, already pre-processed, from the docFactory and put them in the page.

Jean-Paul

From exarkun at divmod.com  Mon Jul 30 10:27:32 2007
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Mon Jul 30 10:27:33 2007
Subject: [Twisted-web] Creating contexts for Unit Tests
In-Reply-To: <46A72AB9.4030105@nu.no>
Message-ID: <20070730142732.4947.1261217898.divmod.quotient.16653@ohm>

On Wed, 25 Jul 2007 12:49:29 +0200, tarjei <tarjei@nu.no> wrote:
> [snip]
>
>BTW: Should new apps be written in conformance with this document:
>
>http://divmod.org/trac/wiki/DivmodNevow/ContextRemoval
>?

As much as is currently possible.  Note, however, that not everything
described on that page is implemented, even in current Nevow trunk@HEAD.

Jean-Paul

