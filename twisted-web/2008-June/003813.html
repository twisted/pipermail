<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] Redirect problem
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Redirect%20problem&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003812.html">
   <LINK REL="Next"  HREF="003816.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] Redirect problem</H1>
    <B>tarjei</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Redirect%20problem&In-Reply-To="
       TITLE="[Twisted-web] Redirect problem">tarjei at nu.no
       </A><BR>
    <I>Fri Jun 20 06:45:51 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="003812.html">[Twisted-web] Python 2.3 support in Nevow
</A></li>
        <LI>Next message: <A HREF="003816.html">[Twisted-web] Silently dying server processes started with twistd
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3813">[ date ]</a>
              <a href="thread.html#3813">[ thread ]</a>
              <a href="subject.html#3813">[ subject ]</a>
              <a href="author.html#3813">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Hi, using Nevow, I want to send an extra header X-objectId to the client
when the client has posted an image to a page.

My problem is that when I do a post, the client returns the headers
(including mine) but then hangs partly out into the request.

Example:
curl <A HREF="http://localhost:8000/store/">http://localhost:8000/store/</A> -F image=@./globalwarming.jpg
HTTP/1.1 302 Found
Content-length: 391
Content-type: application/xml
Accept-ranges: bytes
Server: TwistedWeb/8.1.0
Last-modified: Fri, 20 Jun 2008 10:42:22 GMT
Location:
/info/2008/6/20/f/f95556fd25cc4a8a8cb87b7453bbd0de/f95556fd25cc4a8a8cb87b7453bbd0de.jpg
Date: Fri, 20 Jun 2008 10:42:22 GMT
X-objectId:
2008/6/20/f/f95556fd25cc4a8a8cb87b7453bbd0de/f95556fd25cc4a8a8cb87b7453bbd0de.jpg

&lt;imageMetadata&gt;&lt;property name=&quot;width&quot; value=&quot;934&quot; /&gt;&lt;property
name=&quot;extension&quot; value=&quot;.jpg&quot; /&gt;&lt;property name=&quot;format&quot; value=&quot;JPEG&quot;
/&gt;&lt;property name=&quot;colour&quot; value=&quot;768&quot; /&gt;&lt;property name=&quot;height&quot;
value=&quot;524&quot; /&gt;&lt;property name=&quot;id&quot;
value=&quot;2008/6/20/f/f95556fd25cc4a8a8cb87b7453bbd0de/f95556fd25cc4a8a8cb87b7453bbd0de.jpg&quot;
/&gt;&lt;property name=&quot;filename&quot; value=&quot;globalwarming.jpg&quot; /&gt;&lt;/imageMetad



class StoreImage(rend.Page):
    addSlash=True
    &quot;&quot;&quot;
    Gets a file and a set of metadata fields.
    POST with the image in the field image and a metadata dictionary of
name =&gt; value pairs.
    &quot;&quot;&quot;

    def __init__(self, config):
        self.config = config

    def locateChild(self, ctx, segments):
	# removed som internal processing here to make the example smaller.
        self.metadata = {'id': &quot;pokpokpokpo/oijoioij&quot; } # dummy data
        self.xmlFileName = &quot;/somefile.xml&quot;
        return self, ()

    def renderHTTP(self, ctx):
        metadata = self.metadata
        request = inevow.IRequest(ctx)
        request.setHeader('Content-Type', 'text/xml; charset=UTF-8')
        request.setHeader('X-objectId', metadata['id'] )
        #request.setResponseCode(&quot;303&quot;) # 303
        request.redirect( &quot;/info/&quot; + metadata['id'] )
        #request.finish()

        # I have also tried to return &quot;&quot; but with the same results.
        return static.File(self.xmlFileName, 'text/xml')



I have tried various ways to get this working. I've tried to call
request.finish(), but then the process bombs out.

Any tips to what I should do to get this working would be very welcome.

Kind regards,
Tarjei
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.6 (GNU/Linux)
Comment: Using GnuPG with Mozilla - <A HREF="http://enigmail.mozdev.org">http://enigmail.mozdev.org</A>

iD8DBQFIW4pfYVRKCnSvzfIRArmOAJ9rR94r2taNbFav18FJGPy70iwAvwCfX0v8
FbEX7pBHtvpXJ9qtySEveCc=
=L6YP
-----END PGP SIGNATURE-----

</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003812.html">[Twisted-web] Python 2.3 support in Nevow
</A></li>
	<LI>Next message: <A HREF="003816.html">[Twisted-web] Silently dying server processes started with twistd
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3813">[ date ]</a>
              <a href="thread.html#3813">[ thread ]</a>
              <a href="subject.html#3813">[ subject ]</a>
              <a href="author.html#3813">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
