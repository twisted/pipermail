<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] nevow/stan + pregenerated HTML
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20nevow/stan%20%2B%20pregenerated%20HTML&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000461.html">
   <LINK REL="Next"  HREF="000463.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] nevow/stan + pregenerated HTML</H1>
    <B>Mike Warren</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20nevow/stan%20%2B%20pregenerated%20HTML&In-Reply-To="
       TITLE="[Twisted-web] nevow/stan + pregenerated HTML">spam at mike-warren.com
       </A><BR>
    <I>Wed Jun  2 16:59:11 MDT 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="000461.html">[Twisted-web] nevow/stan + pregenerated HTML
</A></li>
        <LI>Next message: <A HREF="000463.html">[Twisted-web] nevow/stan + pregenerated HTML
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#462">[ date ]</a>
              <a href="thread.html#462">[ thread ]</a>
              <a href="subject.html#462">[ subject ]</a>
              <a href="author.html#462">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Mike Warren &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">spam at mike-warren.com</A>&gt; writes:

&gt;<i> Is there any way to do this? Ideas?
</I>
Of course, I got an idea right after I sent this. But, I think I might
have found a bug in Nevow (although I'm pretty new at this; *please*
correct me if I'm wrong).

I figured I could make my own class implementing
nevow.inevow.ISerializable and skip the whole &quot;quoting&quot; phase
altogether. I did this:

,----
|<i> class RawString(str):
</I>|<i>     __implements__ = nevow.inevow.ISerializable
</I>|<i>     
</I>|<i>     def serialize(self, context):
</I>|<i>         return str(self)
</I>`----

...however, in nevow/flat/ten.py:

,----
|<i> # FIXME: hack!
</I>|<i> # and the way serialize is implemented is possibly an
</I>|<i> # abuse of the compy system, but hey, it WORKS. :)
</I>|<i> 
</I>|<i> cachedAdapters = {}
</I>|<i> def getSerializer(obj):
</I>|<i>     if hasattr(obj, '__class__'):
</I>|<i>         klas = obj.__class__
</I>|<i>     else:
</I>|<i>         klas = type(obj)
</I>|<i> 
</I>|<i>     adapter = cachedAdapters.get(klas, None)
</I>|<i>     if adapter is not None:
</I>|<i>         return adapter
</I>|<i>     
</I>|<i>     #print &quot;Adding cache entry for &quot;,klas
</I>|<i>     registry = compy.getRegistry(None)
</I>|<i>     fromInterfaces = compy.classToInterfaces(klas)
</I>|<i>     for fromInterface in fromInterfaces:
</I>|<i>         #print &quot; trying: &quot;, fromInterface
</I>|<i>         adapter = registry.getAdapterFactory(
</I>|<i>             fromInterface,
</I>|<i>             inevow.ISerializable,
</I>|<i>             None)
</I>|<i>         if adapter is not None:
</I>|<i>             cachedAdapters[klas] = adapter
</I>|<i>             return adapter
</I>|<i>     return None
</I>`----

...it appears that this code presumes that one needs an adaptor to the
ISerializable interface. My object already implements this, however,
so I added these two lines (after the &quot; trying:&quot; print statement):

,----
|<i>         if fromInterface == inevow.ISerializable:      
</I>|<i>             return lambda object,x: object.serialize(x)
</I>`----

...which makes everything do exactly what I want (namely, in my
original code, I return a RawString for my pregenerated HTML and it
makes it through fine). [Of course, I realise I might end up with
non-conforming XHTML if I fuck up my pregeneration, but hey...]

Am I right? Should I file a patch? (After adding code to cache the
lambda, too)

Cheers,

-- 
mike [at] mike [dash] warren [dot] com
&lt;URL:<A HREF="http://www.mike-warren.com">http://www.mike-warren.com</A>&gt;
gpg --keyserver 80.71.227.37 --recv-key 579911BD
87F2 4D98 BDB0 0E90 EE2A 0CF9 1087 0884 5799 11BD

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000461.html">[Twisted-web] nevow/stan + pregenerated HTML
</A></li>
	<LI>Next message: <A HREF="000463.html">[Twisted-web] nevow/stan + pregenerated HTML
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#462">[ date ]</a>
              <a href="thread.html#462">[ thread ]</a>
              <a href="subject.html#462">[ subject ]</a>
              <a href="author.html#462">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
