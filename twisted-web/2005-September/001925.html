<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] twisted.web2.stream.IStream.reset()?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20twisted.web2.stream.IStream.reset%28%29%3F&In-Reply-To=2F2BEA1A-7F4F-4D91-ADF4-B09CF7313305%40slamb.org">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001924.html">
   <LINK REL="Next"  HREF="001926.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] twisted.web2.stream.IStream.reset()?</H1>
    <B>Jp Calderone</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20twisted.web2.stream.IStream.reset%28%29%3F&In-Reply-To=2F2BEA1A-7F4F-4D91-ADF4-B09CF7313305%40slamb.org"
       TITLE="[Twisted-web] twisted.web2.stream.IStream.reset()?">exarkun at divmod.com
       </A><BR>
    <I>Fri Sep 23 15:37:43 MDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="001924.html">[Twisted-web] twisted.web2.stream.IStream.reset()?
</A></li>
        <LI>Next message: <A HREF="001926.html">[Twisted-web] twisted.web2.stream.IStream.reset()?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1925">[ date ]</a>
              <a href="thread.html#1925">[ thread ]</a>
              <a href="subject.html#1925">[ subject ]</a>
              <a href="author.html#1925">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Fri, 23 Sep 2005 14:27:41 -0700, Scott Lamb &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">slamb at slamb.org</A>&gt; wrote:
&gt;<i>Hi David and all,
</I>&gt;<i>
</I>&gt;<i>I stumbled across your twisted web2-client branch from google. I need  to 
</I>&gt;<i>make a specialized HTTP load generator that uses Keep-Alives. 
</I>&gt;<i>twisted.web2.client seems the best way, so I'm trying to make this  branch 
</I>&gt;<i>work for me.
</I>&gt;<i>
</I>&gt;<i>My load generator needs to make a bunch of sequences of authenticated 
</I>&gt;<i>POSTs, picking up a cookie along the way.
</I>&gt;<i>
</I>&gt;<i>I've stumbled onto a bug: the first request will return a  401Unauthorized. 
</I>&gt;<i>HTTPClientFactory.handleStatus_401 deals with  this...but the postdata is 
</I>&gt;<i>gone.
</I>&gt;<i>
</I>&gt;<i>This code generates the new request:
</I>&gt;<i>
</I>&gt;<i>                 req = Request(request.method, request.uri,  request.args,
</I>&gt;<i>                               request.headers, request.stream)
</I>&gt;<i>
</I>&gt;<i>It looks like web2.stream.IStream is single-use - it returns a None  when 
</I>&gt;<i>there's no more data. I think this - or maybe a  IResettableStream subclass 
</I>&gt;<i>- needs a reset() method.
</I>&gt;<i>
</I>&gt;<i>I've got a patch that allowed me to proceed. I wouldn't recommend  applying 
</I>&gt;<i>as-is - I only messed with the MemoryStream that I'm using,  and there's no 
</I>&gt;<i>unit test. I want to send this in before I forget  about it, though.
</I>
Many stream sources cannot be rewound.  Implementing reset for IStream would require many implementations to hold their entire contents in memory.  This is completely unreasonable.  Creating a separate interface for streams which could be rewound would avoid this problem, but at the same time limit the actual implementations your code could work with to an extreme subset.

Instead of extending IStream or creating a new interface, you probably want to wrap request.stream before passing it to the request.  The wrapper can take care of providing restartability.  It can also prevent the concurrency bugs that handing a single stream to multiple Requests will present.

Jp

</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001924.html">[Twisted-web] twisted.web2.stream.IStream.reset()?
</A></li>
	<LI>Next message: <A HREF="001926.html">[Twisted-web] twisted.web2.stream.IStream.reset()?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1925">[ date ]</a>
              <a href="thread.html#1925">[ thread ]</a>
              <a href="subject.html#1925">[ subject ]</a>
              <a href="author.html#1925">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
