<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] [Twisted-Python] twisted.web questions
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20%5BTwisted-Python%5D%20twisted.web%20questions&In-Reply-To=26255.63.107.91.99.1276531016.squirrel%40webmail.zoteca.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004495.html">
   <LINK REL="Next"  HREF="004497.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] [Twisted-Python] twisted.web questions</H1>
    <B>Allen Bierbaum</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20%5BTwisted-Python%5D%20twisted.web%20questions&In-Reply-To=26255.63.107.91.99.1276531016.squirrel%40webmail.zoteca.com"
       TITLE="[Twisted-web] [Twisted-Python] twisted.web questions">abierbaum at gmail.com
       </A><BR>
    <I>Mon Jun 14 18:42:28 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="004495.html">[Twisted-web] twisted.web questions
</A></li>
        <LI>Next message: <A HREF="004497.html">[Twisted-web] [Twisted-Python] twisted.web questions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4496">[ date ]</a>
              <a href="thread.html#4496">[ thread ]</a>
              <a href="subject.html#4496">[ subject ]</a>
              <a href="author.html#4496">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i>
</I>&gt;<i> [..]
</I>&gt;<i>
</I>&gt;&gt;<i> There's a branch of Twisted that implements this, hopefully it will
</I>&gt;<i> &gt;&gt; eventually be merged:
</I>&gt;<i> &gt;&gt; <A HREF="http://twistedmatrix.com/trac/ticket/3711">http://twistedmatrix.com/trac/ticket/3711</A>
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt;&gt;
</I>&gt;<i> &gt; Is there anything that is currently holding this up?  (ie. is the design
</I>&gt;<i> &gt; on
</I>&gt;<i> &gt; this branch what will end up in the system or could it change
</I>&gt;<i> &gt; dramatically?)
</I>&gt;<i>
</I>&gt;<i> There are a bunch of review comments in the ticket. You could just write
</I>&gt;<i> your own until this is ready, I've done it a number of times and it's a
</I>&gt;<i> pretty small piece of code.
</I>&gt;<i>
</I>
I started writing one of my own today (basically a wrapper in render_GET
that calls an deferrable render_GET).

Something like this:

  def _bg_GET(self, request):
      # Do something slow
      request.write(result)
      return request

   def render_GET(self, request):
      d = deferToThread(self._bg_GET, request)
      d.addCallback(lambda r: r.finish())
      return NOT_DONE_YET

That seems to work, but I would like to
   a) not use the deferToThread() and
   b) do something that doesn't sacrifice too much performance.

At the end of the day, what I would really like is something in render_GET
that checks the return from calling the internal GET method and if it is a
deferred it adds a callback to finish the request, if not it simply returns
the result.  (this would allow me to use deferToThread, inlineCallbacks, etc
as needed in my get methods)

Can you see any issues with doing something like this?  (it seems almost too
simple so I expect that I must be missing something)

-Allen
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://twistedmatrix.com/pipermail/twisted-web/attachments/20100614/071ab021/attachment.htm">http://twistedmatrix.com/pipermail/twisted-web/attachments/20100614/071ab021/attachment.htm</A> 
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004495.html">[Twisted-web] twisted.web questions
</A></li>
	<LI>Next message: <A HREF="004497.html">[Twisted-web] [Twisted-Python] twisted.web questions
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4496">[ date ]</a>
              <a href="thread.html#4496">[ thread ]</a>
              <a href="subject.html#4496">[ subject ]</a>
              <a href="author.html#4496">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
