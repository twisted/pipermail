<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] Nevow and distrib
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Nevow%20and%20distrib&In-Reply-To=1089609671.14113.1.camel%40localhost">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000537.html">
   <LINK REL="Next"  HREF="000540.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] Nevow and distrib</H1>
    <B>Matt Goodall</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Nevow%20and%20distrib&In-Reply-To=1089609671.14113.1.camel%40localhost"
       TITLE="[Twisted-web] Nevow and distrib">matt at pollenation.net
       </A><BR>
    <I>Mon Jul 12 03:51:18 MDT 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="000537.html">[Twisted-web] Nevow and distrib
</A></li>
        <LI>Next message: <A HREF="000540.html">[Twisted-web] Nevow and distrib
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#539">[ date ]</a>
              <a href="thread.html#539">[ thread ]</a>
              <a href="subject.html#539">[ subject ]</a>
              <a href="author.html#539">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Mon, 2004-07-12 at 06:21, David Reid wrote:
&gt;<i> Much more interesting, is the new-web/twisted/web/proxy.py which moshez
</I>&gt;<i> rewrote to allow support of both TCP and Unix sockets.
</I>&gt;<i> In a much cleaner way than my distrib.py hackery.
</I>
Yes, that does look good. However, there's nothing which tells the Nevow
app what URL it is actually working behind which means generated URLs
are incorrect. Now, if proxy also set the 'x-forwarded-from' header then
the Nevow app would work just the same. Hmm, it records 'host' in the
request headers ... perhaps that's supposed to include the port too?

Anyway, thanks for mentioning this.

Cheers, Matt

&gt;<i> 
</I>&gt;<i> -David
</I>&gt;<i> 
</I>&gt;<i> On Sun, 2004-07-11 at 20:01, Matt Goodall wrote:
</I>&gt;<i> &gt; Hi all,
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Attached is a distrib module and a patch to nevow/appserver.py that
</I>&gt;<i> &gt; allows Nevow to work behind a distrib server. Yippee! I claim no credit
</I>&gt;<i> &gt; for the distrib module, I ripped it from new-web. The change to
</I>&gt;<i> &gt; appserver.py is almost certainly not robust enough but ti works for a
</I>&gt;<i> &gt; simple distrib server. Patches will be most welcome as you fix the
</I>&gt;<i> &gt; bugs ;-).
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; You don't need a Publisher with this as it's all proxy based. I imagine
</I>&gt;<i> &gt; the proxy will work over a UNIX socket but I only tested over TCP. Below
</I>&gt;<i> &gt; is the server I used to test:
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; from twisted.application import service
</I>&gt;<i> &gt; from twisted.application import internet
</I>&gt;<i> &gt; from nevow import appserver, distrib
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; application = service.Application('distribtest')
</I>&gt;<i> &gt; internet.TCPServer(
</I>&gt;<i> &gt;     8000,
</I>&gt;<i> &gt;     appserver.NevowSite(
</I>&gt;<i> &gt;         distrib.ResourceSubscription('localhost', 8001)
</I>&gt;<i> &gt;     )
</I>&gt;<i> &gt; ).setServiceParent(application)
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Also, I imagine it's relatively easy to use the same technique to hide a
</I>&gt;<i> &gt; Nevow app behind Apache. It's just a matter of adding a 'x-forwarded-
</I>&gt;<i> &gt; from' header to the request before proxying it to the twistd server (see
</I>&gt;<i> &gt; distrib.py). mod_proxy + mod_headers should help, maybe mod_rewrite too.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Hope this is of interest.
</I>&gt;<i> &gt; 
</I>&gt;<i> &gt; Cheers, Matt
</I>&gt;<i> &gt; 
</I>&gt;<i> 
</I>&gt;<i> ______________________________________________________________________
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-web mailing list
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">Twisted-web at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web</A>
</I>-- 
     __
    /  \__     Matt Goodall, Pollenation Internet Ltd
    \__/  \    w: <A HREF="http://www.pollenation.net">http://www.pollenation.net</A>
  __/  \__/    e: <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">matt at pollenation.net</A>
 /  \__/  \    t: +44 (0)113 2252500
 \__/  \__/
 /  \          Any views expressed are my own and do not necessarily
 \__/          reflect the views of my employer.


</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000537.html">[Twisted-web] Nevow and distrib
</A></li>
	<LI>Next message: <A HREF="000540.html">[Twisted-web] Nevow and distrib
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#539">[ date ]</a>
              <a href="thread.html#539">[ thread ]</a>
              <a href="subject.html#539">[ subject ]</a>
              <a href="author.html#539">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
