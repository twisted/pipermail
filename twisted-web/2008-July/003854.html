<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> Resource as Avatar (was Re: [Twisted-web] newbiew question)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=Resource%20as%20Avatar%20%28was%20Re%3A%20%5BTwisted-web%5D%20newbiew%20question%29&In-Reply-To=48873C9D.5000609%40imperial.ac.uk">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003853.html">
   <LINK REL="Next"  HREF="003855.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>Resource as Avatar (was Re: [Twisted-web] newbiew question)</H1>
    <B>Jean-Paul Calderone</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=Resource%20as%20Avatar%20%28was%20Re%3A%20%5BTwisted-web%5D%20newbiew%20question%29&In-Reply-To=48873C9D.5000609%40imperial.ac.uk"
       TITLE="Resource as Avatar (was Re: [Twisted-web] newbiew question)">exarkun at divmod.com
       </A><BR>
    <I>Wed Jul 23 10:58:09 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="003853.html">Resource as Avatar (was Re: [Twisted-web] newbiew question)
</A></li>
        <LI>Next message: <A HREF="003855.html">Resource as Avatar (was Re: [Twisted-web] newbiew question)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3854">[ date ]</a>
              <a href="thread.html#3854">[ thread ]</a>
              <a href="subject.html#3854">[ subject ]</a>
              <a href="author.html#3854">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Wed, 23 Jul 2008 15:13:49 +0100, Phil Mayers &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">p.mayers at imperial.ac.uk</A>&gt; wrote:
&gt;&gt;&gt;<i>The information about the user does not belong in any Resource subclass: a
</I>&gt;&gt;&gt;<i>Resource is a page that can be generated for different users, so it should
</I>&gt;&gt;&gt;<i>only contain information that is the same for all users. Any user specific
</I>&gt;&gt;&gt;<i>data should be fetched via the request object.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>This is totally inaccurate. It's perfectly reasonable to store
</I>&gt;&gt;<i>user-specific data in Resource objects.  &quot;a Resource is a page that
</I>&gt;&gt;<i>can be generated for different users&quot; is either irrelevant or not
</I>&gt;&gt;<i>true, I can't tell which. You can dynamically and return Resources
</I>&gt;&gt;<i>based on which user is making the request.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>Now, I'm not sure my favorite abstraction for a user is a string; I'd
</I>&gt;&gt;<i>probably pass something other than a username to a Resource. Perhaps a
</I>&gt;&gt;<i>rich object representing the user.
</I>&gt;<i>
</I>&gt;<i>Since this is a common mis-conception (one I suffered from and have now 
</I>&gt;<i>disabused myself of) it's worth discussing.
</I>&gt;<i>
</I>&gt;<i>If my understanding is correct: twisted.cred uses the concept of an 
</I>&gt;<i>&quot;avatar&quot;. Avatars (I think...):
</I>&gt;<i>
</I>&gt;<i>  * are protocol objects
</I>
In some sense, they are protocol objects - they are used by protocol
implementations to authorize user actions.  They are not /themselves/
protocol implementations, though - that is, they do not implement
IProtocol (at least, not in general) or subclass Protocol.  I'm not
sure if this is what you meant.

&gt;<i>  * represent the user
</I>
Yep, absolutely. :)

&gt;<i>
</I>&gt;<i>In twisted.web, the Resource *is* the avatar. In twisted.mail.imap, the 
</I>&gt;<i>Mailbox is the avatar. In twisted.conch, the Shell is the avatar (and so 
</I>&gt;<i>on).
</I>
Yep.

&gt;<i>I found this initially confusing, because in many web frameworks e.g. Zope, 
</I>&gt;<i>where I came from, the objects representing resources are:
</I>&gt;<i>
</I>&gt;<i>  * long lived
</I>&gt;<i>  * the same instances serve &gt;1 HTTP request
</I>&gt;<i>  * instantiated at process start time
</I>&gt;<i>
</I>&gt;<i>It's also somewhat confusing because unlike other protocols, HTTP requests 
</I>&gt;<i>are very short-lived. It's worth noting you *can* have long-lived multi- 
</I>&gt;<i>instance t.w.Resource objects.
</I>&gt;<i>
</I>&gt;<i>In twisted, a common design pattern seems to be (I hope; I adopted it...)
</I>&gt;<i>
</I>&gt;<i>  * have your realm return a root Resource i.e. one for &quot;/&quot;
</I>
Yep, although note that it doesn't _have_ to be &quot;/&quot;.  You can have the
authenticated/authorized part of your resource hierarchy start wherever
you like.  If it starts at &quot;/&quot;, then every resource on the server is
&quot;guarded&quot;.

&gt;<i>  * attach your User object to that resource
</I>&gt;<i>  * have your root resource dynamically create the leaf resources via 
</I>&gt;<i>locateChild or childFactory, then attach the User object
</I>&gt;<i>  * when you need user info, get at it via e.g. self.user
</I>&gt;<i>  * let the leaf/root objects get GC-ed when the HTTP request is done
</I>
Yep.

&gt;<i>
</I>&gt;<i>I believe changes have been committed to twisted.web making this design 
</I>&gt;<i>pattern even more preferred:
</I>&gt;<i>
</I>&gt;<i><A HREF="http://twistedmatrix.com/trac/changeset/23950">http://twistedmatrix.com/trac/changeset/23950</A>
</I>&gt;<i>
</I>&gt;<i>Code which, by the way, I very much like the look of.
</I>&gt;<i>
</I>&gt;<i>Could someone clarify if this is the &quot;right&quot; way of doing things?
</I>&gt;<i>
</I>
Sounds like you're basically on target.  One area that you didn't talk
much about is what the role of the user object is.  It's possible to
just examine the user object and then, in your custom Resource, decide
what to do based on that examination.  A more powerful approach is to
actually delegate those decisions to the user object (and this is why
twisted.web.guard makes the user object a Resource).  This removes all
checking from your code and just makes the right code for each user
execute automatically.  Explicit checking is tedious and error prone.
Delegating all authorization decisions to the avatar simplifies the
code and makes it less likely that you'll introduce a security issue.

Jean-Paul

</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003853.html">Resource as Avatar (was Re: [Twisted-web] newbiew question)
</A></li>
	<LI>Next message: <A HREF="003855.html">Resource as Avatar (was Re: [Twisted-web] newbiew question)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3854">[ date ]</a>
              <a href="thread.html#3854">[ thread ]</a>
              <a href="subject.html#3854">[ subject ]</a>
              <a href="author.html#3854">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
