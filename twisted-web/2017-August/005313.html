<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] Support for websockets.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-web%5D%20Support%20for%20websockets.&In-Reply-To=%3CCAF8px57Z1oLC1tS3ri5Tao4_HNMv9R7X6kw2cQBmy163BmN41g%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   
   <LINK REL="Next"  HREF="005315.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] Support for websockets.</H1>
    <B>Mike Mestnik</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-web%5D%20Support%20for%20websockets.&In-Reply-To=%3CCAF8px57Z1oLC1tS3ri5Tao4_HNMv9R7X6kw2cQBmy163BmN41g%40mail.gmail.com%3E"
       TITLE="[Twisted-web] Support for websockets.">cheako+twistedmatrix at mikemestnik.net
       </A><BR>
    <I>Fri Aug  4 08:01:36 MDT 2017</I>
    <P><UL>
        
        <LI>Next message (by thread): <A HREF="005315.html">[Twisted-web] Support for websockets.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5313">[ date ]</a>
              <a href="thread.html#5313">[ thread ]</a>
              <a href="subject.html#5313">[ subject ]</a>
              <a href="author.html#5313">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I was working on Tor2web, a client of twisted web.  I discover that to
move forward I'd need
[iResponce](<A HREF="https://github.com/racker/python-twisted-web/blob/master/twisted/web/iweb.py#L497">https://github.com/racker/python-twisted-web/blob/master/twisted/web/iweb.py#L497</A>)
to expose the socket or something to read/write on.  Once it's
necessary to edit twisted-web I might as well go all out and at least
partially implement Websockets.

Here is what I did for [Tor2web](<A HREF="https://pastebin.com/MbHVvwNz">https://pastebin.com/MbHVvwNz</A>) It's
incomplete, I was reading twisted-web and discovered the masked
interface.  Here is a [good reference for
Websockets](<A HREF="https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API/Writing_WebSocket_servers">https://developer.mozilla.org/en-US/docs/Web/API/WebSockets_API/Writing_WebSocket_servers</A>)
at a protocol level, it does say server but if you'r not working in
Javascript this is the document u need to read.

Here is what I'd envision for an interface, knowing only a little
Python and almost no twisted.

1. Upon receiving the response headers indicating a change of
protocol(connection: upgrade).  Remove the socket from any connection
pool, as it can't ever be used for http.  The connection will be
upgraded until it's closed.

2. Expose a socket interface in the iResponse class, it could be the
class itself or an attribute.  This could be a copy of the twisted
socket interface or even that interface itself.  With at least.
a. onRead callback.
b. Write.
c. Close.
d. onClose callback.
e. onError, ect.

The api does not NEED a method to determine if the connection was
upgraded, since the headers indicate as much.  However to prevent
attempts to access the Websocket API when it's not available a
python(ish) method for detecting as much I'll leave to your
discretion.

Thank you.

</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	
	<LI>Next message (by thread): <A HREF="005315.html">[Twisted-web] Support for websockets.
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5313">[ date ]</a>
              <a href="thread.html#5313">[ thread ]</a>
              <a href="subject.html#5313">[ subject ]</a>
              <a href="author.html#5313">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
