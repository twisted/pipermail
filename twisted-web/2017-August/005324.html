<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] Python and Cors
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-web%5D%20Python%20and%20Cors&In-Reply-To=%3CCADfFrhQjt4F6LVWYU-c7NVQ%3DH-UK%2BFcH7UCm9vQREN8Y0eTcsA%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=utf-8">
   <LINK REL="Previous"  HREF="005323.html">
   <LINK REL="Next"  HREF="005325.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] Python and Cors</H1>
    <B>Deve Krehbiel</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-web%5D%20Python%20and%20Cors&In-Reply-To=%3CCADfFrhQjt4F6LVWYU-c7NVQ%3DH-UK%2BFcH7UCm9vQREN8Y0eTcsA%40mail.gmail.com%3E"
       TITLE="[Twisted-web] Python and Cors">deve at speedprint.com
       </A><BR>
    <I>Sun Aug 27 10:10:15 MDT 2017</I>
    <P><UL>
        <LI>Previous message (by thread): <A HREF="005323.html">[Twisted-web] Nevow 0.14.3rc1 released
</A></li>
        <LI>Next message (by thread): <A HREF="005325.html">[Twisted-web] Python and Cors
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5324">[ date ]</a>
              <a href="thread.html#5324">[ thread ]</a>
              <a href="subject.html#5324">[ subject ]</a>
              <a href="author.html#5324">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>First post so forgive me if I am not explaining this right.

I am trying to make a baby cam and then heavily document it for everyone to
have access to. I am using a Raspberry Pi with Rasbian. I am using
mjpg-streamer for the streaming with no problems.

The problem is I am also using two servos for pan and tilt. To accomplish
this I am using an Arduino Uno. This is so I can add IR lighting for night
vision, etc later. I am not a programmer so this is getting frustrating
after a few weeks of failure.

How is it failing you might ask..well, its working perfectly with only ONE
exception:
Every time I push the button for left/right/up/down I get this:

XMLHttpRequest cannot load <A HREF="http://192.168.1.122:81/servos.rpy?value=100P.">http://192.168.1.122:81/servos.rpy?value=100P.</A>
No 'Access-Control-Allow-Origin' header is present on the requested
resource. Origin '<A HREF="http://192.168.1.122:9000">http://192.168.1.122:9000</A>' is therefore not allowed
access.

On the local area network, it still works, but taking it to the internet it
does not.

Here are the two programs that make this happen. One is servos.rpy and the
other is the supporting HTML/Get script;
****
servos.rpy
-----------------------------------
# Import necessary files
import serial
from twisted.web.resource import Resource
# Setup Arduino at correct speed
try:
        arduino = serial.Serial('/dev/ttyACM0', 9600)
except:
        arduino = serial.Serial('/dev/ttyACM1', 9600)

class MoveServo(Resource):
        isLeaf = True
        def render_GET(self,request):
                try:
                # Send value over serial to the Arduino
                        arduino.write(request.args['value'][0])
                        return 'Success'
                except:
                        return 'Failure'

resource = MoveServo()
***

Now for the HTML/Get script:

**
&lt;!doctype html&gt;
&lt;html&gt;
&lt;head&gt;
&lt;title&gt;Make Use Of DIY Security Camera&lt;/title&gt;
&lt;style type=&quot;text/css&quot;&gt;
#container {
/* center the content */
margin: 0 auto;
text-align: center;
}
&lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;div id=&quot;container&quot;&gt;
&lt;img src=&quot;/?action=stream&quot; /&gt;&lt;br&gt;
&lt;script src=&quot;
<A HREF="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js">https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js</A>&quot;&gt;&lt;/script&gt;&lt;br
/&gt;
&lt;button onclick=&quot;servos.move('P', 10)&quot;&gt;Left&lt;/button&gt;
&lt;button onclick=&quot;servos.move('P', -10)&quot;&gt;Right&lt;/button&gt;
&lt;button onclick=&quot;servos.move('T', -10)&quot;&gt;Down&lt;/button&gt;
&lt;button onclick=&quot;servos.move('T', 10)&quot;&gt;Up&lt;/button&gt;
&lt;/div&gt;
&lt;/body&gt;
&lt;script&gt;
var servos;
$( document ).ready(function() {
servos = moveServos();
});
function moveServos() {
// Store some settings, adjust to suit
var panPos = 70,
tiltPos = 90,
tiltMax = 170,
tiltMin = 45,
panMax = 170,
panMin = 20;
return {
move:function(servo, adjustment) {
var value;
if(servo == 'P') {
if(!((panPos &gt;= panMax &amp;&amp; adjustment &gt; 0) || (panPos &lt;= panMin &amp;&amp;
adjustment &lt; 0))) {
// Still within allowed range, &quot;schedule&quot; the movement
panPos += adjustment;
}
value = panPos + 'P';
}
else if(servo == 'T') {
if(!((tiltPos &gt;= tiltMax &amp;&amp; adjustment &gt; 0) || (tiltPos &lt;= tiltMin &amp;&amp;
adjustment &lt; 0))) {
// Still within allowed range, &quot;schedule&quot; the movement
tiltPos += adjustment;
}
value = tiltPos + 'T';
}
// Use AJAX to actually move the servo
$.get('<A HREF="http://192.168.1.122:81/servos.rpy?value=">http://192.168.1.122:81/servos.rpy?value=</A>' + value);
},
}
}
&lt;/script&gt;
&lt;/html&gt;

*****
Twisted is started:  sudo twistd -n web -p 81 --path /usr/local/www/

I would be forever grateful if someone could take a serious look at this
and tell me where I am going wrong. Once this is fixed, I can start
documenting the entire system for everyone. Thank you!

Deve
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;/pipermail/twisted-web/attachments/20170827/047f0986/attachment.html&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message (by thread): <A HREF="005323.html">[Twisted-web] Nevow 0.14.3rc1 released
</A></li>
	<LI>Next message (by thread): <A HREF="005325.html">[Twisted-web] Python and Cors
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5324">[ date ]</a>
              <a href="thread.html#5324">[ thread ]</a>
              <a href="subject.html#5324">[ subject ]</a>
              <a href="author.html#5324">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="https://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
