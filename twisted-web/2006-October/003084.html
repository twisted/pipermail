<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] athena widgets and IE
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20athena%20widgets%20and%20IE&In-Reply-To=20061011123146.1717.2032044096.divmod.quotient.73618%40ohm">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003083.html">
   <LINK REL="Next"  HREF="003085.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] athena widgets and IE</H1>
    <B>Cory Dodt</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20athena%20widgets%20and%20IE&In-Reply-To=20061011123146.1717.2032044096.divmod.quotient.73618%40ohm"
       TITLE="[Twisted-web] athena widgets and IE">corydodt at gmail.com
       </A><BR>
    <I>Wed Oct 11 10:50:13 CDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="003083.html">[Twisted-web] athena widgets and IE
</A></li>
        <LI>Next message: <A HREF="003085.html">[Twisted-web] athena widgets and IE
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3084">[ date ]</a>
              <a href="thread.html#3084">[ thread ]</a>
              <a href="subject.html#3084">[ subject ]</a>
              <a href="author.html#3084">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 10/11/06, Jean-Paul Calderone &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">exarkun at divmod.com</A>&gt; wrote:
&gt;<i>
</I>&gt;<i> On Wed, 11 Oct 2006 12:35:42 +0200, Fabio Forno &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">fabio.forno at gmail.com</A>&gt;
</I>&gt;<i> wrote:
</I>&gt;<i> &gt;Widgets.ChatWidget = Nevow.Athena.Widget.subclass('Widgets.ChatWidget');
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;Widgets.ChatWidget.methods(
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;    function keyPressed (self, event) {
</I>&gt;<i> &gt;        if(event.key()[&quot;string&quot;] == &quot;KEY_ENTER&quot;) {
</I>&gt;<i> &gt;            text_area = window.document.getElementById(&quot;chat_area&quot;);
</I>&gt;<i> &gt;            d = self.callRemote('got_text', text_area.value);
</I>&gt;<i> &gt;            d.addCallback(self.text_sent);
</I>&gt;<i> &gt;        }
</I>&gt;<i> &gt;    }
</I>&gt;<i> &gt;)
</I>
 [...]

&gt;<i> &gt;
</I>&gt;<i> &gt;Then in the xml template I try to get a reference to the just defined
</I>&gt;<i> &gt;method in this way:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;widget = Nevow.Athena.Widget.get(
</I>&gt;<i> &gt;            document.getElementById(&quot;athena:1&quot;);
</I>&gt;<i> &gt;        );
</I>&gt;<i> &gt;
</I>&gt;<i> &gt;widget.keyPressed
</I>&gt;<i>
</I>&gt;<i> Likewise, &quot;athena:1&quot; is an implementation detail, and you can't rely on
</I>&gt;<i> your widget getting id &quot;1&quot; all the time.  Instead, try using the
</I>&gt;<i> athena:handler feature:
</I>&gt;<i>
</I>&gt;<i>     &lt;div nevow:render=&quot;liveFragment&quot;&gt;
</I>&gt;<i>       ...
</I>&gt;<i>       &lt;textarea&gt;
</I>&gt;<i>           &lt;athena:handler event=&quot;onkeypress&quot; handler=&quot;keyPressed&quot; /&gt;
</I>&gt;<i>       &lt;/textarea&gt;
</I>&gt;<i>     &lt;/div&gt;
</I>&gt;<i>
</I>&gt;<i> The problem is he needs to examine the event details after it's received,
</I>and athena:handler only gives the event handler access to the node where it
happened, not the event object.

I suggest this:

YourNS.YourWidget.methods(
    function __init__(self, node) { // {{{
        YourNS.YourWidget.upcall(self, '__init__', node);
        DeanEdwards.addEvent(node, 'keyPressed',
            function onKeyPressed(event) { return self.onKeyPressed(event)
});
    }, // }}}


What's DeanEdwards, you ask?

<A HREF="http://rafb.net/paste/results/57Orqx27.html">http://rafb.net/paste/results/57Orqx27.html</A>

Dean Edwards came up with a nifty cross-browser event handling solution, but
there are others that could work here.  I adapted his solution to the Divmod
namespace style, and added line 63 so .target and .srcElement mean the same
thing.  The above URL will rot pretty quickly, so just google for &lt;dean
edwards event handling&gt;.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://twistedmatrix.com/pipermail/twisted-web/attachments/20061011/ed892c29/attachment.htm">http://twistedmatrix.com/pipermail/twisted-web/attachments/20061011/ed892c29/attachment.htm</A>
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003083.html">[Twisted-web] athena widgets and IE
</A></li>
	<LI>Next message: <A HREF="003085.html">[Twisted-web] athena widgets and IE
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3084">[ date ]</a>
              <a href="thread.html#3084">[ thread ]</a>
              <a href="subject.html#3084">[ subject ]</a>
              <a href="author.html#3084">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
