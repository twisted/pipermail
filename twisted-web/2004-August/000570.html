<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] Cache-friendly Nevow pages
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Cache-friendly%20Nevow%20pages&In-Reply-To=20040808052603.GA26371%40titus.home.puzzling.org">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000569.html">
   <LINK REL="Next"  HREF="000571.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] Cache-friendly Nevow pages</H1>
    <B>James Y Knight</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Cache-friendly%20Nevow%20pages&In-Reply-To=20040808052603.GA26371%40titus.home.puzzling.org"
       TITLE="[Twisted-web] Cache-friendly Nevow pages">foom at fuhm.net
       </A><BR>
    <I>Sun Aug  8 00:21:56 MDT 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="000569.html">[Twisted-web] Cache-friendly Nevow pages
</A></li>
        <LI>Next message: <A HREF="000571.html">[Twisted-web] Cache-friendly Nevow pages
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#570">[ date ]</a>
              <a href="thread.html#570">[ thread ]</a>
              <a href="subject.html#570">[ subject ]</a>
              <a href="author.html#570">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On Aug 8, 2004, at 1:26 AM, Mary Gardiner wrote:

&gt;<i> On Sat, Aug 07, 2004, Mary Gardiner wrote:
</I>&gt;&gt;<i>  2. generate the ETag header based on a hash of page contents
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>    Pros: As best I can tell, this is how the ETag header is really 
</I>&gt;&gt;<i> meant
</I>&gt;&gt;<i>    to be generated, ideally it signals octect equality and should 
</I>&gt;&gt;<i> change
</I>&gt;&gt;<i>    if, for example, Nevow for some reason starts pretty-printing 
</I>&gt;&gt;<i> output.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>    Cons: rend.Page.renderHTTP seems to make this really hard --
</I>&gt;&gt;<i>    even if you set the bufferedflag = True, rend.Page.afterRender
</I>&gt;&gt;<i>    doesn't seem to have any way to access the result of the render.
</I>&gt;<i>
</I>&gt;<i> The attached seems to do what I want here, I'll be interested to hear
</I>&gt;<i> about what horrors I am inflicting upon myself by doing this.
</I>
Generally, ETags are never actually generated by hashing the page 
content. That's just too expensive. To do that, you need to actually 
generate the content before you can tell that you shouldn't send it to 
the user. What a waste of resources!

Apache (and new-web) generate ETags from files via: ETag(&quot;%X-%X-%X&quot; % 
(st.st_ino, st.st_size, st.st_mtime), weak = (time.time() - st.st_mtime 
&lt;= 1))

That &quot;good enough&quot; guarantees that the file still has the same content 
(the etag is weak if the last-modified is recent, because the file 
could be modified twice within the last second and then you wouldn't 
know).

So, for dynamically generated pages, I'd do something similar (e.g. 
your #1). Not sure what you mean about about reducing flexibility or 
what you mean about it making you need to restart the server. If you 
have to restart the server every time you change a template (e.g. for 
stan), use the server start time as part of the ETag. Otherwise, use 
the template modtime. The file-based doc-factories do store mtime, 
although it's currently in a private attribute. That will get updated 
when the template is reloaded.

James


</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000569.html">[Twisted-web] Cache-friendly Nevow pages
</A></li>
	<LI>Next message: <A HREF="000571.html">[Twisted-web] Cache-friendly Nevow pages
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#570">[ date ]</a>
              <a href="thread.html#570">[ thread ]</a>
              <a href="subject.html#570">[ subject ]</a>
              <a href="author.html#570">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
