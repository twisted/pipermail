<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] nested nevow:data?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20nested%20nevow%3Adata%3F&In-Reply-To=2804DFAC-E4B7-11D8-BA7F-000A95864FC4%40divmod.org">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000564.html">
   <LINK REL="Next"  HREF="000566.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] nested nevow:data?</H1>
    <B>Jeff Bowden</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20nested%20nevow%3Adata%3F&In-Reply-To=2804DFAC-E4B7-11D8-BA7F-000A95864FC4%40divmod.org"
       TITLE="[Twisted-web] nested nevow:data?">jlb at houseofdistraction.com
       </A><BR>
    <I>Mon Aug  2 16:52:31 MDT 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="000564.html">[Twisted-web] nested nevow:data?
</A></li>
        <LI>Next message: <A HREF="000566.html">[Twisted-web] nested nevow:data?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#565">[ date ]</a>
              <a href="thread.html#565">[ thread ]</a>
              <a href="subject.html#565">[ subject ]</a>
              <a href="author.html#565">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Donovan Preston wrote:

&gt;<i>
</I>&gt;<i> On Aug 2, 2004, at 1:36 PM, Jeff Bowden wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> Should it be possible to nest nevow:data declarations in a template?  
</I>&gt;&gt;<i> E.g.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>    &lt;html nevow:data=&quot;order&quot; nevow:render=&quot;order&quot;&gt;
</I>&gt;&gt;<i>    &lt;head&gt;&lt;title&gt;Order &lt;nevow:slot name=&quot;order_number&quot;/&gt;&lt;/title&gt;&lt;/head&gt;
</I>&gt;&gt;<i>    &lt;body&gt;
</I>&gt;&gt;<i>      &lt;h1&gt;Order &lt;nevow:slot name=&quot;order_number&quot;/&gt;&lt;/h1&gt;
</I>&gt;&gt;<i>      &lt;ul nevow:data=&quot;order_items&quot; nevow:render=&quot;sequence&quot;&gt;
</I>&gt;&gt;<i>        &lt;li nevow:pattern=&quot;item&quot; nevow:render=&quot;mapping&quot;&gt;
</I>&gt;&gt;<i>           ... slots and stuff
</I>&gt;&gt;<i>        &lt;/li&gt;
</I>&gt;&gt;<i>       &lt;/ul&gt;
</I>&gt;&gt;<i>    &lt;/body&gt;
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> When I do this I get a big long stack trace rooted in 
</I>&gt;&gt;<i> nevow/accessors.py.  It works fine if I remove the outer 
</I>&gt;&gt;<i> nevow:data=&quot;order&quot; (and dummy up a static fillSlots call for 
</I>&gt;&gt;<i> &quot;order_number&quot; in render_order).  It also works if I remove the inner 
</I>&gt;&gt;<i> section.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I can work around the problem by putting the nevow:data=&quot;order&quot; 
</I>&gt;&gt;<i> declaration  in multiple places but it would be handy if I didn't 
</I>&gt;&gt;<i> have to.  Is this a bug or is it by design?
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> What type is &quot;order&quot;? A data directive puts that data on the context 
</I>&gt;<i> stack for the duration of that xml node; additional data directives 
</I>&gt;<i> are handled by getting an IContainer adapter around the nearest data 
</I>&gt;<i> on the stack. If, as I am suspecting, &quot;order&quot; is a rich python class, 
</I>&gt;<i> what you want to do is either mix in DataFactory to your order class 
</I>&gt;<i> and declare that it implements IContainer, or provide an IContainer 
</I>&gt;<i> adapter for your order class (which is probably a subclass of 
</I>&gt;<i> DataFactory). For example:
</I>&gt;<i>
</I>&gt;<i> class OrderContainer(DataFactory):
</I>&gt;<i>     def data_order_number(self, ctx, data):
</I>&gt;<i>         return self.original.orderNumber
</I>&gt;<i>
</I>&gt;<i>     def data_order_items(self, ctx, data):
</I>&gt;<i>         return self.original.items
</I>&gt;<i>
</I>&gt;<i> compy.registerAdapter(OrderContainer, MyOrderClass, IContainer)
</I>&gt;<i>
</I>&gt;<i> This is by design. It's intended to work in such a way that fragments 
</I>&gt;<i> of template can have data pushed at them, and they can operate without 
</I>&gt;<i> knowledge of the context of the entire page.
</I>&gt;<i>
</I>&gt;<i> The biggest mistake people make in this area is when they do something 
</I>&gt;<i> like push a list onto the context and then try to access another data_ 
</I>&gt;<i> method of the Page class. The directive will be satisfied by doing 
</I>&gt;<i> IContainer(theList).child(theDirective), and since the IContainer 
</I>&gt;<i> adapter for lists doesn't know how to handle anything except integer 
</I>&gt;<i> indexes, they get an exception.
</I>&gt;<i>
</I>&gt;<i> eg:
</I>&gt;<i>
</I>&gt;<i> &lt;ol n:data=&quot;someList&quot; n:render=&quot;sequence&quot;&gt;
</I>&gt;<i>     &lt;li n:pattern=&quot;header&quot; n:data=&quot;someOtherDirective&quot;&gt;
</I>&gt;<i>     &lt;!-- This won't work because &quot;someList&quot; is the topmost data on the 
</I>&gt;<i> stack, and thus we will get an exception instead of having our 
</I>&gt;<i> data_someOtherDirective method called on our Page --&gt;
</I>&gt;<i>         Header here
</I>&gt;<i>     &lt;/li&gt;
</I>&gt;<i>     &lt;li n:pattern=&quot;item&quot; n:render=&quot;string&quot;&gt;
</I>&gt;<i>         Items here
</I>&gt;<i>     &lt;/li&gt;
</I>&gt;<i> &lt;/ol&gt;
</I>

So you are saying is that a nested data directive will try to reference 
the outer data directive rather than the page class?  Wow, I'm glad I 
asked.  I wouldn't have guessed that based on the tutorial.

Is there a high-level overview or diagram somewhere of how all pieces of 
Nevow fit together?

OK anyway so yeah, as you guessed, &quot;order&quot; is a python list and the 
exception I get matches your description exactly.  The 
OrderContainer(DataFactory) suggestion seems like a conceptually clean 
solution for my current task but it won't be quite so tidy when I go to 
nest *it* inside of a more-or-less unrelated outer directive, which is 
my next step.  Maybe I'll make a data container that just passes through 
requests to the page and wraps them in a new instance of itself before 
returning them (i.e. simple nesting with no implied relationship between 
inner and outer scopes).


</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000564.html">[Twisted-web] nested nevow:data?
</A></li>
	<LI>Next message: <A HREF="000566.html">[Twisted-web] nested nevow:data?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#565">[ date ]</a>
              <a href="thread.html#565">[ thread ]</a>
              <a href="subject.html#565">[ subject ]</a>
              <a href="author.html#565">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
