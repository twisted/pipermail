<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] nested nevow:data?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20nested%20nevow%3Adata%3F&In-Reply-To=410E7BA8.4050209%40houseofdistraction.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000563.html">
   <LINK REL="Next"  HREF="000565.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] nested nevow:data?</H1>
    <B>Donovan Preston</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20nested%20nevow%3Adata%3F&In-Reply-To=410E7BA8.4050209%40houseofdistraction.com"
       TITLE="[Twisted-web] nested nevow:data?">dp at divmod.org
       </A><BR>
    <I>Mon Aug  2 13:07:10 MDT 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="000563.html">[Twisted-web] nested nevow:data?
</A></li>
        <LI>Next message: <A HREF="000565.html">[Twisted-web] nested nevow:data?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#564">[ date ]</a>
              <a href="thread.html#564">[ thread ]</a>
              <a href="subject.html#564">[ subject ]</a>
              <a href="author.html#564">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On Aug 2, 2004, at 1:36 PM, Jeff Bowden wrote:

&gt;<i> Should it be possible to nest nevow:data declarations in a template?  
</I>&gt;<i> E.g.
</I>&gt;<i>
</I>&gt;<i>    &lt;html nevow:data=&quot;order&quot; nevow:render=&quot;order&quot;&gt;
</I>&gt;<i>    &lt;head&gt;&lt;title&gt;Order &lt;nevow:slot name=&quot;order_number&quot;/&gt;&lt;/title&gt;&lt;/head&gt;
</I>&gt;<i>    &lt;body&gt;
</I>&gt;<i>      &lt;h1&gt;Order &lt;nevow:slot name=&quot;order_number&quot;/&gt;&lt;/h1&gt;
</I>&gt;<i>      &lt;ul nevow:data=&quot;order_items&quot; nevow:render=&quot;sequence&quot;&gt;
</I>&gt;<i>        &lt;li nevow:pattern=&quot;item&quot; nevow:render=&quot;mapping&quot;&gt;
</I>&gt;<i>           ... slots and stuff
</I>&gt;<i>        &lt;/li&gt;
</I>&gt;<i>       &lt;/ul&gt;
</I>&gt;<i>    &lt;/body&gt;
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> When I do this I get a big long stack trace rooted in 
</I>&gt;<i> nevow/accessors.py.  It works fine if I remove the outer 
</I>&gt;<i> nevow:data=&quot;order&quot; (and dummy up a static fillSlots call for 
</I>&gt;<i> &quot;order_number&quot; in render_order).  It also works if I remove the inner 
</I>&gt;<i> section.
</I>&gt;<i>
</I>&gt;<i> I can work around the problem by putting the nevow:data=&quot;order&quot; 
</I>&gt;<i> declaration  in multiple places but it would be handy if I didn't have 
</I>&gt;<i> to.  Is this a bug or is it by design?
</I>
What type is &quot;order&quot;? A data directive puts that data on the context 
stack for the duration of that xml node; additional data directives are 
handled by getting an IContainer adapter around the nearest data on the 
stack. If, as I am suspecting, &quot;order&quot; is a rich python class, what you 
want to do is either mix in DataFactory to your order class and declare 
that it implements IContainer, or provide an IContainer adapter for 
your order class (which is probably a subclass of DataFactory). For 
example:

class OrderContainer(DataFactory):
	def data_order_number(self, ctx, data):
		return self.original.orderNumber

	def data_order_items(self, ctx, data):
		return self.original.items

compy.registerAdapter(OrderContainer, MyOrderClass, IContainer)

This is by design. It's intended to work in such a way that fragments 
of template can have data pushed at them, and they can operate without 
knowledge of the context of the entire page.

The biggest mistake people make in this area is when they do something 
like push a list onto the context and then try to access another data_ 
method of the Page class. The directive will be satisfied by doing 
IContainer(theList).child(theDirective), and since the IContainer 
adapter for lists doesn't know how to handle anything except integer 
indexes, they get an exception.

eg:

&lt;ol n:data=&quot;someList&quot; n:render=&quot;sequence&quot;&gt;
	&lt;li n:pattern=&quot;header&quot; n:data=&quot;someOtherDirective&quot;&gt;
	&lt;!-- This won't work because &quot;someList&quot; is the topmost data on the 
stack, and thus we will get an exception instead of having our 
data_someOtherDirective method called on our Page --&gt;
		Header here
	&lt;/li&gt;
	&lt;li n:pattern=&quot;item&quot; n:render=&quot;string&quot;&gt;
		Items here
	&lt;/li&gt;
&lt;/ol&gt;

Woven used to have a syntax which used &quot;..&quot; and &quot;/&quot; to allow you to 
navigate through the stuff on the data stack, but this hasn't yet been 
implemented in nevow. It may be at some point in the future. For now, 
the broken example above could be written like:

&lt;ol&gt;
	&lt;li n:data=&quot;someOtherDirective&quot;&gt;
		Header here
	&lt;/li&gt;
	&lt;n:invisible n:data=&quot;someList&quot; n:render=&quot;sequence&quot;&gt;
		&lt;li n:pattern=&quot;item&quot; n:render=&quot;string&quot;&gt;
			Items here
		&lt;/li&gt;
	&lt;/n:invisible&gt;
&lt;/ol&gt;

dp


</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000563.html">[Twisted-web] nested nevow:data?
</A></li>
	<LI>Next message: <A HREF="000565.html">[Twisted-web] nested nevow:data?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#564">[ date ]</a>
              <a href="thread.html#564">[ thread ]</a>
              <a href="subject.html#564">[ subject ]</a>
              <a href="author.html#564">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
