<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] Passing context through/around/across webform
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Passing%20context%20through/around/across%20webform&In-Reply-To=20041018135208.GA31358%40perpetual.moxn.net">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000749.html">
   <LINK REL="Next"  HREF="000754.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] Passing context through/around/across webform</H1>
    <B>James Y Knight</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Passing%20context%20through/around/across%20webform&In-Reply-To=20041018135208.GA31358%40perpetual.moxn.net"
       TITLE="[Twisted-web] Passing context through/around/across webform">foom at fuhm.net
       </A><BR>
    <I>Mon Oct 18 16:45:51 MDT 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="000749.html">[Twisted-web] Passing context through/around/across webform
</A></li>
        <LI>Next message: <A HREF="000754.html">[Twisted-web] Passing context through/around/across webform
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#750">[ date ]</a>
              <a href="thread.html#750">[ thread ]</a>
              <a href="subject.html#750">[ subject ]</a>
              <a href="author.html#750">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Here's my horribly hacked up copy of Choice that works for what I need. 
The changes from the normal Choice are that choicesAttribute is really 
choicesMethod, and that it's supposed to return a list of (id, text), 
and the ids are used as the keys sent to the client, instead of the 
offset in the list. Offset in the list is worthless to me, because the 
list is dynamically generated and won't be consistent.

class ChoiceTuple(Typed):
     &quot;&quot;&quot;Allow the user to pick from a list of &quot;choices&quot;, or a list of 
choices found
     by accessing the list in the attribute &quot;choicesAttribute&quot; of the 
object we
     are configuring. The elements of the list will be rendered by 
calling &quot;str&quot;.
     &quot;&quot;&quot;
     def __init__(self, choices=None, choicesAttribute=None, *args, 
**kw):
         Typed.__init__(self, *args, **kw)
         if choices is None:
             self.choices = ()
         else:
             self.choices = choices
         self.choicesAttribute = choicesAttribute

     def coerce(self, val, binding):
         &quot;&quot;&quot;Coerce a value with the help of an object, which is the 
object
         we are configuring.
         &quot;&quot;&quot;
         try:
             val = int(val)
         except ValueError:
             raise InputError(&quot;%r is an invalid choice.&quot; % val)
         return val

class ChoiceTupleRenderer(webform.BaseInputRenderer):
     def input(self, context, slot, data, name, value):
         tv = data.typedValue
         if tv.choicesAttribute:
             choices = 
getattr(context.locate(iformless.IConfigurable).boundTo, 
tv.choicesAttribute)(context, data)
         else:
             choices = tv.choices
         if isinstance(choices, defer.Deferred):
             return choices.addCallback(self.input2, context, slot, 
data, name, value)
         self.input2(choices, context, slot, data, name, value)

     def input2(self, choices, context, slot, data, name, value):
         numChoices = len(choices)
         if numChoices == 0:
             return None

         selecter = tags.select(id=formutils.keyToXMLID(context.key), 
name=name)

         for key, val in choices:
             if key == value:
                 selecter[tags.option(value=str(key), 
selected=&quot;selected&quot;)[str(val)]]
             else:
                 selecter[tags.option(value=str(key))[str(val)]]
         return slot[selecter]


</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000749.html">[Twisted-web] Passing context through/around/across webform
</A></li>
	<LI>Next message: <A HREF="000754.html">[Twisted-web] Passing context through/around/across webform
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#750">[ date ]</a>
              <a href="thread.html#750">[ thread ]</a>
              <a href="subject.html#750">[ subject ]</a>
              <a href="author.html#750">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
