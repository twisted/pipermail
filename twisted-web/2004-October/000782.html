<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] Re: [Nevow-commits] r740 - Refactor urlToChild
	API to	avoid passing superfluous data (#1 from issue 121).
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Re%3A%20%5BNevow-commits%5D%20r740%20-%20Refactor%20urlToChild%0A%09API%20to%09avoid%20passing%20superfluous%20data%20%28%231%20from%20issue%20121%29.&In-Reply-To=7304C323-243C-11D9-9668-000A95A50FB2%40fuhm.net">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000771.html">
   <LINK REL="Next"  HREF="000780.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] Re: [Nevow-commits] r740 - Refactor urlToChild
	API to	avoid passing superfluous data (#1 from issue 121).</H1>
    <B>Tommi Virtanen</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Re%3A%20%5BNevow-commits%5D%20r740%20-%20Refactor%20urlToChild%0A%09API%20to%09avoid%20passing%20superfluous%20data%20%28%231%20from%20issue%20121%29.&In-Reply-To=7304C323-243C-11D9-9668-000A95A50FB2%40fuhm.net"
       TITLE="[Twisted-web] Re: [Nevow-commits] r740 - Refactor urlToChild
	API to	avoid passing superfluous data (#1 from issue 121).">tv at twistedmatrix.com
       </A><BR>
    <I>Sat Oct 23 01:57:32 MDT 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="000771.html">[Twisted-web] Re: [Nevow-commits] r740 - Refactor urlToChild API to
	avoid passing superfluous data (#1 from issue 121).
</A></li>
        <LI>Next message: <A HREF="000780.html">[Twisted-web] Re: [Twisted-Python] twisted webdav server
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#782">[ date ]</a>
              <a href="thread.html#782">[ thread ]</a>
              <a href="subject.html#782">[ subject ]</a>
              <a href="author.html#782">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>James Y Knight wrote:
&gt;&gt;<i> Refactor urlToChild API to avoid passing superfluous data (#1 from 
</I>&gt;&gt;<i> issue 121).
</I>&gt;<i> I believe this change is wrong: prePathURL() changes. setupSession has 
</I>&gt;<i> to use the prePathURL in place when guard's locateChild() is called, not 
</I>&gt;<i> the one in place at the time some other resource calls setupSession().
</I>
In theory, I believe you are right (and that particular patch can easily
be reverted without really affecting rest of the issue, it was
cleanup-only).

In practise, is request.setupSession really wanted? Noone seems to be
calling it, and commenting out the two lines that set it causes
no unit tests to fail.

I formally request you write unit tests for it if you want to keep it.
If you can write a test that fails due to changing prePathURL, I'll
happily make it work again.

[0 <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">tv at tao</A> ~/src/nevow/upstream]$ grapple setupSession
nevow/guard.py:186:        request.setupSession = lambda : 
self.createSession(request, segments=[])
nevow/guard.py:200:        request.setupSession = lambda : 
self.createSession(request, segments)
nevow/context.py:329:toSetOnRequest = ['args', 'content', 'fields', 
'isSecure', 'method', 'path', 'postpath', 'prepath', 
'receieved_headers', 'setupSession', 'session', 'uri']
examples/userdb.tac:312:    def setupSession(self, ctx):
examples/userdb.tac:318:        self.setupSession(ctx)
examples/userdb.tac:322:        self.setupSession(ctx)
# matches: 6
# matching-files: 3
[0 <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">tv at tao</A> ~/src/nevow/upstream]$

The examples/userdb.tac seems to be an unrelated function that just
happens to have the same name.

[0 <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">tv at tao</A> ~/src/twisted/stable]$ grapple setupSession
twisted/web/woven/guard.py:207:        request.setupSessionURL = setupURL
twisted/web/woven/guard.py:208:        request.setupSession = lambda: 
Redirect(setupURL)
twisted/web/woven/guard.py:316:            return request.setupSession()
twisted/web/woven/guard.py:417:            return request.setupSession()
# matches: 4
# matching-files: 1
[0 <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">tv at tao</A> ~/src/twisted/stable]$

So woven calls it. Whoppee. I see no reason for nevow guard to try to be
compatible with woven guard.

</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000771.html">[Twisted-web] Re: [Nevow-commits] r740 - Refactor urlToChild API to
	avoid passing superfluous data (#1 from issue 121).
</A></li>
	<LI>Next message: <A HREF="000780.html">[Twisted-web] Re: [Twisted-Python] twisted webdav server
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#782">[ date ]</a>
              <a href="thread.html#782">[ thread ]</a>
              <a href="subject.html#782">[ subject ]</a>
              <a href="author.html#782">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
