<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] Nevow: Authenticated site with &quot;remember me&quot; and
	vhosts
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Nevow%3A%20Authenticated%20site%20with%20%22remember%20me%22%20and%0A%09vhosts&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000798.html">
   <LINK REL="Next"  HREF="000800.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] Nevow: Authenticated site with &quot;remember me&quot; and
	vhosts</H1>
    <B>Paul Moore</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Nevow%3A%20Authenticated%20site%20with%20%22remember%20me%22%20and%0A%09vhosts&In-Reply-To="
       TITLE="[Twisted-web] Nevow: Authenticated site with &quot;remember me&quot; and
	vhosts">pf_moore at yahoo.co.uk
       </A><BR>
    <I>Sat Oct 30 09:03:00 MDT 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="000798.html">[Twisted-web] Twisted as reverse proxy for access control?
</A></li>
        <LI>Next message: <A HREF="000800.html">[Twisted-web] Nevow: Authenticated site with &quot;remember me&quot; and
	vhosts
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#799">[ date ]</a>
              <a href="thread.html#799">[ thread ]</a>
              <a href="subject.html#799">[ subject ]</a>
              <a href="author.html#799">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I'm trying to use Nevow to build a site which displays the results of
a series of SQL queries. It looks good so far, I have the basic site
structure all sorted out in my mind (it's *very* impressive how quick
that was in Nevow). Before I flesh things out much further, I want to
add some authentication - basically, &quot;guest&quot; users will be able to
see a limited subset of the data.

Adding authentication including a &quot;login&quot; form in the sidebar (a bit
like Roundup does) was again very easy. I basically cribbed from the
existing examples. But there are a few things I's now like to add:

1. Ultimately, I want to proxy the app through Apache, so I was using
   the Virtual Host Monster. Im ny original, unauthenticated,
   application, I added a &quot;vhost&quot; child to the main application
   resource, and that was it. I can no longer do that, as the
   resource is wrapped in a guard.SessionWrapper, which doesn't have
   a putChild method. I'm not clear that I want the vhost child to be
   authenticated anyway - what I *think* I want is for &quot;/&quot; to be
   authenticated, but &quot;/vhost&quot; not to be. Or do I? Any suggestions?
2. I'd like to add a &quot;remember me&quot; checkbox, which if checked sets a
   cookie to remember the user's ID, so that they don't have to log
   in again for (say) 2 weeks. Much like gmail, or Yahoo, do. But I'm
   not too sure how I'd go about this. I'm not even sure where I'd
   *put* auto-login code: the page is too late (the guard has done
   its thing by then) but anything else seems to be too early (ie,
   not per-session, if you see what I mean). I suspect I need to
   subclass the Portal, or something, but I'm not sure...

I've scanned the various examples, both in the distribution and in
the Nevow sandbox, but nothing seems to do what I want. Can anyone
give me some pointers?

&lt;off on a tangent&gt;
This is the sort of area where the lack of documentation really
hurts. Examples are great (and the wealth of Nevow examples is realy
nice) but there's a lack of &quot;general principle&quot; documentation to make
it easy to generalise the example code. My best example of this is
that I can't work out what to return from a render_* method - should
it be a function, or a string, or a stan tree, or what? I suspect
that by the magic of interfaces, the answer is &quot;anything that can be
adapted to an ISomething&quot; (which needs further documentation to say
what standard adapters from string, sequence, whatever to ISomething
exist) - but it's not stated anywhere, which makes writing render_*
methods an exciting exercise in experimentation :-)

At the other end of the scale, the source is really too low-level to
follow for this sort of thing (I have tried).

Is there any documentation effort for Nevow going on anywhere? I'd
happily contribute, although it would more likely be in the form of
questions than answers at the moment :-)
&lt;/off on a tangent&gt;

FWIW, I attach my driver script below, in case it clarifies my
authentication question above.

-------------- next part --------------
from twisted.application import internet
from twisted.application import service

from twisted.web import static

from nevow import appserver
from nevow import vhost
from nevow import guard
from nevow import inevow

from twisted.cred import portal
from twisted.cred import checkers
from twisted.cred import credentials

from testapp.web import pages

# Authorisation setup.

# First we need a realm, which provides requestAvatar
# TODO: need NotLoggedIn, LoggedIn and noLogout
class MyRealm:
    &quot;&quot;&quot;A simple implementor of cred's IRealm.
       For web, this gives us the LoggedIn page.
    &quot;&quot;&quot;
    __implements__ = portal.IRealm

    def requestAvatar(self, avatarId, mind, *interfaces):
        for iface in interfaces:
            if iface is inevow.IResource:
                # do web stuff
                if avatarId is checkers.ANONYMOUS:
                    resc = pages.BasePage()
                else:
                    resc = pages.BasePage(avatarId)
		resc.realm = self
		return (inevow.IResource, resc, resc.logout)

        raise NotImplementedError(&quot;Can't support that interface.&quot;)


# Now create a portal to our realm
realm = MyRealm()
portal = portal.Portal(realm)

# Create a checker for a static list of test users
myChecker = checkers.InMemoryUsernamePasswordDatabaseDontUse()
myChecker.addUser(&quot;user&quot;,&quot;password&quot;)
myChecker.addUser(&quot;fred&quot;, &quot;flintstone&quot;)

# Register our checker, and an anonymous user checker, with the portal
portal.registerChecker(checkers.AllowAnonymousAccess(), credentials.IAnonymous)
portal.registerChecker(myChecker)

application = service.Application('testapp')

# Instead of the application resource being the base page, it becomes a
# SessionWrapper round the portal we created. The base page is part of the
# realm - see above...

# appResource = pages.BasePage()
appResource = guard.SessionWrapper(portal)

#appResource.putChild('robots.txt', static.File('static/robots.txt'))
# SessionWrapper doesn't have a putChild method...
#vResource = vhost.VHostMonsterResource()
#appResource.putChild('vhost', vResource)

webServer = internet.TCPServer(8080, appserver.NevowSite(appResource)) 
webServer.setServiceParent(application)

# vim:ft=python:
-------------- next part --------------
Paul
-- 
The scientific name for an animal that doesn't either run from or
fight its enemies is lunch. -- Michael Friedman
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000798.html">[Twisted-web] Twisted as reverse proxy for access control?
</A></li>
	<LI>Next message: <A HREF="000800.html">[Twisted-web] Nevow: Authenticated site with &quot;remember me&quot; and
	vhosts
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#799">[ date ]</a>
              <a href="thread.html#799">[ thread ]</a>
              <a href="subject.html#799">[ subject ]</a>
              <a href="author.html#799">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
