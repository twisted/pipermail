<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] Telnet chat server
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Telnet%20chat%20server&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   
   <LINK REL="Next"  HREF="004184.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] Telnet chat server</H1>
    <B>Jason St.Clair</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Telnet%20chat%20server&In-Reply-To="
       TITLE="[Twisted-web] Telnet chat server">woahyeahyeah at yahoo.com
       </A><BR>
    <I>Wed Jun  3 18:57:07 EDT 2009</I>
    <P><UL>
        
        <LI>Next message: <A HREF="004184.html">[Twisted-web] Telnet chat server
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4183">[ date ]</a>
              <a href="thread.html#4183">[ thread ]</a>
              <a href="subject.html#4183">[ subject ]</a>
              <a href="author.html#4183">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I've got a simple little chat server set up that people can telnet into.&#160; The code is as follows:

----------

from twisted.internet import reactor
from twisted.internet.protocol import ServerFactory 
from twisted.protocols.basic import LineOnlyReceiver 
import threading

class ChatProtocol(LineOnlyReceiver): 

&#160;&#160;&#160; name = &quot;&quot; 

&#160;&#160;&#160; def getName(self): 
&#160;&#160;&#160;&#160;&#160;&#160;&#160; if self.name!=&quot;&quot;: 
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; return self.name 
&#160;&#160;&#160;&#160;&#160;&#160;&#160; return self.transport.getPeer().host 

&#160;&#160;&#160; def connectionMade(self): 
&#160;&#160;&#160;&#160;&#160;&#160;&#160; print &quot;New connection from &quot;+self.getName() &#160;
&#160;&#160;&#160;&#160;&#160;&#160;&#160;
 self.sendLine(&quot;Welcome to the chat.\r\n/quit to quit.&quot;) 
&#160;&#160;&#160;&#160;&#160;&#160;&#160; self.factory.sendMessageToAllClients(self.getName()+&quot; joined the chat.&quot;) 
&#160;&#160;&#160;&#160;&#160;&#160;&#160; self.factory.clientProtocols.append(self)

&#160;&#160;&#160; def connectionLost(self, reason): 
&#160;&#160;&#160;&#160;&#160;&#160;&#160; print &quot;Lost connection from &quot;+self.getName() 
&#160;&#160;&#160;&#160;&#160;&#160;&#160; self.factory.clientProtocols.remove(self) 
&#160;&#160;&#160;&#160;&#160;&#160;&#160; self.factory.sendMessageToAllClients(self.getName()+&quot; disconnected.&quot;) 

&#160;&#160;&#160; def lineReceived(self, line): 
&#160;&#160;&#160;&#160;&#160;&#160;&#160; if line==&quot;/quit&quot;: 
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; self.transport.loseConnection() 
&#160;&#160;&#160;&#160;&#160;&#160;&#160; else:
 
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; self.factory.sendMessageToAllClients(self.getName()+&quot;: &quot;+line) 

&#160;&#160;&#160; def sendLine(self, line): 
&#160;&#160;&#160;&#160;&#160;&#160;&#160; self.transport.write(line+&quot;\r\n&quot;) 

class ChatProtocolFactory(ServerFactory): 

&#160;&#160;&#160; protocol = ChatProtocol 

&#160;&#160;&#160; def __init__(self): 
&#160;&#160;&#160;&#160;&#160;&#160;&#160; self.clientProtocols = [] 

&#160;&#160;&#160; def sendMessageToAllClients(self, mesg): 
&#160;&#160;&#160;&#160;&#160;&#160;&#160; for client in self.clientProtocols:
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; client.sendLine(mesg) 
&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160;&#160; &#160;
def Test():
&#160;&#160;&#160; global test
&#160;&#160;&#160; factory.sendMessageToAllClients('Hey.')
&#160;&#160;&#160; test = threading.Timer(1.0,
 Test)
&#160;&#160;&#160; test.start()
test = threading.Timer(1.0, Test)
test.start()

print &quot;Starting Server&quot;
factory = ChatProtocolFactory()
reactor.listenTCP(3009, factory)
reactor.run()

----------

The
problem is that last def, &quot;def Test()&quot;.&#160; It should send the line &quot;Hey.&quot;
to all connected users every second.&#160; It does that - however, the
message only sends through if the client is typing or has entered a
line.&#160; So, if a client is idle for 30 seconds, then starts typing, he
will receive &quot;Hey.&quot; 30 times in a row - one for each second he was idle.

Is there any way to get this to send the message and have it show up for a client even when they're idle?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://twistedmatrix.com/pipermail/twisted-web/attachments/20090603/38fbd7a0/attachment.htm">http://twistedmatrix.com/pipermail/twisted-web/attachments/20090603/38fbd7a0/attachment.htm</A> 
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	
	<LI>Next message: <A HREF="004184.html">[Twisted-web] Telnet chat server
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4183">[ date ]</a>
              <a href="thread.html#4183">[ thread ]</a>
              <a href="subject.html#4183">[ subject ]</a>
              <a href="author.html#4183">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
