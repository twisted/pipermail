From peter.westlake at pobox.com  Fri Jan  4 11:00:22 2013
From: peter.westlake at pobox.com (Peter Westlake)
Date: Fri, 04 Jan 2013 16:00:22 +0000
Subject: [Twisted-web] Redirect after login with nevow guard
Message-ID: <1357315222.22587.140661173414169.605E19F8@webmail.messagingengine.com>

I'm using nevow.guard, and when someone logs in I would like to send
them to the URL they originally typed. It's possible to do this by
posting to the URL guard.LOGIN_AVATAR + other stuff, e.g. to go to
http://example.com/foo/bar after logging in, the login page should post
to http://example.com/__login__/foo/bar. This works nicely. The problem
is, the login page doesn't know that the user was trying to go to
foo/bar. How can it get that information? I would have thought that it
would be available as the segments argument in locateChild, but for some
reason it isn't. Before logging in, the segments argument is always
empty.

Peter.




From p.mayers at imperial.ac.uk  Fri Jan  4 11:32:46 2013
From: p.mayers at imperial.ac.uk (Phil Mayers)
Date: Fri, 04 Jan 2013 16:32:46 +0000
Subject: [Twisted-web] Redirect after login with nevow guard
In-Reply-To: <1357315222.22587.140661173414169.605E19F8@webmail.messagingengine.com>
References: <1357315222.22587.140661173414169.605E19F8@webmail.messagingengine.com>
Message-ID: <50E7042E.8050006@imperial.ac.uk>

On 04/01/13 16:00, Peter Westlake wrote:
> I'm using nevow.guard, and when someone logs in I would like to send
> them to the URL they originally typed. It's possible to do this by
> posting to the URL guard.LOGIN_AVATAR + other stuff, e.g. to go to
> http://example.com/foo/bar after logging in, the login page should post
> to http://example.com/__login__/foo/bar. This works nicely. The problem
> is, the login page doesn't know that the user was trying to go to
> foo/bar. How can it get that information? I would have thought that it
> would be available as the segments argument in locateChild, but for some
> reason it isn't. Before logging in, the segments argument is always
> empty.

Looking at some *very* old code, we have something like this:


class LoginPage(rend.Page):

     def locateChild(self, c, s):
         return self, []

     def data_misc(self, ctx, data):
         u = url.root.child(guard.LOGIN_AVATAR)
         for path in inevow.ICurrentSegments(ctx):
             u = u.child(path)
         return {
             'action': u
             }


     docFactory = loaders.stan(
       T.html[
         T.head[
             T.title['ICT Host Database - not logged in'],
         ], # head
         T.body(data=T.directive('misc'), render=T.directive('mapping'))[
           T.form(action=T.slot('action'), method='post')[
             ...

components.registerAdapter(LoginPage, ihdb.IAnonymous, inevow.IResource)


i.e. the component you register as the adapter for the "Anonymous" user 
needs a "data" method that gathers the url segments, and you reference 
that data method from the "action" value of the login form - so the form 
will be posted to:

/$guard.LOGIN_AVATAR/original/url/goes/here


From peter.westlake at pobox.com  Fri Jan  4 11:50:35 2013
From: peter.westlake at pobox.com (Peter Westlake)
Date: Fri, 04 Jan 2013 16:50:35 +0000
Subject: [Twisted-web] Redirect after login with nevow guard
In-Reply-To: <50E7042E.8050006@imperial.ac.uk>
References: <1357315222.22587.140661173414169.605E19F8@webmail.messagingengine.com>
	<50E7042E.8050006@imperial.ac.uk>
Message-ID: <1357318235.4612.140661173435749.015F40A4@webmail.messagingengine.com>

That's brilliant, thank you!

The bit I didn't know about was ICurrentSegments. I *think* I see how
this works :-)

Peter.

On Fri, Jan 4, 2013, at 16:32, Phil Mayers wrote:
> On 04/01/13 16:00, Peter Westlake wrote:
> > I'm using nevow.guard, and when someone logs in I would like to send
> > them to the URL they originally typed. It's possible to do this by
> > posting to the URL guard.LOGIN_AVATAR + other stuff, e.g. to go to
> > http://example.com/foo/bar after logging in, the login page should post
> > to http://example.com/__login__/foo/bar. This works nicely. The problem
> > is, the login page doesn't know that the user was trying to go to
> > foo/bar. How can it get that information? I would have thought that it
> > would be available as the segments argument in locateChild, but for some
> > reason it isn't. Before logging in, the segments argument is always
> > empty.
> 
> Looking at some *very* old code, we have something like this:
> 
> 
> class LoginPage(rend.Page):
> 
>      def locateChild(self, c, s):
>          return self, []
> 
>      def data_misc(self, ctx, data):
>          u = url.root.child(guard.LOGIN_AVATAR)
>          for path in inevow.ICurrentSegments(ctx):
>              u = u.child(path)
>          return {
>              'action': u
>              }
> 
> 
>      docFactory = loaders.stan(
>        T.html[
>          T.head[
>              T.title['ICT Host Database - not logged in'],
>          ], # head
>          T.body(data=T.directive('misc'), render=T.directive('mapping'))[
>            T.form(action=T.slot('action'), method='post')[
>              ...
> 
> components.registerAdapter(LoginPage, ihdb.IAnonymous, inevow.IResource)
> 
> 
> i.e. the component you register as the adapter for the "Anonymous" user 
> needs a "data" method that gathers the url segments, and you reference 
> that data method from the "action" value of the login form - so the form 
> will be posted to:
> 
> /$guard.LOGIN_AVATAR/original/url/goes/here
> 
> _______________________________________________
> Twisted-web mailing list
> Twisted-web at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web


From peter.westlake at pobox.com  Fri Jan  4 13:30:47 2013
From: peter.westlake at pobox.com (Peter Westlake)
Date: Fri, 04 Jan 2013 18:30:47 +0000
Subject: [Twisted-web] [Twisted-Python] Speed of rendering?
In-Reply-To: <1351084544.6435.140661144837881.57112D47@webmail.messagingengine.com>
References: <1340286731.21022.140661092192609.7FC851D7@webmail.messagingengine.com>
	<278A6852-053C-4125-882E-26D478255497@twistedmatrix.com>
	<1340401929.23556.140661092828441.30BFC47D@webmail.messagingengine.com>
	<163A532D-64BC-43E7-95C6-77F7294E5EC8@twistedmatrix.com>
	<1340565271.29668.140661093394541.28B0F791@webmail.messagingengine.com>
	<1346683843.31263.140661123041661.574E334C@webmail.messagingengine.com>
	<29C14868-41E5-4C39-8336-B467208C6B9D@twistedmatrix.com>
	<1351005031.8415.140661144406353.08239F58@webmail.messagingengine.com>
	<20121024125924.4595.1178557312.divmod.xquotient.2@localhost6.localdomain6>
	<1351084544.6435.140661144837881.57112D47@webmail.messagingengine.com>
Message-ID: <1357324247.31399.140661173476561.11F56E5E@webmail.messagingengine.com>

A while back I promised to write some benchmarks for
twisted.web.template's flattening functions. Is something like this
suitable? If so, I'll add lots more test cases. The output format could
be improved, too - any preferences?

Peter.

from twisted.web.template import flatten
from twisted.web.server import Request
import twisted.web.http

channel = twisted.web.http.HTTPChannel()
request = Request(channel, False)


def make(content):
    def f():
        d = flatten(request, content, lambda _: None)
        assert d.called
    return f


def test(content):
    return timeit.timeit(stmt=make(content), number=repeats)

repeats = 1000

deeplist = ['centre']
for n in range(100):
    deeplist = [deeplist]

tests = {
    'empty': '',
    'string': 'hello',
    'shortlist': ['hello'],
    'longlist': [str(n) for n in range(100)],
    'deeplist': deeplist,
}


if __name__ == '__main__':
    import timeit
    from sys import argv
    for name in argv[1:] or tests:
        print name, test(tests[name])


From exarkun at twistedmatrix.com  Fri Jan  4 14:58:13 2013
From: exarkun at twistedmatrix.com (exarkun at twistedmatrix.com)
Date: Fri, 04 Jan 2013 19:58:13 -0000
Subject: [Twisted-web] [Twisted-Python] Speed of rendering?
In-Reply-To: <1357324247.31399.140661173476561.11F56E5E@webmail.messagingengine.com>
References: <1340286731.21022.140661092192609.7FC851D7@webmail.messagingengine.com>
	<278A6852-053C-4125-882E-26D478255497@twistedmatrix.com>
	<1340401929.23556.140661092828441.30BFC47D@webmail.messagingengine.com>
	<163A532D-64BC-43E7-95C6-77F7294E5EC8@twistedmatrix.com>
	<1340565271.29668.140661093394541.28B0F791@webmail.messagingengine.com>
	<1346683843.31263.140661123041661.574E334C@webmail.messagingengine.com>
	<29C14868-41E5-4C39-8336-B467208C6B9D@twistedmatrix.com>
	<1351005031.8415.140661144406353.08239F58@webmail.messagingengine.com>
	<20121024125924.4595.1178557312.divmod.xquotient.2@localhost6.localdomain6>
	<1351084544.6435.140661144837881.57112D47@webmail.messagingengine.com>
	<1357324247.31399.140661173476561.11F56E5E@webmail.messagingengine.com>
Message-ID: <20130104195813.4649.1661214274.divmod.xquotient.20@localhost6.localdomain6>

On 06:30 pm, peter.westlake at pobox.com wrote:
>A while back I promised to write some benchmarks for
>twisted.web.template's flattening functions. Is something like this
>suitable? If so, I'll add lots more test cases. The output format could
>be improved, too - any preferences?

The output should be something that we can load into our codespeed 
instance.  The output of any of the existing benchmarks in lp:twisted- 
benchmarks should be a good example of that format (I don't even recall 
what it is right now - it may not even be a "format" so much as a shape 
of data to submit to an HTTP API).

The `timeit` module is probably not suitable to use to collect the data, 
as it makes some questionable choices with respect to measurement 
technique, and at the very least it's inconsistent with the rest of the 
benchmarks we have.

Selecting data to operate on is probably an important part of this 
benchmark (or collection of benchmarks).  It may not be possible to 
capture all of the interesting performance characteristics in a single 
dataset.  However, at least something that includes HTML tags is 
probably desirable, since that is the primary use-case.

There are some other Python templating systems with benchmarks.  One 
approach that might make sense is to try to build analogous benchmarks 
for twisted.web.template.  (Or perhaps a little thought will reveal that 
it's not possible to make comparisons between twisted.web.template and 
those systems, so there's no reason to follow their benchmarking lead.)

Jean-Paul
>Peter.
>
>from twisted.web.template import flatten
>from twisted.web.server import Request
>import twisted.web.http
>
>channel = twisted.web.http.HTTPChannel()
>request = Request(channel, False)
>
>
>def make(content):
>    def f():
>        d = flatten(request, content, lambda _: None)
>        assert d.called
>    return f
>
>
>def test(content):
>    return timeit.timeit(stmt=make(content), number=repeats)
>
>repeats = 1000
>
>deeplist = ['centre']
>for n in range(100):
>    deeplist = [deeplist]
>
>tests = {
>    'empty': '',
>    'string': 'hello',
>    'shortlist': ['hello'],
>    'longlist': [str(n) for n in range(100)],
>    'deeplist': deeplist,
>}
>
>
>if __name__ == '__main__':
>    import timeit
>    from sys import argv
>    for name in argv[1:] or tests:
>        print name, test(tests[name])
>
>_______________________________________________
>Twisted-web mailing list
>Twisted-web at twistedmatrix.com
>http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web


From levinie001 at gmail.com  Fri Jan  4 20:50:37 2013
From: levinie001 at gmail.com (Levi Nie)
Date: Sat, 5 Jan 2013 09:50:37 +0800
Subject: [Twisted-web] file upload with twisted
Message-ID: <CAEMsKDudEvLCeVf=sVPW_BE7rX2qtx9rAQERvssAMsckF9yYfA@mail.gmail.com>

When i send a http request with a big file, can i check the content-length
then enable or disable the
file upload?

I use the s3cmd client sent the request. And i need disable the file upload
if the file size is over the quota.

how can i do this?
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-web/attachments/20130105/43bc7e14/attachment.htm 

From glyph at twistedmatrix.com  Fri Jan  4 23:14:51 2013
From: glyph at twistedmatrix.com (Glyph)
Date: Fri, 4 Jan 2013 20:14:51 -0800
Subject: [Twisted-web] file upload with twisted
In-Reply-To: <CAEMsKDudEvLCeVf=sVPW_BE7rX2qtx9rAQERvssAMsckF9yYfA@mail.gmail.com>
References: <CAEMsKDudEvLCeVf=sVPW_BE7rX2qtx9rAQERvssAMsckF9yYfA@mail.gmail.com>
Message-ID: <DEA8BBC4-E7C6-446B-90A3-BA1037BD1267@twistedmatrix.com>


On Jan 4, 2013, at 5:50 PM, Levi Nie <levinie001 at gmail.com> wrote:

> When i send a http request with a big file, can i check the content-length then enable or disable the
> file upload?
> 
> I use the s3cmd client sent the request. And i need disable the file upload if the file size is over the quota.
> 
> how can i do this?

This s3cmd? https://github.com/s3tools/s3cmd/blob/master/s3cmd

It doesn't look like it uses Twisted, so I don't think this is a question for this list.



From poisonoff at gmail.com  Sat Jan  5 04:25:21 2013
From: poisonoff at gmail.com (=?UTF-8?B?0JDRgNC60LDQtNC40Lkg0JvQtdCy0LjQvQ==?=)
Date: Sat, 5 Jan 2013 15:25:21 +0600
Subject: [Twisted-web] file upload with twisted
In-Reply-To: <DEA8BBC4-E7C6-446B-90A3-BA1037BD1267@twistedmatrix.com>
References: <CAEMsKDudEvLCeVf=sVPW_BE7rX2qtx9rAQERvssAMsckF9yYfA@mail.gmail.com>
	<DEA8BBC4-E7C6-446B-90A3-BA1037BD1267@twistedmatrix.com>
Message-ID: <CACgbmJ=G-FZZee62VADTV2FcLUxu0zC4PY9R3LUa2CU7tVP2Lg@mail.gmail.com>

I resolve same problem in self project, reimplement method
handleContentChunk in server.Request

My code:

<code># For maximum
	handleContentChunkLength = 0

	def handleContentChunk(self, data):
		"""
		Write a chunk of data.
		"""
		self.handleContentChunkLength += len(data)

		if self.handleContentChunkLength >= WEB_LIMIT_REQUEST_SIZE:
			self.transport.write(b"HTTP/1.1 413 Request Entity Too Large\r\n\r\n")
			self.transport.loseConnection()

			# Raise to log error
			raise ValueError('Maximum length equal')

		self.content.write(data)</code>

On Sat, Jan 5, 2013 at 10:14 AM, Glyph <glyph at twistedmatrix.com> wrote:
>
> On Jan 4, 2013, at 5:50 PM, Levi Nie <levinie001 at gmail.com> wrote:
>
>> When i send a http request with a big file, can i check the content-length then enable or disable the
>> file upload?
>>
>> I use the s3cmd client sent the request. And i need disable the file upload if the file size is over the quota.
>>
>> how can i do this?
>
> This s3cmd? https://github.com/s3tools/s3cmd/blob/master/s3cmd
>
> It doesn't look like it uses Twisted, so I don't think this is a question for this list.
>
>
> _______________________________________________
> Twisted-web mailing list
> Twisted-web at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web


From peter.westlake at pobox.com  Sat Jan  5 19:48:13 2013
From: peter.westlake at pobox.com (Peter Westlake)
Date: Sun, 06 Jan 2013 00:48:13 +0000
Subject: [Twisted-web] [Twisted-Python] Speed of rendering?
In-Reply-To: <20130104195813.4649.1661214274.divmod.xquotient.20@localhost6.localdomain6>
References: <1340286731.21022.140661092192609.7FC851D7@webmail.messagingengine.com>
	<278A6852-053C-4125-882E-26D478255497@twistedmatrix.com>
	<1340401929.23556.140661092828441.30BFC47D@webmail.messagingengine.com>
	<163A532D-64BC-43E7-95C6-77F7294E5EC8@twistedmatrix.com>
	<1340565271.29668.140661093394541.28B0F791@webmail.messagingengine.com>
	<1346683843.31263.140661123041661.574E334C@webmail.messagingengine.com>
	<29C14868-41E5-4C39-8336-B467208C6B9D@twistedmatrix.com>
	<1351005031.8415.140661144406353.08239F58@webmail.messagingengine.com>
	<20121024125924.4595.1178557312.divmod.xquotient.2@localhost6.localdomain6>
	<1351084544.6435.140661144837881.57112D47@webmail.messagingengine.com>
	<1357324247.31399.140661173476561.11F56E5E@webmail.messagingengine.com>
	<20130104195813.4649.1661214274.divmod.xquotient.20@localhost6.localdomain6>
Message-ID: <1357433293.21505.140661173901005.4677B3D4@webmail.messagingengine.com>

On Fri, Jan 4, 2013, at 19:58, exarkun at twistedmatrix.com wrote:
> On 06:30 pm, peter.westlake at pobox.com wrote:
> >A while back I promised to write some benchmarks for
> >twisted.web.template's flattening functions. Is something like this
> >suitable? If so, I'll add lots more test cases. The output format could
> >be improved, too - any preferences?
> 
> The output should be something that we can load into our codespeed 
> instance.  The output of any of the existing benchmarks in lp:twisted- 
> benchmarks should be a good example of that format (I don't even recall 
> what it is right now - it may not even be a "format" so much as a shape 
> of data to submit to an HTTP API).

It's pretty simple. The main difference is that all the other benchmarks
only print a single result, and I was planning to do a number of tests.
They can always go in separate files if it's a problem.

> The `timeit` module is probably not suitable to use to collect the data, 
> as it makes some questionable choices with respect to measurement 
> technique, and at the very least it's inconsistent with the rest of the 
> benchmarks we have.

What sort of choices? As far as I can see it just gets the time
before the benchmarked code and the time after and subtracts.
That looks quite close to what the other benchmarks do.
What method would you prefer?

> Selecting data to operate on is probably an important part of this 
> benchmark (or collection of benchmarks).  It may not be possible to 
> capture all of the interesting performance characteristics in a single 
> dataset.  However, at least something that includes HTML tags is 
> probably desirable, since that is the primary use-case.

Yes, that's where I'm going to spend most of my effort.

> There are some other Python templating systems with benchmarks.  One 
> approach that might make sense is to try to build analogous benchmarks 
> for twisted.web.template.  (Or perhaps a little thought will reveal that 
> it's not possible to make comparisons between twisted.web.template and 
> those systems, so there's no reason to follow their benchmarking lead.)

I'll do that if I get time, thanks.

Peter.


From exarkun at twistedmatrix.com  Sun Jan  6 15:22:09 2013
From: exarkun at twistedmatrix.com (exarkun at twistedmatrix.com)
Date: Sun, 06 Jan 2013 20:22:09 -0000
Subject: [Twisted-web] [Twisted-Python] Speed of rendering?
In-Reply-To: <1357433293.21505.140661173901005.4677B3D4@webmail.messagingengine.com>
References: <1340286731.21022.140661092192609.7FC851D7@webmail.messagingengine.com>
	<278A6852-053C-4125-882E-26D478255497@twistedmatrix.com>
	<1340401929.23556.140661092828441.30BFC47D@webmail.messagingengine.com>
	<163A532D-64BC-43E7-95C6-77F7294E5EC8@twistedmatrix.com>
	<1340565271.29668.140661093394541.28B0F791@webmail.messagingengine.com>
	<1346683843.31263.140661123041661.574E334C@webmail.messagingengine.com>
	<29C14868-41E5-4C39-8336-B467208C6B9D@twistedmatrix.com>
	<1351005031.8415.140661144406353.08239F58@webmail.messagingengine.com>
	<20121024125924.4595.1178557312.divmod.xquotient.2@localhost6.localdomain6>
	<1351084544.6435.140661144837881.57112D47@webmail.messagingengine.com>
	<1357324247.31399.140661173476561.11F56E5E@webmail.messagingengine.com>
	<20130104195813.4649.1661214274.divmod.xquotient.20@localhost6.localdomain6>
	<1357433293.21505.140661173901005.4677B3D4@webmail.messagingengine.com>
Message-ID: <20130106202209.4649.2128100837.divmod.xquotient.138@localhost6.localdomain6>

On 12:48 am, peter.westlake at pobox.com wrote:
>On Fri, Jan 4, 2013, at 19:58, exarkun at twistedmatrix.com wrote:
>>On 06:30 pm, peter.westlake at pobox.com wrote:
>> >A while back I promised to write some benchmarks for
>> >twisted.web.template's flattening functions. Is something like this
>> >suitable? If so, I'll add lots more test cases. The output format 
>>could
>> >be improved, too - any preferences?
>>
>>The output should be something that we can load into our codespeed
>>instance.  The output of any of the existing benchmarks in lp:twisted-
>>benchmarks should be a good example of that format (I don't even 
>>recall
>>what it is right now - it may not even be a "format" so much as a 
>>shape
>>of data to submit to an HTTP API).
>
>It's pretty simple. The main difference is that all the other 
>benchmarks
>only print a single result, and I was planning to do a number of tests.
>They can always go in separate files if it's a problem.

Codespeed cannot handle more than one result per benchmark.
>>The `timeit` module is probably not suitable to use to collect the 
>>data,
>>as it makes some questionable choices with respect to measurement
>>technique, and at the very least it's inconsistent with the rest of 
>>the
>>benchmarks we have.
>
>What sort of choices? As far as I can see it just gets the time
>before the benchmarked code and the time after and subtracts.
>That looks quite close to what the other benchmarks do.

It does a ton more stuff than this, so I'm not sure what you mean here. 
It's full of dynamic code generation and loop counting/prediction logic, 
gc manipulation, and other stuff.  Plus, it changes from Python version 
to Python version.
>What method would you prefer?

Something simple and accurate. :)  You may need to do some investigation 
to determine the best approach.

Jean-Paul
>>Selecting data to operate on is probably an important part of this
>>benchmark (or collection of benchmarks).  It may not be possible to
>>capture all of the interesting performance characteristics in a single
>>dataset.  However, at least something that includes HTML tags is
>>probably desirable, since that is the primary use-case.
>
>Yes, that's where I'm going to spend most of my effort.
>>There are some other Python templating systems with benchmarks.  One
>>approach that might make sense is to try to build analogous benchmarks
>>for twisted.web.template.  (Or perhaps a little thought will reveal 
>>that
>>it's not possible to make comparisons between twisted.web.template and
>>those systems, so there's no reason to follow their benchmarking 
>>lead.)
>
>I'll do that if I get time, thanks.
>
>Peter.
>
>_______________________________________________
>Twisted-web mailing list
>Twisted-web at twistedmatrix.com
>http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web


From levinie001 at gmail.com  Tue Jan 15 03:55:56 2013
From: levinie001 at gmail.com (Levi Nie)
Date: Tue, 15 Jan 2013 16:55:56 +0800
Subject: [Twisted-web] interrupt the file sending if the file size over the
 quota...some errors here...
Message-ID: <CAEMsKDtsArhPNrB52CowABnN=6i4sb-t8M32PdtYszq0Tq4p5w@mail.gmail.com>

i want to interrupt the file sending. but i can't change the client. so i
need change the server.
All things go well, but the message i wanna response seem not work.
is the self.transport.loseConnection() (the last line) blocking the
messages?
in fact, i work on Cumulus(nimbus project) which based on twisted. And i
use s3cmd as the client.

here is the my code:

        def headerReceived(self,line):
        pycb.log(logging.INFO, "===== def headerReceived of cumulus.py")
        http.HTTPChannel.headerReceived(self,line)
        pycb.log(logging.INFO, "===== self.length is %s"%self.length)

        header, data = line.split(':', 1)
        header = header.lower()
        data = data.strip()
        if header=='authorization':
            self.authorization=data


        if self.length and self.authorization:
            user_id = self.authorization.split(':')[0].split()[1].strip()
            user = pycb.config.auth.get_user(user_id)

            pycb.log(logging.INFO, "===== user who put this object is
%s"%user)

            remaining_quota = user.get_remaining_quota()
            pycb.log(logging.INFO, "===== remaining_quota is
%s"%remaining_quota)
            quota_check=self.length-remaining_quota
            pycb.log(logging.INFO, "=====
quota_check=self.length-remaining_quota of cumulus.py")

            if quota_check>0:
                requestId = str(uuid.uuid1()).replace("-", "")
                ex=cbException('AccountProblem')

                m_msg = "HTTP/1.1 %s %s\r\n" % (ex.httpCode, ex.httpDesc)
                self.transport.write(m_msg)

                m_msg = "%s: %s\r\n" % (('x-amz-request-id', requestId))
                self.transport.write(m_msg)
                #req.setHeader('x-amz-request-id', requestId)

                m_msg = "%s: %s\r\n" % (('x-amz-id-2', str(uuid.uuid1())))
                self.transport.write(m_msg)

                e_msg = ex.make_xml_string(self._path, str(uuid.uuid1()))
                pycb.log(logging.INFO, "===== e_msg is %s"%e_msg)
                #self.transport.write("\r\n")
                self.transport.write(e_msg)
                pycb.log(logging.INFO, "===== self.transport.write(e_msg)")


                self.transport.loseConnection()
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-web/attachments/20130115/3b5147b7/attachment.htm 

From levinie001 at gmail.com  Tue Jan 15 04:58:06 2013
From: levinie001 at gmail.com (Levi Nie)
Date: Tue, 15 Jan 2013 17:58:06 +0800
Subject: [Twisted-web] Twisted-web Digest, Vol 105, Issue 2
In-Reply-To: <mailman.3.1357405201.7306.twisted-web@twistedmatrix.com>
References: <mailman.3.1357405201.7306.twisted-web@twistedmatrix.com>
Message-ID: <CAEMsKDsud3CbPFTipnpPuhfLk2tbnrYVXBbCQz8HTpCnw6iojA@mail.gmail.com>

tks


2013/1/6 <twisted-web-request at twistedmatrix.com>

> Send Twisted-web mailing list submissions to
>         twisted-web at twistedmatrix.com
>
> To subscribe or unsubscribe via the World Wide Web, visit
>         http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web
> or, via email, send a message with subject or body 'help' to
>         twisted-web-request at twistedmatrix.com
>
> You can reach the person managing the list at
>         twisted-web-owner at twistedmatrix.com
>
> When replying, please edit your Subject line so it is more specific
> than "Re: Contents of Twisted-web digest..."
>
>
> Today's Topics:
>
>    1. Re: [Twisted-Python] Speed of rendering? (Peter Westlake)
>    2. Re: [Twisted-Python] Speed of rendering?
>       (exarkun at twistedmatrix.com)
>    3. file upload with twisted (Levi Nie)
>    4. Re: file upload with twisted (Glyph)
>    5. Re: file upload with twisted (??????? ?????)
>
>
> ----------------------------------------------------------------------
>
> Message: 1
> Date: Fri, 04 Jan 2013 18:30:47 +0000
> From: Peter Westlake <peter.westlake at pobox.com>
> Subject: Re: [Twisted-web] [Twisted-Python] Speed of rendering?
> To: Twisted Web World <twisted-web at twistedmatrix.com>
> Message-ID:
>         <
> 1357324247.31399.140661173476561.11F56E5E at webmail.messagingengine.com>
>
> Content-Type: text/plain
>
> A while back I promised to write some benchmarks for
> twisted.web.template's flattening functions. Is something like this
> suitable? If so, I'll add lots more test cases. The output format could
> be improved, too - any preferences?
>
> Peter.
>
> from twisted.web.template import flatten
> from twisted.web.server import Request
> import twisted.web.http
>
> channel = twisted.web.http.HTTPChannel()
> request = Request(channel, False)
>
>
> def make(content):
>     def f():
>         d = flatten(request, content, lambda _: None)
>         assert d.called
>     return f
>
>
> def test(content):
>     return timeit.timeit(stmt=make(content), number=repeats)
>
> repeats = 1000
>
> deeplist = ['centre']
> for n in range(100):
>     deeplist = [deeplist]
>
> tests = {
>     'empty': '',
>     'string': 'hello',
>     'shortlist': ['hello'],
>     'longlist': [str(n) for n in range(100)],
>     'deeplist': deeplist,
> }
>
>
> if __name__ == '__main__':
>     import timeit
>     from sys import argv
>     for name in argv[1:] or tests:
>         print name, test(tests[name])
>
>
>
> ------------------------------
>
> Message: 2
> Date: Fri, 04 Jan 2013 19:58:13 -0000
> From: exarkun at twistedmatrix.com
> Subject: Re: [Twisted-web] [Twisted-Python] Speed of rendering?
> To: Twisted Web World <twisted-web at twistedmatrix.com>
> Message-ID:
>
> <20130104195813.4649.1661214274.divmod.xquotient.20 at localhost6.localdomain6
> >
>
> Content-Type: text/plain; charset="utf-8"; format="flowed"
>
> On 06:30 pm, peter.westlake at pobox.com wrote:
> >A while back I promised to write some benchmarks for
> >twisted.web.template's flattening functions. Is something like this
> >suitable? If so, I'll add lots more test cases. The output format could
> >be improved, too - any preferences?
>
> The output should be something that we can load into our codespeed
> instance.  The output of any of the existing benchmarks in lp:twisted-
> benchmarks should be a good example of that format (I don't even recall
> what it is right now - it may not even be a "format" so much as a shape
> of data to submit to an HTTP API).
>
> The `timeit` module is probably not suitable to use to collect the data,
> as it makes some questionable choices with respect to measurement
> technique, and at the very least it's inconsistent with the rest of the
> benchmarks we have.
>
> Selecting data to operate on is probably an important part of this
> benchmark (or collection of benchmarks).  It may not be possible to
> capture all of the interesting performance characteristics in a single
> dataset.  However, at least something that includes HTML tags is
> probably desirable, since that is the primary use-case.
>
> There are some other Python templating systems with benchmarks.  One
> approach that might make sense is to try to build analogous benchmarks
> for twisted.web.template.  (Or perhaps a little thought will reveal that
> it's not possible to make comparisons between twisted.web.template and
> those systems, so there's no reason to follow their benchmarking lead.)
>
> Jean-Paul
> >Peter.
> >
> >from twisted.web.template import flatten
> >from twisted.web.server import Request
> >import twisted.web.http
> >
> >channel = twisted.web.http.HTTPChannel()
> >request = Request(channel, False)
> >
> >
> >def make(content):
> >    def f():
> >        d = flatten(request, content, lambda _: None)
> >        assert d.called
> >    return f
> >
> >
> >def test(content):
> >    return timeit.timeit(stmt=make(content), number=repeats)
> >
> >repeats = 1000
> >
> >deeplist = ['centre']
> >for n in range(100):
> >    deeplist = [deeplist]
> >
> >tests = {
> >    'empty': '',
> >    'string': 'hello',
> >    'shortlist': ['hello'],
> >    'longlist': [str(n) for n in range(100)],
> >    'deeplist': deeplist,
> >}
> >
> >
> >if __name__ == '__main__':
> >    import timeit
> >    from sys import argv
> >    for name in argv[1:] or tests:
> >        print name, test(tests[name])
> >
> >_______________________________________________
> >Twisted-web mailing list
> >Twisted-web at twistedmatrix.com
> >http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web
>
>
>
> ------------------------------
>
> Message: 3
> Date: Sat, 5 Jan 2013 09:50:37 +0800
> From: Levi Nie <levinie001 at gmail.com>
> Subject: [Twisted-web] file upload with twisted
> To: "twisted-web at twistedmatrix.com" <twisted-web at twistedmatrix.com>
> Message-ID:
>         <CAEMsKDudEvLCeVf=
> sVPW_BE7rX2qtx9rAQERvssAMsckF9yYfA at mail.gmail.com>
> Content-Type: text/plain; charset="iso-8859-1"
>
> When i send a http request with a big file, can i check the content-length
> then enable or disable the
> file upload?
>
> I use the s3cmd client sent the request. And i need disable the file upload
> if the file size is over the quota.
>
> how can i do this?
> -------------- next part --------------
> An HTML attachment was scrubbed...
> URL:
> http://twistedmatrix.com/pipermail/twisted-web/attachments/20130105/43bc7e14/attachment.html
>
> ------------------------------
>
> Message: 4
> Date: Fri, 4 Jan 2013 20:14:51 -0800
> From: Glyph <glyph at twistedmatrix.com>
> Subject: Re: [Twisted-web] file upload with twisted
> To: Twisted Web World <twisted-web at twistedmatrix.com>
> Message-ID: <DEA8BBC4-E7C6-446B-90A3-BA1037BD1267 at twistedmatrix.com>
> Content-Type: text/plain; charset=iso-8859-1
>
>
> On Jan 4, 2013, at 5:50 PM, Levi Nie <levinie001 at gmail.com> wrote:
>
> > When i send a http request with a big file, can i check the
> content-length then enable or disable the
> > file upload?
> >
> > I use the s3cmd client sent the request. And i need disable the file
> upload if the file size is over the quota.
> >
> > how can i do this?
>
> This s3cmd? https://github.com/s3tools/s3cmd/blob/master/s3cmd
>
> It doesn't look like it uses Twisted, so I don't think this is a question
> for this list.
>
>
>
>
> ------------------------------
>
> Message: 5
> Date: Sat, 5 Jan 2013 15:25:21 +0600
> From: ??????? ????? <poisonoff at gmail.com>
> Subject: Re: [Twisted-web] file upload with twisted
> To: Twisted Web World <twisted-web at twistedmatrix.com>
> Message-ID:
>         <CACgbmJ=
> G-FZZee62VADTV2FcLUxu0zC4PY9R3LUa2CU7tVP2Lg at mail.gmail.com>
> Content-Type: text/plain; charset=UTF-8
>
> I resolve same problem in self project, reimplement method
> handleContentChunk in server.Request
>
> My code:
>
> <code># For maximum
>         handleContentChunkLength = 0
>
>         def handleContentChunk(self, data):
>                 """
>                 Write a chunk of data.
>                 """
>                 self.handleContentChunkLength += len(data)
>
>                 if self.handleContentChunkLength >= WEB_LIMIT_REQUEST_SIZE:
>                         self.transport.write(b"HTTP/1.1 413 Request Entity
> Too Large\r\n\r\n")
>                         self.transport.loseConnection()
>
>                         # Raise to log error
>                         raise ValueError('Maximum length equal')
>
>                 self.content.write(data)</code>
>
> On Sat, Jan 5, 2013 at 10:14 AM, Glyph <glyph at twistedmatrix.com> wrote:
> >
> > On Jan 4, 2013, at 5:50 PM, Levi Nie <levinie001 at gmail.com> wrote:
> >
> >> When i send a http request with a big file, can i check the
> content-length then enable or disable the
> >> file upload?
> >>
> >> I use the s3cmd client sent the request. And i need disable the file
> upload if the file size is over the quota.
> >>
> >> how can i do this?
> >
> > This s3cmd? https://github.com/s3tools/s3cmd/blob/master/s3cmd
> >
> > It doesn't look like it uses Twisted, so I don't think this is a
> question for this list.
> >
> >
> > _______________________________________________
> > Twisted-web mailing list
> > Twisted-web at twistedmatrix.com
> > http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web
>
>
>
> ------------------------------
>
> _______________________________________________
> Twisted-web mailing list
> Twisted-web at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web
>
>
> End of Twisted-web Digest, Vol 105, Issue 2
> *******************************************
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-web/attachments/20130115/7bd647e4/attachment-0001.htm 

