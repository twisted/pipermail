<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] [Nevow] new chapter about authentication
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20%5BNevow%5D%20new%20chapter%20about%20authentication&In-Reply-To=20060803172908.1717.1777397042.divmod.quotient.13388%40ohm">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002932.html">
   <LINK REL="Next"  HREF="002934.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] [Nevow] new chapter about authentication</H1>
    <B>Manlio Perillo</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20%5BNevow%5D%20new%20chapter%20about%20authentication&In-Reply-To=20060803172908.1717.1777397042.divmod.quotient.13388%40ohm"
       TITLE="[Twisted-web] [Nevow] new chapter about authentication">manlio_perillo at libero.it
       </A><BR>
    <I>Thu Aug  3 13:26:13 CDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="002932.html">[Twisted-web] [Nevow] new chapter about authentication
</A></li>
        <LI>Next message: <A HREF="002934.html">[Twisted-web] [Nevow] new chapter about authentication
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2933">[ date ]</a>
              <a href="thread.html#2933">[ thread ]</a>
              <a href="subject.html#2933">[ subject ]</a>
              <a href="author.html#2933">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Valentino Volonghi aka Dialtone ha scritto:
&gt;<i> On Thu, 03 Aug 2006 18:28:04 +0200, Manlio Perillo
</I>&gt;<i> &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">manlio_perillo at libero.it</A>&gt; wrote:
</I>&gt;&gt;<i> Of course.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Is this better?:
</I>&gt;&gt;<i> &quot;&quot;&quot;Session cookies carry some text used to authenticate users (called
</I>&gt;&gt;<i> authenticator).
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The only secure way to transport such an information beetwen client and
</I>&gt;&gt;<i> server is with HTTPS.&quot;&quot;&quot;
</I>&gt;<i> 
</I>&gt;<i> This is better. Although 'carry some text used to' is not that good,
</I>&gt;<i> what would be good is to write that it carries _exactly_.
</I>&gt;<i> 
</I>
Ok.

&gt;<i> [...]
</I>&gt;<i>
</I>&gt;&gt;<i> An attacker &quot;authenticate&quot; into the application using a stealed cookie.
</I>&gt;&gt;<i> No one is changing/regenerating the password, the attacker only changes
</I>&gt;&gt;<i> the account email address and then ask the system to send the
</I>&gt;&gt;<i> &quot;forgotten&quot; password to the new (under its control) email address.
</I>&gt;<i> 
</I>&gt;&gt;<i> It needs to execute HTTP commands, and the sessions does not change.
</I>&gt;<i> 
</I>&gt;<i> Given your other suggestions (one of them was store the hash of the
</I>&gt;<i> password) how are you going to send the &quot;forgotten&quot; password? You don't
</I>&gt;<i> even know it.
</I>&gt;<i> 
</I>
Ok, so you where supposing this feature.
And, indeed, I think I'm going to hash the passwords.

&gt;<i> You must autogenerate a new one and then send it, and if it's like that
</I>&gt;<i> you 'just' lost an account and not a password.
</I>&gt;<i> 
</I>
One can simply update the entry in the database, without having the
application code know about this (but I'm not sure here, I have to do
some tests since I'm interested in this feature).


&gt;<i> Anyway these suggestions are more part of another chapter that could be
</I>&gt;<i> titled: &quot;Suggestions on safe web app design&quot; rather than part of the
</I>&gt;<i> authentication chapter.
</I>&gt;<i> 
</I>&gt;&gt;&gt;<i> sessions are not authentication, of course they are not good for that.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Yes, sessions carry authenticators.
</I>&gt;<i> 
</I>&gt;<i> What are these and why?
</I>&gt;<i> 
</I>
authenticator or authentication token.
On papers (like <A HREF="http://pdos.lcs.mit.edu/cookies/pubs/webauth:tr.pdf">http://pdos.lcs.mit.edu/cookies/pubs/webauth:tr.pdf</A>) and
the OWASPGuide they use this term.

&gt;&gt;&gt;<i> They are different kind of things.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> No.
</I>&gt;&gt;<i> Both cookies, URLs and hidden form's controls are a mean to transport
</I>&gt;&gt;<i> sessions IDs.
</I>&gt;<i> 
</I>&gt;<i> Those are _different_ means to transport session ID.
</I>&gt;<i> 
</I>
Ok.

&gt;&gt;<i> Do you prefer a fully usable site to a secure one?
</I>&gt;&gt;<i> Cookies are standards.
</I>&gt;<i> 
</I>&gt;<i> You still have to show me how it is not secure to use session IDs in the
</I>&gt;<i> URL.
</I>
<A HREF="http://divmod.org/trac/ticket/1377">http://divmod.org/trac/ticket/1377</A>

Try to add the icon for XHTML validation.
You will see your session id on the validator page, once you visit it.

Your site can include links for sponsors.
And these sponsor may be interested to steal user's data.

Not so many user will click on these links, but some will do it.


I have also request the ticket #1378
But I think this is more difficult to exploit, unless you don't filter
this kind of HTML code:

&lt;html&gt;
  &lt;body&gt;
    &lt;p&gt;Hello world
      &lt;meta http-equiv=&quot;Set-Cookie&quot;
            content=&quot;sessionid=1234; Expires=Friday, 01-Jan-2010
000:00:00 0GMT&quot;&gt;
    &lt;/p&gt;
  &lt;/body&gt;
&lt;/html&gt;


How many developers knows to remove meta tag in the body?



&gt;&gt;<i> I don't have an e-commerce site.
</I>&gt;&gt;<i> Its only a portal.
</I>&gt;<i> 
</I>&gt;<i> You are spending more time here talking about how to make session id
</I>&gt;<i> exchange more secure while you could have simply used https and that's all.
</I>&gt;<i> Doesn't sound very efficient.
</I>&gt;<i> 
</I>
Well, know I'm spending a couple of hours on this topic, but HTTPs will
slowdown my site forever.

&gt;&gt;<i> Mea culpa on using the wrong term. Of course I intended persistent.
</I>&gt;<i> 
</I>&gt;<i> persistent sessions are yet another thing and the user asks for the
</I>&gt;<i> explicitly by ticking 'remember me'.
</I>&gt;<i> 
</I>
Of course.

&gt;&gt;<i> I will do some test but HTTPs for every page is likely too heavy for the
</I>&gt;&gt;<i> poor server.
</I>&gt;<i> 
</I>&gt;<i> heavier than nothing, probably true
</I>&gt;<i> heavier than encrypting/decrypting all cookie values each time? slightly
</I>&gt;<i> heavier timewise? not at all.
</I>&gt;<i> 
</I>
Encryption is not really needed, only signing.
But, as you say, HTTPs can be a better solution at all.

&gt;<i> [...]
</I>&gt;<i> 
</I>&gt;<i> See? You can decide it, although if you did this because it was an
</I>&gt;<i> optimization you will regret doing it.
</I>&gt;<i> 
</I>
Well, for some uses cases it can just work.

&gt;&gt;&gt;<i> And this
</I>&gt;&gt;&gt;<i> will be enforced without the context. Also... Are you actually worrying
</I>&gt;&gt;&gt;<i> about creating one object compared to the cost of rendering a dynamic
</I>&gt;&gt;&gt;<i> page? (and locating it!)
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I have learned to not make pre-assumptions without doing some tests.
</I>&gt;<i> 
</I>&gt;<i> well... I did tests and I know what happens during page rendering and
</I>&gt;<i> page lookup. For each rendering 6 to infinite contexts are instantiated.
</I>&gt;<i> If you nest more than 5 fragments python reaches the infinite recursion
</I>&gt;<i> limit (this number might vary, just to give you an example of how many
</I>&gt;<i> objects are created during rendering). 
</I>
But this is a nightmare! ;-)
Have you done some tests with the new version context-less?

&gt;<i> You are removing a:
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">dialtone at aiolia</A> /Volumes/dati/Sviluppo/Divmod/branches % python -m
</I>&gt;<i> timeit -s 'class Foo(object): pass' -c
</I>&gt;<i> 'Foo()'                                         [17:31]
</I>&gt;<i> 1000000 loops, best of 3: 1.62 usec per loop
</I>&gt;<i> 
</I>&gt;<i> 1.62 usec (on my ibook)
</I>&gt;<i> 
</I>&gt;<i> over something that is extremely more expensive per se (child lookup).
</I>&gt;<i> 
</I>
But you forgot to include some time here...

&gt;&gt;&gt;<i> Of course there's nothing that prevents you to
</I>&gt;&gt;&gt;<i> return always the same page object from guard.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;&gt;<i> And guard has some (avoidable) security problems, too...
</I>&gt;&gt;&gt;&gt;<i> It uses URLs based sessions without my permission.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> my who? user? developer?
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Developer.
</I>&gt;<i> 
</I>&gt;<i> Can't see that as such a big problem... But it should be configurable
</I>&gt;<i> indeed, open a ticket.
</I>&gt;<i> 
</I>
Done.

But I think that it will never be commited, since it will involve a
partial refactoring of Guard.

The same reason why old file upload support is still there (and there is
no control on the size of POST data so someone can send me an image of 3
MB).

At least I can change this without changing source code.

&gt;<i> [...]
</I>
&gt;&gt;<i> Some other personal advice about yout guard implementation:
</I>&gt;&gt;<i> - I think that SessionManager should be renamed SessionFactory
</I>&gt;<i> 
</I>&gt;<i> It's not a proper factory. SessionManager is a clean name, it manages
</I>&gt;<i> lifetimes and creation/destruction. Exactly what a manager does.
</I>&gt;<i> 
</I>
Ok.

&gt;&gt;<i> - Maybe the getSession() of the SessionManager class should be changed
</I>&gt;&gt;<i>  in getSession(sessionInterface=ISession)
</I>&gt;&gt;<i>  That is, ISessionManager should work a little like the
</I>&gt;&gt;<i>  ICredentialsChecker.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>  I can define an IGuardSession with additional features (the guard
</I>&gt;&gt;<i>  attribute that really make sense only for authenticator's sessions.)
</I>&gt;<i> 
</I>&gt;<i> what's an authenticator's session? 
</I>
A session used for user's authentication.

I can create a session only to store some state (as an example, to count
how time an user failed the login).
Why it should have a guard attribute?

And, indeed, in newow.inevow are defined ISession and IGuardSession.

&gt;<i> This might be useful but seems like a
</I>&gt;<i> lot of added complexity for a pretty small usecase. Remember sessions
</I>&gt;<i> are an implementation detail not something that should be exposed to the
</I>&gt;<i> user. I can't imagine a need for such a generic API.
</I>&gt;<i> 
</I>
You are right.
But you are also supposing that SessionManager creates only one king of
session.

&gt;&gt;<i> - If you choose to not create sessions for anonymous users, then there
</I>&gt;&gt;<i>  is no more need for the loggedIn callback
</I>&gt;<i> 
</I>&gt;<i> If you give me enough reason to remove the loggedIn callback I will
</I>&gt;<i> remove it.
</I>&gt;<i> 
</I>
If it is possible to avoid creating sessions for anonymous users, then a
session needs only to be created after a successful login.
So you can put the code that is now in loggedIn in createSession.



Regards  Manlio Perillo

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002932.html">[Twisted-web] [Nevow] new chapter about authentication
</A></li>
	<LI>Next message: <A HREF="002934.html">[Twisted-web] [Nevow] new chapter about authentication
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2933">[ date ]</a>
              <a href="thread.html#2933">[ thread ]</a>
              <a href="subject.html#2933">[ subject ]</a>
              <a href="author.html#2933">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
