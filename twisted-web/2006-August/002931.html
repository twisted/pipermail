<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] [Nevow] new chapter about authentication
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20%5BNevow%5D%20new%20chapter%20about%20authentication&In-Reply-To=20060803105816.1717.1666872432.divmod.quotient.13119%40ohm">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002930.html">
   <LINK REL="Next"  HREF="002932.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] [Nevow] new chapter about authentication</H1>
    <B>Manlio Perillo</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20%5BNevow%5D%20new%20chapter%20about%20authentication&In-Reply-To=20060803105816.1717.1666872432.divmod.quotient.13119%40ohm"
       TITLE="[Twisted-web] [Nevow] new chapter about authentication">manlio_perillo at libero.it
       </A><BR>
    <I>Thu Aug  3 11:28:04 CDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="002930.html">[Twisted-web] [Nevow] new chapter about authentication
</A></li>
        <LI>Next message: <A HREF="002932.html">[Twisted-web] [Nevow] new chapter about authentication
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2931">[ date ]</a>
              <a href="thread.html#2931">[ thread ]</a>
              <a href="subject.html#2931">[ subject ]</a>
              <a href="author.html#2931">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Valentino Volonghi aka Dialtone ha scritto:
&gt;<i> On Thu, 03 Aug 2006 12:17:03 +0200, Manlio Perillo
</I>&gt;<i> &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">manlio_perillo at libero.it</A>&gt; wrote:
</I>&gt;<i> [...]
</I>&gt;<i> 
</I>&gt;&gt;&gt;<i> Line 19:
</I>&gt;&gt;&gt;<i> The most secure way is to use HTTPS, based on SSL. But SSL can cause
</I>&gt;&gt;&gt;<i> too burden on an application.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> The most secure way to do what?
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> To use sessions.
</I>&gt;<i> 
</I>&gt;<i> I think you are confused here... HTTPS and sessions are 2 totally
</I>&gt;<i> different things.
</I>&gt;<i> 
</I>
Of course.

Is this better?:
&quot;&quot;&quot;Session cookies carry some text used to authenticate users (called
authenticator).

The only secure way to transport such an information beetwen client and
server is with HTTPS.&quot;&quot;&quot;

&gt;<i> [...]
</I>&gt;&gt;<i> The system should ask for the user password when the user wants to
</I>&gt;&gt;<i> change its email address.
</I>&gt;&gt;<i> This is important *if* the system allow an user to ask for its forgotten
</I>&gt;&gt;<i> password and this is sent to its email address.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> An attacker (that obtained a valid session ID) can change the account
</I>&gt;&gt;<i> email address and ask for the password!
</I>&gt;<i> 
</I>&gt;<i> This is a non-problem with my guard. Asking authentication each time
</I>&gt;<i> invalidates the current session credentials (because you changed the
</I>&gt;<i> password in the database when you autogenerated a new one). To reach the
</I>&gt;<i> user pages again you'd have to know the autogenerated one. because the
</I>&gt;<i> one stored in the session is not valid anymore.
</I>&gt;<i> 
</I>
Not sure.

An attacker &quot;authenticate&quot; into the application using a stealed cookie.
No one is changing/regenerating the password, the attacker only changes
the account email address and then ask the system to send the
&quot;forgotten&quot; password to the new (under its control) email address.

It needs to execute HTTP commands, and the sessions does not change.

And now the attacker knows the username + password for a poor client.
And maybe this poor (and fool) client uses the same credentials for its
e-banking account...

&gt;&gt;&gt;<i> Session section:
</I>&gt;&gt;&gt;<i> Why is it suggested to use cookies when at the end of the same
</I>&gt;&gt;&gt;<i> subsection you say that this approach has several flaws?
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Because, by design, sessions are not good for authentication.
</I>&gt;<i> 
</I>&gt;<i> sessions are not authentication, of course they are not good for that.
</I>&gt;<i> 
</I>
Yes, sessions carry authenticators.

&gt;&gt;<i> However cookies based sessions are better that URL based sessions or
</I>&gt;&gt;<i> form based sessions.
</I>&gt;<i> 
</I>&gt;<i> They are different kind of things. 
</I>
No.
Both cookies, URLs and hidden form's controls are a mean to transport
sessions IDs.

I'm just using sessions where I should say session IDs.

&gt;<i> Sometimes clients don't support
</I>&gt;<i> cookies. How are you going to provide a usable website for them?
</I>&gt;<i> 
</I>
Do you prefer a fully usable site to a secure one?
Cookies are standards.

&gt;&gt;<i> The only flaw of a well written session management system (as I can
</I>&gt;&gt;<i> understand) is a replication attack (done by someone that can see the
</I>&gt;&gt;<i> traffic beetwen client and server).
</I>&gt;<i> 
</I>&gt;<i> Just use HTTPS.
</I>&gt;<i> 
</I>
I don't have an e-commerce site.
Its only a portal.

&gt;&gt;<i> This assuming that one isn't using permanent sessions.
</I>&gt;<i> 
</I>&gt;<i> There is no such thing as permanent sessions. They might be persistent
</I>&gt;<i> for some time but not permanent.
</I>&gt;<i> 
</I>
Mea culpa on using the wrong term. Of course I intended persistent.

&gt;<i> [...]
</I>&gt;<i>
</I>&gt;<i> Much of the problems you are trying to find here are all resolved by
</I>&gt;<i> using https for everything in your website. I doubt it's worth to lose
</I>&gt;<i> so much developer time in trying to make secure something that cannot be
</I>&gt;<i> secure by design (there is a machine that is not under your control and
</I>&gt;<i> that is also the one you want to protect). Just use HTTPS for all your
</I>&gt;<i> website. Safer and simpler.
</I>&gt;<i> 
</I>
I will do some test but HTTPs for every page is likely too heavy for the
poor server.

&gt;&gt;<i> No.
</I>&gt;&gt;<i> I can create a complete &quot;static&quot; site, with all Resources created at
</I>&gt;&gt;<i> start time.
</I>&gt;<i> 
</I>&gt;<i> You can do _EXACTLY_ the same thing with guard. Did I mention that guard
</I>&gt;<i> is like it is to avoid changing ANY code in your application?
</I>&gt;<i> 
</I>&gt;&gt;<i> Maybe I need to add some examples.
</I>&gt;&gt;<i> And I would like to do some benchmark to understand the cost of creating
</I>&gt;&gt;<i> every resource object on the fly.
</I>&gt;<i> 
</I>&gt;<i> rend.Page() objects are made to be destroyed for every request. 
</I>
Not sure.
The root resource is created only once, right?
And I can do:

class ChildPage(rend.Page):
	...

class MainPage(rend.Page):
	...



root = MainPage()
child = ChildPage()

root.putChild('a', child)
child.putChild('b', child)


server = appserver.NevowSite(root)


&gt;<i> And this
</I>&gt;<i> will be enforced without the context. Also... Are you actually worrying
</I>&gt;<i> about creating one object compared to the cost of rendering a dynamic
</I>&gt;<i> page? (and locating it!) 
</I>
I have learned to not make pre-assumptions without doing some tests.

&gt;<i> Of course there's nothing that prevents you to
</I>&gt;<i> return always the same page object from guard.
</I>&gt;<i> 
</I>&gt;&gt;<i> And guard has some (avoidable) security problems, too...
</I>&gt;&gt;<i> It uses URLs based sessions without my permission.
</I>&gt;<i> 
</I>&gt;<i> my who? user? developer?
</I>&gt;<i> 
</I>
Developer.

&gt;<i> [...]
</I>
&gt;&gt;<i> This allow one to write custom code, as an example one can create an
</I>&gt;&gt;<i> additional cookie with a signed and crypted client address, using the
</I>&gt;&gt;<i> same interface.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Or, more paranoic, one can create an additional cookie with a signed and
</I>&gt;&gt;<i> maybe encrypted serial number.
</I>&gt;&gt;<i> This number is incremented at every request (both on the session cookie
</I>&gt;&gt;<i> and on the session object) and checked.
</I>&gt;<i> 
</I>&gt;<i> This looks so paranoid 
</I>
Just as I have said.

&gt;<i> I can't believe anyone could use it... Why should
</I>&gt;<i> I need such a secure way of communicating through the web? 
</I>
Some sites, as an example, bind cookies to user IP address (Yahoo, at
least some years ago).

&gt;<i> there are
</I>&gt;<i> already other kinds of mechanism that are even more secure than that. I
</I>&gt;<i> think HTTPS, secure cookies and encrypted cookie values are more than
</I>&gt;<i> enough to barely trust a cookie.
</I>&gt;<i> 
</I>&gt;<i> Anyway it seems reasonable to factor out the cookie handling stuff.
</I>&gt;<i> 
</I>
Ok!

Some other personal advice about yout guard implementation:
- I think that SessionManager should be renamed SessionFactory
- Maybe the getSession() of the SessionManager class should be changed
  in getSession(sessionInterface=ISession)
  That is, ISessionManager should work a little like the
  ICredentialsChecker.

  I can define an IGuardSession with additional features (the guard
  attribute that really make sense only for authenticator's sessions.)
- If you choose to not create sessions for anonymous users, then there
  is no more need for the loggedIn callback


A last thing:
how will be the Session management in web2?


P.S.
You may wonder why I'm so paranoic.
Well, I'm reading
<A HREF="http://www.owasp.org/index.php/Category:OWASP_Guide_Project">http://www.owasp.org/index.php/Category:OWASP_Guide_Project</A>
...


Thanks and regards  Manlio Perillo

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002930.html">[Twisted-web] [Nevow] new chapter about authentication
</A></li>
	<LI>Next message: <A HREF="002932.html">[Twisted-web] [Nevow] new chapter about authentication
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2931">[ date ]</a>
              <a href="thread.html#2931">[ thread ]</a>
              <a href="subject.html#2931">[ subject ]</a>
              <a href="author.html#2931">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
