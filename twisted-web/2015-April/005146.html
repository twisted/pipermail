<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] Client.agent - PartialDownloadError - cannot	determine cause
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-web%5D%20Client.agent%20-%20PartialDownloadError%20-%20cannot%0A%09determine%20cause&In-Reply-To=%3C2C620A21-1ED2-4551-9405-974F8DD00A5F%40twistedmatrix.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005144.html">
   <LINK REL="Next"  HREF="005147.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] Client.agent - PartialDownloadError - cannot	determine cause</H1>
    <B>Glyph</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-web%5D%20Client.agent%20-%20PartialDownloadError%20-%20cannot%0A%09determine%20cause&In-Reply-To=%3C2C620A21-1ED2-4551-9405-974F8DD00A5F%40twistedmatrix.com%3E"
       TITLE="[Twisted-web] Client.agent - PartialDownloadError - cannot	determine cause">glyph at twistedmatrix.com
       </A><BR>
    <I>Mon Apr 13 23:33:39 MDT 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="005144.html">[Twisted-web] Client.agent - PartialDownloadError - cannot determine cause
</A></li>
        <LI>Next message: <A HREF="005147.html">[Twisted-web] web UI example for Twisted application
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5146">[ date ]</a>
              <a href="thread.html#5146">[ thread ]</a>
              <a href="subject.html#5146">[ subject ]</a>
              <a href="author.html#5146">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
&gt;<i> On Apr 13, 2015, at 15:30, Chris Drane &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">csdrane at gmail.com</A>&gt; wrote:
</I>&gt;<i> 
</I>&gt;<i> I revisited the Stack Overflow post and it appears that I am able to receive HTTP responses properly now. Doing so required me to launch WireShark and copy a browser's actual headers. I also had to add a ContentDecoderAgent. 
</I>
This is a good idea, but it's also a bit of an accident.  Some sites may give you length prefixes with a content decoder, but there will still be some that provoke a PartialDownloadError no matter what you do.  There are edge cases in HTTP where you just cannot know if you have received everything the server sent, and many sites still operate that way.

&gt;<i> Specifically it was the lack of an Accept-Encoding that was causing the problem. I added [&quot;gzip, deflate, sdch&quot;] and it seemed to do the trick.
</I>
Hrm.  You have to set this header manually, even using a ContentDecoderAgent?  That sounds like a bug.

&gt;<i> I really do think that there should be an easier way to do this.
</I>
Absolutely.  From the very beginning, Agent was not really supposed to be a &quot;high level&quot; HTTP API, but those working on it sort of ran out of energy halfway through.  If you're writing applications today, you probably should use treq instead - <A HREF="https://github.com/twisted/treq">https://github.com/twisted/treq</A> &lt;<A HREF="https://github.com/twisted/treq">https://github.com/twisted/treq</A>&gt; - but longer-term the plan is to absorb treq or something very much like it into Twisted itself.

Looking through the ticket tracker, though, I see that the plan ... does not seem to be very well documented.  I can't find the &quot;high level&quot; ticket anywhere, and the closest thing I can find with just a few minutes of searching the tracker is this:

<A HREF="https://twistedmatrix.com/trac/ticket/3987#comment:29">https://twistedmatrix.com/trac/ticket/3987#comment:29</A> &lt;<A HREF="https://twistedmatrix.com/trac/ticket/3987#comment:29">https://twistedmatrix.com/trac/ticket/3987#comment:29</A>&gt;

which closes a ticket about a &quot;high level interface&quot; by talking about a &quot;mid-level API&quot;.  We clearly need a higher level API within Twisted itself.

&gt;<i> I also don't understand why the Agent couldn't have properly interpreted the initial response.
</I>
It did properly interpret the initial response.  You may or may not have received the whole body, and that's exactly what PartialDownloadError means.  If responses which might be the whole response OR might be the server breaking the connection on you are acceptable, handle that error and just treat the body that you have received so far as complete.  This is perfectly acceptable in many cases.

&gt;<i> Thanks for everyone's time.
</I>
Thanks for using Twisted!  Sorry that this experience was somewhat rocky.  I hope you'll stick around and help us improve it.

-glyph
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://twistedmatrix.com/pipermail/twisted-web/attachments/20150414/68a97e27/attachment-0001.html">http://twistedmatrix.com/pipermail/twisted-web/attachments/20150414/68a97e27/attachment-0001.html</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="005144.html">[Twisted-web] Client.agent - PartialDownloadError - cannot determine cause
</A></li>
	<LI>Next message: <A HREF="005147.html">[Twisted-web] web UI example for Twisted application
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5146">[ date ]</a>
              <a href="thread.html#5146">[ thread ]</a>
              <a href="subject.html#5146">[ subject ]</a>
              <a href="author.html#5146">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
