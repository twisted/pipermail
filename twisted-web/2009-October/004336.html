<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] My solution to appending slashes to resources
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20My%20solution%20to%20appending%20slashes%20to%20resources&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004339.html">
   <LINK REL="Next"  HREF="004337.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] My solution to appending slashes to resources</H1>
    <B>Mark Wright</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20My%20solution%20to%20appending%20slashes%20to%20resources&In-Reply-To="
       TITLE="[Twisted-web] My solution to appending slashes to resources">markscottwright at gmail.com
       </A><BR>
    <I>Wed Oct  7 11:50:02 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="004339.html">[Twisted-web] Exceptions in twisted.web.client
</A></li>
        <LI>Next message: <A HREF="004337.html">[Twisted-web] My solution to appending slashes to resources
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4336">[ date ]</a>
              <a href="thread.html#4336">[ thread ]</a>
              <a href="subject.html#4336">[ subject ]</a>
              <a href="author.html#4336">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>(I didn't reply to my original message because the mailing list never
sent it to me.  Yet, I can see it at the archives here
<A HREF="http://twistedmatrix.com/pipermail/twisted-web/2009-October/004334.html">http://twistedmatrix.com/pipermail/twisted-web/2009-October/004334.html</A>
- is anyone getting these messages?)

A bit of metaprogramming to the rescue.  For those Resource classes
that you want to append slashes automatically, this seems to work.
Can anyone see any problems with this?

def append_slashes(rsc_class):
    original_getChild = rsc_class.getChild
    original_render = rsc_class.render

    def slash_appending_getChild(self, path, request):
        if path == '':
            return self
        else:
            return original_getChild(self, path, request)

    def slash_appending_render(self, request):
        if request.prepath[-1] != '':
            request.redirect(request.childLink(&quot;&quot;))
            return &quot;&quot;
        else:
            return original_render(self, request)

    rsc_class.getChild = slash_appending_getChild
    rsc_class.render = slash_appending_render
    rsc_class.isLeaf = False
    return rsc_class


# test code
# entering <A HREF="http://localhost:8080/hello">http://localhost:8080/hello</A> should redirect to
<A HREF="http://localhost:8080/hello/">http://localhost:8080/hello/</A>

from twisted.internet import reactor
from twisted.python import log
from twisted.web import server, resource, static
import sys

class MyPage(resource.Resource):
    def render_GET(self, request):
        return &quot;&lt;html&gt;&lt;body&gt;&lt;p&gt;Hello World&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;&quot;
append_slashes(MyPage)

log.startLogging(sys.stdout)
root = resource.Resource()
root.putChild(&quot;hello&quot;, MyPage())
site = server.Site(root)
reactor.listenTCP(8080, site)
reactor.run()



-- 
Mark Wright
<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">markscottwright at gmail.com</A>

</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004339.html">[Twisted-web] Exceptions in twisted.web.client
</A></li>
	<LI>Next message: <A HREF="004337.html">[Twisted-web] My solution to appending slashes to resources
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4336">[ date ]</a>
              <a href="thread.html#4336">[ thread ]</a>
              <a href="subject.html#4336">[ subject ]</a>
              <a href="author.html#4336">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
