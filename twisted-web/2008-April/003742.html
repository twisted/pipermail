<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] HTTPClient vs. HTTPClientFactory
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20HTTPClient%20vs.%20HTTPClientFactory&In-Reply-To=20080418003203.GA5970%40mcnabbs.org">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003741.html">
   <LINK REL="Next"  HREF="003744.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] HTTPClient vs. HTTPClientFactory</H1>
    <B>Matthew Glubb</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20HTTPClient%20vs.%20HTTPClientFactory&In-Reply-To=20080418003203.GA5970%40mcnabbs.org"
       TITLE="[Twisted-web] HTTPClient vs. HTTPClientFactory">matt at madebykite.com
       </A><BR>
    <I>Fri Apr 18 03:26:39 EDT 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="003741.html">[Twisted-web] HTTPClient vs. HTTPClientFactory
</A></li>
        <LI>Next message: <A HREF="003744.html">[Twisted-web] HTTPClient vs. HTTPClientFactory
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3742">[ date ]</a>
              <a href="thread.html#3742">[ thread ]</a>
              <a href="subject.html#3742">[ subject ]</a>
              <a href="author.html#3742">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Andrew,
	
On 18 Apr 2008, at 01:32, Andrew McNabb wrote:
&gt;<i> First, I think I understand the difference between protocol factories
</I>&gt;<i> and protocols, but I could use a little reassurance.  My current
</I>&gt;<i> understanding is that the protocol factory holds the state that is
</I>&gt;<i> common to all connections, whereas the protocol holds the state  
</I>&gt;<i> that is
</I>&gt;<i> specific to a particular connection.  Is that an accurate  
</I>&gt;<i> understanding?
</I>
No, this is not quite correct. In the case of a  
ServerProtocolFactory, you are right, there is one instance for your  
server, but it isn't responsible for managing state. New connections  
to your server will cause the reactor to call buildProtocol in your  
ServerFactory. This, in turn, will create one instance of your  
ServerProtocol for each new connection. It is the ServerProtocol that  
manages the state of that single connection. If you want to manage  
some kind of global state between connections, you should write a  
logic class that exists as a single, global instance within your  
application.

&gt;<i> If that is correct, then what is the difference between a protocol
</I>&gt;<i> factory and a protocol for a client (like HTTPClient) where only one
</I>&gt;<i> connection is involved?  I'm a bit confused about why  
</I>&gt;<i> HTTPClientFactory
</I>&gt;<i> isn't a trivial class.  According to my current understanding, all of
</I>&gt;<i> the logic would be in HTTPClient.
</I>
A ClientProtocolFactory instance is created for *every* client  
connection you attempt to create. The point here is that your  
ClientProtocol is not instantiated *until* the connection has been  
made to your remote resource. The ClientProtocolFactory manages the  
instantiation of your ClientProtocol when successfully connected. I  
agree that 'ClientProtocolFactory' is somewhat misleading as it  
indicates that it is possible to create more than one ClientProtocol  
from your factory. Within normal design patterns, this would be true,  
but in this case your ClientProtocolFactory will only ever create one  
instance of your ClientProtocol (unless you are doing something  
*really* funky - and probably bad!).

To sum up, you always create a new ClientProtocolFactory when making  
a new client connection:

reactor.connectTCP(host, port, ClientProtocolFactory()

Repeat for more clients...

Hope that helps,


Matt

</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003741.html">[Twisted-web] HTTPClient vs. HTTPClientFactory
</A></li>
	<LI>Next message: <A HREF="003744.html">[Twisted-web] HTTPClient vs. HTTPClientFactory
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3742">[ date ]</a>
              <a href="thread.html#3742">[ thread ]</a>
              <a href="subject.html#3742">[ subject ]</a>
              <a href="author.html#3742">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
