<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] Adding Athena JS handlers in render methods?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Adding%20Athena%20JS%20handlers%20in%20render%20methods%3F&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003488.html">
   <LINK REL="Next"  HREF="003505.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] Adding Athena JS handlers in render methods?</H1>
    <B>kgi</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Adding%20Athena%20JS%20handlers%20in%20render%20methods%3F&In-Reply-To="
       TITLE="[Twisted-web] Adding Athena JS handlers in render methods?">iacovou at gmail.com
       </A><BR>
    <I>Tue Jul 24 06:42:36 EDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="003488.html">[Twisted-web] how to implement render_POST?
</A></li>
        <LI>Next message: <A HREF="003505.html">[Twisted-web] Adding Athena JS handlers in render methods?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3489">[ date ]</a>
              <a href="thread.html#3489">[ thread ]</a>
              <a href="subject.html#3489">[ subject ]</a>
              <a href="author.html#3489">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
Hi all.

I hit something earlier today that has me stumped. It might be a case of 
programming blindness, but on the other hand I might just be trying to do 
something that isn't supported.

Up until now, I've been adding Athena event handlers directly in the 
docFactory's stan. However, I needed to add something with an Athena event 
handler that needs data from an asynchronous external source, so I added data 
and render methods.

These normally Just Work, in the case of &quot;vanilla&quot; XHTML, but the Athena 
handlers don't seem to be processed by _rewriteEventHandlerToAttribute().

In other words, instead of a proper event handler being inserted into the 
XHTML, like so:

&lt;a href=&quot;#&quot; onclick=&quot;return Nevow.Athena.Widget.handleEvent(this, 
&amp;quot;onclick&amp;quot;, &amp;quot;onclick&amp;quot;);&quot;&gt;Click Me 0&lt;/a&gt;

a tag like this appears:

&lt;a href=&quot;#&quot;&gt;&lt;athena:handler handler=&quot;onclick&quot; 
event=&quot;onclick&quot;&gt;&lt;/athena:handler&gt;Click Me 1&lt;/a&gt;

Here's some sample code to illustrate this. It's not a complete example in 
that there's no JS code to be invoked when you click on the first link, but 
it's runnable enough that you can load the page and view the page source.

The first link, &quot;Click Me 0&quot;, has correct event handlers inserted.
The second and third links (&quot;Click Me 1&quot; and &quot;Click Me 2&quot;) both have incorrect 
event handlers inserted. One of them simply returns a piece of stan, the 
other also makes a supposedly asynchronous call.

Am I trying to do something unsupported, or is this a bug?

Thanks,

Ricky

==

from twisted.internet import defer

from nevow import athena
from nevow import loaders
from nevow import flat
from nevow import tags as T
from nevow.page   import renderer

_js = athena.handler ( event = 'onclick', handler = 'onclick' )

class MyElement ( athena.LiveElement ):

    docFactory = loaders.stan (
        T.div ( render = T.directive ( 'liveElement' ) ) [
          T.a ( href = '#' ) [ _js, &quot;Click Me 0&quot; ],
          T.br,
          T.div ( render = T.directive ( 'someStan1' ) ),
          T.br,
          T.div ( render = T.directive ( 'someStan2' ) ),
          ]
    )


    def someStan1 ( self, context, name ):
        return T.a ( href = '#' ) [ _js, &quot;Click Me 1&quot; ]
    renderer ( someStan1 )


    def someStan2 ( self, context, name ):
        def _cb ( r ):
            return T.a ( href = '#' ) [ _js, r ]
        d = self._getData()
        d.addCallback ( _cb )
        return d
    renderer ( someStan2 )


    def _getData ( self ):
        return defer.succeed ( &quot;Click Me 2&quot;)




class MyPage ( athena.LivePage ):

    docFactory = loaders.stan (
        T.html [ T.head ( render = T.directive ( &quot;liveglue&quot; ) ),
                 T.body [ T.div ( render = T.directive ( &quot;myelement&quot; ) ) ],
                 ] )


    def render_myelement ( self, request, tag ):
        e = MyElement()
        e.setFragmentParent ( self )
        return e


######################################################################

from twisted.application import service, internet
from nevow        import appserver

port = 7060

application  = service.Application ( &quot;example&quot; )
res          = MyPage()
site         = appserver.NevowSite ( res )
webService   = internet.TCPServer ( port, site )
webService.setServiceParent ( application )

</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003488.html">[Twisted-web] how to implement render_POST?
</A></li>
	<LI>Next message: <A HREF="003505.html">[Twisted-web] Adding Athena JS handlers in render methods?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3489">[ date ]</a>
              <a href="thread.html#3489">[ thread ]</a>
              <a href="subject.html#3489">[ subject ]</a>
              <a href="author.html#3489">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
