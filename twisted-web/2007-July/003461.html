<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] Cannot redirect to a SessionWrapper-wrapped page
	(example code included)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Cannot%20redirect%20to%20a%20SessionWrapper-wrapped%20page%0A%09%28example%20code%20included%29&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003460.html">
   <LINK REL="Next"  HREF="003462.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] Cannot redirect to a SessionWrapper-wrapped page
	(example code included)</H1>
    <B>kgi</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Cannot%20redirect%20to%20a%20SessionWrapper-wrapped%20page%0A%09%28example%20code%20included%29&In-Reply-To="
       TITLE="[Twisted-web] Cannot redirect to a SessionWrapper-wrapped page
	(example code included)">iacovou at gmail.com
       </A><BR>
    <I>Mon Jul 16 06:51:24 EDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="003460.html">[Twisted-web] mysql connect raise error although reconnect=true
</A></li>
        <LI>Next message: <A HREF="003462.html">[Twisted-web] Cannot redirect to a SessionWrapper-wrapped page
	(example code included)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3461">[ date ]</a>
              <a href="thread.html#3461">[ thread ]</a>
              <a href="subject.html#3461">[ subject ]</a>
              <a href="author.html#3461">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
Hi all.

I've got the following setup on a nevow site (actually, it's an Athena site, 
but I suspect that's incidental):

  - I want the initial visit to the root to be redirected to a named location
    on the same site (that is, <A HREF="http://foo.com/">http://foo.com/</A> =&gt; <A HREF="http://foo.com/bar">http://foo.com/bar</A>);

  - I want the named location to present a login page using 
    guard.SessionWrapper and twisted.cred;

  - Once authenticated, the application proper is available at the name
    location.

At the moment, I've got the following situtation:

  - Publishing the DummyPage() at the root works.
  - Publishing the LivePage() without the SessionWrapper at the root works[1].
  - Publishing the LivePage with the SessionWrapper at the root works.
  - Redirecting to the DummyPage() works.
  - Redirecting to the LivePage without the SessionWrapper works.
  - However, redirecting to the LivePage with the SessionWrapper seems to get
    into some sort of loop.

[1] Where &quot;publishing at the root&quot; means, &quot;passing the resource to 
appserver.NevowSite()&quot; on line 157-ish

The cred and guard stuff is more or less lifted from nevow/examples/guarded.py

Specifically, Firefox 2.0.0.3 (at least, that's what it reports; it's the 
latest version on Ubuntu Feisty) says:

&quot;&quot;&quot;
The page isn't redirecting properly

Firefox has detected that the server is redirecting the request for this 
address in a way that will never complete.

    *   This problem can sometimes be caused by disabling or refusing to       
        accept cookies.
&quot;&quot;&quot;

(It is set up to accept all cookies).

Internet Explorer 6 (ies4linux) simply says that the site is unavailable, but 
I can see from the server side logs that it is hitting the server multiple 
times, in the same way as FF.

The server prints out something like this (I'm editing, because it's quite 
verbose):

&quot;GET / HTTP/1.1&quot;

&quot;GET /foopage HTTP/1.1&quot;

&quot;GET /foopage/__session_key__ae8692cb175716b50ba92a316f586f97 HTTP/1.1&quot;

&quot;GET /foopage?__start_session__=1 HTTP/1.1&quot;

&quot;GET /foopage/__session_key__9237e1a6dcd263df40dc3f6357167474?__start_session__=1 
HTTP/1.1&quot;

&quot;GET /foopage?__start_session__=1 HTTP/1.1&quot;

&quot;GET /foopage/__session_key__6e06ee432ba04231e1b1e887d024f04c?__start_session__=1 
HTTP/1.1&quot;

...

[repeated about 10 times in total]

...

[delay]

expired session ae8692cb175716b50ba92a316f586f97
expired session 9237e1a6dcd263df40dc3f6357167474
[repeated about 10 times in total]

I've attached a single-file example of the problem.

Can anyone spot what I'm doing wrong?

Regards,

Ricky

-------------- next part --------------
A non-text attachment was scrubbed...
Name: redirectToGuard.py
Type: application/x-python
Size: 4697 bytes
Desc: not available
Url : <A HREF="http://twistedmatrix.com/pipermail/twisted-web/attachments/20070716/729b2a5a/redirectToGuard.bin">http://twistedmatrix.com/pipermail/twisted-web/attachments/20070716/729b2a5a/redirectToGuard.bin</A>
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003460.html">[Twisted-web] mysql connect raise error although reconnect=true
</A></li>
	<LI>Next message: <A HREF="003462.html">[Twisted-web] Cannot redirect to a SessionWrapper-wrapped page
	(example code included)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3461">[ date ]</a>
              <a href="thread.html#3461">[ thread ]</a>
              <a href="subject.html#3461">[ subject ]</a>
              <a href="author.html#3461">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
