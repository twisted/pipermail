<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] http://genshi.edgewall.org/wiki/GenshiPerformance
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20http%3A//genshi.edgewall.org/wiki/GenshiPerformance&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003351.html">
   
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] http://genshi.edgewall.org/wiki/GenshiPerformance</H1>
    <B>Manlio Perillo</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20http%3A//genshi.edgewall.org/wiki/GenshiPerformance&In-Reply-To="
       TITLE="[Twisted-web] http://genshi.edgewall.org/wiki/GenshiPerformance">manlio_perillo at libero.it
       </A><BR>
    <I>Sat Apr 28 15:23:30 CDT 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="003351.html">[Twisted-web] excess-transports-1938-3 fixes athena problem with IE7
</A></li>
        
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3352">[ date ]</a>
              <a href="thread.html#3352">[ thread ]</a>
              <a href="subject.html#3352">[ subject ]</a>
              <a href="author.html#3352">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I have found two simple benchmark on the genshi site.
The basic benchmark is not a good benchmark, since the tests are not all 
equivalent.

I have added a test for Nevow (the patch is attached).
Before sending the patch to the genshi developers, I want to be sure 
that the code is the best possible.

Here is the results:

basic
=====

Django: 1.35 ms
Cheetah: 0.64 ms
Nevow: 1.88 ms


bigtable
========

Djange template                               370.68 ms
Nevow                                         947.84 ms




Thanks and regards  Manlio Perillo
-------------- next part --------------
Index: bigtable.py
===================================================================
--- bigtable.py	(revisione 565)
+++ bigtable.py	(copia locale)
@@ -9,10 +9,14 @@
 import sys
 import timeit
 from StringIO import StringIO
-from genshi.builder import tag
-from genshi.template import MarkupTemplate
 
 try:
+    from genshi.builder import tag
+    from genshi.template import MarkupTemplate
+except ImportError:
+    MarkupTemplate = None
+
+try:
     from elementtree import ElementTree as et
 except ImportError:
     et = None
@@ -45,10 +49,16 @@
 except ImportError:
     MyghtyInterpreter = None
 
+try:
+    from nevow import inevow, rend, loaders
+except ImportError:
+    inevow = None
+
 table = [dict(a=1,b=2,c=3,d=4,e=5,f=6,g=7,h=8,i=9,j=10)
           for x in range(1000)]
 
-genshi_tmpl = MarkupTemplate(&quot;&quot;&quot;
+if MarkupTemplate:
+    genshi_tmpl = MarkupTemplate(&quot;&quot;&quot;
 &lt;table xmlns:py=&quot;<A HREF="http://genshi.edgewall.org/&quot;">http://genshi.edgewall.org/&quot;</A>&gt;
 &lt;tr py:for=&quot;row in table&quot;&gt;
 &lt;td py:for=&quot;c in row.values()&quot; py:content=&quot;c&quot;/&gt;
@@ -56,7 +66,7 @@
 &lt;/table&gt;
 &quot;&quot;&quot;)
 
-genshi_tmpl2 = MarkupTemplate(&quot;&quot;&quot;
+    genshi_tmpl2 = MarkupTemplate(&quot;&quot;&quot;
 &lt;table xmlns:py=&quot;<A HREF="http://genshi.edgewall.org/&quot;">http://genshi.edgewall.org/&quot;</A>&gt;$table&lt;/table&gt;
 &quot;&quot;&quot;)
 
@@ -184,11 +194,44 @@
 &lt;/table&gt;&quot;&quot;&quot;)
         cs.render()
 
+if inevow:
+    class NevowPage(rend.Page):
+        docFactory = loaders.xmlstr(&quot;&quot;&quot;
+&lt;table xmlns:n=&quot;<A HREF="http://nevow.com/ns/nevow/0.1&quot;">http://nevow.com/ns/nevow/0.1&quot;</A> n:render=&quot;table&quot;&gt;
+  &lt;tr n:pattern=&quot;row&quot;&gt;
+    &lt;td n:pattern=&quot;col&quot;&gt;&lt;n:slot name=&quot;item&quot; /&gt;&lt;/td&gt;
+  &lt;/tr&gt;
+&lt;/table&gt;&quot;&quot;&quot;)
 
+        def render_table(self, ctx, data):
+            tag = ctx.tag
+            l = []
+            rowPattern = tag.patternGenerator('row')
+            
+            for row in table:
+                tr = rowPattern()
+                colPattern = tr.patternGenerator('col')
+                ll = []
+                
+                for col in row.values():
+                    td = colPattern()
+                    td.fillSlots('item', col)
+                    ll.append(td)
+
+                l.append(tr[ll])
+
+            return tag[l]
+
+    def test_nevow():
+        &quot;&quot;&quot;Nevow&quot;&quot;&quot;
+        
+        NevowPage().renderSynchronously()
+
+
 def run(which=None, number=10):
     tests = ['test_builder', 'test_genshi', 'test_genshi_builder', 'test_myghty', 'test_kid',
              'test_kid_et', 'test_et', 'test_cet', 'test_clearsilver',
-             'test_django']
+             'test_django', 'test_nevow']
 
     if which:
         tests = filter(lambda n: n[5:] in which, tests)
Index: basic.py
===================================================================
--- basic.py	(revisione 565)
+++ basic.py	(copia locale)
@@ -4,7 +4,7 @@
 import sys
 import timeit
 
-__all__ = ['clearsilver', 'myghty', 'django', 'kid', 'genshi', 'cheetah']
+__all__ = ['clearsilver', 'myghty', 'django', 'kid', 'genshi', 'cheetah', 'nevow']
 
 def genshi(dirname, verbose=False):
     from genshi.template import TemplateLoader
@@ -105,11 +105,48 @@
     return render
 
 def nevow(dirname, verbose=False):
-    # FIXME: can't figure out the API
-    from nevow.loaders import xmlfile
-    template = xmlfile('template.xml', templateDir=dirname).load()
+    from nevow import rend, loaders
+
+
+    class Base(rend.Page):
+        docFactory = loaders.xmlfile('template.xhtml', templateDir=dirname)
+        template = None # The template to be used, in derived class
+        
+        def render_title(self, ctx, data):
+            return 'Just a test'
+
+        def macro_main(self, ctx):
+            return ctx.tag[
+                loaders.xmlfile(self.template, ignoreDocType=True, templateDir=dirname)
+                ]
+
+    class Main(Base):
+        template = 'main.xhtml'
+
+        def __init__(self, items):
+            self.items = items
+            
+        def render_loop(self, ctx, data):
+            tag = ctx.tag
+            if not self.items:
+                return tag
+
+            l = []
+            itemPattern = tag.patternGenerator('item')
+
+            for item in self.items:
+                li = itemPattern()
+                li.fillSlots('item', item)
+                l.append(li)
+
+            l[-1].attributes['class'] = 'last'
+            return tag[l]
+
+
+    root = Main(['Number %d' % num for num in range(1, 15)])
+    
     def render():
-        print template
+        return root.renderSynchronously()
 
     if verbose:
         print render()
Index: nevow/main.xhtml
===================================================================
--- nevow/main.xhtml	(revisione 0)
+++ nevow/main.xhtml	(revisione 0)
@@ -0,0 +1,10 @@
+&lt;!DOCTYPE html
+          PUBLIC &quot;-//W3C//DTD XHTML 1.0 Strict//EN&quot;
+          &quot;<A HREF="http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd&quot;">http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd&quot;</A>&gt;
+&lt;n:invisible xmlns=&quot;<A HREF="http://www.w3.org/1999/xhtml&quot;">http://www.w3.org/1999/xhtml&quot;</A>
+             xmlns:n=&quot;<A HREF="http://nevow.com/ns/nevow/0.1&quot;">http://nevow.com/ns/nevow/0.1&quot;</A>&gt;
+  &lt;h2&gt;Loop&lt;/h2&gt;
+  &lt;ul n:render=&quot;loop&quot;&gt;
+    &lt;li n:pattern=&quot;item&quot;&gt;&lt;n:slot name=&quot;item&quot; /&gt;&lt;/li&gt;
+  &lt;/ul&gt;
+&lt;/n:invisible&gt;

Propriet&#224; modificate su: nevow/main.xhtml
___________________________________________________________________
Nome: svn:keywords
   + Id

Index: nevow/template.xhtml
===================================================================
--- nevow/template.xhtml	(revisione 0)
+++ nevow/template.xhtml	(revisione 0)
@@ -0,0 +1,20 @@
+&lt;!DOCTYPE html 
+          PUBLIC &quot;-//W3C//DTD XHTML 1.0 Strict//EN&quot;
+          &quot;<A HREF="http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd&quot;">http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd&quot;</A>&gt;
+&lt;html xmlns=&quot;<A HREF="http://www.w3.org/1999/xhtml&quot;">http://www.w3.org/1999/xhtml&quot;</A>
+      xmlns:n=&quot;<A HREF="http://nevow.com/ns/nevow/0.1&quot;">http://nevow.com/ns/nevow/0.1&quot;</A> 
+      lang=&quot;en&quot;&gt;
+  &lt;head&gt;
+    &lt;title n:render=&quot;title&quot; /&gt;
+  &lt;/head&gt;
+
+  &lt;body&gt;
+    &lt;div id=&quot;header&quot;&gt;
+      &lt;h1 n:render=&quot;title&quot; /&gt;
+    &lt;/div&gt;
+
+    &lt;n:invisible n:macro=&quot;main&quot; /&gt;
+
+    &lt;div id=&quot;footer&quot;&gt;&lt;/div&gt;
+  &lt;/body&gt;
+&lt;/html&gt;

Propriet&#224; modificate su: nevow/template.xhtml
___________________________________________________________________
Nome: svn:keywords
   + Id

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003351.html">[Twisted-web] excess-transports-1938-3 fixes athena problem with IE7
</A></li>
	
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3352">[ date ]</a>
              <a href="thread.html#3352">[ thread ]</a>
              <a href="subject.html#3352">[ subject ]</a>
              <a href="author.html#3352">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
