<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] HTTP POST from SMTP server
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20HTTP%20POST%20from%20SMTP%20server&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003586.html">
   <LINK REL="Next"  HREF="003582.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] HTTP POST from SMTP server</H1>
    <B>James Brady</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20HTTP%20POST%20from%20SMTP%20server&In-Reply-To="
       TITLE="[Twisted-web] HTTP POST from SMTP server">rent.lupin.road at gmail.com
       </A><BR>
    <I>Sat Dec  8 17:54:45 EST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="003586.html">[Twisted-web] nevow athena version 9.0 vs later
</A></li>
        <LI>Next message: <A HREF="003582.html">[Twisted-web] HTTP POST from SMTP server
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3581">[ date ]</a>
              <a href="thread.html#3581">[ thread ]</a>
              <a href="subject.html#3581">[ subject ]</a>
              <a href="author.html#3581">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi all,
I'm a complete Twisted newcomer, so still getting to grips with the ways
thing work..

What I'm trying to do is submit a POST request when I receive email into my
SMTP server.

At the moment, I've basically modified emailserver.tac from the examples (
<A HREF="http://twistedmatrix.com/projects/mail/documentation/examples/emailserver.t=">http://twistedmatrix.com/projects/mail/documentation/examples/emailserver.t=</A>
ac
)

My eomReceived message has this code added to it:
...
        client =3D getPage(url=3D'<A HREF="http://localhost:8080/message_event_notif=">http://localhost:8080/message_event_notif=</A>
y',
method=3D'POST',
            postdata=3Durlencode(postdata),
            headers=3D{ 'Content-Type': 'application/x-www-form-urlencoded'=
 }
)
        client.addCallback(self.success)
        client.addErrback(self.failure)
        reactor.run()

...

The POST request is received and processed as expected, and the success
method is invoked, but then the server stacktraces and halts, while the SMTP
sender client never completes. The server stacktrace:
2007/12/08 23:50 +0100 [SMTP,0,127.0.0.1] (Port 2500 Closed)
2007/12/08 23:50 +0100 [SMTP,0,127.0.0.1] Stopping factory
&lt;__builtin__.Smtp2HttpFactory instance at 0x13a4e68&gt;
2007/12/08 23:50 +0100 [HTTPPageGetter,client] Stopping factory
&lt;HTTPClientFactory: <A HREF="http://localhost:8080/message_event_notify">http://localhost:8080/message_event_notify</A>&gt;
2007/12/08 23:50 +0100 [SMTP,0,127.0.0.1] Main loop terminated.
2007/12/08 23:50 +0100 [SMTP,0,127.0.0.1] Unhandled Error
        Traceback (most recent call last):
          File
&quot;/Library/Frameworks/Python.framework/Versions/2.5/lib/python2.5/site-packa=
ges/twisted/application/app.py&quot;,
line 113, in runReactorWithLogging
            reactor.run()
          File
&quot;/Library/Frameworks/Python.framework/Versions/2.5/lib/python2.5/site-packa=
ges/twisted/internet/posixbase.py&quot;,
line 220, in run
            self.mainLoop()
          File
&quot;/Library/Frameworks/Python.framework/Versions/2.5/lib/python2.5/site-packa=
ges/twisted/internet/posixbase.py&quot;,
line 231, in mainLoop
            self.doIteration(t)
          File
&quot;/Library/Frameworks/Python.framework/Versions/2.5/lib/python2.5/site-packa=
ges/twisted/internet/selectreactor.py&quot;,
line 133, in doSelect
            _logrun(selectable, _drdw, selectable, method, dict)
        --- &lt;exception caught here&gt; ---
          File
&quot;/Library/Frameworks/Python.framework/Versions/2.5/lib/python2.5/site-packa=
ges/twisted/python/log.py&quot;,
line 48, in callWithLogger
            return callWithContext({&quot;system&quot;: lp}, func, *args, **kw)
          File
&quot;/Library/Frameworks/Python.framework/Versions/2.5/lib/python2.5/site-packa=
ges/twisted/python/log.py&quot;,
line 33, in callWithContext
            return context.call({ILogContext: newCtx}, func, *args, **kw)
          File
&quot;/Library/Frameworks/Python.framework/Versions/2.5/lib/python2.5/site-packa=
ges/twisted/python/context.py&quot;,
line 59, in callWithContext
            return self.currentContext().callWithContext(ctx, func, *args,
**kw)
          File
&quot;/Library/Frameworks/Python.framework/Versions/2.5/lib/python2.5/site-packa=
ges/twisted/python/context.py&quot;,
line 37, in callWithContext
            return func(*args,**kw)
          File
&quot;/Library/Frameworks/Python.framework/Versions/2.5/lib/python2.5/site-packa=
ges/twisted/internet/selectreactor.py&quot;,
line 149, in _doReadOrWrite
            self._disconnectSelectable(selectable, why, method=3D=3D&quot;doRead=
&quot;)
          File
&quot;/Library/Frameworks/Python.framework/Versions/2.5/lib/python2.5/site-packa=
ges/twisted/internet/posixbase.py&quot;,
line 258, in _disconnectSelectable
            selectable.connectionLost(failure.Failure(why))
          File
&quot;/Library/Frameworks/Python.framework/Versions/2.5/lib/python2.5/site-packa=
ges/twisted/internet/tcp.py&quot;,
line 411, in connectionLost
            self._closeSocket()
          File
&quot;/Library/Frameworks/Python.framework/Versions/2.5/lib/python2.5/site-packa=
ges/twisted/internet/tcp.py&quot;,
line 100, in _closeSocket
            skt =3D self.socket
        exceptions.AttributeError: 'Server' object has no attribute 'socket'

2007/12/08 23:50 +0100 [-] Main loop terminated.
2007/12/08 23:50 +0100 [-] Server Shut Down.


Does anyone have any suggestions?

Thanks,
James
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://twistedmatrix.com/pipermail/twisted-web/attachments/20071208/dd=">http://twistedmatrix.com/pipermail/twisted-web/attachments/20071208/dd=</A>
5cd58b/attachment-0001.htm
</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003586.html">[Twisted-web] nevow athena version 9.0 vs later
</A></li>
	<LI>Next message: <A HREF="003582.html">[Twisted-web] HTTP POST from SMTP server
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3581">[ date ]</a>
              <a href="thread.html#3581">[ thread ]</a>
              <a href="subject.html#3581">[ subject ]</a>
              <a href="author.html#3581">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
