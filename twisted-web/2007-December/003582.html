<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] HTTP POST from SMTP server
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20HTTP%20POST%20from%20SMTP%20server&In-Reply-To=eb27b680712081454p41e7c241p7437c02032fd9e6f%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003581.html">
   <LINK REL="Next"  HREF="003584.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] HTTP POST from SMTP server</H1>
    <B>Jean-Paul Calderone</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20HTTP%20POST%20from%20SMTP%20server&In-Reply-To=eb27b680712081454p41e7c241p7437c02032fd9e6f%40mail.gmail.com"
       TITLE="[Twisted-web] HTTP POST from SMTP server">exarkun at divmod.com
       </A><BR>
    <I>Sat Dec  8 18:02:15 EST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="003581.html">[Twisted-web] HTTP POST from SMTP server
</A></li>
        <LI>Next message: <A HREF="003584.html">[Twisted-web] HTTP POST from SMTP server
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3582">[ date ]</a>
              <a href="thread.html#3582">[ thread ]</a>
              <a href="subject.html#3582">[ subject ]</a>
              <a href="author.html#3582">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Sat, 8 Dec 2007 22:54:45 +0000, James Brady &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">rent.lupin.road at gmail.com</A>&gt; wrote:
&gt;<i>Hi all,
</I>&gt;<i>I'm a complete Twisted newcomer, so still getting to grips with the ways
</I>&gt;<i>thing work..
</I>&gt;<i>
</I>&gt;<i>What I'm trying to do is submit a POST request when I receive email into my
</I>&gt;<i>SMTP server.
</I>&gt;<i>
</I>&gt;<i>At the moment, I've basically modified emailserver.tac from the examples (
</I>&gt;<i><A HREF="http://twistedmatrix.com/projects/mail/documentation/examples/emailserver.tac">http://twistedmatrix.com/projects/mail/documentation/examples/emailserver.tac</A>
</I>&gt;<i>)
</I>&gt;<i>
</I>&gt;<i>My eomReceived message has this code added to it:
</I>&gt;<i>...
</I>&gt;<i>        client = getPage(url='<A HREF="http://localhost:8080/message_event_notify',">http://localhost:8080/message_event_notify',</A>
</I>&gt;<i>method='POST',
</I>&gt;<i>            postdata=urlencode(postdata),
</I>&gt;<i>            headers={ 'Content-Type': 'application/x-www-form-urlencoded' }
</I>&gt;<i>)
</I>&gt;<i>        client.addCallback(self.success)
</I>&gt;<i>        client.addErrback(self.failure)
</I>&gt;<i>        reactor.run()
</I>&gt;<i>
</I>
You don't need to call reactor.run() here - the reactor is already running
(that's how the SMTP server works, after all).  In fact, you can't call
reactor.run() here - the reactor mainloop is not reentrant.

Instead, you probably want to return the &quot;client&quot; Deferred from eomReceived.
The SMTP protocol code will use that Deferred to know when to indicate to
the SMTP client which is talking to it when the message has been delivered
successful or if there is an error.

Jean-Paul

</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003581.html">[Twisted-web] HTTP POST from SMTP server
</A></li>
	<LI>Next message: <A HREF="003584.html">[Twisted-web] HTTP POST from SMTP server
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3582">[ date ]</a>
              <a href="thread.html#3582">[ thread ]</a>
              <a href="subject.html#3582">[ subject ]</a>
              <a href="author.html#3582">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
