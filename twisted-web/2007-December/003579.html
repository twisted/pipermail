<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] nevow athena version 9.0 vs later
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20nevow%20athena%20version%209.0%20vs%20later&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   
   <LINK REL="Next"  HREF="003580.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] nevow athena version 9.0 vs later</H1>
    <B>&#1052;&#1080;&#1093;&#1072;&#1080;&#1083; &#1052;&#1080;&#1093;&#1072;&#1081;&#1083;&#1086;&#1074;</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20nevow%20athena%20version%209.0%20vs%20later&In-Reply-To="
       TITLE="[Twisted-web] nevow athena version 9.0 vs later">mihailovmv77 at gmail.com
       </A><BR>
    <I>Sat Dec  8 16:43:31 EST 2007</I>
    <P><UL>
        
        <LI>Next message: <A HREF="003580.html">[Twisted-web] nevow athena version 9.0 vs later
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3579">[ date ]</a>
              <a href="thread.html#3579">[ thread ]</a>
              <a href="subject.html#3579">[ subject ]</a>
              <a href="author.html#3579">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi

my example consists 2 files: aacc_web.py and aacc_web.js

python aacc_web.py
will start on port 8080

generated html contains textarea and in case of input
prints the entered symbol on the console and in textarea
It works ONLY in version 9.0 and does NOT (!) work in last versions

Explain what's wrong


---------------------------------------------------------------------------=
-------------------------------------------------------

aacc_web.js

//import Nevow.Athena
function keypress(event)
{
    var key =3D event.charCode ? event.charCode : event.keyCode
    var node =3D $(&quot;termid&quot;);
    Nevow.Athena.Widget.get(node).callRemote(&quot;aacc_keypress&quot;, event.charCod=
e,
event.keyCode, event.metaKey, event.altKey, event.ctrlKey, event.shiftKey);
}

AaccWeb.Users =3D Nevow.Athena.Widget.subclass(&quot;AaccWeb.Users&quot;);
AaccWeb.Users.methods(

    function start(self, node, event) {
        self.callRemote(&quot;aacc_start&quot;);
        return false;
    },
    function showConference(self, toWhat) {
        var client_data =3D Nevow.Athena.NodeByAttribute(self.node, &quot;class&quot;,
&quot;Users&quot;);
        client_data.innerHTML =3D toWhat;
    }
);

---------------------------------------------------------------------------=
-------------------------------------------------------
aacc_web.py code

# -*- coding: utf-8 -*-
&quot;&quot;&quot; aacc_web
&quot;&quot;&quot;

from twisted.application import service, internet
from twisted.internet import reactor, protocol, defer, task, ssl
from twisted.protocols import basic
from twisted.python import log, logfile, util
from twisted.cred import portal, checkers, credentials
from twisted.web import static

from nevow import appserver
from nevow import tags, guard
from nevow import rend, loaders, inevow, athena
from nevow import url
from nevow.inevow import IRequest

import os, logging, pprint, time, sys


class Users(athena.LiveFragment):
    jsClass =3D u&quot; AaccWeb.Users&quot;

    docFactory =3D loaders.xmlstr(&quot;&quot;&quot;
&lt;div xmlns:nevow=3D&quot;<A HREF="http://nevow.com/ns/nevow/0.1&quot;">http://nevow.com/ns/nevow/0.1&quot;</A>
   xmlns:athena=3D&quot; <A HREF="http://divmod.org/ns/athena/0.7&quot;">http://divmod.org/ns/athena/0.7&quot;</A>
   nevow:render=3D&quot;liveFragment&quot; class=3D&quot;Users&quot;&gt;
&lt;/div&gt;
&quot;&quot;&quot;)

    running =3D False

    def __init__(self, **kwargs):
        print 'start Users AJAX session'

    def aacc_start(self):
        if self.running:
            return
        reactor.callLater(1, self.updateConference, True)
        self.running =3D True
    athena.expose(aacc_start)

    def aacc_keypress(self, charcode, keycode, metakey, altkey, ctrlkey,
shiftkey):
        print 'charcode: %s keycode: %s metakey: %s altkey: %s ctrlkey: %s
shiftkey: %s' % (charcode, keycode, metakey, altkey, ctrlkey, shiftkey)
        self.updateConference(True, unichr(charcode))
    athena.expose(aacc_keypress)

    def updateConference(self, force=3DFalse, sym=3D''):
        &quot;&quot;&quot; updateConference &quot;&quot;&quot;
        #print 'updateConference'
        def onUpdateConferenceOk(result):
            self.callUpdateConference =3D reactor.callLater(1,
self.updateConference)
        def onUpdateConferenceErr(err):
            self.running =3D False

        if not force:
            self.callUpdateConference =3D reactor.callLater(1,
self.updateConference)
            return

        mystr =3D u&quot;&quot;&quot;&lt;textarea id=3D&quot;termid&quot; cols=3D&quot;10&quot; rows=3D&quot;5&quot;
onkeypress=3D&quot;return keypress(event)&quot;&gt;&quot;&quot;&quot; + sym + u&quot;&quot;&quot;&lt;/textarea&gt;&quot;&quot;&quot;

        #self.callRemote('setFocus')
        df =3D self.callRemote('showConference', mystr)
        df.addCallbacks(onUpdateConferenceOk, onUpdateConferenceErr)

class ConferencePage(athena.LivePage ):

    docFactory =3D loaders.xmlstr(&quot;&quot;&quot;
&lt;!DOCTYPE html PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot;
&quot;<A HREF="http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd</A>
&quot;&gt;
&lt;html xmlns:nevow=3D&quot;<A HREF="http://nevow.com/ns/nevow/0.1&quot;">http://nevow.com/ns/nevow/0.1&quot;</A>&gt;
    &lt;head&gt;
        &lt;meta http-equiv=3D&quot;Content-Type&quot; content=3D&quot;text/html; charset=3Du=
tf-8&quot;
/&gt;
        &lt;nevow:invisible nevow:render=3D&quot;liveglue&quot;/&gt;
        &lt;script type=3D&quot;text/javascript&quot; src=3D&quot;aacc_web.js&quot;&gt;
        &lt;/script&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;div nevow:render=3D&quot;conference&quot;&gt;
        &lt;/div&gt;
    &lt;/body&gt;
&lt;/html&gt;
&quot;&quot;&quot;)

    def __init__(self, *a, **kw):
        super(ConferencePage, self).__init__(*a, **kw)
        self.jsModules.mapping[u'AaccWeb'] =3D util.sibpath(__file__,
'aacc_web.js')

    addSlash =3D True

    def render_liveglue(self, ctx, data):
        req =3D ctx.locate(IRequest)
        args =3D dict([(k,v[0]) for (k,v) in req.args.items()])
        self.args =3D args
        return athena.LivePage.render_liveglue(self, ctx, data)

    def render_conference(self, ctx, data):
        args =3D dict([(k,v) for (k,v) in self.args.items ()])
        c =3D Users(**args)
        c.page =3D self
        reactor.callLater(0, c.aacc_start)
        return ctx.tag[c]

class RootPage(rend.Page):
    &quot;&quot;&quot; &quot;&quot;&quot;
    addSlash =3D True
    docFactory =3D loaders.xmlstr(&quot;&quot;&quot;
&lt;html xmlns:nevow=3D&quot;<A HREF="http://nevow.com/ns/nevow/0.1&quot;">http://nevow.com/ns/nevow/0.1&quot;</A>&gt;
    &lt;body&gt;
    &lt;/body&gt;
&lt;/html&gt;
&quot;&quot;&quot;)

    def renderHTTP(self, ctx):
        print 'render of root page'
        req =3D ctx.locate(IRequest)
        my_url =3D url.here.child('conference')
        return my_url

    def child_conference(self, ctx):
        return ConferencePage()


class aacc_web:
    &quot;&quot;&quot; &quot;&quot;&quot;

    def __init__(self, **kwargs):
        &quot;&quot;&quot; &quot;&quot;&quot;
        resource =3D RootPage()
        site =3D appserver.NevowSite(resource)
        reactor.listenTCP(8080, site)


if __name__ =3D=3D &quot;__main__&quot;:
    aacc_web =3D aacc_web()
    reactor.run()

---------------------------------------------------------------------------=
-------------------------------------------------------

Mike
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://twistedmatrix.com/pipermail/twisted-web/attachments/20071209/0d=">http://twistedmatrix.com/pipermail/twisted-web/attachments/20071209/0d=</A>
499f69/attachment.htm
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	
	<LI>Next message: <A HREF="003580.html">[Twisted-web] nevow athena version 9.0 vs later
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3579">[ date ]</a>
              <a href="thread.html#3579">[ thread ]</a>
              <a href="subject.html#3579">[ subject ]</a>
              <a href="author.html#3579">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
