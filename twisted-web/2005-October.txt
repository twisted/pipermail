From andrea at cpushare.com  Sun Oct  2 09:25:05 2005
From: andrea at cpushare.com (Andrea Arcangeli)
Date: Sun Oct  2 09:25:12 2005
Subject: [Twisted-web] passClient for
	ReverseProxyResource/VHostMonsterResource
Message-ID: <20051002152505.GC16345@opteron.random>

Hello,

I need a new (optional) feature in the
ReverseProxyResource/VHostMonsterResource protocol. It's optional
because I doubt the reverse proxy of other packages could support it
without upgrades. I only had to add "passClient = True" as parameter to
ReverseProxyResource and VHostMonsterResource to enable it (two liner
patch to my code).

In short this passes the client ip and port from the reverse proxy
server to the vmonster resource, this way the nevow server that receives
the proxy connection knows who has connected to the proxy and it can
react accordingly. This is needed to really allow putting more nevow
servers transparently behind the same port, one of my nevow apps really
needed to know the ip of the connecting client.

Cross posting to both lists because it has two different parts, the
first is the Nevow part and the second is the Twisted part.  This code
is online right now and no problems so far (if you see any problem let
me know ;).

Here the Nevow part:

Index: Nevow/nevow/vhost.py
===================================================================
--- Nevow/nevow/vhost.py	(revision 1788)
+++ Nevow/nevow/vhost.py	(working copy)
@@ -134,13 +134,15 @@
     *after* it returns the (resource,segments) tuple.
     """
     implements(inevow.IResource)
+
+    def __init__(self, vhost_segments):
+        self.prepath_segments = vhost_segments+1 # +1 is for /vhost
+
     def locateChild(self, ctx, segments):
         request = inevow.IRequest(ctx)
-        request.prepath = request.prepath[3:]
+        request.prepath = request.prepath[self.prepath_segments:]
         return request.site.resource, segments
 
-_prepathCleaner = _VHostMonsterResourcePrepathCleaner()
-
 class VHostMonsterResource:
     """VHostMonster resource that helps to deploy a Nevow site behind a proxy.
     
@@ -173,14 +175,27 @@
 
     This also means your private server should serve the real content at
     /foo/bar, and not at the root of the tree.
+
+    If passClient is set to True it expects the client to be passed by the
+    proxy (see ReverseProxyResource passClient parameter for details). When
+    passClient is True this page should not be reacheable directly from the
+    internet if logging the IP address and port securely is needed.
     """
     implements(inevow.IResource)
 
+    vhost_segments = 2
+
+    def __init__(self, passClient = False):
+        self.passClient = passClient
+        if passClient:
+            self.vhost_segments = 3
+        self._prepathCleaner = _VHostMonsterResourcePrepathCleaner(self.vhost_segments)
+
     def locateChild(self, ctx, segments):
 
         request = inevow.IRequest(ctx)
 
-        if len(segments) < 2:
+        if len(segments) < self.vhost_segments:
             return rend.NotFound
         else:
             if segments[0] == 'http':
@@ -193,13 +208,18 @@
                 port = int(port)
             else:
                 host, port = segments[1], 80
-           
             request.setHost(host, port)
 
-            prefixLen = len('/'+'/'.join(request.prepath)+'/'+'/'.join(segments[:2]))
-            request.path = '/'+'/'.join(segments[2:])
+            if self.passClient:
+                if ':' not in segments[2]:
+                    return rend.NotFound
+                host, port = segments[2].split(':')
+                request.setClient(host, port)
+
+            prefixLen = len('/'+'/'.join(request.prepath)+'/'+'/'.join(segments[:self.vhost_segments]))
+            request.path = '/'+'/'.join(segments[self.vhost_segments:])
             request.uri = request.uri[prefixLen:]
 
-            return _prepathCleaner, segments[2:]
+            return self._prepathCleaner, segments[self.vhost_segments:]
         
 compy.backwardsCompatImplements(VHostMonsterResource)



Here the twisted part:

Index: Twisted/twisted/web/http.py
===================================================================
--- Twisted/twisted/web/http.py	(revision 14534)
+++ Twisted/twisted/web/http.py	(working copy)
@@ -876,6 +876,10 @@
         self.received_headers["host"] = host
         self.host = address.IPv4Address("TCP", host, port)
 
+    def setClient(self, host, port):
+        """Same as setHost but for the client address"""
+        self.client = address.IPv4Address("TCP", host, port)
+
     def getClientIP(self):
         if isinstance(self.client, address.IPv4Address):
             return self.client.host
Index: Twisted/twisted/web/proxy.py
===================================================================
--- Twisted/twisted/web/proxy.py	(revision 14534)
+++ Twisted/twisted/web/proxy.py	(working copy)
@@ -160,23 +160,33 @@
     to a different server.
     """
 
-    def __init__(self, host, port, path):
+    def __init__(self, host, port, path, passClient = False):
         resource.Resource.__init__(self)
         self.host = host
         self.port = port
         self.path = path
+        self.passClient = passClient
 
+    def getPath(self, request):
+        path = self.path
+        if self.passClient:
+            path += '/%s:%d' % (request.client.host, request.client.port)
+        return path
+
     def getChild(self, path, request):
-        return ReverseProxyResource(self.host, self.port, self.path+'/'+path)
+        return ReverseProxyResource(self.host, self.port, self.getPath(request)+'/'+path, False)
 
     def render(self, request):
         request.received_headers['host'] = self.host
         request.content.seek(0, 0)
+
+        path = self.getPath(request)
+
         qs = urlparse.urlparse(request.uri)[4]
         if qs:
-            rest = self.path + '?' + qs
+            rest = path + '?' + qs
         else:
-            rest = self.path
+            rest = path
         clientFactory = ProxyClientFactory(request.method, rest, 
                                      request.clientproto, 
                                      request.getAllHeaders(),

From andy at thecablelounge.com  Mon Oct  3 02:02:02 2005
From: andy at thecablelounge.com (Andy Gayton)
Date: Mon Oct  3 02:02:10 2005
Subject: [Twisted-web] Patch for athena branch: LivePageFactory
Message-ID: <4340E57A.9000504@thecablelounge.com>

Athena livepage instances need to be unique for each page render.

This patch addresses controlling creation of livepage instances by 
introducing a LivePageFactory.  Instead of having child_ etc directly 
return a livepage instance, they should request a persistent 
LivePageFactory for an instance.

eg:

def child_aLivePageInstancePlease(self, context):
	return aPersistentLivePageFactory.clientFactory(context)

When a livepage instance renders, it registers itself with its factory. 
  Each instance has an id. All client server remote calls carry this id 
so that the factory can return the correct livepage instance to handle 
an incoming request.

An example use is at: svn://twisted.cablelounge.com/sandbox/athena/chatola

Andy.
-------------- next part --------------
A non-text attachment was scrubbed...
Name: athena.livePageFactory.patch
Type: text/x-patch
Size: 3409 bytes
Desc: not available
Url : http://twistedmatrix.com/pipermail/twisted-web/attachments/20051003/ff778a85/athena.livePageFactory.bin
From alberto.trujillo at ucd.ie  Mon Oct  3 09:13:22 2005
From: alberto.trujillo at ucd.ie (Alberto Trujillo)
Date: Mon Oct  3 09:09:41 2005
Subject: [Twisted-web] LivePage in templates
Message-ID: <43414A92.1080702@ucd.ie>

Hi:
I'm trying to understand how works LivePage, but everything is very 
confuse and I'm listening that a lot of changes are happening in LivePage.
Could anybody give me a little idea, tutorial, o explanation about 
LivePage, and how can I use LivePage in the templates, I mean with out 
using Stan.

Thanks in advance.

From exarkun at divmod.com  Mon Oct  3 09:24:09 2005
From: exarkun at divmod.com (Jp Calderone)
Date: Mon Oct  3 09:24:11 2005
Subject: [Twisted-web] LivePage in templates
In-Reply-To: <43414A92.1080702@ucd.ie>
Message-ID: <20051003152409.3914.1100610282.divmod.quotient.23588@ohm>

On Mon, 03 Oct 2005 16:13:22 +0100, Alberto Trujillo <alberto.trujillo@ucd.ie> wrote:
>Hi:
>I'm trying to understand how works LivePage, but everything is very confuse 
>and I'm listening that a lot of changes are happening in LivePage.
>Could anybody give me a little idea, tutorial, o explanation about LivePage, 
>and how can I use LivePage in the templates, I mean with out using Stan.
>
>Thanks in advance.
>

There's pretty much just one requirement.  You need to invoke the "liveglue" renderer:

    <html namespace junk>
        <head><nevow:invisible nevow:render="liveglue" /></head>
        ...
    </html>

Sprinkle with Javascript to taste.  The current client-side API is "server.handle('name', ...)" (no return value).  The API under development will most likely turn out as "server.callRemote('name', ...')" with a Deferred as the return value.

Jp

From alberto.trujillo at ucd.ie  Mon Oct  3 10:32:22 2005
From: alberto.trujillo at ucd.ie (Alberto Trujillo)
Date: Mon Oct  3 10:28:39 2005
Subject: [Twisted-web] LivePage in templates
In-Reply-To: <20051003152409.3914.1100610282.divmod.quotient.23588@ohm>
References: <20051003152409.3914.1100610282.divmod.quotient.23588@ohm>
Message-ID: <43415D16.9080909@ucd.ie>

Thank you very much for this, because I didn't know anything about that. 
I'll try to put in practise, althoug if you could send me a completed 
example to know how is working would be great.

Thanks again.


Jp Calderone wrote:

> On Mon, 03 Oct 2005 16:13:22 +0100, Alberto Trujillo 
> <alberto.trujillo@ucd.ie> wrote:
>
>> Hi:
>> I'm trying to understand how works LivePage, but everything is very 
>> confuse and I'm listening that a lot of changes are happening in 
>> LivePage.
>> Could anybody give me a little idea, tutorial, o explanation about 
>> LivePage, and how can I use LivePage in the templates, I mean with 
>> out using Stan.
>>
>> Thanks in advance.
>>
>
> There's pretty much just one requirement.  You need to invoke the 
> "liveglue" renderer:
>
>    <html namespace junk>
>        <head><nevow:invisible nevow:render="liveglue" /></head>
>        ...
>    </html>
>
> Sprinkle with Javascript to taste.  The current client-side API is 
> "server.handle('name', ...)" (no return value).  The API under 
> development will most likely turn out as "server.callRemote('name', 
> ...')" with a Deferred as the return value.
>
> Jp
>
> _______________________________________________
> Twisted-web mailing list
> Twisted-web@twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web



From alberto.trujillo at ucd.ie  Tue Oct  4 08:38:01 2005
From: alberto.trujillo at ucd.ie (Alberto Trujillo)
Date: Tue Oct  4 08:34:25 2005
Subject: [Twisted-web] LivePage with out stan
Message-ID: <434293C9.2030002@ucd.ie>

Could anybody tell me how to use LivePage with out use Stan. I've been 
trying the last two days with out any result.
If somebody can show me a example I will appreciate it.

Thanks in advance.

From foom at fuhm.net  Wed Oct  5 13:08:37 2005
From: foom at fuhm.net (James Y Knight)
Date: Wed Oct  5 13:08:50 2005
Subject: [Twisted-web] Re: [Twisted-Python] When can I start using web2?
In-Reply-To: <20051005173226.GH5406@opteron.random>
References: <4343F008.6070805@polynode.com>
	<72070441-F307-49D0-9F62-7435EBCF8DF2@fuhm.net>
	<20051005173226.GH5406@opteron.random>
Message-ID: <77C2B05C-8E6A-4A32-B6B4-509ED1C666FC@fuhm.net>

[Please move conversation to the twisted-web mailing list, where it  
should've been to begin with]

On Oct 5, 2005, at 1:32 PM, Andrea Arcangeli wrote:
> Nevow has its own API, why should it even care about the underlying
> infrastructure, be it web or web2?

Nevow replaces and modifies much of the t.web infrastructure. Thus  
some parts are heavily dependent upon t.web as it is now.

> Just port nevow to web2, and then it should work, no? I don't like the
> idea that the nevow API will have to change.
>
> Or do you want to make the nevow API obsolete, and if so why and what
> was the problem with it? There are existing apps so I think it'd be
> quite important not to require changes to applications while moving  
> from
> web to web2. Best would be to have a switch in nevow, so the  
> application
> can decide if nevow should base itself on top of web or web2 at  
> runtime.

The solution of course is still up in the air, but my view is that  
two things should happen:
1) There _must_ be compatibility with the nevow resource API, similar  
to the already existing compatibility with resources written for the  
web1 resource API.
2) Nevow should aim to divorce itself from the resource API, just  
concerning itself with the rendering process. This would entail  
creating a new class similar to rend.Page but without having its own  
locateChild/renderHTTP, that can then be added into the class for the  
resource model of your framework of choice. I'm not exactly sure how  
that would work, though.

James

From andrea at cpushare.com  Wed Oct  5 16:41:38 2005
From: andrea at cpushare.com (Andrea Arcangeli)
Date: Wed Oct  5 16:41:45 2005
Subject: [Twisted-web] Re: [Twisted-Python] When can I start using web2?
In-Reply-To: <77C2B05C-8E6A-4A32-B6B4-509ED1C666FC@fuhm.net>
References: <4343F008.6070805@polynode.com>
	<72070441-F307-49D0-9F62-7435EBCF8DF2@fuhm.net>
	<20051005173226.GH5406@opteron.random>
	<77C2B05C-8E6A-4A32-B6B4-509ED1C666FC@fuhm.net>
Message-ID: <20051005224138.GL5406@opteron.random>

On Wed, Oct 05, 2005 at 03:08:37PM -0400, James Y Knight wrote:
> The solution of course is still up in the air, but my view is that  
> two things should happen:
> 1) There _must_ be compatibility with the nevow resource API, similar  
> to the already existing compatibility with resources written for the  
> web1 resource API.
> 2) Nevow should aim to divorce itself from the resource API, just  
> concerning itself with the rendering process. This would entail  
> creating a new class similar to rend.Page but without having its own  
> locateChild/renderHTTP, that can then be added into the class for the  
> resource model of your framework of choice. I'm not exactly sure how  
> that would work, though.

Ok. If there are technical reasons to prefer the web2 api rather than
keeping the compatibility layer by default, that's ok.

I just want to remind that breaking APIs will just hurt the nevow
userbase. Not a big deal for me since my project is quite maintained and
I even need and use features I wrote myself that aren't in any SVN yet,
but think about other projects that you write once and you may not want
having to maintain much over time: breaking APIs will hurt them. So if
we modify nevow API we should break it once for all, and try not having
to break it again, to give the project more strength and more confidence
to its users.

Thanks.

From alberto.trujillo at ucd.ie  Thu Oct  6 10:08:51 2005
From: alberto.trujillo at ucd.ie (Alberto Trujillo)
Date: Thu Oct  6 10:06:28 2005
Subject: [Twisted-web] Changing attribute tags with Live Page
Message-ID: <43454C13.9030405@ucd.ie>

Hello everybody:
I would like to know if it's possible to change the value attribute of a 
input tag with Live Page.
I have tried it in the following code, but in the final result looks 
like I'm inserting a input text inside the input text that I already 
have. Please, somebody could tell me how to fix this code.

    def render_selectExperiments(self, ctx, data):
        """Fill the select box that contain the experiments"""
        def expDetails(client, value):
            expDatas = self.mydatas(value)
            client.set('expName_form', tags.input(type="text", 
value=expDatas.name))
        hnd_expDetails = livepage.handler(expDetails, 
byId('experiments').value)
       
        ctx.fillSlots('onclick', hnd_expDetails)
        ctx.fillSlots('value', data.id)
        ctx.fillSlots('label', data.name)
        return ctx.tag


Thanks in advance.

From m.milvo at gmail.com  Sat Oct  8 08:48:16 2005
From: m.milvo at gmail.com (Michael M)
Date: Sat Oct  8 08:48:50 2005
Subject: [Twisted-web] LivePage with out stan
In-Reply-To: <434293C9.2030002@ucd.ie>
References: <434293C9.2030002@ucd.ie>
Message-ID: <3a767c390510080748k13af2abfqdbfcf526e407f833@mail.gmail.com>

Hi,
Why don't you want to use stan. Have you had a look at using the nevow
xml setup instead of using stan??

It would probably help a little bit if you could explain what you are
trying to do.

Cheers
Michael

On 10/4/05, Alberto Trujillo <alberto.trujillo@ucd.ie> wrote:
> Could anybody tell me how to use LivePage with out use Stan. I've been
> trying the last two days with out any result.
> If somebody can show me a example I will appreciate it.
>
> Thanks in advance.
>
> _______________________________________________
> Twisted-web mailing list
> Twisted-web@twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web
>

From tv at twistedmatrix.com  Sun Oct  9 04:36:36 2005
From: tv at twistedmatrix.com (Tommi Virtanen)
Date: Sun Oct  9 04:36:45 2005
Subject: [Twisted-web] Access control feature for web2
Message-ID: <4348F2B4.1050605@twistedmatrix.com>

Hi. My access control feature thingie needs review.
It's in Twisted/brances/tv/web2-access.

It also includes a bugfix+unittest for web2 context
lookup order, which differed from nevow, and was
not very useful.

Please to be readink.

From dreid at dreid.org  Sun Oct  9 14:34:34 2005
From: dreid at dreid.org (David Reid)
Date: Sun Oct  9 14:33:38 2005
Subject: [Twisted-web] Re: [Twisted-Python] When can I start using web2?
In-Reply-To: <77C2B05C-8E6A-4A32-B6B4-509ED1C666FC@fuhm.net>
References: <4343F008.6070805@polynode.com>
	<72070441-F307-49D0-9F62-7435EBCF8DF2@fuhm.net>
	<20051005173226.GH5406@opteron.random>
	<77C2B05C-8E6A-4A32-B6B4-509ED1C666FC@fuhm.net>
Message-ID: <1128890074.27630.10.camel@audrey.local>

[Oops, stupid search folders, I didn't notice I wasn't sending it to
twisted-web]

On Wed, 2005-10-05 at 12:48 -0400, James Y Knight wrote:

> > * File uploads.
> 
> Should work, needs documentationing. Summary: fileupload.py is the  
> low level functionality that you usually don't need to call
directly.  
> server.parsePOSTData is the "normal" interface into this system,  
> which is what resource.PostableResource calls when confronted with a  
> POST. It does what you want most of the time: incrementally parsing  
> the form fields into request.args and request.files, putting the  
> files in temp files on disk, with some limits on the file size  
> (customization of said limits should be pushed out to the toplevel  
> functions but hasn't been). request.args is a dict of {fieldname:  
> valuestring}, request.files is a dict of {fieldname: (filename,  
> content-type, TemporaryFile-instance)}.
> 

Also twisted.web2.static.FileSaver started off as just an example of
handling file uploads and turned into an attempt at a drop in resource
for handling them.  I tried to write it around what I percieved to be a
common use case, which was:
 
 * type limiting
 * size limiting
 * forcing permissions
 * globally unique filenames (FileSaver.makeUniqueName is easily
overrideable if the md5 of filename + the md5 of the time string isn't
sufficient or is overkill for your needs)

I'm not sure if it actually succeeded as more than an example, I don't
know that anyone is actively using it, and I'm rather surprised that
James failed to mention it, perhaps he forgot about it himself.

-David



From alberto.trujillo at ucd.ie  Mon Oct 10 03:10:25 2005
From: alberto.trujillo at ucd.ie (Alberto Trujillo)
Date: Mon Oct 10 03:08:42 2005
Subject: [Twisted-web] LivePage with out stan
In-Reply-To: <3a767c390510080748k13af2abfqdbfcf526e407f833@mail.gmail.com>
References: <434293C9.2030002@ucd.ie>
	<3a767c390510080748k13af2abfqdbfcf526e407f833@mail.gmail.com>
Message-ID: <434A3001.3060201@ucd.ie>

We don't want to use stan because we want to keep the html code 
separated in different files. Because in this way is easier to change 
the template, or make changes in the html file.
Anyway, want I need to know if is there is a way to change the values of 
the attributes in a tag object.
Now we have a form with select box that with event onclick has to change 
the values in the other field of the form, I've try it to change in the 
way that I know, but the result that I got is a input text inside the 
input text where I want to change the value, and even I after I can't 
edit the input text.
Here I send you the code to show you what I did.

    def render_selectExperiments(self, ctx, data):
        """Fill the select box that contain the experiments"""
        def expDetails(client, value):
            expDatas = self.mydatas(value)
            client.set('expName', expDatas.name)
            client.set('expType', expDatas.typeId)
            client.set('expDescription', expDatas.description)
          
            node = byId('expName_form')
            node.value = expDatas.name
            client.set('expName_form', node)
           
            client.set('expDescription_form', expDatas.description)
        hnd_expDetails = livepage.handler(expDetails, 
byId('experiments').value)


Thank you.

Michael M wrote:

>Hi,
>Why don't you want to use stan. Have you had a look at using the nevow
>xml setup instead of using stan??
>
>It would probably help a little bit if you could explain what you are
>trying to do.
>
>Cheers
>Michael
>
>On 10/4/05, Alberto Trujillo <alberto.trujillo@ucd.ie> wrote:
>  
>
>>Could anybody tell me how to use LivePage with out use Stan. I've been
>>trying the last two days with out any result.
>>If somebody can show me a example I will appreciate it.
>>
>>Thanks in advance.
>>
>>_______________________________________________
>>Twisted-web mailing list
>>Twisted-web@twistedmatrix.com
>>http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web
>>
>>    
>>
>
>_______________________________________________
>Twisted-web mailing list
>Twisted-web@twistedmatrix.com
>http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web
>  
>


From mary-twisted at puzzling.org  Mon Oct 10 18:43:05 2005
From: mary-twisted at puzzling.org (Mary Gardiner)
Date: Mon Oct 10 18:43:13 2005
Subject: [Twisted-web] Success of virtual sprint
Message-ID: <20051011004305.GJ21420@home.puzzling.org>

I'd like to thank everyone who sprinted or helped out sprinters on IRC
this weekend. 102 separate commits were made to Twisted SVN over the
weekend, much more than a typical weekend ;) Oh yeah, and there was a
lot of work on the 2.1 release of Twisted Core too...

When I first discussed the vsprint idea with Chris Armstrong at the
Sydney Sprint in August, our plan was to have vsprints on a weekend
every 3 or 4 months. Another possibility might be to have smaller
sprints on particular topics more often: I may try this out with a
documentation sprint in a few months, other people might like to try it
with other projects.

Thanks for playing,

Mary

-- 
<_joshua> perhaps we could have some sort of sacrificial goat technology where people decide collectively that someone absolutely must get laid
<tangra> for the good of the state
<tangra> kind of like the draft lottery

From radeex at gmail.com  Mon Oct 10 19:03:52 2005
From: radeex at gmail.com (Christopher Armstrong)
Date: Mon Oct 10 19:04:29 2005
Subject: [Twisted-web] Success of virtual sprint
In-Reply-To: <20051011004305.GJ21420@home.puzzling.org>
References: <20051011004305.GJ21420@home.puzzling.org>
Message-ID: <60ed19d40510101803s19510cd1k381099932c3accc6@mail.gmail.com>

On 10/11/05, Mary Gardiner <mary-twisted@puzzling.org> wrote:
> When I first discussed the vsprint idea with Chris Armstrong at the
> Sydney Sprint in August, our plan was to have vsprints on a weekend
> every 3 or 4 months. Another possibility might be to have smaller
> sprints on particular topics more often: I may try this out with a
> documentation sprint in a few months, other people might like to try it
> with other projects.

Also, it would be cool to have a release sprint every 2-3 months. The
topic would be "fix Urgent bugs" ;-)

> Thanks for playing,

Hooray Twisted!

--
  Twisted   |  Christopher Armstrong: International Man of Twistery
   Radix    |    -- http://radix.twistedmatrix.com
            |  Release Manager, Twisted Project
  \\\V///   |    -- http://twistedmatrix.com
   |o O|    |
w----v----w-+

From alberto.trujillo at ucd.ie  Tue Oct 11 11:53:19 2005
From: alberto.trujillo at ucd.ie (Alberto Trujillo)
Date: Tue Oct 11 11:51:09 2005
Subject: [Twisted-web] ClientToServerEvent, how to get it?
Message-ID: <434BFC0F.4000301@ucd.ie>

Hello all!
Just a fast question. I need to translate a nevow handler into its 
client string representation already on the server side, to include it 
in some weird text/javascript thing...
for example:

myhandler = livepage.handler(contentHandler, 'd.getSelected()'

should be translated to a string looking like this: (already on the 
server side)

nevow_clientToServerEvent('1',this,'','someJsFunction()'); return false;"

is this possible on the server side, i tried to use 
livepage.flt(myhandler) but that gave me a weird error msg, is there a 
way to get the client representation already on the server side?


thanks very much in advance!

Alberto


From alberto.trujillo at ucd.ie  Wed Oct 12 05:22:10 2005
From: alberto.trujillo at ucd.ie (Alberto Trujillo)
Date: Wed Oct 12 05:20:14 2005
Subject: [Twisted-web] Problems with the back button in LivePage
Message-ID: <434CF1E2.4020302@ucd.ie>

Hello all:
I have noticed that each time that I press the back button in my web 
browser I receive the next error:

Exception: SyntaxError: missing ) after argument list
Caused by script.alert('Exception on server: 
'bf38512a0b82eafbd6fd98c17a984e4-0'')

I have seen that the last quotes are two simple quotes and probably that 
is the reason because the ) is missing, but This problem comes from 
inside Live Page, and I don't be able to fix it, do I?

I inserting the "liveid" and the "liveglue" in my template like I show 
you here, is this ok?

    < script nevow:render="liveid" />
    < script nevow:render="liveglue" />

Thank you very much in advance for all your help.

From mcfletch at rogers.com  Wed Oct 12 12:28:55 2005
From: mcfletch at rogers.com (Mike C. Fletcher)
Date: Wed Oct 12 12:30:57 2005
Subject: [Twisted-web] Problems with the back button in LivePage
In-Reply-To: <434CF1E2.4020302@ucd.ie>
References: <434CF1E2.4020302@ucd.ie>
Message-ID: <434D55E7.6000603@rogers.com>

Alberto Trujillo wrote:

> Hello all:
> I have noticed that each time that I press the back button in my web 
> browser I receive the next error:
>
> Exception: SyntaxError: missing ) after argument list
> Caused by script.alert('Exception on server: 
> 'bf38512a0b82eafbd6fd98c17a984e4-0'')
>
> I have seen that the last quotes are two simple quotes and probably 
> that is the reason because the ) is missing, but This problem comes 
> from inside Live Page, and I don't be able to fix it, do I?
>
> I inserting the "liveid" and the "liveglue" in my template like I show 
> you here, is this ok?
>
>    < script nevow:render="liveid" />
>    < script nevow:render="liveglue" />

The problem has been fixed in SVN livepage by avoiding caching of the 
page.  However, SVN livepage has an entirely different API from the 
released version, so unless you're wanting to migrate to that API (or 
use a backward compatibility layer such as I posted a few weeks ago) 
you're stuck with the bug (or you could try back-porting the 
anti-caching headers I suppose).

Good luck,
Mike

-- 
________________________________________________
  Mike C. Fletcher
  Designer, VR Plumber, Coder
  http://www.vrplumber.com
  http://blog.vrplumber.com


From mithrandi-twisted-web at mithrandi.za.net  Wed Oct 12 15:39:48 2005
From: mithrandi-twisted-web at mithrandi.za.net (Tristan Seligmann)
Date: Wed Oct 12 15:40:03 2005
Subject: [Twisted-web] JSON parsing fix
Message-ID: <20051012213948.GA25553@mithrandi.za.net>

Skipped content of type multipart/mixed-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: Digital signature
Url : http://twistedmatrix.com/pipermail/twisted-web/attachments/20051012/45806fd6/attachment.bin
From exarkun at divmod.com  Wed Oct 12 20:06:25 2005
From: exarkun at divmod.com (Jp Calderone)
Date: Wed Oct 12 20:06:28 2005
Subject: [Twisted-web] JSON parsing fix
In-Reply-To: <20051012213948.GA25553@mithrandi.za.net>
Message-ID: <20051013020625.3914.1486614773.divmod.quotient.27628@ohm>

On Wed, 12 Oct 2005 23:39:48 +0200, Tristan Seligmann <mithrandi-twisted-web@mithrandi.za.net> wrote:
>Hi,
>
>The attached patch fixes JSON parsing of strings with embedded
>double-quotes, ie. "stuff like \"this\"".

Thanks!  Applied the fix, along with a few more test inputs.

Jp

From glyph at divmod.com  Wed Oct 12 21:10:44 2005
From: glyph at divmod.com (Glyph Lefkowitz)
Date: Wed Oct 12 21:10:49 2005
Subject: [Twisted-web] Problems with the back button in LivePage
In-Reply-To: <434D55E7.6000603@rogers.com>
References: <434CF1E2.4020302@ucd.ie> <434D55E7.6000603@rogers.com>
Message-ID: <434DD034.1080405@divmod.com>

Mike C. Fletcher wrote:
> Alberto Trujillo wrote:

> The problem has been fixed in SVN livepage by avoiding caching of the
> page.  However, SVN livepage has an entirely different API from the
> released version, so unless you're wanting to migrate to that API (or
> use a backward compatibility layer such as I posted a few weeks ago)
> you're stuck with the bug (or you could try back-porting the
> anti-caching headers I suppose).

There is a new release of Nevow available: 0.5.  See
http://divmod.org/projects/nevow

Sorry for the sluggish release announcement, but we have a lot of stuff
to talk about :).  You should see it showing up in the next few days.

From alberto.trujillo at ucd.ie  Thu Oct 13 08:00:52 2005
From: alberto.trujillo at ucd.ie (Alberto Trujillo)
Date: Thu Oct 13 07:58:48 2005
Subject: [Twisted-web] Problems with the back button in LivePage
In-Reply-To: <434D55E7.6000603@rogers.com>
References: <434CF1E2.4020302@ucd.ie> <434D55E7.6000603@rogers.com>
Message-ID: <434E6894.5080308@ucd.ie>

Mike C. Fletcher wrote:

> Alberto Trujillo wrote:
>
>> Hello all:
>> I have noticed that each time that I press the back button in my web 
>> browser I receive the next error:
>>
>> Exception: SyntaxError: missing ) after argument list
>> Caused by script.alert('Exception on server: 
>> 'bf38512a0b82eafbd6fd98c17a984e4-0'')
>>
>> I have seen that the last quotes are two simple quotes and probably 
>> that is the reason because the ) is missing, but This problem comes 
>> from inside Live Page, and I don't be able to fix it, do I?
>>
>> I inserting the "liveid" and the "liveglue" in my template like I 
>> show you here, is this ok?
>>
>>    < script nevow:render="liveid" />
>>    < script nevow:render="liveglue" />
>
>
> The problem has been fixed in SVN livepage by avoiding caching of the 
> page.  However, SVN livepage has an entirely different API from the 
> released version, so unless you're wanting to migrate to that API (or 
> use a backward compatibility layer such as I posted a few weeks ago) 
> you're stuck with the bug (or you could try back-porting the 
> anti-caching headers I suppose).
>
> Good luck,
> Mike
>
Thank you very much for the information. We'll see what to do about 
livepage, and in the mean time I going to have a look to that layer that 
you are talking about.

From andrea at cpushare.com  Thu Oct 13 23:38:14 2005
From: andrea at cpushare.com (Andrea Arcangeli)
Date: Thu Oct 13 23:38:22 2005
Subject: [Twisted-web] Re: [Twisted-Python] ANN: Nufox 0.1.0
In-Reply-To: <434D1B34.4020300@nunatak.com.au>
References: <434D1B34.4020300@nunatak.com.au>
Message-ID: <20051014053814.GG18159@opteron.random>

On Thu, Oct 13, 2005 at 01:18:28AM +1100, Timothy Stebbing wrote:
> Nufox is a remote-XUL server framework for building live, event-driven, 
> through-the-web GUI applications without writing markup, just python. 
> This is the initial release and represents several months work, much 
> thanks to cablehead, radix, exarkun et al for their advice and 
> contributions.
> 
> url: http://trac.nunatak.com.au/projects/nufox
> download: http://trac.nunatak.com.au/trac/Nufox-0.1.0.tar.gz

Looks pretty cool!

btw, you like me use nevow but you don't seem to be using web2 at all,
you've got only one document explaining some bits of web2 in the doc
directory.

I still wonder what is the roadmap w.r.t. to nevow and web2, and when
approximatively should we start to worry about migrating our apps to
web2?

From glyph at divmod.com  Fri Oct 14 00:04:58 2005
From: glyph at divmod.com (glyph@divmod.com)
Date: Fri Oct 14 00:05:03 2005
Subject: Oh, by the way,
	Nevow 0.5 (was Re: [Twisted-web] Re: [Twisted-Python] ANN: Nufox
	0.1.0)
In-Reply-To: <20051014053814.GG18159@opteron.random>
Message-ID: <20051014060458.3914.606184497.divmod.quotient.28111@ohm>



On Fri, 14 Oct 2005 07:38:14 +0200, Andrea Arcangeli <andrea@cpushare.com> wrote:

>I still wonder what is the roadmap w.r.t. to nevow and web2, and when
>approximatively should we start to worry about migrating our apps to
>web2?

We are hard at work trying to come up with that roadmap.  When you need to start worrying about migrating your apps to web2, there will be some loud noises on this list.

We are *also* planning to do more releases of Nevow, as JP has just documented our last one on his blog:

http://www.livejournal.com/users/jcalderone/11535.html

so there will be a discrete release where you will do the web2 migration.  You don't have to track trunk in every application any more :).

From glyph at divmod.com  Fri Oct 14 00:09:01 2005
From: glyph at divmod.com (glyph@divmod.com)
Date: Fri Oct 14 00:09:05 2005
Subject: [Twisted-web] NEVOW REPOSITORY MOVING TOMORROW
In-Reply-To: 0
Message-ID: <20051014060901.3914.1897182484.divmod.quotient.28113@ohm>

I've mentioned this a few times on IRC but just to make sure that there is no last minute confusion: the Nevow repository will be moving to a new URL (http://divmod.org/svn/Divmod/trunk/Nevow) tomorrow.  The repository may be down for up to 12 hours starting at 12:00 noon EDT.

This is a temporary inconvenience, however.  When it comes back up, all the services currently available for other Divmod projects through Trac will be available for Nevow.  We are also going to be using the centralized bugtracker in Trac for tracking issues.  We won't be taking down the old Roundup instance, but please file new issues at http://divmod.org/trac and copy over the important old ones so that we can have all the nice trac features, like "Fixes #1234" in commit messages meaning something.

From michele.simionato at gmail.com  Fri Oct 14 04:34:36 2005
From: michele.simionato at gmail.com (Michele Simionato)
Date: Fri Oct 14 04:34:41 2005
Subject: [Twisted-web] my first post,
	writing a Web interface to a PostgreSQL db
Message-ID: <4edc17eb0510140334m357d878dr7686c7ed383efa78@mail.gmail.com>

I need to write a Web interface to a PostgreSQL database and I am
considering to use Twisted for that. So, I have a few questions.

First of all, I would like to know if there already something available
that I should look at. Second, I have a more specific question.

Suppose I have a large table with 1,000,000 records and a SELECT query
that returns 1000 results and takes 10 minutes.

I don't want my users to wait. I want to display the result of the
query as an HTML table of 50 rows. The user should click, wait
30 seconds, see the result, then click a 'next' button to see
the other 50 results, etc. In other words, I am looking for a lazy query
functionality.

Is that already available? If not, is it easy/difficult to implement?

Thanks for any suggestion,

        Michele Simionato

From dialtone at divmod.com  Fri Oct 14 06:51:32 2005
From: dialtone at divmod.com (Valentino Volonghi aka Dialtone)
Date: Fri Oct 14 06:54:47 2005
Subject: [Twisted-web] my first post,
	writing a Web interface to a PostgreSQL db
In-Reply-To: <4edc17eb0510140334m357d878dr7686c7ed383efa78@mail.gmail.com>
References: <4edc17eb0510140334m357d878dr7686c7ed383efa78@mail.gmail.com>
Message-ID: <20051014125132.GA3251@divmod.com>

On Fri, Oct 14, 2005 at 10:34:36AM +0000, Michele Simionato wrote:

Hi Michele :),

> I need to write a Web interface to a PostgreSQL database and I am
> considering to use Twisted for that. So, I have a few questions.

Let's see if I can answer all of them.

> First of all, I would like to know if there already something available
> that I should look at. Second, I have a more specific question.

Depends on what 'Something' means in your view.
There are 2 projects that I know of that work with twisted and databases (or
postgresql) that are worth a try.

The first one is called Tada (Twisted Async Database API):
http://www.darkarts.co.za/projects/tada/

which is a new version of adbapi that instead of incredibly ignoring DB-API2
it makes it so that each DB-API2 method call returns a deferred. It also has
an SQLObject-like way of dealing with the database that may be useful.

Another effort is pgasync:
svn://svn.jamwt.com/pgasync/trunk

pgasync is a pure python database module that uses Twisted to implement the
PostgreSQL protocol. It tries to be DB-API2 compliant although failing in some
cases (not hard to fix but requires a bit of time that you may not have). Like
Tada it returns deferreds from DB-API2 method calls, but manages to do some
magic that avoids returning a deferred in some places.

The last one is the standard abapi module that while maybe not beautiful it is
indeed very simple and well tested in real life.

> Suppose I have a large table with 1,000,000 records and a SELECT query
> that returns 1000 results and takes 10 minutes.
> 
> I don't want my users to wait. I want to display the result of the
> query as an HTML table of 50 rows. The user should click, wait
> 30 seconds, see the result, then click a 'next' button to see
> the other 50 results, etc. In other words, I am looking for a lazy query
> functionality.

Lazy query functionality requires you to store the cursor that run the query
somewhere (togheter with the connection from which it was created) so that you
can use fetchmany() on it. There is no other way that comes to my mind.
I haven't experimented with this kind of jobs with any of the above, but I can
guess that adbapi is not the right tool for the object, whereas pgasync or
tada might be the right starting point (although they might reveal to be the
wrong approach too).

> Is that already available? If not, is it easy/difficult to implement?

It shouldn't be hard to implement as long as you don't need to migrate the
cursor and the connection to some other machine.

The idea that comes to mind is that you can store the connection with the
cursor in the session (or something like that, maybe the session is not the
right place but depends on the framework you are using) and reuse them for
each user. Of course if you are in a load balanced environment then you need
to be able to 'migrate' those connection from one computer to another one
(unless you are using stateful load balancers) which is extremely hard.

Another solution could be to take advantage of OFFSET and LIMIT keywords in
SQL to avoid calculating the whole 1000 results but only limiting the
resultset to the strictly necessary thus lowering response times.

Hope I've been helpful :)

-- 
Valentino Volonghi aka Dialtone
Now Running MacOSX 10.4
Blog: http://vvolonghi.blogspot.com
http://weever.berlios.de
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 186 bytes
Desc: not available
Url : http://twistedmatrix.com/pipermail/twisted-web/attachments/20051014/904fdb0c/attachment.bin
From catalin at bounce-software.com  Fri Oct 14 08:20:07 2005
From: catalin at bounce-software.com (Catalin Constantin)
Date: Fri Oct 14 07:20:10 2005
Subject: [Twisted-web] twisted web +nevow in development mode
Message-ID: <964420166.20051014162007@bounce-software.com>

hi there.

i am interested if there is any howto for running twisted web in a
development mode.

basically right now all my Resources are loaded on startup.
the code changes i make in my classes are not visible until i do a
restart. the restart is slow sometimes + you loose the session data.

so i was thinking if there is something like the .rpy "scripts" which
are executed on each request. or like turbogears (cherrypy) has in
dev mode, the option to reload the "modules" on each request.


or, are there any other workflows i should follow to develop a twisted
web nevow application ?


thank you for your response !


-- 
Catalin Constantin
Bounce Software
http://www.bounce-software.com
http://www.cabanova.ro


From michele.simionato at gmail.com  Fri Oct 14 07:23:46 2005
From: michele.simionato at gmail.com (Michele Simionato)
Date: Fri Oct 14 07:23:50 2005
Subject: [Twisted-web] my first post,
	writing a Web interface to a PostgreSQL db
In-Reply-To: <20051014125132.GA3251@divmod.com>
References: <4edc17eb0510140334m357d878dr7686c7ed383efa78@mail.gmail.com>
	<20051014125132.GA3251@divmod.com>
Message-ID: <4edc17eb0510140623r54623187wc1cd57f619fbde25@mail.gmail.com>

On 10/14/05, Valentino Volonghi aka Dialtone <dialtone@divmod.com> wrote:
> On Fri, Oct 14, 2005 at 10:34:36AM +0000, Michele Simionato wrote:
>
> Hi Michele :)

Hi Valentino! (funny to write to you in a foreign language ;)

> There are 2 projects that I know of that work with twisted and databases (or
> postgresql) that are worth a try.

I will have a look at them

> Lazy query functionality requires you to store the cursor that run the query
> somewhere (togheter with the connection from which it was created) so that you
> can use fetchmany() on it. There is no other way that comes to my mind.

Trouble is, .fetchmany() does not work. It first perform the full query (having
the user to wait 10 minutes in my example) and then it returns the results
in bunches. Also LIMIT and OFFSET do not work. I want to resume an already
started query, not to restart the full query and extracts a subset of it.

I don't see any way to do that in the DB API 2.0, and I am beginning to suspect
that it is much harder than I expected ...

           Michele Simionato

From ldanielburr at mac.com  Fri Oct 14 07:25:43 2005
From: ldanielburr at mac.com (L. Daniel Burr)
Date: Fri Oct 14 07:25:47 2005
Subject: [Twisted-web] my first post,
	writing a Web interface to a PostgreSQL db
In-Reply-To: <4edc17eb0510140334m357d878dr7686c7ed383efa78@mail.gmail.com>
References: <4edc17eb0510140334m357d878dr7686c7ed383efa78@mail.gmail.com>
Message-ID: <op.sym0w5ft3oj628@l-daniel-burrs-powerbook-g4-17.local>

This is very simple to do, using the LIMIT OFFSET functionality in  
Postgres.

Just create a Resource which accepts a request arg indicating the offset,  
and then execute your query like so:

cursor.execute('SELECT foo, bar from mytable LIMIT 50 OFFSET %d' % offset)

As your users move forward and back through the dataset, you just change  
the offset.

If you are using Postgres, you should look at pgasync (search the mailing  
lists), which is a fully async (no threading) adapter for use with twisted  
and Postgres; awesome stuff.

The only real work to do here is to keep track of which offset your user  
currently is viewing, and that's trivial as well.

Hope this helps,

L. Daniel Burr

P.S.  There's an even cooler way to do this:  
http://openrico.org/rico/livegrid.page

On Fri, 14 Oct 2005 05:34:36 -0500, Michele Simionato  
<michele.simionato@gmail.com> wrote:

> I need to write a Web interface to a PostgreSQL database and I am
> considering to use Twisted for that. So, I have a few questions.
>
> First of all, I would like to know if there already something available
> that I should look at. Second, I have a more specific question.
>
> Suppose I have a large table with 1,000,000 records and a SELECT query
> that returns 1000 results and takes 10 minutes.
>
> I don't want my users to wait. I want to display the result of the
> query as an HTML table of 50 rows. The user should click, wait
> 30 seconds, see the result, then click a 'next' button to see
> the other 50 results, etc. In other words, I am looking for a lazy query
> functionality.
>
> Is that already available? If not, is it easy/difficult to implement?
>
> Thanks for any suggestion,
>
>         Michele Simionato
>
> _______________________________________________
> Twisted-web mailing list
> Twisted-web@twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web



From michele.simionato at gmail.com  Fri Oct 14 07:33:18 2005
From: michele.simionato at gmail.com (Michele Simionato)
Date: Fri Oct 14 07:33:21 2005
Subject: [Twisted-web] my first post,
	writing a Web interface to a PostgreSQL db
In-Reply-To: <op.sym0w5ft3oj628@l-daniel-burrs-powerbook-g4-17.local>
References: <4edc17eb0510140334m357d878dr7686c7ed383efa78@mail.gmail.com>
	<op.sym0w5ft3oj628@l-daniel-burrs-powerbook-g4-17.local>
Message-ID: <4edc17eb0510140633q5dd00ccag2f9e295e14006160@mail.gmail.com>

On 10/14/05, L. Daniel Burr <ldanielburr@mac.com> wrote:
> This is very simple to do, using the LIMIT OFFSET functionality in
> Postgres.

No, doing a full select or a select with OFFSET takes the same amount of time,
the query is restarted from the beginning.

From dialtone at divmod.com  Fri Oct 14 08:01:15 2005
From: dialtone at divmod.com (Valentino Volonghi aka Dialtone)
Date: Fri Oct 14 08:01:21 2005
Subject: [Twisted-web] twisted web +nevow in development mode
In-Reply-To: <964420166.20051014162007@bounce-software.com>
References: <964420166.20051014162007@bounce-software.com>
Message-ID: <20051014140115.GB3251@divmod.com>

On Fri, Oct 14, 2005 at 04:20:07PM +0200, Catalin Constantin wrote:
> or, are there any other workflows i should follow to develop a twisted
> web nevow application ?

No, and recent development in the frameworks you cited are heading towards the
same conclusion (stopping the process and restarting a new one, I remember to
have read the code from somebody from cherrypy2 that implemented a spawner
thread that spawns a new process that spawns an observer thread on the files
of the project and blabla. There you loose the session data too except that
it's a tiny bit faster to restart (but restarts nonetheless).

Just avoid writing much stan and keep more templates flying around (you can
modify them as you prefer without restarting anything).

Also when you usually develop something you often change state and
constructors, which means that reloading is useless anyway (you really need to
stop and restart).

-- 
Valentino Volonghi aka Dialtone
Now Running MacOSX 10.4
Blog: http://vvolonghi.blogspot.com
http://weever.berlios.de
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 186 bytes
Desc: not available
Url : http://twistedmatrix.com/pipermail/twisted-web/attachments/20051014/3bdec9e9/attachment-0001.bin
From ldanielburr at mac.com  Fri Oct 14 10:50:27 2005
From: ldanielburr at mac.com (L. Daniel Burr)
Date: Fri Oct 14 10:50:33 2005
Subject: [Twisted-web] my first post,
	writing a Web interface to a PostgreSQL db
In-Reply-To: <4edc17eb0510140633q5dd00ccag2f9e295e14006160@mail.gmail.com>
References: <4edc17eb0510140334m357d878dr7686c7ed383efa78@mail.gmail.com>
	<op.sym0w5ft3oj628@l-daniel-burrs-powerbook-g4-17.local>
	<4edc17eb0510140633q5dd00ccag2f9e295e14006160@mail.gmail.com>
Message-ID: <op.synaedpp3oj628@l-daniel-burrs-powerbook-g4-17.local>

My apologies, I didn't understand that you wanted to cache the entire  
dataset at the beginning.

In that case, I'd select the data into a temporary table ( a temp table  
containing only 1000 records should be very fast to access, once it is  
populated) at startup time, and them use the LIMIT OFFSET strategy against  
the temporary table.

Does this meet your need a little better?

L. Daniel Burr

On Fri, 14 Oct 2005 08:33:18 -0500, Michele Simionato  
<michele.simionato@gmail.com> wrote:

> On 10/14/05, L. Daniel Burr <ldanielburr@mac.com> wrote:
>> This is very simple to do, using the LIMIT OFFSET functionality in
>> Postgres.
>
> No, doing a full select or a select with OFFSET takes the same amount of  
> time,
> the query is restarted from the beginning.
>
> _______________________________________________
> Twisted-web mailing list
> Twisted-web@twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web



From andrea at cpushare.com  Fri Oct 14 12:42:51 2005
From: andrea at cpushare.com (Andrea Arcangeli)
Date: Fri Oct 14 12:42:58 2005
Subject: Oh, by the way,
	Nevow 0.5 (was Re: [Twisted-web] Re: [Twisted-Python] ANN: Nufox
	0.1.0)
In-Reply-To: <20051014060458.3914.606184497.divmod.quotient.28111@ohm>
References: <20051014053814.GG18159@opteron.random>
	<20051014060458.3914.606184497.divmod.quotient.28111@ohm>
Message-ID: <20051014184251.GI18159@opteron.random>

On Fri, Oct 14, 2005 at 02:04:58AM -0400, glyph@divmod.com wrote:
> We are hard at work trying to come up with that roadmap.  When you need to 
> start worrying about migrating your apps to web2, there will be some loud 
> noises on this list.
> 
> We are *also* planning to do more releases of Nevow, as JP has just 
> documented our last one on his blog:
> 
> http://www.livejournal.com/users/jcalderone/11535.html
> 
> so there will be a discrete release where you will do the web2 migration.  
> You don't have to track trunk in every application any more :).

Ok great! ;)

BTW, my favourite new feature is the persistence for sessions, I'm going
to try it out soon...

From eric.faurot at gmail.com  Sat Oct 15 10:45:47 2005
From: eric.faurot at gmail.com (Eric Faurot)
Date: Sat Oct 15 10:45:50 2005
Subject: [Twisted-web] LiveWeb 0.1.0
Message-ID: <e012d6b50510150945i5095024oaabe7d6d350679af@mail.gmail.com>

Hi,

I just released a very first version of liveweb (that I used to call
liveresource before). It is yet another livepage implementation
with backends for twisted.web, nevow and twisted.web2.
It allows reference passing between the server and the client
a la twisted.spread.pb

It does not work correctly on all major browsers yet (IE is totally
broken), and the transport logic must be rethought to deal better
with browser limitations (they usually do not send any more request
while one is still pending...) It should be useable on Firefox though.

If somebody is interested, I'd love to have feedback on the features
and API.

http://ekyo.nerim.net/python/liveweb-0.1.0.tar.gz

Eric.
From garanin at m-lan.ru  Sun Oct 16 15:05:22 2005
From: garanin at m-lan.ru (Garanin Michael)
Date: Sun Oct 16 15:05:23 2005
Subject: [Twisted-web] bind_*
Message-ID: <1129496722.4935.5.camel@localhost>

                                                                          
Hello!
Sorry i am nevow-newcomer. 
I use nevow 0.5.0 and my page has method: 

 def bind_doSomething(self, ctx):
        return [('param',annotate.Integer()) ]


It's work and i see labels "Do Something" and "Call" in my browser.
My question: how i can change labels?
Thanks!



From andy at thecablelounge.com  Sun Oct 16 18:28:33 2005
From: andy at thecablelounge.com (Andy Gayton)
Date: Sun Oct 16 18:29:10 2005
Subject: [Twisted-web] bind_*
In-Reply-To: <1129496722.4935.5.camel@localhost>
References: <1129496722.4935.5.camel@localhost>
Message-ID: <4352F031.2090501@thecablelounge.com>

Garanin Michael wrote:
>                                                                           
> Hello!
> Sorry i am nevow-newcomer. 
> I use nevow 0.5.0 and my page has method: 
> 
>  def bind_doSomething(self, ctx):
>         return [('param',annotate.Integer()) ]
> 
> 
> It's work and i see labels "Do Something" and "Call" in my browser.
> My question: how i can change labels?

     args = [formless.Argument('param', annotate.Integer()),]
     return formless.MethodBinding('doSomething',
         formless.Method(arguments=args), action='Custom Label')

Andy.

From michele.simionato at gmail.com  Mon Oct 17 03:07:03 2005
From: michele.simionato at gmail.com (Michele Simionato)
Date: Mon Oct 17 03:07:07 2005
Subject: [Twisted-web] looking for a request.getfirst
Message-ID: <4edc17eb0510170207p14f4fd94h90fb72e46f6f5db1@mail.gmail.com>

I am surprise I don't find a method to extract the value of a field from a
request object. At the moment I am using a helper function

def getfirst(name, request):
    return request.args.get(name, [None])[0]

but is there a better solution?

        Michele Simionato

From michele.simionato at gmail.com  Mon Oct 17 03:34:20 2005
From: michele.simionato at gmail.com (Michele Simionato)
Date: Mon Oct 17 03:34:23 2005
Subject: [Twisted-web] my first post,
	writing a Web interface to a PostgreSQL db
In-Reply-To: <20051014125132.GA3251@divmod.com>
References: <4edc17eb0510140334m357d878dr7686c7ed383efa78@mail.gmail.com>
	<20051014125132.GA3251@divmod.com>
Message-ID: <4edc17eb0510170234x744be07dje843216dad4afe36@mail.gmail.com>

On 10/14/05, Valentino Volonghi aka Dialtone <dialtone@divmod.com> wrote:

> The last one is the standard abapi module that while maybe not beautiful it is
> indeed very simple and well tested in real life.

Does the standard module have any introspection feature? I mean, for instance
getting the field names? Using the DB API 2.0 interface I can extract the
information from the cursor .description attribute, but how do I get the
information from twisted.enterprise?

          Michele Simionato

From andy at thecablelounge.com  Mon Oct 17 06:01:10 2005
From: andy at thecablelounge.com (Andy Gayton)
Date: Mon Oct 17 06:01:46 2005
Subject: [Twisted-web] looking for a request.getfirst
In-Reply-To: <4edc17eb0510170207p14f4fd94h90fb72e46f6f5db1@mail.gmail.com>
References: <4edc17eb0510170207p14f4fd94h90fb72e46f6f5db1@mail.gmail.com>
Message-ID: <43539286.3010909@thecablelounge.com>

Michele Simionato wrote:
> I am surprise I don't find a method to extract the value of a field from a
> request object. At the moment I am using a helper function
> 
> def getfirst(name, request):
>     return request.args.get(name, [None])[0]
> 
> but is there a better solution?

There is a convenience method 'arg' on nevow's context object that does 
this:

     def arg(self, get, default=None):
         """Placeholder until I can find Jerub's implementation of this

         Return a single named argument from the request arguments
         """
         req = self.locate(IRequest)
         return req.args.get(get, [default])[0]

It's used in nevow/examples/manualform

HTH,
Andy.

From dialtone at divmod.com  Mon Oct 17 12:20:44 2005
From: dialtone at divmod.com (Valentino Volonghi aka Dialtone)
Date: Mon Oct 17 12:21:09 2005
Subject: [Twisted-web] my first post,
	writing a Web interface to a PostgreSQL db
In-Reply-To: <4edc17eb0510170234x744be07dje843216dad4afe36@mail.gmail.com>
References: <4edc17eb0510140334m357d878dr7686c7ed383efa78@mail.gmail.com>
	<20051014125132.GA3251@divmod.com>
	<4edc17eb0510170234x744be07dje843216dad4afe36@mail.gmail.com>
Message-ID: <20051017182044.GA1242@divmod.com>

On Mon, Oct 17, 2005 at 09:34:20AM +0000, Michele Simionato wrote:
> Does the standard module have any introspection feature? I mean, for instance
> getting the field names? Using the DB API 2.0 interface I can extract the
> information from the cursor .description attribute, but how do I get the
> information from twisted.enterprise?

With runInteraction you get a standard DB-API2 cursor on which you can call
whatever you want.

-- 
Valentino Volonghi aka Dialtone
Now Running MacOSX 10.4
Blog: http://vvolonghi.blogspot.com
http://weever.berlios.de
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 186 bytes
Desc: not available
Url : http://twistedmatrix.com/pipermail/twisted-web/attachments/20051017/09da057a/attachment.bin
From spex66 at gmx.net  Tue Oct 18 10:18:30 2005
From: spex66 at gmx.net (Peter Arwanitis)
Date: Tue Oct 18 10:18:33 2005
Subject: [Twisted-web] nevow livepage - where are my parameters
	(request.args) gone?
Message-ID: <4f5e04810510180918o62fc6e9ekcede35f527fb5972@mail.gmail.com>

Hi there,

first: Thanks for nevow 0.5!
JIT :) for evaluation and integration in an ongoing project of mine.

Searching for AJAX features with python-support the "chatola" example is an
amazing eye-opener!!!

The bi-directional support is stunning! And the code is compact...

Hacking through the roughs, I have
* migrated my existing twisted.web.server to nevow.appserver stuff: DONE
(cannot have them both, cause of interface-adaption-hell)
* sucessful broadcasting from wxPython/twisted.reactor-application to
connected browsers, via send()
* ...

Problems I cannot hack:
* using nevow:render="store" and appropriate render_store() method. I'm
returning plain string WITH rendered html (from existing code) --> HOW can I
avoid the escaping of all '<' '&' and '>'??? No, it's not sure that ii is
xhtml.
* Problem using href-links form inside my lifepage with additional
parameters http://localhost:8080/lifesite?when=20051010 (not AJAX -> plain
request)
Where does my parameters gone??? only things like ('livepage_client', '0',
'output') occuring?

thanks for hints
Peter
(=PA=)
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-web/attachments/20051018/bb39b3ff/attachment.htm
From denis.leborgne at rieter.com  Wed Oct 19 02:15:24 2005
From: denis.leborgne at rieter.com (denis.leborgne@rieter.com)
Date: Wed Oct 19 02:18:31 2005
Subject: [Twisted-web] Memory leak with twisted web server on QNX
Message-ID: <OF316118B7.85E10B15-ONC125709F.0026DA7C-C125709F.002D5B34@rieter.com>

Hi,

I use twisted as a very simple web server to serve python scripts. I now 
have a problem of memory leak on the server. I use Python 2.2.1 on QNX 
6.3, Twisted version is 1.3.0. 
I made the following test scripts :

Web server

from twisted.web import server, resource,static,script
from twisted.internet import reactor

root = static.File("site")
root.processors = {'.py': script.PythonScript,
                 '.rpy': script.ResourceScript}

site = server.Site(root)
reactor.listenTCP(8500, site)
reactor.run()

Test script (.rpy file)

from twisted.web import resource

class Test(resource.Resource):
    isLeaf = True

    def render_GET(self, request):
        return """<html>
                    <head>
                        <meta http-equiv="refresh" content="5">
                    </head>
                    Hello, world!</html>"""

resource = Test()



About every 4 "refresh", the memory used by my server increases by 96k, 
with nor release of memory. I checked the object number by watching 
len(gc.get_objects()), but it is stable. 
Any idea to help me to solve this problem, my server is expected to run 
continuously.

Thanks.

Denis
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-web/attachments/20051019/dd783fa3/attachment.htm
From andrew-twisted at puzzling.org  Wed Oct 19 08:05:30 2005
From: andrew-twisted at puzzling.org (Andrew Bennetts)
Date: Wed Oct 19 08:05:46 2005
Subject: [Twisted-web] Memory leak with twisted web server on QNX
In-Reply-To: <OF316118B7.85E10B15-ONC125709F.0026DA7C-C125709F.002D5B34@rieter.com>
References: <OF316118B7.85E10B15-ONC125709F.0026DA7C-C125709F.002D5B34@rieter.com>
Message-ID: <20051019140530.GP19919@trogdor.home.puzzling.org>

On Wed, Oct 19, 2005 at 10:15:24AM +0200, denis.leborgne@rieter.com wrote:
> 
> Hi,
> 
> I use twisted as a very simple web server to serve python scripts. I now have a
> problem of memory leak on the server. I use Python 2.2.1 on QNX 6.3, Twisted
> version is 1.3.0.
[...]
> About every 4 "refresh", the memory used by my server increases by 96k, with
> nor release of memory. I checked the object number by watching len
> (gc.get_objects()), but it is stable.
> Any idea to help me to solve this problem, my server is expected to run
> continuously.

There was a leak in the _c_urlarg.c module in 1.3.0, which causes a string
the size of the url to be leaked every request.  This doesn't sound like it
would account for the 96k per 4 requests to me, but perhaps the memory
allocation strategy on QNX explains that.

Either upgrade to Twisted 2.0 or newer, or grab _c_urlarg.c from that
version or SVN (it's a one-line fix) and recompile it, or just delete the
compiled module -- it'll fall back to the slower pure-python version in the
standard library, but it won't leak.

Let us know if that solves it, or at least helps.

-Andrew.


From michele.simionato at gmail.com  Wed Oct 19 09:06:06 2005
From: michele.simionato at gmail.com (Michele Simionato)
Date: Wed Oct 19 09:06:11 2005
Subject: [Twisted-web] sessions how to
Message-ID: <4edc17eb0510190806g4ef133ag1ac60443248151e5@mail.gmail.com>

Can anybody point out to me some examples of session management with
twisted web? For instance, how do I make a login page?
Users and passwords should be stored into a PostgreSQL DB.
TIA,

         Michele Simionato

From spex66 at gmx.net  Wed Oct 19 11:07:40 2005
From: spex66 at gmx.net (Peter Arwanitis)
Date: Wed Oct 19 11:08:16 2005
Subject: [Twisted-web] nevow livepage - where are my
	parameters	(request.args) gone?
In-Reply-To: <4f5e04810510180918o62fc6e9ekcede35f527fb5972@mail.gmail.com>
References: <4f5e04810510180918o62fc6e9ekcede35f527fb5972@mail.gmail.com>
Message-ID: <43567D5C.2050801@gmx.net>

Hi,

OK, the riddle of the lost parameters is solved

part of my fault... cause I'm not able to render my nevow Page with 
plain-html (problem:1), Ive taken the the shortcut via hook in 
livepage.goingLive and
client.send(set('idOfMyDiv', plainHTMLasString), eol)

Fact is: in goingLive my parameters appended to the url (and visible in 
browser!) are LOST!!!

hacking down to liveglue.js they are abviously cut-of and trashed

my solution (pragmatic and without knowledge about sense and further 
sideeffects):

/* hacking liveglue.js * /
...
/* route parameter to server site */
var queryParam = '';
if (queryParamIndex != -1) {
  queryParam = '&' + base_url.substring(queryParamIndex+1, base_url.length);
  base_url = base_url.substring(0, queryParamIndex);
 }
...
function connect(outputNum) {
...
  /* building the url in connect() --> appending extracted parameter if any
     mysite/livepage_client/output?outputNum=0&when=20051010
*/
  var U = base_url + nevow_clientHandleId + "/output?outputNum=" + 
outputNum + queryParam;
...

now I can retrieve my parameters during goingLive (problem:2) solved

any hints for a better (existing) solution???
recommendations for (problem:1)?

bye
Peter
(=PA=)

Peter Arwanitis schrieb:

> Hi there,
>
> first: Thanks for nevow 0.5!
> JIT :) for evaluation and integration in an ongoing project of mine.
>
> Searching for AJAX features with python-support the "chatola" example 
> is an amazing eye-opener!!!
>
> The bi-directional support is stunning! And the code is compact...
>
> Hacking through the roughs, I have
> * migrated my existing twisted.web.server to nevow.appserver stuff: 
> DONE (cannot have them both, cause of interface-adaption-hell)
> * sucessful broadcasting from wxPython/twisted.reactor-application to 
> connected browsers, via send()
> * ...
>
> Problems I cannot hack:
> (problem:1) using nevow:render="store" and appropriate render_store() 
> method. I'm returning plain string WITH rendered html (from existing 
> code) --> HOW can I avoid the escaping of all '<' '&' and '>'??? No, 
> it's not sure that ii is xhtml.
> (problem:2) Problem using href-links form inside my lifepage with 
> additional parameters http://localhost:8080/lifesite?when=20051010 
> (not AJAX -> plain request)
> Where does my parameters gone??? only things like ('livepage_client', 
> '0', 'output') occuring?
>
> thanks for hints
> Peter
> (=PA=)
>
>------------------------------------------------------------------------
>
>_______________________________________________
>Twisted-web mailing list
>Twisted-web@twistedmatrix.com
>http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web
>  
>


From dekonerding at lbl.gov  Wed Oct 19 14:36:36 2005
From: dekonerding at lbl.gov (David E. Konerding)
Date: Wed Oct 19 14:36:45 2005
Subject: [Twisted-web] twisted.web getPage-- retrieving error information 
Message-ID: <4356AE54.5070409@lbl.gov>

Hi folks,

I am tryign to get useful error information when I use 
twisted.web.getPage.  For example, this code doesn't supply a trailing
slash when making a request for www.google.com.  This causes getPage to 
make an invalid request to the web server
("GET  HTTP/1.1") which causes the server to disconnect immediately 
(that's true for the google web server.  for apache, it produces
an "Invalid Request" message and error code).

It doens't seem like the error object passed to the errback contains any 
useful information which I can bubble up to the user.
For example, I'd like to know what data was received before the server 
closed the connection.  ANy ideas?

from twisted.internet import reactor
from twisted.web.client import getPage

def gotPage(result):
    print "gotPage: result=", result

def gotPageErr(error):
    print "gotPageErr: error=", error
   
def getAPage(url):
    gp = getPage(url)
    gp.addCallback(gotPage)
    gp.addErrback(gotPageErr)

reactor.callWhenRunning(getAPage, "http://google.com")
reactor.run()



From david at remahl.se  Wed Oct 19 15:48:47 2005
From: david at remahl.se (David Remahl)
Date: Wed Oct 19 15:49:23 2005
Subject: [Twisted-web] Preventing XSS when using Nevow's vhost functionality
Message-ID: <301F4B8C-3B09-499B-AEA0-C8E8930E930C@remahl.se>

Say I implement web server that serves content for a number of  
different users, each on their own sub domain. My nevow site has a  
root resource that is sensitive to the host / port information in the  
request (virtual hosting). Since this happens is in a reverse-proxy  
situation, the root resource has a child, vhost, that allows the  
application to gain knowledge of which host the user accessed. One of  
the users, "evil", has a goal of stealing cookie content from people  
who visit goody's web shop.

The attacker makes the victim go to this URL:
     http://goody.com/vhost/http/evil.net/pageWithAttackJS.html
which gets rewritten (by the reverse proxy) to:
     http://internalserver:1234/vhost/http/goody.com/vhost/http/ 
evil.net/pageWithAttackJS.html

The web server looks up the vhost child of the root resource which  
consumes the next two components. It sets the host to goody.com, as  
it should be and passes control back to the root resource. The  
remaining URI at this point is:
     http://goody.com/vhost/http/evil.net/pageWithAttackJS.html

This once more invokes the vhost functionality, the following results  
and is accessed:
     http://evil.net/pageWithAttackJS.html

The malicious javascript code is sent to the client which interprets  
it. The problem is that the client still believes it accessed a  
resource on goody.com, and therefore allows the JS to access cookies  
set by goody.com. The same design flaw can be used for phising  
attacks etc (faking the "sender" of some information).

Can anyone suggest a good approach for preventing this kind of  
violation? I think limiting vhost from working unless the current  
request's host is (internalserver, 1234) would be safest. Other ideas?

/ Thanks, David Remahl

From dreid at dreid.org  Wed Oct 19 17:07:58 2005
From: dreid at dreid.org (David Reid)
Date: Wed Oct 19 17:07:49 2005
Subject: [Twisted-web] Preventing XSS when using Nevow's vhost
	functionality
In-Reply-To: <301F4B8C-3B09-499B-AEA0-C8E8930E930C@remahl.se>
References: <301F4B8C-3B09-499B-AEA0-C8E8930E930C@remahl.se>
Message-ID: <8F803272-D035-49EF-ACD3-3FDCF03F301B@dreid.org>


On Oct 19, 2005, at 2:48 PM, David Remahl wrote:
> The attacker makes the victim go to this URL:
>     http://goody.com/vhost/http/evil.net/pageWithAttackJS.html
> which gets rewritten (by the reverse proxy) to:
>     http://internalserver:1234/vhost/http/goody.com/vhost/http/ 
> evil.net/pageWithAttackJS.html
>
> The web server looks up the vhost child of the root resource which  
> consumes the next two components. It sets the host to goody.com, as  
> it should be and passes control back to the root resource. The  
> remaining URI at this point is:
>     http://goody.com/vhost/http/evil.net/pageWithAttackJS.html
>
> This once more invokes the vhost functionality, the following  
> results and is accessed:
>     http://evil.net/pageWithAttackJS.html

Your example is a little confusing.  VHostMonsterResource does expose  
applications using nevow.url to link hijacking.  So for your example  
to work /pageWithAttackJS.html would have to be on the target server,  
and generated links on that page would get rewritten as http:// 
evil.net/.  Potentially these generated links could include a  
<script> tag.

So now that everyone is on the same page, i've attached a proof of  
concept tac that better demonstrates the problem.  If you start the  
tac and go to it with http://localhost:8080/vhost/http/foo.bar/vhost/ 
http/google.com/ you should see the google logo loaded. if you do not  
include the final vhost call nothing should load.

So the problem is two fold, VHostMonsterResource is to trusting of  
the Host: header.  The solution to that is to use something like  
web2.vhost.VHostURIRewrite which sets the host:port for the request  
mangling at configuration time.   This might not be ideal in all  
enviroments if you have multiple hosts forwarding to the same  
application.

Another problem is that URL generation is to trusting of the context.  
Being able to easily generate links relative-to-root (rendering  
without the scheme and netloc portions) would also prevent this type  
of link hijacking.  (Though it would be potentially vulnerable to  
attacks from a sister application.)  But relative-to-root URL  
generation (as sane default) would negate the need for  
vhost.VHostMonsterResource in most cases.

However as for fixing VHostMonsterResource, I'd rather just see it  
die the slow painful death it deserves.  But I think if you're going  
to limit VHostMonsterResource to one proxy url, you might as well  
switch to a configuration time rewriter.  Another solution is to  
simply tag the request as rewritten so it doesn't get mangled a  
second time, raising the appropriate error code)

-David

?
-------------- next part --------------
Skipped content of type multipart/mixed
From jason.mobarak at gmail.com  Wed Oct 19 17:29:58 2005
From: jason.mobarak at gmail.com (Jason Mobarak)
Date: Wed Oct 19 17:30:05 2005
Subject: [Twisted-web] Preventing XSS when using Nevow's
	vhost	functionality
In-Reply-To: <8F803272-D035-49EF-ACD3-3FDCF03F301B@dreid.org>
References: <301F4B8C-3B09-499B-AEA0-C8E8930E930C@remahl.se>
	<8F803272-D035-49EF-ACD3-3FDCF03F301B@dreid.org>
Message-ID: <4356D6F6.6060108@gmail.com>

David Reid wrote:
> 
> On Oct 19, 2005, at 2:48 PM, David Remahl wrote:
> 
>> The attacker makes the victim go to this URL:
>>     http://goody.com/vhost/http/evil.net/pageWithAttackJS.html
>> which gets rewritten (by the reverse proxy) to:
>>     
>> http://internalserver:1234/vhost/http/goody.com/vhost/http/evil.net/pageWithAttackJS.html
>>
>> The web server looks up the vhost child of the root resource which 
>> consumes the next two components. It sets the host to goody.com, as it 
>> should be and passes control back to the root resource. The remaining 
>> URI at this point is:
>>     http://goody.com/vhost/http/evil.net/pageWithAttackJS.html
>>
>> This once more invokes the vhost functionality, the following results 
>> and is accessed:
>>     http://evil.net/pageWithAttackJS.html
> 
> 
> Your example is a little confusing.  VHostMonsterResource does expose 
> applications using nevow.url to link hijacking.  So for your example to 
> work /pageWithAttackJS.html would have to be on the target server, and 
> generated links on that page would get rewritten as http://evil.net/.  
> Potentially these generated links could include a <script> tag.  

So pageWithAttackJS.js would more likely be liveglue.js?

> 
> So now that everyone is on the same page, i've attached a proof of 
> concept tac that better demonstrates the problem.  If you start the tac 
> and go to it with 
> http://localhost:8080/vhost/http/foo.bar/vhost/http/google.com/ you 
> should see the google logo loaded. if you do not include the final vhost 
> call nothing should load.

I don't quite understand why this works.  If the first two segments of 
the vhost request are the protocol and the host why isn't it the case 
that these segments are consumed, the URL is re-written to:

http://foo.bar/vhost/http/google.com

...and it fails because foo.bar doesn't exist?  Why are the segments 
still consumed after this point, or...?

> 
> So the problem is two fold, VHostMonsterResource is to trusting of the 
> Host: header.  The solution to that is to use something like 
> web2.vhost.VHostURIRewrite which sets the host:port for the request 
> mangling at configuration time.   This might not be ideal in all 
> enviroments if you have multiple hosts forwarding to the same application.
> 
> Another problem is that URL generation is to trusting of the context. 
> Being able to easily generate links relative-to-root (rendering without 
> the scheme and netloc portions) would also prevent this type of link 
> hijacking.  (Though it would be potentially vulnerable to attacks from a 
> sister application.)  But relative-to-root URL generation (as sane 
> default) would negate the need for vhost.VHostMonsterResource in most cases.
> 
> However as for fixing VHostMonsterResource, I'd rather just see it die 
> the slow painful death it deserves.  But I think if you're going to 
> limit VHostMonsterResource to one proxy url, you might as well switch to 
> a configuration time rewriter.  Another solution is to simply tag the 
> request as rewritten so it doesn't get mangled a second time, raising 
> the appropriate error code)
> 
> -David


From david at remahl.se  Wed Oct 19 17:39:37 2005
From: david at remahl.se (David Remahl)
Date: Wed Oct 19 17:40:18 2005
Subject: [Twisted-web] Preventing XSS when using Nevow's vhost
	functionality
In-Reply-To: <8F803272-D035-49EF-ACD3-3FDCF03F301B@dreid.org>
References: <301F4B8C-3B09-499B-AEA0-C8E8930E930C@remahl.se>
	<8F803272-D035-49EF-ACD3-3FDCF03F301B@dreid.org>
Message-ID: <8F59F465-0CF4-4703-BACA-888CB3388252@remahl.se>

On 20 okt 2005, at 01.07, David Reid wrote:

> On Oct 19, 2005, at 2:48 PM, David Remahl wrote:
>> The attacker makes the victim go to this URL:
>>     http://goody.com/vhost/http/evil.net/pageWithAttackJS.html
>> which gets rewritten (by the reverse proxy) to:
>>     http://internalserver:1234/vhost/http/goody.com/vhost/http/ 
>> evil.net/pageWithAttackJS.html
>>
>> The web server looks up the vhost child of the root resource which  
>> consumes the next two components. It sets the host to goody.com,  
>> as it should be and passes control back to the root resource. The  
>> remaining URI at this point is:
>>     http://goody.com/vhost/http/evil.net/pageWithAttackJS.html
>>
>> This once more invokes the vhost functionality, the following  
>> results and is accessed:
>>     http://evil.net/pageWithAttackJS.html
>
> Your example is a little confusing.  VHostMonsterResource does  
> expose applications using nevow.url to link hijacking.  So for your  
> example to work /pageWithAttackJS.html would have to be on the  
> target server, and generated links on that page would get rewritten  
> as http://evil.net/.  Potentially these generated links could  
> include a <script> tag.
>
> So now that everyone is on the same page, i've attached a proof of  
> concept tac that better demonstrates the problem.  If you start the  
> tac and go to it with http://localhost:8080/vhost/http/foo.bar/ 
> vhost/http/google.com/ you should see the google logo loaded. if  
> you do not include the final vhost call nothing should load.
>
> So the problem is two fold, VHostMonsterResource is to trusting of  
> the Host: header.  The solution to that is to use something like  
> web2.vhost.VHostURIRewrite which sets the host:port for the request  
> mangling at configuration time.   This might not be ideal in all  
> enviroments if you have multiple hosts forwarding to the same  
> application.
>
> Another problem is that URL generation is to trusting of the  
> context. Being able to easily generate links relative-to-root  
> (rendering without the scheme and netloc portions) would also  
> prevent this type of link hijacking.  (Though it would be  
> potentially vulnerable to attacks from a sister application.)  But  
> relative-to-root URL generation (as sane default) would negate the  
> need for vhost.VHostMonsterResource in most cases.
>
> However as for fixing VHostMonsterResource, I'd rather just see it  
> die the slow painful death it deserves.  But I think if you're  
> going to limit VHostMonsterResource to one proxy url, you might as  
> well switch to a configuration time rewriter.  Another solution is  
> to simply tag the request as rewritten so it doesn't get mangled a  
> second time, raising the appropriate error code)
>
> -David
>
> <xss-nevow.tac>

Thanks for your reply!

I'm not sure your PoC encapsulates precisely the problem I described,  
but it is a valid variant which doesn't require as many preconditions  
(but is not possible to exploit in some browsers, such as Safari,  
that won't trust JS from another host even if directly referenced  
from goody). I think I should clarify that in my example, goody.com  
and evil.net are two sites that _are_ indeed served by the same nevow  
application. They each have their own little space on the same  
server, but they don't administer the application serving their  
content. I guess that's what you refer to as "sister applications".

If anyone is still unclear on my idea of the attack, I'll construct  
another PoC, since the two exploits are fundamentally different.

I'm not familiar with web2.vhost.VHostURIRewrite, but will check it  
out..."Configuration time", you say. I assume that means at the start  
of the handling of a request, not when the application is set up and  
configured? If so, that sounds like a good solution in many cases.

Only allowing a single "invocation" of the monster resource is  
insufficient in certain situations, namely when http://internalserver: 
1234/ is accessible from the outside and not _exclusively_ by the  
reverse proxy. This might also be a problem with the VHostURIRewrite  
approach?

/ Thanks, David
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-web/attachments/20051020/4b522254/attachment-0001.htm
From dreid at dreid.org  Wed Oct 19 17:42:54 2005
From: dreid at dreid.org (David Reid)
Date: Wed Oct 19 17:42:44 2005
Subject: [Twisted-web] Preventing XSS when using Nevow's
	vhost	functionality
In-Reply-To: <4356D6F6.6060108@gmail.com>
References: <301F4B8C-3B09-499B-AEA0-C8E8930E930C@remahl.se>
	<8F803272-D035-49EF-ACD3-3FDCF03F301B@dreid.org>
	<4356D6F6.6060108@gmail.com>
Message-ID: <267D86B6-4195-45CE-AB7F-8807731A973D@dreid.org>


On Oct 19, 2005, at 4:29 PM, Jason Mobarak wrote:
> So pageWithAttackJS.js would more likely be liveglue.js?

Perhaps, but I don't think liveglue.js is a hardcoded relative link.

> I don't quite understand why this works.  If the first two segments  
> of the vhost request are the protocol and the host why isn't it the  
> case that these segments are consumed, the URL is re-written to:
>
> http://foo.bar/vhost/http/google.com
>
> ...and it fails because foo.bar doesn't exist?  Why are the  
> segments still consumed after this point, or...?

Because the point of VHostMonsterResource is so that the application  
doesn't need to know the url it's actually being accessed from in a  
ProxyPass situation.  In a real world example you'd trick the user to  
go to http://foo.bar/vhost/http/google.com/ and the user would, the  
apache server at foo.bar would foward the request to http://localhost: 
8080/vhost/http/foo.bar/vhost/http/google.com/  so the above multiple  
calls happen and the final request consists of a host being set to  
google.com.  There just isn't any implementation for it to fail  
because foo.bar doesn't exist.  The jist is, VHostMonsterResources  
flaws are numerous and inherent.

-David
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-web/attachments/20051019/d3335958/attachment.htm
From dreid at dreid.org  Wed Oct 19 17:52:28 2005
From: dreid at dreid.org (David Reid)
Date: Wed Oct 19 17:52:20 2005
Subject: [Twisted-web] Preventing XSS when using Nevow's vhost
	functionality
In-Reply-To: <8F59F465-0CF4-4703-BACA-888CB3388252@remahl.se>
References: <301F4B8C-3B09-499B-AEA0-C8E8930E930C@remahl.se>
	<8F803272-D035-49EF-ACD3-3FDCF03F301B@dreid.org>
	<8F59F465-0CF4-4703-BACA-888CB3388252@remahl.se>
Message-ID: <15F60756-7244-4B50-817D-DB92BDE2D7EE@dreid.org>


On Oct 19, 2005, at 4:39 PM, David Remahl wrote:
> I'm not familiar with web2.vhost.VHostURIRewrite, but will check it  
> out..."Configuration time", you say. I assume that means at the  
> start of the handling of a request, not when the application is set  
> up and configured? If so, that sounds like a good solution in many  
> cases.

In fact configuration time does mean in the .tac.  You create a  
vhost.VHostURIRewrite resource like so:

    root = vhost.VHostURIRewrite(uri='http://host:port/path',  
resource=realrootresource)
    server.Site(root)

There is also a AutoVHostURIRewrite which makes use of x-app-scheme,  
x-forwarded-host, x-app-location, and x-forwarded-for headers to  
determine the real hostname port path etc and also the client ip  
address.  I'm fairly sure this isn't vulnerable to a similar attack  
as VHostMonsterResource but I haven't done an extensive audit of that  
particular code.

> Only allowing a single "invocation" of the monster resource is  
> insufficient in certain situations, namely when http:// 
> internalserver:1234/ is accessible from the outside and not  
> _exclusively_ by the reverse proxy. This might also be a problem  
> with the VHostURIRewrite approach?

It would be a problem with AutoVHostURIRewrite but not a problem with  
VHostURIRewrite, because VHostURIRewrite would mangle the request  
unconditionally and if the client clicked an absolute link would end  
up at the proper location anyway.   This unconditional mangling might  
have other implications if internalserver:1234 is accessible from  
outside but in my opinion that's just more of a reason to not have  
that kind of configuration.

-David
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-web/attachments/20051019/c5e60e62/attachment.htm
From mistobaan at gmail.com  Thu Oct 20 05:08:58 2005
From: mistobaan at gmail.com (Misto .)
Date: Thu Oct 20 05:09:01 2005
Subject: [Twisted-web] Probleming Building Nevow
Message-ID: <e437f2f0510200408g1ad0abf0k851e37bb63f932cb@mail.gmail.com>

Hi folks!

Today I did these steps:

nevow>svn co http://divmod.org/svn/Divmod/trunk/Nevow/
...

nevow>python setup.py build

c:\Documents and Settings\Giovanni\workspace\Nevow>python setup.py
Traceback (most recent call last):
  File "setup.py", line 8, in ?
    import setupcommon
  File "c:\Documents and
Settings\Giovanni\workspace\Nevow\setupcommon.py", line 1, in ?
    import nevow
  File "c:\Documents and
Settings\Giovanni\workspace\Nevow\nevow\__init__.py", line 12, in ?
    from nevow import compy
  File "c:\Documents and
Settings\Giovanni\workspace\Nevow\nevow\compy.py", line 16, in ?
    from compyCompat import *
AttributeError: 'module' object has no attribute 'IComponentized'


I'am running on windows XP

What appens?

Misto

From dialtone at divmod.com  Thu Oct 20 05:19:07 2005
From: dialtone at divmod.com (Valentino Volonghi aka Dialtone)
Date: Thu Oct 20 05:19:21 2005
Subject: [Twisted-web] Probleming Building Nevow
In-Reply-To: <e437f2f0510200408g1ad0abf0k851e37bb63f932cb@mail.gmail.com>
References: <e437f2f0510200408g1ad0abf0k851e37bb63f932cb@mail.gmail.com>
Message-ID: <20051020111907.GA9373@divmod.com>

On Thu, Oct 20, 2005 at 01:08:58PM +0200, Misto . wrote:
> What appens?

svn up
and retry

-- 
Valentino Volonghi aka Dialtone
Now Running MacOSX 10.4
Blog: http://vvolonghi.blogspot.com
http://weever.berlios.de
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 186 bytes
Desc: not available
Url : http://twistedmatrix.com/pipermail/twisted-web/attachments/20051020/99b123ca/attachment.bin
From dreid at dreid.org  Thu Oct 20 13:06:35 2005
From: dreid at dreid.org (David Reid)
Date: Thu Oct 20 13:06:24 2005
Subject: [Twisted-web] Preventing XSS when using Nevow's vhost
	functionality
In-Reply-To: <8F59F465-0CF4-4703-BACA-888CB3388252@remahl.se>
References: <301F4B8C-3B09-499B-AEA0-C8E8930E930C@remahl.se>
	<8F803272-D035-49EF-ACD3-3FDCF03F301B@dreid.org>
	<8F59F465-0CF4-4703-BACA-888CB3388252@remahl.se>
Message-ID: <FE1F959C-C942-4E35-918B-46F95F0147DB@dreid.org>


On Oct 19, 2005, at 4:39 PM, David Remahl wrote:
> I'm not sure your PoC encapsulates precisely the problem I  
> described, but it is a valid variant which doesn't require as many  
> preconditions (but is not possible to exploit in some browsers,  
> such as Safari, that won't trust JS from another host even if  
> directly referenced from goody). I think I should clarify that in  
> my example, goody.com and evil.net are two sites that _are_ indeed  
> served by the same nevow application. They each have their own  
> little space on the same server, but they don't administer the  
> application serving their content. I guess that's what you refer to  
> as "sister applications".

I just wrote this very long email about your suggested exploit, and  
then realized that the example configuration I imagined wouldn't  
cause the type of behavior you describe.   I can imagine a very  
complicated configuration that invovling 3  
vhost.VHostMonsterResources and 1 NameVirtualHost might allow someone  
to suddenly jump between two domains in the NameVirtualHost (at the  
urging of an attacker) but I haven't tried to put together a PoC. If  
this is in fact the configuration you're suggesting I only have this  
to say I can not think of a single use case for vhost.NameVirtualHost  
vhost.VHostMonsterResource being used today in a configuration such  
as what I believe you to be describing.  But if there is a use-case  
I'm honestly not sure there is a way to make it work without properly.

-David
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-web/attachments/20051020/61d03615/attachment.htm
From dreid at dreid.org  Thu Oct 20 13:39:37 2005
From: dreid at dreid.org (David Reid)
Date: Thu Oct 20 13:39:25 2005
Subject: [Twisted-web] Preventing XSS when using Nevow's vhost
	functionality
In-Reply-To: <FE1F959C-C942-4E35-918B-46F95F0147DB@dreid.org>
References: <301F4B8C-3B09-499B-AEA0-C8E8930E930C@remahl.se>
	<8F803272-D035-49EF-ACD3-3FDCF03F301B@dreid.org>
	<8F59F465-0CF4-4703-BACA-888CB3388252@remahl.se>
	<FE1F959C-C942-4E35-918B-46F95F0147DB@dreid.org>
Message-ID: <B072CAFB-D1DF-404A-AD7F-9B20A635B99F@dreid.org>

Attached is a proof of concept which points out the highly specific  
configuration (erroneous configuration) that would cause such an  
attack to work.

As you'll see http://localhost:8080/vhost/http/goody.com/vhost/http/ 
evil.net/ actually serves the EvilPage instance.

-------------- next part --------------
A non-text attachment was scrubbed...
Name: vhost-vuln.tac
Type: application/octet-stream
Size: 1529 bytes
Desc: not available
Url : http://twistedmatrix.com/pipermail/twisted-web/attachments/20051020/471ca419/vhost-vuln.obj
From therve at free.fr  Fri Oct 21 14:09:14 2005
From: therve at free.fr (Thomas HERVE)
Date: Fri Oct 21 14:11:47 2005
Subject: [Twisted-web] Status of Livepage ?
Message-ID: <20051021220914.lw016gs375wkg48k@itchy.wasabout.net>

I was wondering what is the current status of Livepage in Nevow : for us
Livepage users, is the move to 0.5 worthy ? I don't see big improvements, maybe
on client side (server.handle is cool) and cleaner API, but I do see things
broken.

With 0.4.1 I'm stuck with Twisted 1.3, so it's problematic (Twisted.Web and
Twisted.Mail updates for examples). Will Athena (official name ?) become the
standard Livepage in 0.6, so it could be wise to wait for it ?

To be more constructive, I've identify 2 problems in the flatten process in
Livepage:
1) The __call__ function in livepage makes a non-exhaustive test (basestring,
stan.Tag, types.FunctionType, types.MethodType, types.UnboundMethodType), and
it's a problem for examples with lists :
    client.set("mynode", [tags.span["tes't"], tags.span["tes't"]])
2) The _jsSingleQuoteQuote function in flat.flatstan seems to operate _before_
the flattening of stan content, so doesn't quote content when it added in
flattener:
    class Dummy(object): pass
    def flatter(o, res): return "Hi! I've got a quote!"
    flat.registerFlattener(flatter, Dummy)
    client.set("mynode", tags.span[Dummy()])

Thanks for your answers,

-- 
Thomas

From slamb at slamb.org  Fri Oct 21 22:51:53 2005
From: slamb at slamb.org (Scott Lamb)
Date: Fri Oct 21 22:51:57 2005
Subject: [Twisted-web] web2.client keep-alive problem
Message-ID: <9FF5984C-39AD-4936-AF95-9E3018898563@slamb.org>

I've run into another problem in my application that uses the dreid/ 
web2-client branch. This one I'm not sure how to solve, or even  
kludge around for the moment.

My application makes a bunch of HTTP requests in serial. It needs to  
see the previous response to make the next request.

When I handle a HTTP response, I originally wrote it like this  
(simplified):

     def _makeRequest(self, ...):
         req = client.Request(...)
         req.addCallback(self._handleResponse)

     def _handleResponse(self, response):
         stream.readStream(response.stream, self._handleResponseBody)

     def _handleResponseBody(self, body):
         self._makeRequest(...)

This worked fine - proper HTTP Keep-Alives and whatnot - until I got  
a large response back. Then I realized that stream.readStream gives  
me chunks and I should instead be using this (if I want to handle the  
whole response at once):

     def _handleResponse(self, response):
         self.body = ''
         stream.readStream(response.stream, self._handleResponseChunk
         ).addCallback(self._handleResponseBody)

     def _handleResponseChunk(self, chunk):
         self.body += chunk

     def _handleResponseBody(self):
         self._makeRequest(...)
         self.body = None

This works with the chunking, but I am now making an HTTP connection  
for each request. HTTPClient._endResponse() calls  
self.response.stream.finish() and then tears down the connection if  
no request is pending. But stream.finish() doesn't call my deferred  
right away; it happens later from the reactor. So though I want to  
make another request, I haven't had my chance yet. My connection is  
torn down, then I make a new one and do an expensive SSL handshake,  
which is all wasted round trips, bandwidth, and CPU time.

I can think of two ways to solve this:

(1) make stream.ProducerStream.finish() call _handleResponseBody  
right away. But there's a "reactor.callLater(0, self._read)" in  
stream._StreamReader that looks to be there for a reason. I haven't  
thought it through, but I suspect there are unsolvable recursion  
problems with this approach.

(2) make HTTPClient not check if the connection should be torn down  
until after my deferred has had a chance to run. Would just a  
"reactor.callLater(0, self._endResponse2)" be enough? Are callLaters  
guaranteed to be run in order?

-- 
Scott Lamb <http://www.slamb.org/>


From slamb at slamb.org  Sat Oct 22 00:15:20 2005
From: slamb at slamb.org (Scott Lamb)
Date: Sat Oct 22 00:15:30 2005
Subject: [Twisted-web] web2.client keep-alive problem
In-Reply-To: <9FF5984C-39AD-4936-AF95-9E3018898563@slamb.org>
References: <9FF5984C-39AD-4936-AF95-9E3018898563@slamb.org>
Message-ID: <3848B457-ED3F-4285-9814-168D8C06B6FA@slamb.org>

On 21 Oct 2005, at 21:51, Scott Lamb wrote:

> (2) make HTTPClient not check if the connection should be torn down  
> until after my deferred has had a chance to run. Would just a  
> "reactor.callLater(0, self._endResponse2)" be enough? Are  
> callLaters guaranteed to be run in order?

I just tried this and it seems to work. It'd be reassuring to hear  
that it's guaranteed, though.

-- 
Scott Lamb <http://www.slamb.org/>


From maillists at ivsn.com  Sun Oct 23 05:17:30 2005
From: maillists at ivsn.com (Paul Reznicek)
Date: Sun Oct 23 05:18:11 2005
Subject: [Twisted-web] Problem accessing  svn://divmod.org/svn/Nevow/trunk
Message-ID: <435B714A.60509@ivsn.com>

Dears at Divmod,
The svn://divmod.org/svn/Nevow/trunk is not accessible with following error:

svn list svn://divmod.org/svn/Nevow/ --verbose --non-interactive
svn: Berkeley DB error while opening environment for filesystem /svn/Nevow/db:
Permission denied
error (1)

Would you please correct it, so I can update my local files?

Thanks and best regards,
Paul Reznicek

From maillists at ivsn.com  Sun Oct 23 09:09:42 2005
From: maillists at ivsn.com (Paul Reznicek)
Date: Sun Oct 23 09:10:23 2005
Subject: [Twisted-web] Problem accessing  svn://divmod.org - 2
In-Reply-To: <200510231405.17884.michal@pasternak.in>
References: <200510231405.17884.michal@pasternak.in>
Message-ID: <435BA7B6.2060508@ivsn.com>

Michal Pasternak wrote:
> 
> ..........
> 
> I've mentioned this a few times on IRC but just to make sure that there is no
>  last minute confusion: the Nevow repository will be moving to a new URL
>  (http://divmod.org/svn/Divmod/trunk/Nevow) tomorrow.  The repository may be ...
> .........

Thank you for the hint, but would you please give me a tip for access rights?
I got following error:

svn list svn://divmod.org/svn/Divmod/trunk/Nevow/ --verbose --non-interactive
svn: No access allowed to this repository
error (1)

Thanks again,
Paul Reznicek

From david at remahl.se  Sun Oct 23 09:16:59 2005
From: david at remahl.se (David Remahl)
Date: Sun Oct 23 09:17:51 2005
Subject: [Twisted-web] Problem accessing  svn://divmod.org - 2
In-Reply-To: <435BA7B6.2060508@ivsn.com>
References: <200510231405.17884.michal@pasternak.in>
	<435BA7B6.2060508@ivsn.com>
Message-ID: <3D2F5FD0-D096-4956-9747-F3E0041DCEFC@remahl.se>

On 23 okt 2005, at 17.09, Paul Reznicek wrote:

> Michal Pasternak wrote:
>> ..........
>> I've mentioned this a few times on IRC but just to make sure that  
>> there is no
>>  last minute confusion: the Nevow repository will be moving to a  
>> new URL
>>  (http://divmod.org/svn/Divmod/trunk/Nevow) tomorrow.  The  
>> repository may be ...
>> .........
>
> Thank you for the hint, but would you please give me a tip for  
> access rights?
> I got following error:
>
> svn list svn://divmod.org/svn/Divmod/trunk/Nevow/ --verbose --non- 
> interactive
> svn: No access allowed to this repository
> error (1)
>
> Thanks again,
> Paul Reznicek

Read again, the scheme is now http:, not svn:. :-)

/ Rgds, David


From maillists at ivsn.com  Sun Oct 23 09:26:28 2005
From: maillists at ivsn.com (Paul Reznicek)
Date: Sun Oct 23 09:27:04 2005
Subject: [Twisted-web] Problem accessing  svn://divmod.org - 2
In-Reply-To: <3D2F5FD0-D096-4956-9747-F3E0041DCEFC@remahl.se>
References: <200510231405.17884.michal@pasternak.in>	<435BA7B6.2060508@ivsn.com>
	<3D2F5FD0-D096-4956-9747-F3E0041DCEFC@remahl.se>
Message-ID: <435BABA4.7050705@ivsn.com>

David Remahl wrote:
> ............
> 
> Read again, the scheme is now http:, not svn:. :-)
> 
> / Rgds, David
> 

THANKS !!! I needed to clean my glasses ...
Regards, Paul

From bhyz00 at gmail.com  Sun Oct 23 14:31:42 2005
From: bhyz00 at gmail.com (Boh Yap)
Date: Sun Oct 23 14:31:45 2005
Subject: [Twisted-web] Form POST to a twisted web2 Resource fails...
Message-ID: <5ca6b3580510231331y1393e6bhf0d2b817676aa319@mail.gmail.com>

hi,

I have recently (last 2 weeks) been working with twisted2 and web2.
However when submitting a form using 'method="POST" ', I get this error:

  The requested method POST is not supported by
/vwZMbr_detl?mbr_id=6&listuse=edit&LOI=0.

But when I use 'method="GET", its OK.

I followed the example in the Twisted2 docs.
<http://twistedmatrix.com/projects/web2/documentation/examples/demo.html>

this is what I have in the HTML form:
(vwZMbr_detl is the Resource thats suppose to process the Web form)

--snip--
<form method="POST" enctype="x-www-form-urlencoded">   <-- following
example code

...error_msg: The requested method POST is not supported by
                        /vwZMbr_detl?mbr_id=6&listuse=edit&LOI=0.


<form action="vwZMbr_detl" method="POST">                         <--
this doesnt work either!

    error_msg:  The requested method POST is not supported by /vwZMbr_detl.


<form action="vwZMbr_detl" method="get">                <-- this works !
...
--snip--

my resource has this:

    class MyResc(resource.PostableResource):
        ....
          def render(self, ctx):                                      
       <-- reneder method to return a string
                ....

further notes:
 the code has been ported over from Twisted1.xx and web1, and is
working fine as .rpy's (as beta but not yet deployed in pproduction)
 Am porting over to Twisted2 and Web2 as starting on a new project, as
might as well use the latest and greatest... is that advisable? Can
someone pls advise if Twisted2 + Web2 is ready for production? The
app. will have start off with reltively low volume, but may need to
scale up qite quickly. Any advise will be appreciated.


I've dug around but cannot seem to find a solution,  and any help will
be appreciated....

thanks,

Boh Yap
bhyz@mac.com

From bhyz00 at gmail.com  Mon Oct 24 14:24:57 2005
From: bhyz00 at gmail.com (Boh Yap)
Date: Mon Oct 24 14:25:00 2005
Subject: [Twisted-web] Re: Twisted-web Digest, Vol 19, Issue 22
In-Reply-To: <E1EU6cA-0000jC-02@pyramid.twistedmatrix.com>
References: <E1EU6cA-0000jC-02@pyramid.twistedmatrix.com>
Message-ID: <5ca6b3580510241324j992eecdpa949e007790d16f3@mail.gmail.com>

have since solved the problem.

I called the resource 'vwZMbr_detl' via a wrapper in the root resource
published as .tac. This wrapper was a child in the toplevel resorce.

In my class declaration for the wrapper, I did not inherit
resource.PostableResource, just 'resource.Resource', altho I had this
in the actual 'vwZMbr_detl' class.

below is the solution and parts of code, hope this helps somebody...

ie:

---start code snippet---
(ZMembr.tac)                                                          
<-- module that was published
   ....
   class  zoomMbr_detl(resource.Resource):     <-- the wrapper class that
                                                                      
                   called 'vwZMbr_detl' class

   class  zoomMbr_detl(resource.PostableResource):  <-- changed to this,
                                                                      
                              now works!
   ...
   class Toplevel(resource.Resource)             <-- top level resource
   ...

         child_vwZMbr_detl = zoomMbr_detl()     <--child of top-level resource

         def render(self, ctx)                                     <--
render mthd for top level
                                                                      
                 resource
               ....

site = server.Site(Toplevel())                             <--
boilerplate for publishing
                                                                      
               twisted resources.
from twisted.application import service, strports
application = service.Application("ZMembr")
webserver = strports.service('tcp:8780', http.HTTPFactory(site))
webserver.setServiceParent(application)

---end---



On 10/25/05, twisted-web-request@twistedmatrix.com
<twisted-web-request@twistedmatrix.com> wrote:
> Send Twisted-web mailing list submissions to
>         twisted-web@twistedmatrix.com
>
> To subscribe or unsubscribe via the World Wide Web, visit
>         http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web
> or, via email, send a message with subject or body 'help' to
>         twisted-web-request@twistedmatrix.com
>
> You can reach the person managing the list at
>         twisted-web-owner@twistedmatrix.com
>
> When replying, please edit your Subject line so it is more specific
> than "Re: Contents of Twisted-web digest..."
>
>
> Today's Topics:
>
>    1. Form POST to a twisted web2 Resource fails... (Boh Yap)
>
>
> ----------------------------------------------------------------------
>
> Message: 1
> Date: Mon, 24 Oct 2005 04:31:42 +0800
> From: Boh Yap <bhyz00@gmail.com>
> Subject: [Twisted-web] Form POST to a twisted web2 Resource fails...
> To: twisted-web@twistedmatrix.com
> Message-ID:
>         <5ca6b3580510231331y1393e6bhf0d2b817676aa319@mail.gmail.com>
> Content-Type: text/plain; charset=ISO-8859-1
>
> hi,
>
> I have recently (last 2 weeks) been working with twisted2 and web2.
> However when submitting a form using 'method="POST" ', I get this error:
>
>   The requested method POST is not supported by
> /vwZMbr_detl?mbr_id=6&listuse=edit&LOI=0.
>
> But when I use 'method="GET", its OK.
>
> I followed the example in the Twisted2 docs.
> <http://twistedmatrix.com/projects/web2/documentation/examples/demo.html>
>
> this is what I have in the HTML form:
> (vwZMbr_detl is the Resource thats suppose to process the Web form)
>
> --snip--
> <form method="POST" enctype="x-www-form-urlencoded">   <-- following
> example code
>
> ...error_msg: The requested method POST is not supported by
>                         /vwZMbr_detl?mbr_id=6&listuse=edit&LOI=0.
>
>
> <form action="vwZMbr_detl" method="POST">                         <--
> this doesnt work either!
>
>     error_msg:  The requested method POST is not supported by /vwZMbr_detl.
>
>
> <form action="vwZMbr_detl" method="get">                <-- this works !
> ...
> --snip--
>
> my resource has this:
>
>     class MyResc(resource.PostableResource):
>         ....
>           def render(self, ctx):
>        <-- reneder method to return a string
>                 ....
>
> further notes:
>  the code has been ported over from Twisted1.xx and web1, and is
> working fine as .rpy's (as beta but not yet deployed in pproduction)
>  Am porting over to Twisted2 and Web2 as starting on a new project, as
> might as well use the latest and greatest... is that advisable? Can
> someone pls advise if Twisted2 + Web2 is ready for production? The
> app. will have start off with reltively low volume, but may need to
> scale up qite quickly. Any advise will be appreciated.
>
>
> I've dug around but cannot seem to find a solution,  and any help will
> be appreciated....
>
> thanks,
>
> Boh Yap
> bhyz@mac.com
>
>
>
> ------------------------------
>
> _______________________________________________
> Twisted-web mailing list
> Twisted-web@twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web
>
>
> End of Twisted-web Digest, Vol 19, Issue 22
> *******************************************
>
'

From p.mayers at imperial.ac.uk  Mon Oct 24 15:14:21 2005
From: p.mayers at imperial.ac.uk (Phil Mayers)
Date: Mon Oct 24 15:14:56 2005
Subject: [Twisted-web] small bug LivePage in 0.5
Message-ID: <435D4EAD.8060504@imperial.ac.uk>

Accessing this page causes the server to spin at 100% CPU usage:

class WrongBaseClass(rend.Page):
   docFactory = loaders.stan(
     html[
       head[
         livepage.glue,
       ],
       body[
         p["blah"],
       ],
     ])

...whilst it's clearly an error, a helpful diagnostic message would have 
saved me hours of debugging including ripping out a perfectly good HTTP 
basic auth base class and implementing guard (talking of which)

From p.mayers at imperial.ac.uk  Mon Oct 24 15:53:51 2005
From: p.mayers at imperial.ac.uk (Phil Mayers)
Date: Mon Oct 24 15:54:26 2005
Subject: [Twisted-web] Nevow, guard and PAM
Message-ID: <435D57EF.8000605@imperial.ac.uk>

A common requirement (I imagine) is to hook Nevow/Guard authentication 
out to system auth; even more commonly PAM, though maybe not. This is a 
relatively straightforward recipie that works for me. See:

http://deadbeefbabe.org/paste/1939

Basically, a Cred checker for IUsernamePassword is written; it writes 
the u/p down the unix socket to Cyrus SASLs "saslauthd", and callbacks 
or errbacks a deferred as appropriate.

My RHEL3 box has:

/etc/sysconfig/saslauthd::

FLAGS="-c -n 0"
MECH="pam"

...and /etc/pam.d/MYSERVICE:

#%PAM-1.0
auth       required     /lib/security/$ISA/pam_krb5.so no_user_check
account    required     /lib/security/$ISA/pam_permit.so
password   required     /lib/security/$ISA/pam_permit.so
session    required     /lib/security/$ISA/pam_permit.so

...Kerberos being used to hand off to AD.

There's also some code in there to handle jumping "straight in" to a 
guarded hiearchy; specifically the locateChild and data_misc / 
"form(action=T.slot('action'))" idiom. I *think* this is right, but may 
not be completely general. I'd appreciate comments.

From robbyd at u20.org  Thu Oct 27 11:50:17 2005
From: robbyd at u20.org (Robby Dermody)
Date: Thu Oct 27 11:49:44 2005
Subject: [Twisted-web] livepage connection "timing out"/dying randomly
Message-ID: <43611359.6050207@u20.org>

Hey guys,

I seem to have a problem with client browsers to my guarded livepage 
application loosing their livepage connections. It seems that the guard 
session doesn?t expire, but the livepage system on the server side seems 
like it will loose track of the client?s nevow handle. This is under the 
Nevow 0.5.0 release, and it happens under both IE 6.0.x and Firefox 1.0.x.

Basically, my server app makes livepage calls to the client browser js 
via clientHandle.call() to reflect dynamically updated data as it 
happens? (maybe one call every 4 seconds). At this point I found this 
problem (that at some point these updates in the client would stop, 
while the server was still making the livepage call() invocations like 
everything was fine and dandy). The problem was that things just seemed 
to die, and I could find no error output showing why.

Well, in my search for a fix/error output, I added a js function on the 
client that calls server.handle('refreshSession()') every 120 seconds 
via the use of repeated setTimeout() calls. The corresponding 
handle_refreshSession() function on the server gets that client's 
session object and touch()es it.

This will start out working fine for usually a few hours (the session 
timeout is 1200 seconds currently), and the client will stay logged in. 
Then after some seemingly arbitrary amount of time, I will start getting 
the following errors, one set for each refreshSession() call:

 From the client side (firefox java console):

Error: syntax error
Source File: http://216.148.216.20:8800/mon/nevow_glue.js
Line: 155
Source Code:
<html><head><title>Exception</title></head><body><style type="text/css">

 From a glance at nevow_glue.js, it looks like the server returned an 
exception page to the client and nevow_clientToServerEvent() in 
nevow_glue.js didn?t like that when it tried to evaluate it as 
javascript code, or some kind of javascript result.

On the server side I get the following python exception:

---**** EXCEPTION START ****---
Traceback (most recent call last):
   File "/usr/lib/python2.4/site-packages/twisted/internet/defer.py", 
line 216, in addCallback
     callbackKeywords=kw)
   File "/usr/lib/python2.4/site-packages/twisted/internet/defer.py", 
line 207, in addCallbacks
     self._runCallbacks()
   File "/usr/lib/python2.4/site-packages/twisted/internet/defer.py", 
line 328, in _runCallbacks
     self.result = callback(self.result, *args, **kw)
   File "/usr/lib/python2.4/site-packages/nevow/appserver.py", line 308, 
in handleSegment
     return defer.maybeDeferred(
--- <exception caught here> ---
   File "/usr/lib/python2.4/site-packages/twisted/internet/defer.py", 
line 117, in maybeDeferred
     result = f(*args, **kw)
   File "/usr/lib/python2.4/site-packages/nevow/livepage.py", line 596, 
in locateChild
     client = self.clientFactory.clientHandles[handleId]
exceptions.KeyError: '2'

---****  EXCEPTION END  ****---

In this case, the key ?2? was the setting of the client?s 
?nevow_clientHandleID? variable. This will happen every time the client 
tries to make the call (e.g. every 120 seconds).

I think these two types of updates I?m doing (one where the server tries 
to call a js method on the client when its data is updated, and one 
where the client periodically ?pings? the server) are both exposing the 
same error. The only difference is that the one where the client pings 
the server with the server.handle() call exposes some error messages of 
what may be going wrong.

Might I be forgetting to do something, or using livepage improperly? My 
goal is to make it so that, as long as a client?s browser is logged in 
and at my page, they will keep getting livepage events indefinitely.

Might the newest version from the repository fix this?


Thanks for any help,

Robby

From clw at get2net.dk  Sat Oct 29 14:06:16 2005
From: clw at get2net.dk (Claus =?iso-8859-1?q?Ladekj=E6r_Wilson?=)
Date: Sat Oct 29 14:08:46 2005
Subject: [Twisted-web] installing xen - missing twisted
Message-ID: <200510292206.16709.clw@get2net.dk>

I'm trying to install xen on gentoo linux. But installation complains that it 
misses twisted which I did install. So maybe the installation of xen doesn't 
find it. How could I tell it where it is?
-- 
Venlig hilsen / Greetings from
Claus Ladekj?r Wilson
Bellisv?nget 18
DK - 5450 Otterup
tlf. +45-66191050 / mob. +45-61665543
http://www.clauswilson.dk
Linux gentoo 2004.2 kernel 2.6.7

From dripton at ripton.net  Sat Oct 29 17:27:33 2005
From: dripton at ripton.net (David Ripton)
Date: Sat Oct 29 17:27:36 2005
Subject: [Twisted-web] installing xen - missing twisted
In-Reply-To: <200510292206.16709.clw@get2net.dk>
References: <200510292206.16709.clw@get2net.dk>
Message-ID: <20051029232733.GA16643@vidar.dreamhost.com>

On 2005.10.29 22:06:16 +0200, Claus Ladekj?r Wilson wrote:
> I'm trying to install xen on gentoo linux. But installation complains that it 
> misses twisted which I did install. So maybe the installation of xen doesn't 
> find it. How could I tell it where it is?

This is the twisted-web list.  You probably wanted the main twisted
list.  Actually, you probably wanted the Gentoo forums.

Gentoo method:

"man equery" will show you how to search for installed packages and
files.  I think you want "equery f twisted"  (If you don't have equery,
"emerge gentoolkit".)

Python method:

$ python
Python 2.4.2 (#1, Sep 30 2005, 00:16:18)
[GCC 3.4.4 (Gentoo 3.4.4-r1, ssp-3.4.4-1.0, pie-8.7.8)] on linux2
Type "help", "copyright", "credits" or "license" for more information.
>>> import twisted
>>> twisted.__path__
['/usr/lib/python2.4/site-packages/twisted']

Generic Unixoid method:
$ find / -name twisted

-- 
David Ripton    dripton@ripton.net

From clw at get2net.dk  Sat Oct 29 18:07:35 2005
From: clw at get2net.dk (Claus =?iso-8859-1?q?Ladekj=E6r_Wilson?=)
Date: Sat Oct 29 18:10:26 2005
Subject: [Twisted-web] installing xen - missing twisted
In-Reply-To: <20051029232733.GA16643@vidar.dreamhost.com>
References: <200510292206.16709.clw@get2net.dk>
	<20051029232733.GA16643@vidar.dreamhost.com>
Message-ID: <200510300207.35256.clw@get2net.dk>


thanks a lot!


S?ndag den 30. oktober 2005 01:27 skrev David Ripton:
> On 2005.10.29 22:06:16 +0200, Claus Ladekj?r Wilson wrote:
> > I'm trying to install xen on gentoo linux. But installation complains
> > that it misses twisted which I did install. So maybe the installation of
> > xen doesn't find it. How could I tell it where it is?
>
> This is the twisted-web list.  You probably wanted the main twisted
> list.  Actually, you probably wanted the Gentoo forums.
>
> Gentoo method:
>
> "man equery" will show you how to search for installed packages and
> files.  I think you want "equery f twisted"  (If you don't have equery,
> "emerge gentoolkit".)
>
> Python method:
>
> $ python
> Python 2.4.2 (#1, Sep 30 2005, 00:16:18)
> [GCC 3.4.4 (Gentoo 3.4.4-r1, ssp-3.4.4-1.0, pie-8.7.8)] on linux2
> Type "help", "copyright", "credits" or "license" for more information.
>
> >>> import twisted
> >>> twisted.__path__
>
> ['/usr/lib/python2.4/site-packages/twisted']
>
> Generic Unixoid method:
> $ find / -name twisted

-- 
Venlig hilsen / Greetings from
Claus Ladekj?r Wilson
Bellisv?nget 18
DK - 5450 Otterup
tlf. +45-66191050 / mob. +45-61665543
http://www.clauswilson.dk
Linux gentoo 2004.2 kernel 2.6.7

From foom at fuhm.net  Sun Oct 30 20:08:24 2005
From: foom at fuhm.net (James Y Knight)
Date: Sun Oct 30 20:08:33 2005
Subject: [Twisted-web] livepage connection "timing out"/dying randomly
In-Reply-To: <43611359.6050207@u20.org>
References: <43611359.6050207@u20.org>
Message-ID: <6C18BD20-063C-405D-B5BA-1DD18965A4C7@fuhm.net>

On Oct 27, 2005, at 1:50 PM, Robby Dermody wrote:
> I seem to have a problem with client browsers to my guarded  
> livepage application loosing their livepage connections. It seems  
> that the guard session doesn?t expire, but the livepage system on  
> the server side seems like it will loose track of the client?s  
> nevow handle. This is under the Nevow 0.5.0 release, and it happens  
> under both IE 6.0.x and Firefox 1.0.x.

I believe both livepage and athena currently have broken reconnect  
support, so if the server->client socket closes unexpectedly for  
whatever reason (the most common reason is you have an HTTP proxy  
with a timeout of a small number of seconds), the client will attempt  
to reconnect to the same livepage session with the same client id (as  
it should), but the server doesn't accept the reconnect attempt and  
throws an error.

James



