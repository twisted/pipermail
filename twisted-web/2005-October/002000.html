<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] Preventing XSS when using Nevow's vhost functionality
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Preventing%20XSS%20when%20using%20Nevow%27s%20vhost%20functionality&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001999.html">
   <LINK REL="Next"  HREF="002001.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] Preventing XSS when using Nevow's vhost functionality</H1>
    <B>David Remahl</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Preventing%20XSS%20when%20using%20Nevow%27s%20vhost%20functionality&In-Reply-To="
       TITLE="[Twisted-web] Preventing XSS when using Nevow's vhost functionality">david at remahl.se
       </A><BR>
    <I>Wed Oct 19 15:48:47 MDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="001999.html">[Twisted-web] twisted.web getPage-- retrieving error information 
</A></li>
        <LI>Next message: <A HREF="002001.html">[Twisted-web] Preventing XSS when using Nevow's vhost
	functionality
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2000">[ date ]</a>
              <a href="thread.html#2000">[ thread ]</a>
              <a href="subject.html#2000">[ subject ]</a>
              <a href="author.html#2000">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Say I implement web server that serves content for a number of  
different users, each on their own sub domain. My nevow site has a  
root resource that is sensitive to the host / port information in the  
request (virtual hosting). Since this happens is in a reverse-proxy  
situation, the root resource has a child, vhost, that allows the  
application to gain knowledge of which host the user accessed. One of  
the users, &quot;evil&quot;, has a goal of stealing cookie content from people  
who visit goody's web shop.

The attacker makes the victim go to this URL:
     <A HREF="http://goody.com/vhost/http/evil.net/pageWithAttackJS.html">http://goody.com/vhost/http/evil.net/pageWithAttackJS.html</A>
which gets rewritten (by the reverse proxy) to:
     <A HREF="http://internalserver:1234/vhost/http/goody.com/vhost/http/">http://internalserver:1234/vhost/http/goody.com/vhost/http/</A> 
evil.net/pageWithAttackJS.html

The web server looks up the vhost child of the root resource which  
consumes the next two components. It sets the host to goody.com, as  
it should be and passes control back to the root resource. The  
remaining URI at this point is:
     <A HREF="http://goody.com/vhost/http/evil.net/pageWithAttackJS.html">http://goody.com/vhost/http/evil.net/pageWithAttackJS.html</A>

This once more invokes the vhost functionality, the following results  
and is accessed:
     <A HREF="http://evil.net/pageWithAttackJS.html">http://evil.net/pageWithAttackJS.html</A>

The malicious javascript code is sent to the client which interprets  
it. The problem is that the client still believes it accessed a  
resource on goody.com, and therefore allows the JS to access cookies  
set by goody.com. The same design flaw can be used for phising  
attacks etc (faking the &quot;sender&quot; of some information).

Can anyone suggest a good approach for preventing this kind of  
violation? I think limiting vhost from working unless the current  
request's host is (internalserver, 1234) would be safest. Other ideas?

/ Thanks, David Remahl

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001999.html">[Twisted-web] twisted.web getPage-- retrieving error information 
</A></li>
	<LI>Next message: <A HREF="002001.html">[Twisted-web] Preventing XSS when using Nevow's vhost
	functionality
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2000">[ date ]</a>
              <a href="thread.html#2000">[ thread ]</a>
              <a href="subject.html#2000">[ subject ]</a>
              <a href="author.html#2000">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
