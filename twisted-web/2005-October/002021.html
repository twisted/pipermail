<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] livepage connection &quot;timing out&quot;/dying randomly
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20livepage%20connection%20%22timing%20out%22/dying%20randomly&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002020.html">
   <LINK REL="Next"  HREF="002025.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] livepage connection &quot;timing out&quot;/dying randomly</H1>
    <B>Robby Dermody</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20livepage%20connection%20%22timing%20out%22/dying%20randomly&In-Reply-To="
       TITLE="[Twisted-web] livepage connection &quot;timing out&quot;/dying randomly">robbyd at u20.org
       </A><BR>
    <I>Thu Oct 27 11:50:17 MDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="002020.html">[Twisted-web] Nevow, guard and PAM
</A></li>
        <LI>Next message: <A HREF="002025.html">[Twisted-web] livepage connection &quot;timing out&quot;/dying randomly
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2021">[ date ]</a>
              <a href="thread.html#2021">[ thread ]</a>
              <a href="subject.html#2021">[ subject ]</a>
              <a href="author.html#2021">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hey guys,

I seem to have a problem with client browsers to my guarded livepage 
application loosing their livepage connections. It seems that the guard 
session doesn&#8217;t expire, but the livepage system on the server side seems 
like it will loose track of the client&#8217;s nevow handle. This is under the 
Nevow 0.5.0 release, and it happens under both IE 6.0.x and Firefox 1.0.x.

Basically, my server app makes livepage calls to the client browser js 
via clientHandle.call() to reflect dynamically updated data as it 
happens&#8230; (maybe one call every 4 seconds). At this point I found this 
problem (that at some point these updates in the client would stop, 
while the server was still making the livepage call() invocations like 
everything was fine and dandy). The problem was that things just seemed 
to die, and I could find no error output showing why.

Well, in my search for a fix/error output, I added a js function on the 
client that calls server.handle('refreshSession()') every 120 seconds 
via the use of repeated setTimeout() calls. The corresponding 
handle_refreshSession() function on the server gets that client's 
session object and touch()es it.

This will start out working fine for usually a few hours (the session 
timeout is 1200 seconds currently), and the client will stay logged in. 
Then after some seemingly arbitrary amount of time, I will start getting 
the following errors, one set for each refreshSession() call:

 From the client side (firefox java console):

Error: syntax error
Source File: <A HREF="http://216.148.216.20:8800/mon/nevow_glue.js">http://216.148.216.20:8800/mon/nevow_glue.js</A>
Line: 155
Source Code:
&lt;html&gt;&lt;head&gt;&lt;title&gt;Exception&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;style type=&quot;text/css&quot;&gt;

 From a glance at nevow_glue.js, it looks like the server returned an 
exception page to the client and nevow_clientToServerEvent() in 
nevow_glue.js didn&#8217;t like that when it tried to evaluate it as 
javascript code, or some kind of javascript result.

On the server side I get the following python exception:

---**** EXCEPTION START ****---
Traceback (most recent call last):
   File &quot;/usr/lib/python2.4/site-packages/twisted/internet/defer.py&quot;, 
line 216, in addCallback
     callbackKeywords=kw)
   File &quot;/usr/lib/python2.4/site-packages/twisted/internet/defer.py&quot;, 
line 207, in addCallbacks
     self._runCallbacks()
   File &quot;/usr/lib/python2.4/site-packages/twisted/internet/defer.py&quot;, 
line 328, in _runCallbacks
     self.result = callback(self.result, *args, **kw)
   File &quot;/usr/lib/python2.4/site-packages/nevow/appserver.py&quot;, line 308, 
in handleSegment
     return defer.maybeDeferred(
--- &lt;exception caught here&gt; ---
   File &quot;/usr/lib/python2.4/site-packages/twisted/internet/defer.py&quot;, 
line 117, in maybeDeferred
     result = f(*args, **kw)
   File &quot;/usr/lib/python2.4/site-packages/nevow/livepage.py&quot;, line 596, 
in locateChild
     client = self.clientFactory.clientHandles[handleId]
exceptions.KeyError: '2'

---****  EXCEPTION END  ****---

In this case, the key &#8216;2&#8217; was the setting of the client&#8217;s 
&#8220;nevow_clientHandleID&#8221; variable. This will happen every time the client 
tries to make the call (e.g. every 120 seconds).

I think these two types of updates I&#8217;m doing (one where the server tries 
to call a js method on the client when its data is updated, and one 
where the client periodically &#8220;pings&#8221; the server) are both exposing the 
same error. The only difference is that the one where the client pings 
the server with the server.handle() call exposes some error messages of 
what may be going wrong.

Might I be forgetting to do something, or using livepage improperly? My 
goal is to make it so that, as long as a client&#8217;s browser is logged in 
and at my page, they will keep getting livepage events indefinitely.

Might the newest version from the repository fix this?


Thanks for any help,

Robby

</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002020.html">[Twisted-web] Nevow, guard and PAM
</A></li>
	<LI>Next message: <A HREF="002025.html">[Twisted-web] livepage connection &quot;timing out&quot;/dying randomly
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2021">[ date ]</a>
              <a href="thread.html#2021">[ thread ]</a>
              <a href="subject.html#2021">[ subject ]</a>
              <a href="author.html#2021">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
