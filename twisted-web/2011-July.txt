From johnaherne at rocs.co.uk  Fri Jul  1 04:42:13 2011
From: johnaherne at rocs.co.uk (John Aherne)
Date: Fri, 1 Jul 2011 09:42:13 +0100
Subject: [Twisted-web] mental block on agent.request response timeout
Message-ID: <BANLkTimVO5zN7OsVkACCRt9Ju54A6dxDBQ@mail.gmail.com>

I've spent some time going through the code for _newclient.py with the
addition
of the changes for 4330.

I have been trying to find a way to incorporate checking for no response
from an agent.request
I am using the sample code of response.py in the ''using web client' howto
in the twisted docs as a simple basis to do some testing

I have set up a test server that will not respond for a given time so I can
see what my request will do.

What I can't do is work out where on the request deferred I add my callback
for
the _canceller method in http11clientprotocol in _newclient. Or have I got
that completely wrong.

Nor how I can then call this canceller method on the callback to get it to
fire
if the timeout has been exceeded

It seems that the agent.request wraps the http11 Request so I am unclear
where things are happening

I'm a bit stuck .And I think  I'm missing the obvious in some way.

If someone has an example of how I might setup the calls I would be very
happy to see it.

Thanks for any info.

John Aherne
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-web/attachments/20110701/942464b9/attachment.htm 

From johnaherne at rocs.co.uk  Sun Jul  3 13:58:51 2011
From: johnaherne at rocs.co.uk (John Aherne)
Date: Sun, 3 Jul 2011 18:58:51 +0100
Subject: [Twisted-web] Agent and request timeout
Message-ID: <CAKmUHjZZkgwN=5og-b21pvxfV6KexEyDrgxTW010e5Q7VbNwtw@mail.gmail.com>

I have some progress on the request timeout.

I have something that seems to work. But I am sure I have got something
wrong..

This is a copy of the response.py example with some additions to deal with
request timeouts.

Any chance that someone could take a look and let me know where I have gone
wrong.

#!/usr/bin/env python
# -*- coding: UTF-8 -*-
from pprint import pformat

from twisted.internet import reactor
from twisted.internet.defer import Deferred
from twisted.internet.protocol import Protocol
from twisted.web.client import Agent
from twisted.web.http_headers import Headers
import urllib
import time

class BeginningPrinter(Protocol):
    def __init__(self, finished):
        self.finished = finished
        self.remaining = 1024 * 10

    def dataReceived(self, bytes):
        if self.remaining:
            display = bytes[:self.remaining]
            print 'Some data received:', bytes, 'no bytes', len(bytes)
            print display
            self.remaining -= len(display)

    def connectionLost(self, reason):
        print 'Finished receiving body:', reason.getErrorMessage()
        self.finished.callback(None)

def do_cancel(d):
    print 'got do cancel'
    d._canceller(d)


from stringprod_resp import StringProducer
my_data = ['fred','ted','red','fred']
for c, a in enumerate(my_data):
    if c > 2:
        time.sleep(10)
    agent = Agent(reactor)
    #postdata = urllib.urlencode({'Username' : 'nsp05682',
    #                             'Password' : 'rocs345',
    #                             'Action' : 'CheckCredits'})
    postdata = urllib.urlencode({'the-field' : a})
    body = StringProducer(postdata)
    print 'body', body
    d = agent.request(
        'POST',
        'http://www.johna.com/test',
        Headers({'User-Agent': ['Twisted Web Client'],
                 'Accept-Encoding':['identity'],
                 'Content-Type':['application/x-www-form-urlencoded']}),
        body)
    #             'Content-Length':[str(len(postdata))],



    def cbRequest(response):
        print 'Response version:', response.version
        print 'Response code:', response.code
        print 'Response phrase:', response.phrase
        print 'Response headers:'
        print pformat(list(response.headers.getAllRawHeaders()))
        finished = Deferred()
        print 'response deliverbody',response.deliverBody
        response.deliverBody(BeginningPrinter(finished))
        return finished
    d.addCallback(cbRequest)
    #reactor.callLater(10, check_timeout,d)
    #j = dir(d)
    #print 'later', j
    #print 'fff cancel', d.cancel
    #print 'fff canceller', d._canceller
    #k = dir(agent.request)
    #print 'kkk', k
    #print 'reacotcallater'
    #if a == 'fred':
    #    print 'cancel ', a
    no_response = reactor.callLater(40, do_cancel, d)
        #d.cancel()

    def got_error(o):
        print 'got error', str(o)
        reason = dir(o)
        print 'got reason', o.getErrorMessage

    def cbShutdown(ignored, no_response):
        print 'got finish ignored', ignored
        #print 'no rsposne', no_response
        norep = dir(no_response)
        #print 'kkk', norep
        if no_response.cancelled:
            print 'already cancelled'
        else:
            print 'not cancelled'
            no_response.cancel()
            no_response = None
        #reactor.stop()
    d.addCallback(cbShutdown, no_response)
    d.addErrback(got_error)


reactor.run()
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-web/attachments/20110703/b0a005d6/attachment.htm 

From mayvimmer at fibertel.com.ar  Tue Jul  5 00:14:18 2011
From: mayvimmer at fibertel.com.ar (mayvimmer at fibertel.com.ar)
Date: Tue, 05 Jul 2011 01:14:18 -0300
Subject: [Twisted-web] Deferred 101
Message-ID: <4d6bff0b1eb3.4e12656a@fibertel.com.ar>

Hi guys,
 I'm totally new to Twisted although everything I try so far has been a lot of
fun. I have a really simple situation it seems I cannot wrap my head around.
Although the tutorial have been really helpful I cannof find how to fix this
last part.

I created a "login" method that connects with my db through adbapi and
returns a deferred. I'm using it with pyamf and it's working ok. Now I have to
implement the same thing but accept logins through a standard web page. I
followed the Twisted web in 60 seconds tutorial and created a render_POST
method that processes the login method. The only catch is that I'm returning a
mako template page. Ok, finally my problem: I cannot make it return the result
of the deferred: if I debug the response I see a "<Deferred at ...>" but
not the intended message. Actually if I add a callback method that just prints
the response, I can get it (but since that prints the message in the log, it
doesn't help). What am I missing?

Here's some code to help me explain my problem:

class Login(Resource):
    """LogIn post processing"""
    isLeaf = True

    def render_POST(self, request):
        rsp = None
        errc = None
        usr = User()
        username = cgi.escape(request.args['username'][0])
        passwd = cgi.escape(request.args['passwd'][0])
        try:
            # here I get the answer of the process. I would expect the login
            # message but instead I get a deferred repr object.
            rsp = usr.login(request, username, passwd)
        except Exception, e:
            errc = e.args[0]
        # this should return the contents of postproc.mak (a regular file) 
        # but with certain keywords replaced.
        request.write(serve_tpl('postproc.mak',
                **{'status':rsp, 'username':username,
                   'errorcode':errc}))
        request.finish()
        return NOT_DONE_YET

class Userobject):

    def login(self, request, username, password):
        rp = defer.Deferred()

        def cb(rs):
            resp = u'Unidentified reason'
            if len(rs)==0:
                resp = u'No account exists for the given username'
            elif rs[0]['password'!=password:
                resp = u'Password does not match'
            else:
                resp = u'Ok'
            rp.callback(resp)

        def eb(failure): rp.errback(failure)

        d = self.conn_pool.runQuery('select password from user where '
                        'username=?', (username,))
        d.addCallback(cb).addErrback(eb)

        return rp

TIA,
Eduardo Miguez




From p.mayers at imperial.ac.uk  Tue Jul  5 03:01:04 2011
From: p.mayers at imperial.ac.uk (Phil Mayers)
Date: Tue, 05 Jul 2011 08:01:04 +0100
Subject: [Twisted-web] Deferred 101
In-Reply-To: <4d6bff0b1eb3.4e12656a@fibertel.com.ar>
References: <4d6bff0b1eb3.4e12656a@fibertel.com.ar>
Message-ID: <4E12B6B0.2080003@imperial.ac.uk>

On 07/05/2011 05:14 AM, mayvimmer at fibertel.com.ar wrote:
> Hi guys,
>   I'm totally new to Twisted although everything I try so far has been a lot of
> fun. I have a really simple situation it seems I cannot wrap my head around.
> Although the tutorial have been really helpful I cannof find how to fix this
> last part.
>
> I created a "login" method that connects with my db through adbapi and
> returns a deferred. I'm using it with pyamf and it's working ok. Now I have to
> implement the same thing but accept logins through a standard web page. I
> followed the Twisted web in 60 seconds tutorial and created a render_POST
> method that processes the login method. The only catch is that I'm returning a
> mako template page. Ok, finally my problem: I cannot make it return the result
> of the deferred: if I debug the response I see a "<Deferred at ...>" but
> not the intended message. Actually if I add a callback method that just prints
> the response, I can get it (but since that prints the message in the log, it
> doesn't help). What am I missing?

The problem is almost certainly that Mako is not deferred-aware. If it 
were, it would stop the render when encountering a deferred and re-start 
when the deferred callback runs. But if it were, the return value of 
it's render method would almost certainly itself be a deferred, which of 
course it's not.

Try something this:

def render_POST(self, request):
   d = myDeferredMethod()
   def render(value):
     request.write(template.render(...., value=value))
     request.finish()
   d.addCallback(render)
   return NOT_DONE_YET

i.e. add a callback to the deferred which does the rendering for you 
only when the result is available.

FWIF the recently added twisted.web.template handles deferred natively.


From mayvimmer at fibertel.com.ar  Wed Jul  6 00:03:29 2011
From: mayvimmer at fibertel.com.ar (mayvimmer at fibertel.com.ar)
Date: Wed, 06 Jul 2011 01:03:29 -0300
Subject: [Twisted-web] Deferred 101
Message-ID: <50c46741c2a.4e13b461@fibertel.com.ar>

----- Mensaje original -----
De: Phil Mayers <p.mayers at imperial.ac.uk>
Fecha: Martes, Julio 5, 2011 4:01 am
Asunto: Re: [Twisted-web] Deferred 101

> On 07/05/2011 05:14 AM, mayvimmer at fibertel.com.ar wrote:
> > Hi guys,
> >   I'm totally new to Twisted although everything I try so far has been a lot of
> > fun. I have a really simple situation it seems I cannot wrap my head around.
> > Although the tutorial have been really helpful I cannof find how to fix this
> > last part.
> >
> 
> The problem is almost certainly that Mako is not deferred-aware. If 
> it 
> were, it would stop the render when encountering a deferred and re-
> start 
> when the deferred callback runs. But if it were, the return value 
> of 
> it's render method would almost certainly itself be a deferred, 
> which of 
> course it's not.
> 
> Try something this:
> 
> def render_POST(self, request):
>   d = myDeferredMethod()
>   def render(value):
>     request.write(template.render(...., value=value))
>     request.finish()
>   d.addCallback(render)
>   return NOT_DONE_YET
> 
> i.e. add a callback to the deferred which does the rendering for 
> you 
> only when the result is available.
> 
> FWIF the recently added twisted.web.template handles deferred 
> natively.
>

Thanks a lot Phil. That fixed my problem.

Eduardo Miguez




From johnaherne at rocs.co.uk  Thu Jul  7 03:31:02 2011
From: johnaherne at rocs.co.uk (John Aherne)
Date: Thu, 7 Jul 2011 08:31:02 +0100
Subject: [Twisted-web] Agent request timeout
Message-ID: <CAKmUHjaC1tFwbNNwsLOvDGgs7jEPckr3Sqs6MYBhKEm+Kym5Lg@mail.gmail.com>

So far this is where I have got to.

In my timeout using callLater, I call d._canceller().

This calls _connectionLost_WAITING which is partly what I would expect. But
it does not call _canceller_WAITING which I would have expected as well.

The function at d._canceller would appear to be cancelConnection so I can
see why it would go to loseConnection right away. But I  have not found
where cancelConnection resides yet.

The _connectLost_WAITING then calls disconnectParser and finally does the
errback with ResponseFailed and the connection is dropped cleanly.

The fact that _canceller_WAITING is not called makes me think I am making
the wrong call on the request deferred when I use d._canceller(), but I have
not seen anything else I can call.

Also d._canceller requires a parameter. And I can pass it anything and it
seems to not make use of any argument I pass in. I have used d the deferred,
None, 'TRANSMITTING' the string all with exactly the same effect.

So it makes me think I am making the wrong call on the request deferred.

Does anyone know if I should be calling some other function.

Below is the result from a test run outputting various points the program
runs through which might be helpful.


E:\jahtest>test_post.py
dispatcher <function dispatcher at 0x00FD57B0> template <function
deliverBody at
 0x00FD5770>
dispatcher <function dispatcher at 0x00FD58F0> template <function
_bodyDataRecei
ved at 0x00FD58B0>
dispatcher <function dispatcher at 0x00FD5A30> template <function
_bodyDataFinis
hed at 0x00FD59F0>
dispatcher <function dispatcher at 0x00FD5F70> template <function _canceller
at
0x00FD5F30>
dispatcher <function dispatcher at 0x00FD9170> template <function
connectionLost
 at 0x00FD9130>
body <stringprod_resp.StringProducer object at 0x00F9BCB0>
fff canceller <function cancelConnect at 0x00FD95B0>
got do cancel
connectionlost waiting [Failure instance: Traceback (failure with no
frames): <c
lass 'twisted.internet.error.ConnectionDone'>: Connection was closed
cleanly.
]
disconnect parser [Failure instance: Traceback (failure with no frames):
<class
'twisted.internet.error.ConnectionDone'>: Connection was closed cleanly.
]
got error <bound method Failure.getErrorMessage of
<twisted.python.failure.Failu
re <class 'twisted.web._newclient.ResponseFailed'>>>


Thanks for any info.

John Aherne
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-web/attachments/20110707/c529ebe8/attachment.htm 

From mithrandi at mithrandi.net  Thu Jul  7 05:44:14 2011
From: mithrandi at mithrandi.net (Tristan Seligmann)
Date: Thu, 7 Jul 2011 11:44:14 +0200
Subject: [Twisted-web] Agent request timeout
In-Reply-To: <CAKmUHjaC1tFwbNNwsLOvDGgs7jEPckr3Sqs6MYBhKEm+Kym5Lg@mail.gmail.com>
References: <CAKmUHjaC1tFwbNNwsLOvDGgs7jEPckr3Sqs6MYBhKEm+Kym5Lg@mail.gmail.com>
Message-ID: <CAMcKhMTM-d6+voyKb=NCbRZts_vs-_NXteinym58GNVj5Me0gw@mail.gmail.com>

On Thu, Jul 7, 2011 at 9:31 AM, John Aherne <johnaherne at rocs.co.uk> wrote:
> The fact that _canceller_WAITING is not called makes me think I am making
> the wrong call on the request deferred when I use d._canceller(), but I have
> not seen anything else I can call.

I'll admit to not knowing exactly what you're doing, but shouldn't you
be calling d.cancel() not d._canceller() ?
-- 
mithrandi, i Ainil en-Balandor, a faer Ambar


From johnaherne at rocs.co.uk  Thu Jul  7 12:20:34 2011
From: johnaherne at rocs.co.uk (John Aherne)
Date: Thu, 7 Jul 2011 17:20:34 +0100
Subject: [Twisted-web] Agent request timeout
In-Reply-To: <CAMcKhMTM-d6+voyKb=NCbRZts_vs-_NXteinym58GNVj5Me0gw@mail.gmail.com>
References: <CAKmUHjaC1tFwbNNwsLOvDGgs7jEPckr3Sqs6MYBhKEm+Kym5Lg@mail.gmail.com>
	<CAMcKhMTM-d6+voyKb=NCbRZts_vs-_NXteinym58GNVj5Me0gw@mail.gmail.com>
Message-ID: <CAKmUHjae6gAqmL3KLE7Ae4YVpYfZ0_d55Sb3agt+TU=gjBdKCQ@mail.gmail.com>

On Thu, Jul 7, 2011 at 10:44 AM, Tristan Seligmann
<mithrandi at mithrandi.net>wrote:

> On Thu, Jul 7, 2011 at 9:31 AM, John Aherne <johnaherne at rocs.co.uk> wrote:
> > The fact that _canceller_WAITING is not called makes me think I am making
> > the wrong call on the request deferred when I use d._canceller(), but I
> have
> > not seen anything else I can call.
>
> I'll admit to not knowing exactly what you're doing, but shouldn't you
> be calling d.cancel() not d._canceller() ?
>

You are correct of course. I started off using cancel() but was getting
already called errors. So I started looking around to see what was going on
and tried to trace through the various functions being called. That's how I
ended up playing around with _canceller.

What I did not do was find out what was really causing the already called
errors.

Which now you have prompted me I have sorted out. Typically something silly
- like overriding the callLater functions.

So sorry for all the noise over _canceller.

Thanks

John Aherne
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-web/attachments/20110707/7bbd7aae/attachment.htm 

From bdfy at mail.ru  Thu Jul 14 08:50:38 2011
From: bdfy at mail.ru (Ivan)
Date: Thu, 14 Jul 2011 16:50:38 +0400
Subject: [Twisted-web] =?utf-8?q?How_to_do_create_a_very_simple_tac_file_?=
	=?utf-8?q?=3F?=
In-Reply-To: <CAKmUHjae6gAqmL3KLE7Ae4YVpYfZ0_d55Sb3agtTU=gjBdKCQ@mail.gmail.com>
References: <CAMcKhMTM-d6+voyKb=NCbRZts_vs-_NXteinym58GNVj5Me0gw@mail.gmail.com>
	<CAKmUHjaC1tFwbNNwsLOvDGgs7jEPckr3Sqs6MYBhKEm+Kym5Lg@mail.gmail.com>
	<CAKmUHjae6gAqmL3KLE7Ae4YVpYfZ0_d55Sb3agtTU=gjBdKCQ@mail.gmail.com>
Message-ID: <E1QhLNG-0003i8-00.bdfy-mail-ru@f156.mail.ru>

I have a very simple example:

from twisted.internet import protocol, utils, reactor


def start():
??? utils.getProcessOutputAndValue('sleep',['1000'])

reactor.callWhenRunning(start)
reactor.run()

?

How to create tac file for this example ?


-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-web/attachments/20110714/2fb14ce6/attachment.htm 

From stephen at thorne.id.au  Thu Jul 14 09:05:12 2011
From: stephen at thorne.id.au (Thorne, Stephen)
Date: Thu, 14 Jul 2011 14:05:12 +0100
Subject: [Twisted-web] How to do create a very simple tac file ?
In-Reply-To: <E1QhLNG-0003i8-00.bdfy-mail-ru@f156.mail.ru>
References: <CAMcKhMTM-d6+voyKb=NCbRZts_vs-_NXteinym58GNVj5Me0gw@mail.gmail.com>
	<CAKmUHjaC1tFwbNNwsLOvDGgs7jEPckr3Sqs6MYBhKEm+Kym5Lg@mail.gmail.com>
	<CAKmUHjae6gAqmL3KLE7Ae4YVpYfZ0_d55Sb3agtTU=gjBdKCQ@mail.gmail.com>
	<E1QhLNG-0003i8-00.bdfy-mail-ru@f156.mail.ru>
Message-ID: <CAFPU7=u56NkCVpkMm8K5fygyAN7=5RSm2=HSUVBZC5i=MHS6WQ@mail.gmail.com>

On Thu, Jul 14, 2011 at 13:50, Ivan <bdfy at mail.ru> wrote:
> I have a very simple example:
>
> from twisted.internet import protocol, utils, reactor
>
>
> def start():
> ??? utils.getProcessOutputAndValue('sleep',['1000'])
>
> reactor.callWhenRunning(start)
> reactor.run()

I put together an example of how to create a 'complete' example
application using twisted plugins (which are also run with 'twistd'
but allow things like command line arguments) a few weeks ago.

repo is here: https://bitbucket.org/jerub/twisted-plugin-example

It shows how to do things in 'Service.startService', this approach
would map to using a .tac file as well, with some munging.

https://bitbucket.org/jerub/twisted-plugin-example/src/a3af1e55194a/examplepackage/examplemodule.py#cl-49

Stephen.


From duncan.mcgreggor at gmail.com  Thu Jul 14 09:27:51 2011
From: duncan.mcgreggor at gmail.com (Duncan McGreggor)
Date: Thu, 14 Jul 2011 07:27:51 -0600
Subject: [Twisted-web] How to do create a very simple tac file ?
In-Reply-To: <CAFPU7=u56NkCVpkMm8K5fygyAN7=5RSm2=HSUVBZC5i=MHS6WQ@mail.gmail.com>
References: <CAMcKhMTM-d6+voyKb=NCbRZts_vs-_NXteinym58GNVj5Me0gw@mail.gmail.com>
	<CAKmUHjaC1tFwbNNwsLOvDGgs7jEPckr3Sqs6MYBhKEm+Kym5Lg@mail.gmail.com>
	<CAKmUHjae6gAqmL3KLE7Ae4YVpYfZ0_d55Sb3agtTU=gjBdKCQ@mail.gmail.com>
	<E1QhLNG-0003i8-00.bdfy-mail-ru@f156.mail.ru>
	<CAFPU7=u56NkCVpkMm8K5fygyAN7=5RSm2=HSUVBZC5i=MHS6WQ@mail.gmail.com>
Message-ID: <CAFJQhU7qC9+ker+mDufxb6f0CD8Z_-gvqobQ2jpq+j_REuhDPQ@mail.gmail.com>

On Thu, Jul 14, 2011 at 7:05 AM, Thorne, Stephen <stephen at thorne.id.au> wrote:
> On Thu, Jul 14, 2011 at 13:50, Ivan <bdfy at mail.ru> wrote:
>> I have a very simple example:
>>
>> from twisted.internet import protocol, utils, reactor
>>
>>
>> def start():
>> ??? utils.getProcessOutputAndValue('sleep',['1000'])
>>
>> reactor.callWhenRunning(start)
>> reactor.run()
>
> I put together an example of how to create a 'complete' example
> application using twisted plugins (which are also run with 'twistd'
> but allow things like command line arguments) a few weeks ago.
>
> repo is here: https://bitbucket.org/jerub/twisted-plugin-example
>
> It shows how to do things in 'Service.startService', this approach
> would map to using a .tac file as well, with some munging.
>
> https://bitbucket.org/jerub/twisted-plugin-example/src/a3af1e55194a/examplepackage/examplemodule.py#cl-49
>
> Stephen.

I gotta second this. This is the best example of Twisted plugins I've
seen yet. I know I'll regret saying this, but it's foolproof.

d


From bdfy at mail.ru  Thu Jul 14 11:35:00 2011
From: bdfy at mail.ru (Ivan)
Date: Thu, 14 Jul 2011 19:35:00 +0400
Subject: [Twisted-web]
	=?utf-8?q?How_to_do_create_a_very_simple_tac_file_?= =?utf-8?q?=3F?=
In-Reply-To: <CAFJQhU7qC9ker+mDufxb6f0CD8Z_-gvqobQ2jpq+j_REuhDPQ@mail.gmail.com>
References: <CAFPU7=u56NkCVpkMm8K5fygyAN7=5RSm2=HSUVBZC5i=MHS6WQ@mail.gmail.com>
	<CAMcKhMTM-d6+voyKb=NCbRZts_vs-_NXteinym58GNVj5Me0gw@mail.gmail.com>
	<CAFJQhU7qC9ker+mDufxb6f0CD8Z_-gvqobQ2jpq+j_REuhDPQ@mail.gmail.com>
Message-ID: <E1QhNwK-00047z-00.bdfy-mail-ru@f86.mail.ru>



Thank you for example. I write a simple plugin for template:

from twisted.application import service, internet
from twisted.internet import utils, reactor
from twisted.python import log
from twisted.python import usage

class Options(usage.Options):
??? pass

class TestService(service.Service):
??? name = 'TestService'

??? def __init__(self, reactor):
??????? self.reactor = reactor

??? def startService(self):
??????? self.reactor.callWhenRunning(self.Test)
??????? self.reactor.run()

??? def Test(self):
??????? utils.getProcessOutputAndValue('/usr/bin/sleep', args = ['1000'])


def makeService(options):
??? s = TestService(reactor)
??? return s

?
It's work (twistd -n test ) , but kill pid ( without kill -9 ) don't work. I see a message "Main loop terminated" and script continue running. Why ?




14 ???? 2011, 17:30 ?? Duncan McGreggor <duncan.mcgreggor at gmail.com>:



 
 
 
 
On Thu, Jul 14, 2011 at 7:05 AM, Thorne, Stephen <
stephen at thorne.id.au> wrote:
> On Thu, Jul 14, 2011 at 13:50, Ivan <
bdfy at mail.ru> wrote:
>> I have a very simple example:
>>
>> from twisted.internet import protocol, utils, reactor
>>
>>
>> def start():
>> ??? utils.getProcessOutputAndValue('sleep',['1000'])
>>
>> reactor.callWhenRunning(start)
>> reactor.run()
>
> I put together an example of how to create a 'complete' example
> application using twisted plugins (which are also run with 'twistd'
> but allow things like command line arguments) a few weeks ago.
>
> repo is here: 
https://bitbucket.org/jerub/twisted-plugin-example
>
> It shows how to do things in 'Service.startService', this approach
> would map to using a .tac file as well, with some munging.
>
> 
https://bitbucket.org/jerub/twisted-plugin-example/src/a3af1e55194a/examplepackage/examplemodule.py#cl-49
>
> Stephen.

I gotta second this. This is the best example of Twisted plugins I've
seen yet. I know I'll regret saying this, but it's foolproof.

d

_______________________________________________
Twisted-web mailing list

Twisted-web at twistedmatrix.com

http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web
 
   
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-web/attachments/20110714/9aed165f/attachment.htm 

From bdfy at mail.ru  Fri Jul 15 05:49:19 2011
From: bdfy at mail.ru (Ivan)
Date: Fri, 15 Jul 2011 13:49:19 +0400
Subject: [Twisted-web] =?utf-8?q?How_to_kill_child_process_after_parent_pr?=
	=?utf-8?q?ocess_is_killed_=3F?=
Message-ID: <E1Qhf1L-0002x9-00.bdfy-mail-ru@f139.mail.ru>

simple example:

from twisted.internet import utils, reactor

output = utils.getProcessValue('sleep',['1000'])
reactor.run()

"kill pid"? kill parent, but child remains is live
?.





-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-web/attachments/20110715/aa51efc1/attachment.htm 

From vgachkaylo at gmail.com  Fri Jul 15 23:49:43 2011
From: vgachkaylo at gmail.com (Viatcheslav Gachkaylo)
Date: Sat, 16 Jul 2011 10:49:43 +0700
Subject: [Twisted-web] Setting up server environment for twisted application
Message-ID: <CADUmcBOmszXd78XsmHgbNvc6Dn_JQypW_RtB1H8ehrRbENO2mw@mail.gmail.com>

Hello.

Can you tell me what are the best practices for setting up a twistd
daemon in a linux (centos) environment on a server. The server should
be always uptime and relaunch on fatal error. I am sure there is a
common procedure for this.

Also I'm interested in providing secure access to twisted application
services. I set up twisted in a python virtualenv and my application
is running under user 'nobody'. What else could be done? What about
permissions of the python script files and static server resources?

 Also, is it a good idea to listen (HTTP and HTTPS) on ports 8081 and
8083 and set up apache to redirect port 80 and port 443 on a subdomain
to the appropriate twistd daemon ports?

Thank you,
Viatcheslav Gachkaylo
Crystalnix


From radix at twistedmatrix.com  Fri Jul 15 23:58:51 2011
From: radix at twistedmatrix.com (Christopher Armstrong)
Date: Fri, 15 Jul 2011 22:58:51 -0500
Subject: [Twisted-web] Setting up server environment for twisted
	application
In-Reply-To: <CADUmcBOmszXd78XsmHgbNvc6Dn_JQypW_RtB1H8ehrRbENO2mw@mail.gmail.com>
References: <CADUmcBOmszXd78XsmHgbNvc6Dn_JQypW_RtB1H8ehrRbENO2mw@mail.gmail.com>
Message-ID: <CAPkRfUQnnvKZph-rUX8i6BBOHV4zAfjKs2HJ7p-ppJFkUNtKww@mail.gmail.com>

On Fri, Jul 15, 2011 at 10:49 PM, Viatcheslav Gachkaylo <
vgachkaylo at gmail.com> wrote:

> Hello.
>
> Can you tell me what are the best practices for setting up a twistd
> daemon in a linux (centos) environment on a server. The server should
> be always uptime and relaunch on fatal error. I am sure there is a
> common procedure for this.
>
>
I like using Supervisor (http://supervisord.org/) for this purpose, running
with "twistd -n".


-- 
Christopher Armstrong
http://radix.twistedmatrix.com/
http://planet-if.com/
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-web/attachments/20110715/0bc3859c/attachment.htm 

From m-lists at the-moon.net  Sat Jul 16 08:42:20 2011
From: m-lists at the-moon.net (Richard Wall)
Date: Sat, 16 Jul 2011 13:42:20 +0100
Subject: [Twisted-web] Setting up server environment for twisted
	application
In-Reply-To: <CAPkRfUQnnvKZph-rUX8i6BBOHV4zAfjKs2HJ7p-ppJFkUNtKww@mail.gmail.com>
References: <CADUmcBOmszXd78XsmHgbNvc6Dn_JQypW_RtB1H8ehrRbENO2mw@mail.gmail.com>
	<CAPkRfUQnnvKZph-rUX8i6BBOHV4zAfjKs2HJ7p-ppJFkUNtKww@mail.gmail.com>
Message-ID: <CABefbUpjRGBPuQEVVT2F8ZQA-8SKRiTZSY48=a91KcgmfnMiZQ@mail.gmail.com>

On 16 July 2011 04:58, Christopher Armstrong <radix at twistedmatrix.com> wrote:
> On Fri, Jul 15, 2011 at 10:49 PM, Viatcheslav Gachkaylo
> <vgachkaylo at gmail.com> wrote:
>> be always uptime and relaunch on fatal error. I am sure there is a
>> common procedure for this.
> I like using Supervisor (http://supervisord.org/) for this purpose, running
> with "twistd -n".

Also don't forget twisted.runner.procmon and  twistd procmon - it
hasn't got all the features of supervisord, but it may be enough. eg
twistd --logfile=procmon.log --pidfile=procmon.pid procmon \
    twistd --logfile=web.log --pidfile=web.pid -n web --path .

{{{
$ twistd procmon --help
Usage: twistd [options] procmon [procmon options] commandline
Options:
  -t, --threshold=        How long a process has to live before the death is
                          considered instant, in seconds. [default: 1]
  -k, --killtime=         How long a process being killed has to get its affairs
                          in order before it gets killed with an unmaskable
                          signal. [default: 5]
  -m, --minrestartdelay=  The minimum time (in seconds) to wait before
                          attempting to restart a process [default: 1]
  -M, --maxrestartdelay=  The maximum time (in seconds) to wait before
                          attempting to restart a process [default: 3600]
      --version
      --help              Display this help and exit.

procmon runs processes, monitors their progress, and restarts them when they
die.

procmon will not attempt to restart a process that appears to die instantly;
with each "instant" death (less than 1 second, by default), it will delay
approximately twice as long before restarting it. A successful run will reset
the counter.
}}}

-RichardW.


From vgachkaylo at gmail.com  Mon Jul 18 08:43:58 2011
From: vgachkaylo at gmail.com (Viatcheslav Gachkaylo)
Date: Mon, 18 Jul 2011 19:43:58 +0700
Subject: [Twisted-web] Authentication not working
Message-ID: <CADUmcBMcancVGRQYnkvJA9KYmF3akk33Swu7SqAbb7wdtiFQcw@mail.gmail.com>

Hello.

I ask you to help me finding the source of problems with the following code.
The result of opening page at
https://serveraddr:serverport/services/admin is 403 Forbidden.
It needs to show the output from UpdateManager.render_GET().
In server.tac

...

root = resource.ForbiddenResource()
err = resource.ForbiddenResource()
root.putChild("service", err)
upd = UpdateXMLProcessor()
err.putChild("update2", upd)

portal = Portal(PublicHTMLRealm(), [FilePasswordDB('httpd.password')])
credentialFactory = DigestCredentialFactory("md5", "House of Life Updates")
admin = HTTPAuthSessionWrapper(portal, [credentialFactory])
err.putChild('admin', admin)

...

In auth.py:

class PublicHTMLRealm(object):
    implements(IRealm)

    def requestAvatar(self, avatarId, mind, *interfaces):
        if IResource in interfaces:
            resc = UpdateManager()
            resc.realm = self
            return (IResource, resc, lambda: None)
        raise NotImplementedError()

in admin.py:

class UpdateManager(resource.Resource):
    isLeaf = False
    pathFromRoot = '/service/admin'

    def __init__(self):
        resource.Resource.__init__(self)
        self.newFull = NewFullResource()
        self.putChild('new_full', self.newFull)
        self.newDelta = NewDeltaResource()
        self.putChild('new_delta', self.newDelta)
        self.switch = SwitchResource()
        self.putChild('switch', self.switch)
        self.putChild('', self)

    def render_GET(self, request):
        ...

Is anything wrong here in these code parts?
I have no errors shown in the console running with

twistd -ny server.tac

Thank you for your assistance,
Viatcheslav Gachkaylo
Crystalnix


From fshiori at gmail.com  Wed Jul 20 07:41:19 2011
From: fshiori at gmail.com (=?Big5?B?pPTD6A==?=)
Date: Wed, 20 Jul 2011 19:41:19 +0800
Subject: [Twisted-web] How to get Content-Type when I upload a picture?
Message-ID: <CAD4-pM+O4maC2rZKmJq3djkNivb+S0OV6P031tEc21s4k5EhCw@mail.gmail.com>

Dears,

I used twisted to develop my web site just a little time.
I have a question about how to get Content-Type when I upload a picture?
When I get request.args["picture"], I only get picture content strings.
Can I have a easy way to get the picture's Content-Type?

-- 

Best regards,
Eric Chen
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-web/attachments/20110720/0311779b/attachment.htm 

From bdfy at mail.ru  Mon Jul 25 03:46:20 2011
From: bdfy at mail.ru (Ivan)
Date: Mon, 25 Jul 2011 11:46:20 +0400
Subject: [Twisted-web] twistd and logging
In-Reply-To: <CAD4-pMO4maC2rZKmJq3djkNivb+S0OV6P031tEc21s4k5EhCw@mail.gmail.com>
References: <CAD4-pMO4maC2rZKmJq3djkNivb+S0OV6P031tEc21s4k5EhCw@mail.gmail.com>
Message-ID: <E1QlFro-00058k-00.bdfy-mail-ru@f56.mail.ru>


How to divide log to stderr and stdout logs ? For example twistd have only one parameter-log: (--logfile? for stdout ). and for stderr ?






 
   document.write(' 
 
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-web/attachments/20110725/f39c73aa/attachment.htm 

