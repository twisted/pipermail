<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] Livepage, ClientHandle and context
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Livepage%2C%20ClientHandle%20and%20context&In-Reply-To=20050530231708.olbnwr9uqrk00w8g%40itchy.wasabout.net">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001512.html">
   <LINK REL="Next"  HREF="001516.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] Livepage, ClientHandle and context</H1>
    <B>Donovan Preston</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Livepage%2C%20ClientHandle%20and%20context&In-Reply-To=20050530231708.olbnwr9uqrk00w8g%40itchy.wasabout.net"
       TITLE="[Twisted-web] Livepage, ClientHandle and context">dp at ulaluma.com
       </A><BR>
    <I>Mon May 30 17:31:33 MDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="001512.html">[Twisted-web] Livepage, ClientHandle and context
</A></li>
        <LI>Next message: <A HREF="001516.html">[Twisted-web] Livepage, ClientHandle and context
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1513">[ date ]</a>
              <a href="thread.html#1513">[ thread ]</a>
              <a href="subject.html#1513">[ subject ]</a>
              <a href="author.html#1513">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On May 30, 2005, at 2:17 PM, Thomas HERVE wrote:

&gt;<i> I've just started to use nevow i18n and I'm pretty happy with it,  
</I>&gt;<i> it works very
</I>&gt;<i> well and the automatic detection of browser language is invisible.
</I>&gt;<i>
</I>&gt;<i> But my app uses livepage a lot, and I began to face problems when  
</I>&gt;<i> trying to
</I>&gt;<i> translate strings in &quot;dynamic renderers&quot;. After some  
</I>&gt;<i> investigations, I found my
</I>&gt;<i> problem : i18n uses the i18nconfig saved in context to translate  
</I>&gt;<i> strings,  but
</I>&gt;<i> livepage.ClientHandle makes a new &quot;fake&quot; context for each calls via  
</I>&gt;<i> the
</I>&gt;<i> livepage.flt function.
</I>&gt;<i>
</I>&gt;<i> I resolved my problem by creating my ClientHandle and  
</I>&gt;<i> ClientHandleFactory
</I>&gt;<i> implementations, the ClientHandle saving the context at its  
</I>&gt;<i> creation (pretty
</I>&gt;<i> easy, but I would have found it cleaner if clientHandleFactory was  
</I>&gt;<i> a class
</I>&gt;<i> variable of LivePage, Input and Output, and not a module global).  
</I>&gt;<i> Thus, the
</I>&gt;<i> i18nconfig remains in context.
</I>&gt;<i>
</I>&gt;<i> My question is : is this choice good, or is there a good reason for  
</I>&gt;<i> ClientHandle
</I>&gt;<i> not to keep track of the context ? If not, wouldn't it be better to  
</I>&gt;<i> save context
</I>&gt;<i> in ClientHandle (it would useful for others things, getting session  
</I>&gt;<i> for example)
</I>&gt;<i> ?
</I>
You should take a look at the branches/dp/livepage-completion- 
notification-3 branch. It includes a lot of refactoring to livepage,  
one of which causes all of the livepage apis to take a  
JavascriptContext object instead of a ClientHandle. To use the  
ClientHandle, you'll have to get it out of the context, like you  
would other objects: IClientHandle(ctx).

This context is hooked up to the context chain from the outputConduit  
or inputConduit HTTP request, so it should be much more useful to  
you. For example, render_ methods should work properly because  
nevow'll be able to find the IRendererFactory (your Page instance,  
usually).

This branch is not yet fully backwards compatible with the previous  
livepage API. sendScript, call, set, and append are not present as  
methods of ClientHandle. Instead, there is a single ClientHandle.send  
method which takes any stan which can be rendered down to javascript.  
For example, IClientHandle(ctx).send(js(&quot;any javascript here&quot;)) will  
work, as will client.send(livepage.set('foo', 'bar')). I will  
probably add the ClientHandle convenience APIs back soon. They will  
just call send with the appropriate &quot;stan for javascript&quot; object.

In this branch, input handlers can also return javascript which will  
be executed as the response to the input event.

I encourage anyone who is interested in livepage to take a look at  
this branch to see where it is going. Take a look at the examples to  
see what has changed, read the code, and experiment with it. Ask  
questions if you have any. I'll be trying to merge this branch into  
the mainline (after adding some backwards compatibility) in the next  
week.

I'll also be adding some LivePage docs. I think the API will settle  
down after this last round of changes.

dp


</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001512.html">[Twisted-web] Livepage, ClientHandle and context
</A></li>
	<LI>Next message: <A HREF="001516.html">[Twisted-web] Livepage, ClientHandle and context
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1513">[ date ]</a>
              <a href="thread.html#1513">[ thread ]</a>
              <a href="subject.html#1513">[ subject ]</a>
              <a href="author.html#1513">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
