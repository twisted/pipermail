<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] finger tutorial: problems rewriting finger08.py to
 use inlineCallbacks
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20finger%20tutorial%3A%20problems%20rewriting%20finger08.py%20to%0A%20use%20inlineCallbacks&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004028.html">
   <LINK REL="Next"  HREF="004030.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] finger tutorial: problems rewriting finger08.py to
 use inlineCallbacks</H1>
    <B>Paul Goins</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20finger%20tutorial%3A%20problems%20rewriting%20finger08.py%20to%0A%20use%20inlineCallbacks&In-Reply-To="
       TITLE="[Twisted-web] finger tutorial: problems rewriting finger08.py to
 use inlineCallbacks">general at vultaire.net
       </A><BR>
    <I>Wed Dec 10 21:28:34 EST 2008</I>
    <P><UL>
        <LI>Previous message: <A HREF="004028.html">[Twisted-web] twisted.web.wsgi usage example
</A></li>
        <LI>Next message: <A HREF="004030.html">[Twisted-web] finger tutorial: problems rewriting finger08.py
	to use inlineCallbacks
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4029">[ date ]</a>
              <a href="thread.html#4029">[ thread ]</a>
              <a href="subject.html#4029">[ subject ]</a>
              <a href="author.html#4029">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I'm having problems with using inlineCallbacks in the finger tutorial. 
I've used them successfully in some other test programs, but in this case
I really don't know what I'm doing wrong.

Here's the FingerProtocol code from the finger tutorial:

class FingerProtocol(basic.LineReceiver):
    def lineReceived(self, user):
        self.factory.getUser(user) \
            .addErrback(lambda _: &quot;Internal error in server&quot;) \
            .addCallback(lambda m:
                             (self.transport.write(m + &quot;\r\n&quot;),
                              self.transport.loseConnection()))

And here's my modified version:

class FingerProtocol(basic.LineReceiver):
    @defer.inlineCallbacks
    def lineReceived(self, user):
        try:
            data = yield self.factory.getUser(user)
        except Exception:
            data = &quot;Internal error in server&quot;
        self.transport.write(data + &quot;\r\n&quot;)
        self.transport.loseConnection()

For some reason, in my version, the connection is getting terminated
before any writes can take place.  Even if I comment out the
loseConnection line, still nothing goes across to the client and the
connection still gets terminated.

Could anyone tell me where I'm going wrong on this?  Thanks in advance.

- Paul Goins



</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004028.html">[Twisted-web] twisted.web.wsgi usage example
</A></li>
	<LI>Next message: <A HREF="004030.html">[Twisted-web] finger tutorial: problems rewriting finger08.py
	to use inlineCallbacks
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4029">[ date ]</a>
              <a href="thread.html#4029">[ thread ]</a>
              <a href="subject.html#4029">[ subject ]</a>
              <a href="author.html#4029">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
