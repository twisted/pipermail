<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] Twisted and reverse proxies
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Twisted%20and%20reverse%20proxies&In-Reply-To=48AA356F-A7AE-4AC2-B762-A18A08C1C4D9%40ucsd.edu">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004452.html">
   
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] Twisted and reverse proxies</H1>
    <B>Maarten ter Huurne</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Twisted%20and%20reverse%20proxies&In-Reply-To=48AA356F-A7AE-4AC2-B762-A18A08C1C4D9%40ucsd.edu"
       TITLE="[Twisted-web] Twisted and reverse proxies">maarten at treewalker.org
       </A><BR>
    <I>Wed Mar 31 05:28:11 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="004452.html">[Twisted-web] Twisted and reverse proxies
</A></li>
        
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4448">[ date ]</a>
              <a href="thread.html#4448">[ thread ]</a>
              <a href="subject.html#4448">[ subject ]</a>
              <a href="author.html#4448">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Wednesday 31 March 2010, Rob Newman wrote:

&gt;<i> We wish to use an Apache reverse proxy to allow our web users to
</I>&gt;<i> transparently view the Twisted application 'within' our existing Apache
</I>&gt;<i> served site. So that, something like:
</I>&gt;<i> 
</I>&gt;<i> <A HREF="http://www.companyname.com/tools/twisted_app">http://www.companyname.com/tools/twisted_app</A>
</I>&gt;<i> 
</I>&gt;<i> proxies to:
</I>&gt;<i> 
</I>&gt;<i> <A HREF="http://hostname:8080">http://hostname:8080</A>
</I>
This is what the Apache configuration would look like:

===

# Serve static content in Apache:
# (the ProxyPass exception must be located before the ProxyPass rule)
ProxyPass /tools/twisted_app/static !
Alias /tools/twisted_app/static /some/path/on/disk/static

# Act as a proxy for Twisted:
&lt;Location /tools/twisted_app&gt;
  ProxyPass <A HREF="http://hostname:8080">http://hostname:8080</A> retry=1
  ProxyPassReverse <A HREF="http://hostname:8080">http://hostname:8080</A>
  ProxyPassReverseCookiePath / /tools/twisted_app/
&lt;/Location&gt;

===

&quot;ProxyPass&quot; sets up the reverse proxy. The &quot;retry=1&quot; ensures that if your 
Twisted instance returns from being unavailable (for example after an 
upgrade), Apache will retry contacting it 1 second later. The default is a 
lot longer than 1 second.

&quot;ProxyPassReverse&quot; rewrites headers so redirections continue to work. It 
does not rewrite content.

&quot;ProxyPassReverseCookiePath&quot; rewrites cookies to make their path correspond 
to the URL of your web app. Without this, if you run multiple Twisted 
applications reverse proxied on the same host, their (session) cookies will 
have identical paths and start overwriting each other.

&gt;<i> As someone relatively new to Twisted, how will our static (and other)
</I>&gt;<i> resources react to being reverse proxy served? Will they barf? Is there
</I>&gt;<i> any online documentation I can look at for case studies?
</I>
As Ray wrote, in most cases it is best to let Apache serve the static 
content and use Twisted for the dynamic content.

If your app puts absolute URLs in the content it produces, such as 
registration conformation e-mails or RSS/Atom feeds, it must use the 
&quot;/tools/twisted_app&quot; outer URL for this, since Apache does not rewrite 
content. So the application must be aware that it is reverse proxied and 
under which URL.

One thing to remember is that Apache buffers the data it gets from Twisted 
before sending it back to the requester. So if you stream events instead of 
writing a document, the requester will not receive the events until much 
later. I worked around this by reading streaming data directly from the 
Twisted HTTP server.

Bye,
		Maarten

</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004452.html">[Twisted-web] Twisted and reverse proxies
</A></li>
	
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4448">[ date ]</a>
              <a href="thread.html#4448">[ thread ]</a>
              <a href="subject.html#4448">[ subject ]</a>
              <a href="author.html#4448">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
