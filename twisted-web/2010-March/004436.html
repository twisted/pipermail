<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] Newbie question on handling args in URL string
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Newbie%20question%20on%20handling%20args%20in%20URL%20string&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004440.html">
   <LINK REL="Next"  HREF="004437.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] Newbie question on handling args in URL string</H1>
    <B>Rob Newman</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Newbie%20question%20on%20handling%20args%20in%20URL%20string&In-Reply-To="
       TITLE="[Twisted-web] Newbie question on handling args in URL string">rlnewman at ucsd.edu
       </A><BR>
    <I>Thu Mar 18 13:43:40 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="004440.html">[Twisted-web] Web client through https proxy - is it even	possible?
</A></li>
        <LI>Next message: <A HREF="004437.html">[Twisted-web] Newbie question on handling args in URL string
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4436">[ date ]</a>
              <a href="thread.html#4436">[ thread ]</a>
              <a href="subject.html#4436">[ subject ]</a>
              <a href="author.html#4436">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Twisted-Web devs,

I am using Twisted for a web-application. I have a resource called Data, for which variables are called in a URL string:

<A HREF="http://localhost:8008/data?pet=dog&amp;breed=lab&amp;idtag=12345">http://localhost:8008/data?pet=dog&amp;breed=lab&amp;idtag=12345</A>

Where 'pet' is a variable name, as is 'breed' and 'idtag', etc. This all works fine, and we get a JSON object back from the query that we use in the web application. 

In terms of client ease of use we want to be able to handle URL parsing, such that:

<A HREF="http://localhost:8008/data?pet=dog&amp;breed=lab&amp;idtag=12345">http://localhost:8008/data?pet=dog&amp;breed=lab&amp;idtag=12345</A>

can be written:

<A HREF="http://localhost:8008/pet/dog/lab/12345">http://localhost:8008/pet/dog/lab/12345</A>

which is a nice semantic URL.

However, we also have a bunch of static files (such as jquery javascript and images) that we serve in the application, like:

<A HREF="http://localhost:8008/images/layout.png">http://localhost:8008/images/layout.png</A>

- and -

<A HREF="http://localhost:8008/jquery/functionality.js">http://localhost:8008/jquery/functionality.js</A>

We want to make sure we are handling these correctly and efficiently. From twisted.web we are using the rewrite module thus:



import sys
import os
import re

from twisted.web import server, static, rewrite
from twisted.application import service, internet

root = resource.Root()

# Another file (resource.py)  defines the resources Data() and Root()

root.putChild('data', resource.Data())
root.putChild('images', static.File(images_dir))
root.putChild('jquery', static.File(js_dir))

rewrite_root = rewrite.RewriterResource(root, pathToArgs)

site = server.Site(rewrite_root)

application = service.Application('My App Name')

internet.TCPServer(8008, site).setServiceParent(application)



pathToArgs is the critical function, and it is where we are currently determining how to handle these different URL strings:

def pathToArgs(request):

    parts = request.uri.split('/')

    if request.uri == '/':

        # Do nothing - at the root level

    elif 'jquery' in request.postpath:

        # Handle static jquery request

    elif 'images' in request.postpath:

        # Handle static image request

    elif len(request.postpath) == 1:

        # Handle only pet type

    elif len(request.postpath) == 2:

        # Handle pet type and breed

    elif len(request.postpath) == 3:

        # Handle pet type, breed and idtag

    # Imagine this up to 'n' variables.....

    elif len(request.postpath) == n

        # Handle n variables



We seem to have an awful lot of replicated code in trying to parse the URL based on the length of the requested.postpath and dealing with each segment (split by '/') of the URL string. I feel that what we are trying to do has probably already been accounted for in the Twisted architecture available to us. Does anyone have any input on what (if anything) I am missing or lacking? Is this the correct way to approach development in Twisted? I am working my way through the O'Reilly Twisted Network Programming Essentials and studying the Twisted docs online, but I have not seen any 'best practices' approaches to application development, especially where parsing arguments is concerned.

Thanks in advance,
- Rob
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004440.html">[Twisted-web] Web client through https proxy - is it even	possible?
</A></li>
	<LI>Next message: <A HREF="004437.html">[Twisted-web] Newbie question on handling args in URL string
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4436">[ date ]</a>
              <a href="thread.html#4436">[ thread ]</a>
              <a href="subject.html#4436">[ subject ]</a>
              <a href="author.html#4436">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
