<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] How to handle interrupted responses in nevow?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20How%20to%20handle%20interrupted%20responses%20in%20nevow%3F&In-Reply-To=20101008131933.2022.1335597011.divmod.xquotient.463%40localhost.localdomain">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004543.html">
   <LINK REL="Next"  HREF="004541.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] How to handle interrupted responses in nevow?</H1>
    <B>Peter Westlake</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20How%20to%20handle%20interrupted%20responses%20in%20nevow%3F&In-Reply-To=20101008131933.2022.1335597011.divmod.xquotient.463%40localhost.localdomain"
       TITLE="[Twisted-web] How to handle interrupted responses in nevow?">peter.westlake at pobox.com
       </A><BR>
    <I>Fri Oct  8 12:50:51 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="004543.html">[Twisted-web] How to handle interrupted responses in nevow?
</A></li>
        <LI>Next message: <A HREF="004541.html">[Twisted-web] Possible bug in nevow.testutil.FakeRequest setHeaders and getHeaders
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4545">[ date ]</a>
              <a href="thread.html#4545">[ thread ]</a>
              <a href="subject.html#4545">[ subject ]</a>
              <a href="author.html#4545">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>

On Fri, 08 Oct 2010 13:19 +0000, <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">exarkun at twistedmatrix.com</A> wrote:
&gt;<i> On 1 Oct, 02:31 pm, <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">peter.westlake at pobox.com</A> wrote:
</I>&gt;<i> &gt;J.P's excellent article <A HREF="http://jcalderone.livejournal.com/50890.html">http://jcalderone.livejournal.com/50890.html</A>
</I>&gt;<i> &gt;explains how to avoid calling Request.finish() on a request after its
</I>&gt;<i> &gt;connection was lost, because that now raises an exception. The code in
</I>&gt;<i> &gt;the article is able to avoid calling finish() because it handles the
</I>&gt;<i> &gt;rendering itself. The call to finish() is right there in 
</I>&gt;<i> &gt;_delayedRender.
</I>&gt;<i> &gt;But I'm using Nevow (because it's awesome) and all that stuff is done
</I>&gt;<i> &gt;behind the scenes, where I can't get to it.
</I>&gt;<i> 
</I>&gt;<i> Mmm.  Indeed.  Nevow doesn't make it easy to handle this case.
</I>&gt;<i> 
</I>&gt;<i> Nevow itself should be taking some action in this case, I think.  One 
</I>&gt;<i> possibility would be to cancel the Deferred associated with the child 
</I>&gt;<i> lookup/rendering operation.  This would depend on having a new enough 
</I>&gt;<i> version of Twisted (such that Deferred cancellation is available) 
</I>&gt;<i> though.  Otherwise all Nevow could really do is ignore the result of the 
</I>&gt;<i> Deferred when it comes.
</I>
Is the version of Twisted with cancellation more recent than
the version of Nevow that detects the error? If not, it might
be reasonable to expect cancellation to be available. Or would
it be reasonable to test for it at the beginning of the Nevow source?

&gt;<i> Actually, ignoring the result might be a sensible thing to implement 
</I>&gt;<i> first anyway.  It should be simpler and have no application consequences 
</I>&gt;<i> except to get rid of the now-disallowed finish() call.
</I>&gt;<i> 
</I>&gt;<i> Are you interested in helping implement this?
</I>
I'm certainly willing to try! Especially as I have a cron job
that mails me whenever it finds an exception in the log.

Any hints as to how to go about it would be very welcome.
So far I've found NevowRequest._cbFinishRender in appserver.py
- is that the right sort of area? And NevowSite.handleSegment?

Peter.




</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004543.html">[Twisted-web] How to handle interrupted responses in nevow?
</A></li>
	<LI>Next message: <A HREF="004541.html">[Twisted-web] Possible bug in nevow.testutil.FakeRequest setHeaders and getHeaders
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4545">[ date ]</a>
              <a href="thread.html#4545">[ thread ]</a>
              <a href="subject.html#4545">[ subject ]</a>
              <a href="author.html#4545">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
