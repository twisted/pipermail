<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] Proxy Could not accept new connection
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Proxy%20Could%20not%20accept%20new%20connection&In-Reply-To=5acf0ea80908061522n54bad97ck163888f26c1f8325%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004306.html">
   <LINK REL="Next"  HREF="004308.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] Proxy Could not accept new connection</H1>
    <B>Glyph Lefkowitz</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Proxy%20Could%20not%20accept%20new%20connection&In-Reply-To=5acf0ea80908061522n54bad97ck163888f26c1f8325%40mail.gmail.com"
       TITLE="[Twisted-web] Proxy Could not accept new connection">glyph at twistedmatrix.com
       </A><BR>
    <I>Thu Aug  6 22:31:11 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="004306.html">[Twisted-web] Proxy Could not accept new connection
</A></li>
        <LI>Next message: <A HREF="004308.html">[Twisted-web] Proxy Could not accept new connection
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4307">[ date ]</a>
              <a href="thread.html#4307">[ thread ]</a>
              <a href="subject.html#4307">[ subject ]</a>
              <a href="author.html#4307">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Thu, Aug 6, 2009 at 6:22 PM, dave fowler &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">davefowler at gmail.com</A>&gt; wrote:

&gt;<i> I guys.  I'm running a twisted web proxy and after a day or so of usage it
</I>&gt;<i> stops working and start spitting out these errors.
</I>&gt;<i>
</I>&gt;<i> 2009/08/05 14:04 +0000 [__main__.ProxyFactory] Could not accept new
</I>&gt;<i> connection (EMFILE)
</I>&gt;<i> 2009/08/05 14:04 +0000 [__main__.ProxyFactory] Could not accept new
</I>&gt;<i> connection (EMFILE)
</I>&gt;<i> 2009/08/05 14:04 +0000 [__main__.ProxyFactory] Could not accept new
</I>&gt;<i> connection (EMFILE)
</I>&gt;<i> 2009/08/05 14:04 +0000 [__main__.ProxyFactory] Could not accept new
</I>&gt;<i> connection (EMFILE)
</I>&gt;<i> 2009/08/05 14:04 +0000 [__main__.ProxyFactory] Could not accept new
</I>&gt;<i> connection (EMFILE)
</I>&gt;<i> 2009/08/05 14:04 +0000 [__main__.ProxyFactory] Could not accept new
</I>&gt;<i> connection (EMFILE)
</I>&gt;<i>
</I>&gt;<i> Can anyone expand on what this error is or suggestions on fixing it or
</I>&gt;<i> debugging further?
</I>&gt;<i>
</I>&gt;<i> What is the EMFILE?
</I>&gt;<i>
</I>
It means you're out of file descriptors for your process.

See here for the root cause: &lt;<A HREF="http://linux.die.net/man/2/accept">http://linux.die.net/man/2/accept</A>&gt;,
specifically the part about EMFILE in the Errors section.  I'm actually glad
to see this error report - Twisted used to fail in a *much* worse way in
this error condition (&lt;<A HREF="http://twistedmatrix.com/trac/ticket/662">http://twistedmatrix.com/trac/ticket/662</A>&gt;), this is
the first proof I've seen that our fix works in the wild :).

To increase your per-process file-descriptor limit, use &quot;ulimit -n&quot;.  Be
aware that in order to increase this above 1024, you'll need to be root; I
think there's a way to set it up to be bigger than that for non-root users
but I don't know how.

In order to free up file descriptors, keep a list of your open connections
and shut down some of them.  Sadly, your Factory object won't be notified of
this problem, so you might have to hack something gross together (like a log
observer that watches for the string &quot;(EMFILE)&quot;).  I just filed this ticket
to provide a nice, clean notification: &lt;
<A HREF="http://twistedmatrix.com/trac/ticket/3958">http://twistedmatrix.com/trac/ticket/3958</A>&gt;.  This may be a duplicate of
something, but if so it should be closed with a link to what it's a
duplicate of.

In some cases, connections won't shut down properly because there is still
some buffered data and the other end is not available to acknowledge the
connection's closure.  If this is the case, you can forcibly close the file
descriptor (although this may cause some ugliness).  To get a good,
supported way to destroy file descriptors in Twisted, see this ticket: &lt;
<A HREF="http://twistedmatrix.com/trac/ticket/78">http://twistedmatrix.com/trac/ticket/78</A>&gt;.

Good luck!  Sorry Twisted has not handled this error in the best way for
you, I hope you help us fix some of these bugs for the next guy :).
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://twistedmatrix.com/pipermail/twisted-web/attachments/20090806/29cbefc1/attachment.htm">http://twistedmatrix.com/pipermail/twisted-web/attachments/20090806/29cbefc1/attachment.htm</A> 
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004306.html">[Twisted-web] Proxy Could not accept new connection
</A></li>
	<LI>Next message: <A HREF="004308.html">[Twisted-web] Proxy Could not accept new connection
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4307">[ date ]</a>
              <a href="thread.html#4307">[ thread ]</a>
              <a href="subject.html#4307">[ subject ]</a>
              <a href="author.html#4307">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
