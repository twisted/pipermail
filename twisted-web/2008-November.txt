From tzury.by at gmail.com  Mon Nov  3 07:01:04 2008
From: tzury.by at gmail.com (Tzury Bar Yochay)
Date: Mon Nov  3 07:01:14 2008
Subject: [Twisted-web] Give me your hello-world sample a and I'll do the
	rest (TwistedMatrix newbie)
Message-ID: <2f5ea7490811030401j25c6ca7ah4fe6990e591ff154@mail.gmail.com>

SGksCgpJIGFtIHdyaXRpbmcgYW4gYXBwbGljYXRpb24gd2hpY2ggdHJhbnNmZXIgZGF0YSBiZXR3
ZWVuIGNsaWVudHMgd2hpY2ggYXJlCmNvbm5lY3RlZCB0byBhIHNlcnZlciB1c2luZyBlaXRoZXIg
VURQIG9yIFRDUC4KCkFmdGVyIG1ha2luZyBzb21lIHByb2dyZXNzIGluIHRoZSBkZXZlbG9wbWVu
dCwgSSByZWFsaXplZCB0aGF0IEkgd291bGQgYmUKYmV0dGVyIG9mZiB1c2luZyBUd2lzdGVkTWF0
cml4IGluc3RlYWQgb2YgcmUtaW52ZW50aW5nIHRoZSB3aGVlbC4KClNvIEkgbG9va2VkIGF0Cmh0
dHA6Ly90d2lzdGVkbWF0cml4LmNvbS9wcm9qZWN0cy9jb3JlL2RvY3VtZW50YXRpb24vaG93dG8v
aW5kZXguaHRtbCBhbmQKY291bGQgbm90IGdldCB0aGUgaW5mb3JtYXRpb24gZnJvbSB0aGUgc2Ft
cGxlcy4KCkkgd291bGQgYmUgZ2xhZCBpZiBvbmUgY2FuIGRyYXcgdGhlIGxpbmVzIG9mIGhvdyB0
byBnZXQgYSBieXRlcyBzdHJlYW0gZnJvbQpjbGllbnQgQSBhbmQgJ3RyYW5zbWl0JyBpdCB0byBj
bGllbnQgQgoKR2l2aW5nIG1lIGFuIGV4YW1wbGUgd2l0aCBVRFAgb25seSB3b3VsZCBiZSBqdXN0
IGZpbmUgdG8gc3RhcnQgd2l0aAoKVGhhbmsgeW91IGluIGFkdmFuY2UsClR6dXJ5IEJhciBZb2No
YXkKLS0tLS0tLS0tLS0tLS0gbmV4dCBwYXJ0IC0tLS0tLS0tLS0tLS0tCkFuIEhUTUwgYXR0YWNo
bWVudCB3YXMgc2NydWJiZWQuLi4KVVJMOiBodHRwOi8vdHdpc3RlZG1hdHJpeC5jb20vcGlwZXJt
YWlsL3R3aXN0ZWQtd2ViL2F0dGFjaG1lbnRzLzIwMDgxMTAzL2Y2ZGJiZThjL2F0dGFjaG1lbnQu
aHRtCg==
From tzury.by at gmail.com  Mon Nov  3 07:08:47 2008
From: tzury.by at gmail.com (Tzury Bar Yochay)
Date: Mon Nov  3 07:08:51 2008
Subject: [Twisted-web] Re: Give me your hello-world sample a and I'll do the
	rest (TwistedMatrix newbie)
In-Reply-To: <2f5ea7490811030401j25c6ca7ah4fe6990e591ff154@mail.gmail.com>
References: <2f5ea7490811030401j25c6ca7ah4fe6990e591ff154@mail.gmail.com>
Message-ID: <2f5ea7490811030408q59d47000u3682b501c74140fe@mail.gmail.com>

SGksCgpJIGFtIHdyaXRpbmcgYW4gYXBwbGljYXRpb24gd2hpY2ggdHJhbnNmZXIgZGF0YSBiZXR3
ZWVuIGNsaWVudHMgd2hpY2ggYXJlCmNvbm5lY3RlZCB0byBhIHNlcnZlciB1c2luZyBlaXRoZXIg
VURQIG9yIFRDUC4KCkFmdGVyIG1ha2luZyBzb21lIHByb2dyZXNzIGluIHRoZSBkZXZlbG9wbWVu
dCwgSSByZWFsaXplZCB0aGF0IEkgd291bGQgYmUKYmV0dGVyIG9mZiB1c2luZyBUd2lzdGVkTWF0
cml4IGluc3RlYWQgb2YgcmUtaW52ZW50aW5nIHRoZSB3aGVlbC4KClNvIEkgbG9va2VkIGF0Cmh0
dHA6Ly90d2lzdGVkbWF0cml4LmNvbS9wcm9qZWN0cy9jb3JlL2RvY3VtZW50YXRpb24vaG93dG8v
aW5kZXguaHRtbCBhbmQKY291bGQgbm90IGdldCB0aGUgaW5mb3JtYXRpb24gZnJvbSB0aGUgc2Ft
cGxlcy4KCkkgd291bGQgYmUgZ2xhZCBpZiBvbmUgY2FuIGRyYXcgdGhlIGxpbmVzIG9mIGhvdyB0
byBnZXQgYSBieXRlcyBzdHJlYW0gZnJvbQpjbGllbnQgQSBhbmQgJ3RyYW5zbWl0JyBpdCB0byBj
bGllbnQgQgoKR2l2aW5nIG1lIGFuIGV4YW1wbGUgd2l0aCBVRFAgb25seSB3b3VsZCBiZSBqdXN0
IGZpbmUgdG8gc3RhcnQgd2l0aAoKVGhhbmsgeW91IGluIGFkdmFuY2UsClR6dXJ5IEJhciBZb2No
YXkKLS0tLS0tLS0tLS0tLS0gbmV4dCBwYXJ0IC0tLS0tLS0tLS0tLS0tCkFuIEhUTUwgYXR0YWNo
bWVudCB3YXMgc2NydWJiZWQuLi4KVVJMOiBodHRwOi8vdHdpc3RlZG1hdHJpeC5jb20vcGlwZXJt
YWlsL3R3aXN0ZWQtd2ViL2F0dGFjaG1lbnRzLzIwMDgxMTAzLzNiZGQ4MTQxL2F0dGFjaG1lbnQu
aHRtCg==
From tzury.by at gmail.com  Mon Nov  3 07:10:26 2008
From: tzury.by at gmail.com (Tzury Bar Yochay)
Date: Mon Nov  3 07:10:30 2008
Subject: [Twisted-web] Give me your hello-world sample a and I'll do the
	rest (TwistedMatrix newbie)
Message-ID: <2f5ea7490811030410q6910597by8977f328dc6ad626@mail.gmail.com>

SGksCgpJIGFtIHdyaXRpbmcgYW4gYXBwbGljYXRpb24gd2hpY2ggdHJhbnNmZXIgZGF0YSBiZXR3
ZWVuIGNsaWVudHMgd2hpY2ggYXJlCmNvbm5lY3RlZCB0byBhIHNlcnZlciB1c2luZyBlaXRoZXIg
VURQIG9yIFRDUC4KCkFmdGVyIG1ha2luZyBzb21lIHByb2dyZXNzIGluIHRoZSBkZXZlbG9wbWVu
dCwgSSByZWFsaXplZCB0aGF0IEkgd291bGQgYmUKYmV0dGVyIG9mZiB1c2luZyBUd2lzdGVkTWF0
cml4IGluc3RlYWQgb2YgcmUtaW52ZW50aW5nIHRoZSB3aGVlbC4KClNvIEkgbG9va2VkIGF0Cmh0
dHA6Ly90d2lzdGVkbWF0cml4LmNvbS9wcm9qZWN0cy9jb3JlL2RvY3VtZW50YXRpb24vaG93dG8v
aW5kZXguaHRtbCBhbmQKY291bGQgbm90IGdldCB0aGUgaW5mb3JtYXRpb24gZnJvbSB0aGUgc2Ft
cGxlcy4KCkkgd291bGQgYmUgZ2xhZCBpZiBvbmUgY2FuIGRyYXcgdGhlIGxpbmVzIG9mIGhvdyB0
byBnZXQgYSBieXRlcyBzdHJlYW0gZnJvbQpjbGllbnQgQSBhbmQgJ3RyYW5zbWl0JyBpdCB0byBj
bGllbnQgQgoKR2l2aW5nIG1lIGFuIGV4YW1wbGUgd2l0aCBVRFAgb25seSB3b3VsZCBiZSBqdXN0
IGZpbmUgdG8gc3RhcnQgd2l0aAoKVGhhbmsgeW91IGluIGFkdmFuY2UsClR6dXJ5IEJhciBZb2No
YXkKLS0tLS0tLS0tLS0tLS0gbmV4dCBwYXJ0IC0tLS0tLS0tLS0tLS0tCkFuIEhUTUwgYXR0YWNo
bWVudCB3YXMgc2NydWJiZWQuLi4KVVJMOiBodHRwOi8vdHdpc3RlZG1hdHJpeC5jb20vcGlwZXJt
YWlsL3R3aXN0ZWQtd2ViL2F0dGFjaG1lbnRzLzIwMDgxMTAzL2UxM2FiMDdkL2F0dGFjaG1lbnQu
aHRtCg==
From tzury.by at gmail.com  Mon Nov  3 07:12:06 2008
From: tzury.by at gmail.com (Tzury Bar Yochay)
Date: Mon Nov  3 07:12:13 2008
Subject: [Twisted-web] Give me your hello-world sample a and I'll do the
	rest (TwistedMatrix newbie)
Message-ID: <2f5ea7490811030412h6df9dc15qd8c81edb5c5b1aa5@mail.gmail.com>

SGksCgpJIGFtIHdyaXRpbmcgYW4gYXBwbGljYXRpb24gd2hpY2ggdHJhbnNmZXIgZGF0YSBiZXR3
ZWVuIGNsaWVudHMgd2hpY2ggYXJlCmNvbm5lY3RlZCB0byBhIHNlcnZlciB1c2luZyBlaXRoZXIg
VURQIG9yIFRDUC4KCkFmdGVyIG1ha2luZyBzb21lIHByb2dyZXNzIGluIHRoZSBkZXZlbG9wbWVu
dCwgSSByZWFsaXplZCB0aGF0IEkgd291bGQgYmUKYmV0dGVyIG9mZiB1c2luZyBUd2lzdGVkTWF0
cml4IGluc3RlYWQgb2YgcmUtaW52ZW50aW5nIHRoZSB3aGVlbC4KClNvIEkgbG9va2VkIGF0Cmh0
dHA6Ly90d2lzdGVkbWF0cml4LmNvbS9wcm9qZWN0cy9jb3JlL2RvY3VtZW50YXRpb24vaG93dG8v
aW5kZXguaHRtbCBhbmQKY291bGQgbm90IGdldCB0aGUgaW5mb3JtYXRpb24gZnJvbSB0aGUgc2Ft
cGxlcy4KCkkgd291bGQgYmUgZ2xhZCBpZiBvbmUgY2FuIGRyYXcgdGhlIGxpbmVzIG9mIGhvdyB0
byBnZXQgYSBieXRlcyBzdHJlYW0gZnJvbQpjbGllbnQgQSBhbmQgJ3RyYW5zbWl0JyBpdCB0byBj
bGllbnQgQgoKR2l2aW5nIG1lIGFuIGV4YW1wbGUgd2l0aCBVRFAgb25seSB3b3VsZCBiZSBqdXN0
IGZpbmUgdG8gc3RhcnQgd2l0aAoKVGhhbmsgeW91IGluIGFkdmFuY2UsClR6dXJ5IEJhciBZb2No
YXkKLS0tLS0tLS0tLS0tLS0gbmV4dCBwYXJ0IC0tLS0tLS0tLS0tLS0tCkFuIEhUTUwgYXR0YWNo
bWVudCB3YXMgc2NydWJiZWQuLi4KVVJMOiBodHRwOi8vdHdpc3RlZG1hdHJpeC5jb20vcGlwZXJt
YWlsL3R3aXN0ZWQtd2ViL2F0dGFjaG1lbnRzLzIwMDgxMTAzL2JlZTJlMmI2L2F0dGFjaG1lbnQu
aHRtCg==
From afro.systems at gmail.com  Mon Nov  3 07:16:22 2008
From: afro.systems at gmail.com (afro.systems@gmail.com)
Date: Mon Nov  3 07:16:34 2008
Subject: [Twisted-web] Give me your hello-world sample a and I'll do the
	rest (TwistedMatrix newbie)
Message-ID: <2f5ea7490811030416j272bb2f9y8b860e4e3de7d529@mail.gmail.com>

U29ycnkgZm9yIHByZXZpb3VzIG1lc3NhZ2VzIC0gYXJlIGJlZW4gZW5jcnlwdGVkIHVuaW50ZW50
aW9uYWxseSBieSBhCmZpcmVmb3ggZ3BnIHBsdWctaW4KCkhpLAoKSSBhbSB3cml0aW5nIGFuIGFw
cGxpY2F0aW9uIHdoaWNoIHRyYW5zZmVyIGRhdGEgYmV0d2VlbiBjbGllbnRzIHdoaWNoIGFyZQpj
b25uZWN0ZWQgdG8gYSBzZXJ2ZXIgdXNpbmcgZWl0aGVyIFVEUCBvciBUQ1AuCgpBZnRlciBtYWtp
bmcgc29tZSBwcm9ncmVzcyBpbiB0aGUgZGV2ZWxvcG1lbnQsIEkgcmVhbGl6ZWQgdGhhdCBJIHdv
dWxkIGJlCmJldHRlciBvZmYgdXNpbmcgVHdpc3RlZE1hdHJpeCBpbnN0ZWFkIG9mIHJlLWludmVu
dGluZyB0aGUgd2hlZWwuCgpTbyBJIGxvb2tlZCBhdApodHRwOi8vdHdpc3RlZG1hdHJpeC5jb20v
cHJvamVjdHMvY29yZS9kb2N1bWVudGF0aW9uL2hvd3RvL2luZGV4Lmh0bWwgYW5kCmNvdWxkIG5v
dCBnZXQgdGhlIGluZm9ybWF0aW9uIGZyb20gdGhlIHNhbXBsZXMuCgpJIHdvdWxkIGJlIGdsYWQg
aWYgb25lIGNhbiBkcmF3IHRoZSBsaW5lcyBvZiBob3cgdG8gZ2V0IGEgYnl0ZXMgc3RyZWFtIGZy
b20KY2xpZW50IEEgYW5kICd0cmFuc21pdCcgaXQgdG8gY2xpZW50IEIKCkdpdmluZyBtZSBhbiBl
eGFtcGxlIHdpdGggVURQIG9ubHkgd291bGQgYmUganVzdCBmaW5lIHRvIHN0YXJ0IHdpdGgKClRo
YW5rIHlvdSBpbiBhZHZhbmNlLApUenVyeSBCYXIgWW9jaGF5Ci0tLS0tLS0tLS0tLS0tIG5leHQg
cGFydCAtLS0tLS0tLS0tLS0tLQpBbiBIVE1MIGF0dGFjaG1lbnQgd2FzIHNjcnViYmVkLi4uClVS
TDogaHR0cDovL3R3aXN0ZWRtYXRyaXguY29tL3BpcGVybWFpbC90d2lzdGVkLXdlYi9hdHRhY2ht
ZW50cy8yMDA4MTEwMy8wNzA0NzYyNy9hdHRhY2htZW50Lmh0bQo=
From tzury.by at gmail.com  Mon Nov  3 07:17:47 2008
From: tzury.by at gmail.com (Tzury Bar Yochay)
Date: Mon Nov  3 07:17:51 2008
Subject: [Twisted-web] Give me your hello-world sample a and I'll do the
	rest (TwistedMatrix newbie)
Message-ID: <2f5ea7490811030417x33294f3ic1f5f67baec8fffe@mail.gmail.com>

Sorry for previous messages - are been encrypted unintentionally by a
firefox gpg plug-in

Hi,

I am writing an application which transfer data between clients which are
connected to a server using either UDP or TCP.

After making some progress in the development, I realized that I would be
better off using TwistedMatrix instead of re-inventing the wheel.

So I looked at
http://twistedmatrix.com/projects/core/documentation/howto/index.html and
could not get the information from the samples.

I would be glad if one can draw the lines of how to get a bytes stream from
client A and 'transmit' it to client B

Giving me an example with UDP only would be just fine to start with

Thank you in advance,
Tzury Bar Yochay

From glyph at divmod.com  Mon Nov  3 07:55:06 2008
From: glyph at divmod.com (glyph@divmod.com)
Date: Mon Nov  3 07:53:13 2008
Subject: [Twisted-web] Give me your hello-world sample a and I'll do the
	rest (TwistedMatrix newbie)
In-Reply-To: <2f5ea7490811030417x33294f3ic1f5f67baec8fffe@mail.gmail.com>
References: <2f5ea7490811030417x33294f3ic1f5f67baec8fffe@mail.gmail.com>
Message-ID: <20081103125506.6400.551618012.divmod.xquotient.618@weber.divmod.com>

On 12:17 pm, tzury.by@gmail.com wrote:
>Sorry for previous messages - are been encrypted unintentionally by a
>firefox gpg plug-in

They didn't look encrypted, but there sure were a lot of them :).
>I am writing an application which transfer data between clients which 
>are
>connected to a server using either UDP or TCP.

You're certainly in the right place with regard to Twisted itself - 
although this might not be the right list.  If you're dealing with UDP 
and non-HTTP TCP traffic, you probably want twisted- 
python@twistedmatrix.com, not twisted-web.
>After making some progress in the development, I realized that I would 
>be
>better off using TwistedMatrix instead of re-inventing the wheel.

I wish more people reached that conclusion :-).
>So I looked at
>http://twistedmatrix.com/projects/core/documentation/howto/index.html 
>and
>could not get the information from the samples.

>I would be glad if one can draw the lines of how to get a bytes stream 
>from
>client A and 'transmit' it to client B

Your question is actually a FAQ. 
http://twistedmatrix.com/trac/wiki/FrequentlyAskedQuestions#HowdoImakeinputononeconnectionresultinoutputonanother

Please let us know if the answer to the FAQ could be improved or made 
easier to find somehow.

From tzury.by at gmail.com  Mon Nov  3 07:59:30 2008
From: tzury.by at gmail.com (Tzury Bar Yochay)
Date: Mon Nov  3 07:59:36 2008
Subject: [Twisted-web] Give me your hello-world sample a and I'll do the
	rest (TwistedMatrix newbie)
In-Reply-To: <20081103125506.6400.551618012.divmod.xquotient.618@weber.divmod.com>
References: <2f5ea7490811030417x33294f3ic1f5f67baec8fffe@mail.gmail.com>
	<20081103125506.6400.551618012.divmod.xquotient.618@weber.divmod.com>
Message-ID: <2f5ea7490811030459n29f89af4n49d2d3cc10a0eff1@mail.gmail.com>

On Mon, Nov 3, 2008 at 2:55 PM,  <glyph@divmod.com> wrote:
> On 12:17 pm, tzury.by@gmail.com wrote:
>>
>> Sorry for previous messages - are been encrypted unintentionally by a
>> firefox gpg plug-in
>
> They didn't look encrypted, but there sure were a lot of them :).

seems like a bug in the latest update from firePGP firefox plug-in

>>
>> I am writing an application which transfer data between clients which are
>> connected to a server using either UDP or TCP.
>
> You're certainly in the right place with regard to Twisted itself - although
> this might not be the right list.  If you're dealing with UDP and non-HTTP
> TCP traffic, you probably want twisted- python@twistedmatrix.com, not
> twisted-web.
>>
>> After making some progress in the development, I realized that I would be
>> better off using TwistedMatrix instead of re-inventing the wheel.
>
> I wish more people reached that conclusion :-).
>>
>> So I looked at
>> http://twistedmatrix.com/projects/core/documentation/howto/index.html and
>> could not get the information from the samples.
>
>> I would be glad if one can draw the lines of how to get a bytes stream
>> from
>> client A and 'transmit' it to client B
>
> Your question is actually a FAQ.
> http://twistedmatrix.com/trac/wiki/FrequentlyAskedQuestions#HowdoImakeinputononeconnectionresultinoutputonanother
>
> Please let us know if the answer to the FAQ could be improved or made easier
> to find somehow.

thanks for the pending response. that faq is the one I needed. (As
always) I might should have read the FAQ before jumping into the
examples.

From tzury.by at gmail.com  Mon Nov  3 08:13:07 2008
From: tzury.by at gmail.com (Tzury Bar Yochay)
Date: Mon Nov  3 08:13:11 2008
Subject: [Twisted-web] Give me your hello-world sample a and I'll do the
	rest (TwistedMatrix newbie)
In-Reply-To: <2f5ea7490811030459n29f89af4n49d2d3cc10a0eff1@mail.gmail.com>
References: <2f5ea7490811030417x33294f3ic1f5f67baec8fffe@mail.gmail.com>
	<20081103125506.6400.551618012.divmod.xquotient.618@weber.divmod.com>
	<2f5ea7490811030459n29f89af4n49d2d3cc10a0eff1@mail.gmail.com>
Message-ID: <2f5ea7490811030513v2c6c1477rafa645c44feec9f8@mail.gmail.com>

>> Your question is actually a FAQ.
>> http://twistedmatrix.com/trac/wiki/FrequentlyAskedQuestions#HowdoImakeinputononeconnectionresultinoutputonanother
>>
>> Please let us know if the answer to the FAQ could be improved or made easier
>> to find somehow.
>
> thanks for the pending response. that faq is the one I needed. (As
> always) I might should have read the FAQ before jumping into the
> examples.
>

If I could have get that MultiEchoFactory sample using UDP it was more
than one can wish.

-- 
Tzury Bar Yochay

From tzury.by at gmail.com  Mon Nov  3 08:30:11 2008
From: tzury.by at gmail.com (Tzury Bar Yochay)
Date: Mon Nov  3 08:30:17 2008
Subject: [Twisted-web] Give me your hello-world sample a and I'll do the
	rest (TwistedMatrix newbie)
In-Reply-To: <2f5ea7490811030513v2c6c1477rafa645c44feec9f8@mail.gmail.com>
References: <2f5ea7490811030417x33294f3ic1f5f67baec8fffe@mail.gmail.com>
	<20081103125506.6400.551618012.divmod.xquotient.618@weber.divmod.com>
	<2f5ea7490811030459n29f89af4n49d2d3cc10a0eff1@mail.gmail.com>
	<2f5ea7490811030513v2c6c1477rafa645c44feec9f8@mail.gmail.com>
Message-ID: <2f5ea7490811030530m781becc5pf8585a244419bcc1@mail.gmail.com>

On Mon, Nov 3, 2008 at 3:13 PM, Tzury Bar Yochay <tzury.by@gmail.com> wrote:
>>> Your question is actually a FAQ.
>>> http://twistedmatrix.com/trac/wiki/FrequentlyAskedQuestions#HowdoImakeinputononeconnectionresultinoutputonanother
>>>
>>> Please let us know if the answer to the FAQ could be improved or made easier
>>> to find somehow.
>>
>> thanks for the pending response. that faq is the one I needed. (As
>> always) I might should have read the FAQ before jumping into the
>> examples.
>>
>
> If I could have get that MultiEchoFactory sample using UDP it was more
> than one can wish.
>

May you add this to the FAQ:

#UDP multiEcho Sample

from twisted.internet.protocol import DatagramProtocol
from twisted.internet import reactor

class MultiEcho(DatagramProtocol):
    def startProtocol(self):
        self.echoers = []

    def datagramReceived(self, data, (host, port)):
        if not (host, port) in self.echoers:
            self.echoers.append((host, port))
        print "received %r from %s:%d" % (data, host, port)
        for echoer in self.echoers:
            self.transport.write(data, echoer)

reactor.listenUDP(9999, MultiEcho())
reactor.run()

Tzury Bar Yochay

From tzury.by at gmail.com  Tue Nov  4 15:20:25 2008
From: tzury.by at gmail.com (Tzury Bar Yochay)
Date: Tue Nov  4 15:20:43 2008
Subject: [Twisted-web] Having reactor run at the main thread make things
	harder for late adopters
Message-ID: <2f5ea7490811041220j64d2ad63h3b09e35f14680048@mail.gmail.com>

I will first describe my application in a single sentence.

Write a server that can serve TCP/UDP clients on several ports, and
let the clients communicate with each other in a predefined protocol,
while each can 'talk' to the server in a different protocol/port.

In my case where I picked up Twisted relatively late in the project I
need Twisted to plugged into my applocation and not the my application
plugged-into Twisted (at least at this stage).

Is there a way to by-pass this limitation?

At this stage the main problem I see is having transport.write will
have data transmitted immediately when called from another thread.

From george at ringdevelopment.com  Tue Nov  4 15:56:12 2008
From: george at ringdevelopment.com (George Pauly)
Date: Tue Nov  4 15:52:12 2008
Subject: [Twisted-web] Having reactor run at the main thread make
	things harder for late adopters
In-Reply-To: <2f5ea7490811041220j64d2ad63h3b09e35f14680048@mail.gmail.com>
References: <2f5ea7490811041220j64d2ad63h3b09e35f14680048@mail.gmail.com>
Message-ID: <1225832172.10559.25.camel@localhost.localdomain>

On Tue, 2008-11-04 at 22:20 +0200, Tzury Bar Yochay wrote:
> I will first describe my application in a single sentence.
> 
> Write a server that can serve TCP/UDP clients on several ports, and
> let the clients communicate with each other in a predefined protocol,
> while each can 'talk' to the server in a different protocol/port.
> 

Are the clients communicating directly or through the server?

Are the ports specific to either client/server communication or
(presuming the answer to the first question) client/client
communication?


> In my case where I picked up Twisted relatively late in the project I
> need Twisted to plugged into my applocation and not the my application
> plugged-into Twisted (at least at this stage).
> 

Is this because the client is already written with a specific protocol
in mind?


> Is there a way to by-pass this limitation?
> 
> At this stage the main problem I see is having transport.write will
> have data transmitted immediately when called from another thread.
> 

You already have threads in your server?  Is this the limitation?  If
so, are the threads there to handle client connections?

-- 
George Pauly
Ring Development
www.ringdevelopment.com


From tzury.by at gmail.com  Tue Nov  4 16:03:16 2008
From: tzury.by at gmail.com (Tzury Bar Yochay)
Date: Tue Nov  4 16:03:22 2008
Subject: [Twisted-web] Having reactor run at the main thread make things
	harder for late adopters
In-Reply-To: <1225832172.10559.25.camel@localhost.localdomain>
References: <2f5ea7490811041220j64d2ad63h3b09e35f14680048@mail.gmail.com>
	<1225832172.10559.25.camel@localhost.localdomain>
Message-ID: <2f5ea7490811041303g3ec8ae02r7144818a5f426c7b@mail.gmail.com>

On Tue, Nov 4, 2008 at 10:56 PM, George Pauly
<george@ringdevelopment.com> wrote:
> On Tue, 2008-11-04 at 22:20 +0200, Tzury Bar Yochay wrote:
>> I will first describe my application in a single sentence.
>>
>> Write a server that can serve TCP/UDP clients on several ports, and
>> let the clients communicate with each other in a predefined protocol,
>> while each can 'talk' to the server in a different protocol/port.
>>
>
> Are the clients communicating directly or through the server?

clients are to communicate via server only (they are behind NATs)

>
> Are the ports specific to either client/server communication or
> (presuming the answer to the first question) client/client
> communication?
>
Clients can communicate with the server using either one of predefined
available ports.
You never know what port/protocol the firewall will allow them
>
>> In my case where I picked up Twisted relatively late in the project I
>> need Twisted to plugged into my applocation and not the my application
>> plugged-into Twisted (at least at this stage).
>>
>
> Is this because the client is already written with a specific protocol
> in mind?

That is correct!

>
>> Is there a way to by-pass this limitation?
>>
>> At this stage the main problem I see is having transport.write will
>> have data transmitted immediately when called from another thread.
>>
>
> You already have threads in your server?  Is this the limitation?  If
> so, are the threads there to handle client connections?

I am using  (thread-safe) queue.Queue and have one for
incoming-requests and another one for pending-responses.
I have one thread which read on request at a time and handle it. once
done, puts a response in the response-queue. Bare in mind that the
response might be forwarded to another client or to the original
sender depend on the case.

If I won't find a decent way to hack this I might going to rewrite the
more code than I can allow myself at this point of time.
> --
> George Pauly
> Ring Development
> www.ringdevelopment.com
>
>
> _______________________________________________
> Twisted-web mailing list
> Twisted-web@twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web
>



-- 
Tzury Bar Yochay

From george at ringdevelopment.com  Tue Nov  4 16:56:24 2008
From: george at ringdevelopment.com (George Pauly)
Date: Tue Nov  4 16:52:24 2008
Subject: [Twisted-web] Having reactor run at the main thread make
	things harder for late adopters
In-Reply-To: <2f5ea7490811041303g3ec8ae02r7144818a5f426c7b@mail.gmail.com>
References: <2f5ea7490811041220j64d2ad63h3b09e35f14680048@mail.gmail.com>
	<1225832172.10559.25.camel@localhost.localdomain>
	<2f5ea7490811041303g3ec8ae02r7144818a5f426c7b@mail.gmail.com>
Message-ID: <1225835784.10559.49.camel@localhost.localdomain>

On Tue, 2008-11-04 at 23:03 +0200, Tzury Bar Yochay wrote:
...
> 
> I am using  (thread-safe) queue.Queue and have one for
> incoming-requests and another one for pending-responses.
> I have one thread which read on request at a time and handle it. once
> done, puts a response in the response-queue. Bare in mind that the
> response might be forwarded to another client or to the original
> sender depend on the case.
> 
> If I won't find a decent way to hack this I might going to rewrite the
> more code than I can allow myself at this point of time.


This kind of thread work is what Twisted can do for you.  Either do it
with threads or with Twisted.  Queue may be more than you need to handle
the client-client connections.


Referring to the FAQ Glyph recommended to you,                       

http://twistedmatrix.com/trac/wiki/FrequentlyAskedQuestions#HowdoImakeinputononeconnectionresultinoutputonanother

Instead of broadcasting to a list of connections set up a method to
obtain the single appropriate connection and write to that.  


Please respond only to the list.

Thanks,

George


-- 
George Pauly
Ring Development
www.ringdevelopment.com


From tzury.by at gmail.com  Tue Nov  4 17:04:55 2008
From: tzury.by at gmail.com (Tzury Bar Yochay)
Date: Tue Nov  4 17:04:58 2008
Subject: [Twisted-web] Having reactor run at the main thread make things
	harder for late adopters
In-Reply-To: <1225835784.10559.49.camel@localhost.localdomain>
References: <2f5ea7490811041220j64d2ad63h3b09e35f14680048@mail.gmail.com>
	<1225832172.10559.25.camel@localhost.localdomain>
	<2f5ea7490811041303g3ec8ae02r7144818a5f426c7b@mail.gmail.com>
	<1225835784.10559.49.camel@localhost.localdomain>
Message-ID: <2f5ea7490811041404j35235cd4uea4a7529a33e1333@mail.gmail.com>

> This kind of thread work is what Twisted can do for you.  Either do it
> with threads or with Twisted.  Queue may be more than you need to handle
> the client-client connections.
>
> Referring to the FAQ Glyph recommended to you,
>
> http://twistedmatrix.com/trac/wiki/FrequentlyAskedQuestions#HowdoImakeinputononeconnectionresultinoutputonanother
>
> Instead of broadcasting to a list of connections set up a method to
> obtain the single appropriate connection and write to that.
>

Thinking about this over again I decided to bring my application to
Twisted. I will give up the pending queues and will make the code more
readable and control-flow much more traceable.

Thanks very much for your advice and sorry for the reply. (i simply
pressed `r` in my gmail and started typing...)

Tzury

From andrew-twisted at puzzling.org  Tue Nov  4 17:48:33 2008
From: andrew-twisted at puzzling.org (Andrew Bennetts)
Date: Tue Nov  4 17:48:39 2008
Subject: [Twisted-web] Having reactor run at the main thread make
	things harder for late adopters
In-Reply-To: <2f5ea7490811041220j64d2ad63h3b09e35f14680048@mail.gmail.com>
References: <2f5ea7490811041220j64d2ad63h3b09e35f14680048@mail.gmail.com>
Message-ID: <20081104224833.GJ12038@steerpike.home.puzzling.org>

Tzury Bar Yochay wrote:
> I will first describe my application in a single sentence.
> 
> Write a server that can serve TCP/UDP clients on several ports, and
> let the clients communicate with each other in a predefined protocol,
> while each can 'talk' to the server in a different protocol/port.
> 
> In my case where I picked up Twisted relatively late in the project I
> need Twisted to plugged into my applocation and not the my application
> plugged-into Twisted (at least at this stage).
> 
> Is there a way to by-pass this limitation?

You can run the reactor in any thread you like.  You probably need to pass
installSignalHandlers=False to reactor.run in a non-main thread, but otherwise
there's nothing stopping you running the reactor in a separate, non-main thread
if that's what's easiest for you.

> At this stage the main problem I see is having transport.write will
> have data transmitted immediately when called from another thread.

When calling into Twisted from non-Twisted threads, use reactor.callFromThread.
See <http://twistedmatrix.com/projects/core/documentation/howto/threading.html>.

-Andrew.


From tzury.by at gmail.com  Tue Nov  4 22:59:32 2008
From: tzury.by at gmail.com (Tzury Bar Yochay)
Date: Tue Nov  4 22:59:34 2008
Subject: [Twisted-web] Having reactor run at the main thread make things
	harder for late adopters
In-Reply-To: <20081104224833.GJ12038@steerpike.home.puzzling.org>
References: <2f5ea7490811041220j64d2ad63h3b09e35f14680048@mail.gmail.com>
	<20081104224833.GJ12038@steerpike.home.puzzling.org>
Message-ID: <2f5ea7490811041959k436c6a63he6b5a88d0cb4e75d@mail.gmail.com>

>
>> At this stage the main problem I see is having transport.write will
>> have data transmitted immediately when called from another thread.
>
> When calling into Twisted from non-Twisted threads, use reactor.callFromThread.
> See <http://twistedmatrix.com/projects/core/documentation/howto/threading.html>.

I actually saw this reactor.callFromThread but weren't sure whether it
is a singelton i.e. I can use it in another module by simply importing
reactor and calling it and it will affect the same I called .run on in
another module. I checked it right now and it works.

thank you,
 - Tzury

From andrew-twisted at puzzling.org  Tue Nov  4 23:11:08 2008
From: andrew-twisted at puzzling.org (Andrew Bennetts)
Date: Tue Nov  4 23:11:14 2008
Subject: [Twisted-web] Having reactor run at the main thread make
	things harder for late adopters
In-Reply-To: <2f5ea7490811041959k436c6a63he6b5a88d0cb4e75d@mail.gmail.com>
References: <2f5ea7490811041220j64d2ad63h3b09e35f14680048@mail.gmail.com>
	<20081104224833.GJ12038@steerpike.home.puzzling.org>
	<2f5ea7490811041959k436c6a63he6b5a88d0cb4e75d@mail.gmail.com>
Message-ID: <20081105041108.GL12038@steerpike.home.puzzling.org>

Tzury Bar Yochay wrote:
> >
> >> At this stage the main problem I see is having transport.write will
> >> have data transmitted immediately when called from another thread.
> >
> > When calling into Twisted from non-Twisted threads, use reactor.callFromThread.
> > See <http://twistedmatrix.com/projects/core/documentation/howto/threading.html>.
> 
> I actually saw this reactor.callFromThread but weren't sure whether it
> is a singelton i.e. I can use it in another module by simply importing
> reactor and calling it and it will affect the same I called .run on in
> another module. I checked it right now and it works.

Yes, it is a singleton.  As
<http://twistedmatrix.com/projects/core/documentation/howto/reactor-basics.html>
says:

    You can get to the reactor object using the following code:

        from twisted.internet import reactor

The documentation could perhaps be clearer about this (that document implies,
but doesn't directly state, that there's only one reactor instance).

-Andrew.


From exarkun at divmod.com  Wed Nov  5 00:33:39 2008
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Wed Nov  5 00:33:54 2008
Subject: [Twisted-web] Having reactor run at the main thread make things
	harder for late adopters
In-Reply-To: <20081105041108.GL12038@steerpike.home.puzzling.org>
Message-ID: <20081105053339.29191.870275699.divmod.quotient.49919@ohm>

On Wed, 5 Nov 2008 15:11:08 +1100, Andrew Bennetts <andrew-twisted@puzzling.org> wrote:
>Tzury Bar Yochay wrote:
>> >
>> >> At this stage the main problem I see is having transport.write will
>> >> have data transmitted immediately when called from another thread.
>> >
>> > When calling into Twisted from non-Twisted threads, use reactor.callFromThread.
>> > See <http://twistedmatrix.com/projects/core/documentation/howto/threading.html>.
>>
>> I actually saw this reactor.callFromThread but weren't sure whether it
>> is a singelton i.e. I can use it in another module by simply importing
>> reactor and calling it and it will affect the same I called .run on in
>> another module. I checked it right now and it works.
>
>Yes, it is a singleton.  As
><http://twistedmatrix.com/projects/core/documentation/howto/reactor-basics.html>
>says:
>
>    You can get to the reactor object using the following code:
>
>        from twisted.internet import reactor
>
>The documentation could perhaps be clearer about this (that document implies,
>but doesn't directly state, that there's only one reactor instance).
>

Although I don't see how it matters if it's a singleton or not. :)  If it
weren't, you could just pass the reactor you were using to the thread that
needed to use it.

Jean-Paul

From andrew-twisted at puzzling.org  Wed Nov  5 01:41:44 2008
From: andrew-twisted at puzzling.org (Andrew Bennetts)
Date: Wed Nov  5 01:41:49 2008
Subject: [Twisted-web] Having reactor run at the main thread make
	things harder for late adopters
In-Reply-To: <20081105053339.29191.870275699.divmod.quotient.49919@ohm>
References: <20081105041108.GL12038@steerpike.home.puzzling.org>
	<20081105053339.29191.870275699.divmod.quotient.49919@ohm>
Message-ID: <20081105064143.GM12038@steerpike.home.puzzling.org>

Jean-Paul Calderone wrote:
> On Wed, 5 Nov 2008 15:11:08 +1100, Andrew Bennetts <andrew-twisted@puzzling.org> wrote:
[...]
>> Yes, it is a singleton.  As
>> <http://twistedmatrix.com/projects/core/documentation/howto/reactor-basics.html>
>> says:
>>
>>    You can get to the reactor object using the following code:
>>
>>        from twisted.internet import reactor
>>
>> The documentation could perhaps be clearer about this (that document implies,
>> but doesn't directly state, that there's only one reactor instance).
>>
>
> Although I don't see how it matters if it's a singleton or not. :)  If it
> weren't, you could just pass the reactor you were using to the thread that
> needed to use it.

It matters just because it makes it clear that yes, ?from twisted.internet
import reactor? really does Just Work, all the time.

-Andrew.


From exarkun at divmod.com  Wed Nov  5 08:05:21 2008
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Wed Nov  5 08:05:37 2008
Subject: [Twisted-web] Having reactor run at the main thread make things
	harder for late adopters
In-Reply-To: <20081105064143.GM12038@steerpike.home.puzzling.org>
Message-ID: <20081105130521.29191.1572484769.divmod.quotient.50098@ohm>



On Wed, 5 Nov 2008 17:41:44 +1100, Andrew Bennetts <andrew-twisted@puzzling.org> wrote:
>Jean-Paul Calderone wrote:
>> On Wed, 5 Nov 2008 15:11:08 +1100, Andrew Bennetts <andrew-twisted@puzzling.org> wrote:
>[...]
>>> Yes, it is a singleton.  As
>>> <http://twistedmatrix.com/projects/core/documentation/howto/reactor-basics.html>
>>> says:
>>>
>>>    You can get to the reactor object using the following code:
>>>
>>>        from twisted.internet import reactor
>>>
>>> The documentation could perhaps be clearer about this (that document implies,
>>> but doesn't directly state, that there's only one reactor instance).
>>>
>>
>> Although I don't see how it matters if it's a singleton or not. :)  If it
>> weren't, you could just pass the reactor you were using to the thread that
>> needed to use it.
>
>It matters just because it makes it clear that yes, ?from twisted.internet
>import reactor? really does Just Work, all the time.

Sure.  But even if it didn't, you'd be alright.

Plus, parameterized reactor makes unit testing easier.

Jean-Paul

From glyph at divmod.com  Wed Nov  5 10:59:04 2008
From: glyph at divmod.com (glyph@divmod.com)
Date: Wed Nov  5 10:56:59 2008
Subject: [Twisted-web] Having reactor run at the main thread make things
	harder for late adopters
In-Reply-To: <20081105130521.29191.1572484769.divmod.quotient.50098@ohm>
References: <20081105064143.GM12038@steerpike.home.puzzling.org>
	<20081105130521.29191.1572484769.divmod.quotient.50098@ohm>
Message-ID: <20081105155904.6400.690767316.divmod.xquotient.1027@weber.divmod.com>

On 01:05 pm, exarkun@divmod.com wrote:
>On Wed, 5 Nov 2008 17:41:44 +1100, Andrew Bennetts <andrew- 
>twisted@puzzling.org> wrote:

>>It matters just because it makes it clear that yes,  1Cfrom 
>>twisted.internet
>>import reactor 1D really does Just Work, all the time.
>
>Sure.  But even if it didn't, you'd be alright.
>
>Plus, parameterized reactor makes unit testing easier.

As with most things that make testing easier, parameterizing the reactor 
makes a lot of other things easier too.  My long-term plan (very, very 
long term) is to deprecate and remove the twisted.internet.reactor 
import and eliminate the singleton.  However, that won't happen until 
you can get the reactor from everywhere interesting that might need it. 
See ticket http://twistedmatrix.com/trac/ticket/3205 for more 
information.

From amcnabb at mcnabbs.org  Wed Nov  5 10:08:23 2008
From: amcnabb at mcnabbs.org (Andrew McNabb)
Date: Wed Nov  5 13:06:00 2008
Subject: [Twisted-web] Having reactor run at the main thread make
	things harder for late adopters
In-Reply-To: <20081105041108.GL12038@steerpike.home.puzzling.org>
References: <2f5ea7490811041220j64d2ad63h3b09e35f14680048@mail.gmail.com>
	<20081104224833.GJ12038@steerpike.home.puzzling.org>
	<2f5ea7490811041959k436c6a63he6b5a88d0cb4e75d@mail.gmail.com>
	<20081105041108.GL12038@steerpike.home.puzzling.org>
Message-ID: <20081105150823.GB2561@mcnabbs.org>

On Wed, Nov 05, 2008 at 03:11:08PM +1100, Andrew Bennetts wrote:
> 
> The documentation could perhaps be clearer about this (that document implies,
> but doesn't directly state, that there's only one reactor instance).

I've always struggled with reactor being a singleton.  It makes it very
difficult to use Twisted on a small scale in a larger existing project.
Sometimes it would be really nice to stop a reactor and later start
another one.  Unit testing is one of several situations where this can
be a problem.

I suppose this wouldn't be quite as severe of a problem if it were easy
to restart a stopped reactor, but even then, it would be nice to be able
to have two threads that each have their own reactor.  But I guess I'm
just ranting now. :)

-- 
Andrew McNabb
http://www.mcnabbs.org/andrew/
PGP Fingerprint: 8A17 B57C 6879 1863 DE55  8012 AB4D 6098 8826 6868
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 197 bytes
Desc: not available
Url : http://twistedmatrix.com/pipermail/twisted-web/attachments/20081105/c52d9ce4/attachment.pgp
From glyph at divmod.com  Wed Nov  5 14:24:31 2008
From: glyph at divmod.com (glyph@divmod.com)
Date: Wed Nov  5 14:22:23 2008
Subject: [Twisted-web] Having reactor run at the main thread make things
	harder for late adopters
In-Reply-To: <20081105150823.GB2561@mcnabbs.org>
References: <2f5ea7490811041220j64d2ad63h3b09e35f14680048@mail.gmail.com>
	<20081104224833.GJ12038@steerpike.home.puzzling.org>
	<2f5ea7490811041959k436c6a63he6b5a88d0cb4e75d@mail.gmail.com>
	<20081105041108.GL12038@steerpike.home.puzzling.org>
	<20081105150823.GB2561@mcnabbs.org>
Message-ID: <20081105192431.6400.884481684.divmod.xquotient.1050@weber.divmod.com>

On 03:08 pm, amcnabb@mcnabbs.org wrote:
>On Wed, Nov 05, 2008 at 03:11:08PM +1100, Andrew Bennetts wrote:
>>
>>The documentation could perhaps be clearer about this (that document 
>>implies,
>>but doesn't directly state, that there's only one reactor instance).
>
>I've always struggled with reactor being a singleton.  It makes it very
>difficult to use Twisted on a small scale in a larger existing project.
>Sometimes it would be really nice to stop a reactor and later start
>another one.  Unit testing is one of several situations where this can
>be a problem.
>
>I suppose this wouldn't be quite as severe of a problem if it were easy
>to restart a stopped reactor, but even then, it would be nice to be 
>able
>to have two threads that each have their own reactor.  But I guess I'm
>just ranting now. :)

I completely agree, architecturally speaking, for Twisted, that this is 
a good idea.  I already linked to 
<http://twistedmatrix.com/trac/ticket/3205> in this thread, which is a 
broad outline of my long-term plan to eliminate the reactor's singleton- 
ness.

On the other hand, the approach you're describing here, using Twisted 
"just a little", starting up a reactor and spinning it in some obscure 
corner of an application, is basically an architectural antipattern, 
which should be avoided as much as possible.  One of the hardest things 
to do on a modern software project is to keep a coherent high-level 
system design that makes enough sense to introduce new people to it. 
Concurrency, in particular, is a property which is basically impossible 
to introduce into a software system without a comprehensive rethinking 
of how the whole thing works.

I can definitely think of a few "larger projects" - names withheld to 
protect the guilty - whose designs have been influenced and 
rehabilitated by their decision to use Twisted.  I worry about making it 
easier to throw Twisted into a situation where it will make the overall 
design of a system into even more of an incomprehensible mess.  Just 
imagine trying to decipher a GUI project using Twisted for networking, 
where there are 3 or 4 different global reactors, each of which is used 
by a different window or dialog box, and you have to figure out which 
one you need based on what context your Twisted-using code is running 
in.

It's nice to be able to say "you can't do that, it's impossible", when 
someone asks how to set up something like that.

From amcnabb at mcnabbs.org  Wed Nov  5 16:19:25 2008
From: amcnabb at mcnabbs.org (Andrew McNabb)
Date: Wed Nov  5 16:19:33 2008
Subject: [Twisted-web] Having reactor run at the main thread make
	things harder for late adopters
In-Reply-To: <20081105192431.6400.884481684.divmod.xquotient.1050@weber.divmod.com>
References: <2f5ea7490811041220j64d2ad63h3b09e35f14680048@mail.gmail.com>
	<20081104224833.GJ12038@steerpike.home.puzzling.org>
	<2f5ea7490811041959k436c6a63he6b5a88d0cb4e75d@mail.gmail.com>
	<20081105041108.GL12038@steerpike.home.puzzling.org>
	<20081105150823.GB2561@mcnabbs.org>
	<20081105192431.6400.884481684.divmod.xquotient.1050@weber.divmod.com>
Message-ID: <20081105211925.GC3797@mcnabbs.org>

On Wed, Nov 05, 2008 at 07:24:31PM -0000, glyph@divmod.com wrote:
>
> I completely agree, architecturally speaking, for Twisted, that this is  
> a good idea.  I already linked to  
> <http://twistedmatrix.com/trac/ticket/3205> in this thread, which is a  
> broad outline of my long-term plan to eliminate the reactor's singleton-  
> ness.

Thanks.  I must have missed the link earlier.


> On the other hand, the approach you're describing here, using Twisted  
> "just a little", starting up a reactor and spinning it in some obscure  
> corner of an application, is basically an architectural antipattern,  
> which should be avoided as much as possible.

I agree that it should be avoided as much as possible, but I don't think
that it should be impossible to do.  Suppose, for example, that you are
refactoring a project to use Twisted.  It's nice to be able to use it
just a little, then iteratively add more to it.  I agree that you
shouldn't stay in this state long, but it sure would be a nice crutch
during refactoring.


> I can definitely think of a few "larger projects" - names withheld to  
> protect the guilty - whose designs have been influenced and  
> rehabilitated by their decision to use Twisted.  I worry about making it  
> easier to throw Twisted into a situation where it will make the overall  
> design of a system into even more of an incomprehensible mess.  Just  
> imagine trying to decipher a GUI project using Twisted for networking,  
> where there are 3 or 4 different global reactors, each of which is used  
> by a different window or dialog box, and you have to figure out which  
> one you need based on what context your Twisted-using code is running  
> in.

Give me any API, and I can create a program that misuses it. :)

I'm guessing that the GUI project would be much more decipherable if
instead of having 3 or 4 global reactors, there were 3 or 4 reactors
that were nicely encapsulated.  Anyway, if there's a good reason for
having 3 or 4 reactors, I'm sure there's a good way to organize the code
so that things don't get out of hand.

I think the following use cases for mutliple reactors outweigh the
potential risks:
- starting and stopping a reactor multiple times, particularly for
  testing
- making it easier to refactor existing code to use the reactor pattern
- k threads that each have their own reactor

And I'm sure we could come up with others.


> It's nice to be able to say "you can't do that, it's impossible", when  
> someone asks how to set up something like that.

If I wanted to be constantly told "you can't do that, it's impossible",
I wouldn't be a Python guy.  If I want to shoot myself in the foot,
that's my problem.  :)


-- 
Andrew McNabb
http://www.mcnabbs.org/andrew/
PGP Fingerprint: 8A17 B57C 6879 1863 DE55  8012 AB4D 6098 8826 6868
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 197 bytes
Desc: not available
Url : http://twistedmatrix.com/pipermail/twisted-web/attachments/20081105/02eac900/attachment.pgp
From andrew-twisted at puzzling.org  Wed Nov  5 17:02:45 2008
From: andrew-twisted at puzzling.org (Andrew Bennetts)
Date: Wed Nov  5 17:02:51 2008
Subject: [Twisted-web] Having reactor run at the main thread make
	things harder for late adopters
In-Reply-To: <20081105150823.GB2561@mcnabbs.org>
References: <2f5ea7490811041220j64d2ad63h3b09e35f14680048@mail.gmail.com>
	<20081104224833.GJ12038@steerpike.home.puzzling.org>
	<2f5ea7490811041959k436c6a63he6b5a88d0cb4e75d@mail.gmail.com>
	<20081105041108.GL12038@steerpike.home.puzzling.org>
	<20081105150823.GB2561@mcnabbs.org>
Message-ID: <20081105220245.GN12038@steerpike.home.puzzling.org>

Andrew McNabb wrote:
> On Wed, Nov 05, 2008 at 03:11:08PM +1100, Andrew Bennetts wrote:
> > 
> > The documentation could perhaps be clearer about this (that document implies,
> > but doesn't directly state, that there's only one reactor instance).
> 
> I've always struggled with reactor being a singleton.  It makes it very
> difficult to use Twisted on a small scale in a larger existing project.
> Sometimes it would be really nice to stop a reactor and later start
> another one.  Unit testing is one of several situations where this can
> be a problem.
> 
> I suppose this wouldn't be quite as severe of a problem if it were easy
> to restart a stopped reactor, but even then, it would be nice to be able
> to have two threads that each have their own reactor.  But I guess I'm
> just ranting now. :)

Oh, I completely agree.  I was just talking about the documentation for what
we have now.

-Andrew.
-

From glyph at divmod.com  Wed Nov  5 21:55:37 2008
From: glyph at divmod.com (glyph@divmod.com)
Date: Wed Nov  5 21:53:29 2008
Subject: [Twisted-web] Having reactor run at the main thread make things
	harder for late adopters
In-Reply-To: <20081105211925.GC3797@mcnabbs.org>
References: <2f5ea7490811041220j64d2ad63h3b09e35f14680048@mail.gmail.com>
	<20081104224833.GJ12038@steerpike.home.puzzling.org>
	<2f5ea7490811041959k436c6a63he6b5a88d0cb4e75d@mail.gmail.com>
	<20081105041108.GL12038@steerpike.home.puzzling.org>
	<20081105150823.GB2561@mcnabbs.org>
	<20081105192431.6400.884481684.divmod.xquotient.1050@weber.divmod.com>
	<20081105211925.GC3797@mcnabbs.org>
Message-ID: <20081106025537.6400.378398420.divmod.xquotient.1281@weber.divmod.com>

On 5 Nov, 09:19 pm, amcnabb@mcnabbs.org wrote:
>On Wed, Nov 05, 2008 at 07:24:31PM -0000, glyph@divmod.com wrote:

>>On the other hand, the approach you're describing here, using Twisted
>>"just a little", ... is basically an architectural antipattern,
>>which should be avoided as much as possible.
>
>I agree that it should be avoided as much as possible, but I don't 
>think
>that it should be impossible to do.  Suppose, for example, that you are
>refactoring a project to use Twisted.

Sure.
>Give me any API, and I can create a program that misuses it. :)

Oh, come on.  This is a totally bogus argument, and I suspect you 
already know that :).  First of all, it's not true: in some languages (E 
comes to mind) it is possible to create APIs which are literally not 
abusable (for some suitable definition of "abuse", this one about global 
state included).

It's the thing Perl people say when you corner them and make a strong 
case that Python is objectively more readable than Perl.  "Sure, but you 
can create an unreadable program in any language".  That's not the 
point; the point is, does tool X make it more *likely* that you'll 
create maintainable programs?  Does X help people learn how to create 
maintainable programs?  Twisted should be doing those things.
>I think the following use cases for mutliple reactors outweigh the
>potential risks:

This is almost certainly true, and as I've already said I am keenly 
interested in de-globalizing the reactor myself; making it easier to 
test things is a key reason for doing so.  However, we should be aware 
of the risks and try to mitigate them.  It could well be that we could 
come up with an API which is smooth as glass for the "good" use-cases we 
have in mind here, and raises exceptions or emits helpful warnings when 
used for the "bad" ones.  Maybe that's not possible, maybe we can only 
get halfway there: but it would be nice to try.

In fact, it would be a much better influence on architecture to have 
intentional, helpful error messages rather than buggy, non-deterministic 
and unsupported behavior.
>- k threads that each have their own reactor

This is a whole other, almost unrelated can of worms.  You can only use 
Twisted from one thread at a time.  There are things which make 
assumptions about non-reentrancy and mutual exclusion of global module- 
level state.  You can find and fix every instance of this if you want, 
but don't bundle it in with multiple reactors :).
>>It's nice to be able to say "you can't do that, it's impossible", when
>>someone asks how to set up something like that.
>
>If I wanted to be constantly told "you can't do that, it's impossible",
>I wouldn't be a Python guy.  If I want to shoot myself in the foot,
>that's my problem.  :)

Another bogus argument.  There are lots of things that are "impossible" 
in Python.  For example, you "can't" change the values of a tuple, or 
the contents of a string.  I mean, there's terrible stuff you can do 
with ctypes, but if it breaks, you get to keep both pieces.  Similarly, 
there are lots of things that already kind of work, by accident, if you 
instantiate multiple reactors; you can kind of re-set a reactor if you 
know exactly what to twiddle.

When I say it's nice to be able to say that something's impossible, that 
doesn't mean that I don't want to support all the reasonable use-cases, 
just that boundaries are a useful tool.  This is very much the Python 
idiom - consider your options for indenting your code in strange ways, 
for example :).

From jml at mumak.net  Thu Nov  6 04:48:23 2008
From: jml at mumak.net (Jonathan Lange)
Date: Thu Nov  6 04:48:28 2008
Subject: [Twisted-web] Having reactor run at the main thread make things
	harder for late adopters
In-Reply-To: <20081106025537.6400.378398420.divmod.xquotient.1281@weber.divmod.com>
References: <2f5ea7490811041220j64d2ad63h3b09e35f14680048@mail.gmail.com>
	<20081104224833.GJ12038@steerpike.home.puzzling.org>
	<2f5ea7490811041959k436c6a63he6b5a88d0cb4e75d@mail.gmail.com>
	<20081105041108.GL12038@steerpike.home.puzzling.org>
	<20081105150823.GB2561@mcnabbs.org>
	<20081105192431.6400.884481684.divmod.xquotient.1050@weber.divmod.com>
	<20081105211925.GC3797@mcnabbs.org>
	<20081106025537.6400.378398420.divmod.xquotient.1281@weber.divmod.com>
Message-ID: <d06a5cd30811060148q1cccf144g438dc29b70bb7bcf@mail.gmail.com>

On Thu, Nov 6, 2008 at 3:55 AM,  <glyph@divmod.com> wrote:
> On 5 Nov, 09:19 pm, amcnabb@mcnabbs.org wrote:
>>
>> On Wed, Nov 05, 2008 at 07:24:31PM -0000, glyph@divmod.com wrote:
>
>>> On the other hand, the approach you're describing here, using Twisted
>>> "just a little", ... is basically an architectural antipattern,
>>> which should be avoided as much as possible.
>>
>> I agree that it should be avoided as much as possible, but I don't think
>> that it should be impossible to do.  Suppose, for example, that you are
>> refactoring a project to use Twisted.
>
> Sure.
>>
>> Give me any API, and I can create a program that misuses it. :)
>
> Oh, come on.  This is a totally bogus argument, and I suspect you already
> know that :).  First of all, it's not true: in some languages (E comes to
> mind) it is possible to create APIs which are literally not abusable (for
> some suitable definition of "abuse", this one about global state included).
>

On the other hand, there's a related invalid argument that gets used a
lot by library and framework authors: "if we provide X, people might
misuse it, so we should not provide X". This argument is also bogus
(that way lies Java). Provide safe, well-documented alternatives for
the abusers and let those who want to shoot themselves in the foot do
so: sometimes they might actually know better than you.

I don't particularly care about the broader issue under discussion, I
just wanted to make that point.

jml

From amcnabb at mcnabbs.org  Thu Nov  6 13:40:49 2008
From: amcnabb at mcnabbs.org (Andrew McNabb)
Date: Thu Nov  6 13:40:56 2008
Subject: [Twisted-web] Having reactor run at the main thread make
	things harder for late adopters
In-Reply-To: <d06a5cd30811060148q1cccf144g438dc29b70bb7bcf@mail.gmail.com>
References: <2f5ea7490811041220j64d2ad63h3b09e35f14680048@mail.gmail.com>
	<20081104224833.GJ12038@steerpike.home.puzzling.org>
	<2f5ea7490811041959k436c6a63he6b5a88d0cb4e75d@mail.gmail.com>
	<20081105041108.GL12038@steerpike.home.puzzling.org>
	<20081105150823.GB2561@mcnabbs.org>
	<20081105192431.6400.884481684.divmod.xquotient.1050@weber.divmod.com>
	<20081105211925.GC3797@mcnabbs.org>
	<20081106025537.6400.378398420.divmod.xquotient.1281@weber.divmod.com>
	<d06a5cd30811060148q1cccf144g438dc29b70bb7bcf@mail.gmail.com>
Message-ID: <20081106184049.GC2927@mcnabbs.org>

On Thu, Nov 06, 2008 at 10:48:23AM +0100, Jonathan Lange wrote:
> 
> On the other hand, there's a related invalid argument that gets used a
> lot by library and framework authors: "if we provide X, people might
> misuse it, so we should not provide X". This argument is also bogus
> (that way lies Java). Provide safe, well-documented alternatives for
> the abusers and let those who want to shoot themselves in the foot do
> so: sometimes they might actually know better than you.

And this is a great way to sum up the point I was trying to make.

-- 
Andrew McNabb
http://www.mcnabbs.org/andrew/
PGP Fingerprint: 8A17 B57C 6879 1863 DE55  8012 AB4D 6098 8826 6868
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 197 bytes
Desc: not available
Url : http://twistedmatrix.com/pipermail/twisted-web/attachments/20081106/5384f31d/attachment.pgp
From amcnabb at mcnabbs.org  Thu Nov  6 13:46:01 2008
From: amcnabb at mcnabbs.org (Andrew McNabb)
Date: Thu Nov  6 13:46:07 2008
Subject: [Twisted-web] Having reactor run at the main thread make
	things harder for late adopters
In-Reply-To: <20081106025537.6400.378398420.divmod.xquotient.1281@weber.divmod.com>
References: <2f5ea7490811041220j64d2ad63h3b09e35f14680048@mail.gmail.com>
	<20081104224833.GJ12038@steerpike.home.puzzling.org>
	<2f5ea7490811041959k436c6a63he6b5a88d0cb4e75d@mail.gmail.com>
	<20081105041108.GL12038@steerpike.home.puzzling.org>
	<20081105150823.GB2561@mcnabbs.org>
	<20081105192431.6400.884481684.divmod.xquotient.1050@weber.divmod.com>
	<20081105211925.GC3797@mcnabbs.org>
	<20081106025537.6400.378398420.divmod.xquotient.1281@weber.divmod.com>
Message-ID: <20081106184601.GD2927@mcnabbs.org>

On Thu, Nov 06, 2008 at 02:55:37AM -0000, glyph@divmod.com wrote:
>
> This is almost certainly true, and as I've already said I am keenly  
> interested in de-globalizing the reactor myself; making it easier to  
> test things is a key reason for doing so.  However, we should be aware  
> of the risks and try to mitigate them.  It could well be that we could  
> come up with an API which is smooth as glass for the "good" use-cases we  
> have in mind here, and raises exceptions or emits helpful warnings when  
> used for the "bad" ones.  Maybe that's not possible, maybe we can only  
> get halfway there: but it would be nice to try.

I think we really agree for the most part.

>> - k threads that each have their own reactor
>
> This is a whole other, almost unrelated can of worms.  You can only use  
> Twisted from one thread at a time.  There are things which make  
> assumptions about non-reentrancy and mutual exclusion of global module-  
> level state.  You can find and fix every instance of this if you want,  
> but don't bundle it in with multiple reactors :).

Now that you mention that, I have noticed that a few times when reading
Twisted code.  I think that long-term, it's nice to remove global
module-level state wherever possible, but in the meantime, just putting
the above paragraph in the docs as a warning is probably sufficient.


>> If I wanted to be constantly told "you can't do that, it's impossible",
>> I wouldn't be a Python guy.  If I want to shoot myself in the foot,
>> that's my problem.  :)
>
> Another bogus argument.  There are lots of things that are "impossible"  
> in Python.  For example, you "can't" change the values of a tuple, or  
> the contents of a string.  I mean, there's terrible stuff you can do  
> with ctypes, but if it breaks, you get to keep both pieces.  Similarly,  
> there are lots of things that already kind of work, by accident, if you  
> instantiate multiple reactors; you can kind of re-set a reactor if you  
> know exactly what to twiddle.

Let me rephrase that, then.  I think that in Python, the goal is usually
to create a flexible API and to document how it should be properly used
rather than creating barriers to stop people from doing something just
because it might be a bad idea in some contexts.


> When I say it's nice to be able to say that something's impossible, that  
> doesn't mean that I don't want to support all the reasonable use-cases,  
> just that boundaries are a useful tool.  This is very much the Python  
> idiom - consider your options for indenting your code in strange ways,  
> for example :).

Again, I think we agree for the most part.

-- 
Andrew McNabb
http://www.mcnabbs.org/andrew/
PGP Fingerprint: 8A17 B57C 6879 1863 DE55  8012 AB4D 6098 8826 6868
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 197 bytes
Desc: not available
Url : http://twistedmatrix.com/pipermail/twisted-web/attachments/20081106/3c22bd6b/attachment.pgp
From Andy at newworldelectric.com  Thu Nov  6 14:41:27 2008
From: Andy at newworldelectric.com (Andy Fundinger)
Date: Thu Nov  6 14:41:35 2008
Subject: [Twisted-web] Having reactor run at the main thread make things
	harder for late adopters
In-Reply-To: <20081106184601.GD2927@mcnabbs.org>
References: <2f5ea7490811041220j64d2ad63h3b09e35f14680048@mail.gmail.com>
	<20081104224833.GJ12038@steerpike.home.puzzling.org>
	<2f5ea7490811041959k436c6a63he6b5a88d0cb4e75d@mail.gmail.com>
	<20081105041108.GL12038@steerpike.home.puzzling.org>
	<20081105150823.GB2561@mcnabbs.org>
	<20081105192431.6400.884481684.divmod.xquotient.1050@weber.divmod.com>
	<20081105211925.GC3797@mcnabbs.org>
	<20081106025537.6400.378398420.divmod.xquotient.1281@weber.divmod.com>
	<20081106184601.GD2927@mcnabbs.org>
Message-ID: <37d49ed40811061141v39f855cfg38098b619efde468@mail.gmail.com>

I just read through this whole thread and don't understand why no one has
raised suggested running your "little bit of twisted" in another process.
That gives good separation, no multiple thread or singleton issues and
should be quite controllable and it breaks any GIL issues that might come up
as a freebie too.  Of course as you get past dipping your toes in it'll be
rather difficult, but so will anything else.

-Andy Fundinger

On Thu, Nov 6, 2008 at 1:46 PM, Andrew McNabb <amcnabb@mcnabbs.org> wrote:

> On Thu, Nov 06, 2008 at 02:55:37AM -0000, glyph@divmod.com wrote:
> >
> > This is almost certainly true, and as I've already said I am keenly
> > interested in de-globalizing the reactor myself; making it easier to
> > test things is a key reason for doing so.  However, we should be aware
> > of the risks and try to mitigate them.  It could well be that we could
> > come up with an API which is smooth as glass for the "good" use-cases we
> > have in mind here, and raises exceptions or emits helpful warnings when
> > used for the "bad" ones.  Maybe that's not possible, maybe we can only
> > get halfway there: but it would be nice to try.
>
> I think we really agree for the most part.
>
> >> - k threads that each have their own reactor
> >
> > This is a whole other, almost unrelated can of worms.  You can only use
> > Twisted from one thread at a time.  There are things which make
> > assumptions about non-reentrancy and mutual exclusion of global module-
> > level state.  You can find and fix every instance of this if you want,
> > but don't bundle it in with multiple reactors :).
>
> Now that you mention that, I have noticed that a few times when reading
> Twisted code.  I think that long-term, it's nice to remove global
> module-level state wherever possible, but in the meantime, just putting
> the above paragraph in the docs as a warning is probably sufficient.
>
>
> >> If I wanted to be constantly told "you can't do that, it's impossible",
> >> I wouldn't be a Python guy.  If I want to shoot myself in the foot,
> >> that's my problem.  :)
> >
> > Another bogus argument.  There are lots of things that are "impossible"
> > in Python.  For example, you "can't" change the values of a tuple, or
> > the contents of a string.  I mean, there's terrible stuff you can do
> > with ctypes, but if it breaks, you get to keep both pieces.  Similarly,
> > there are lots of things that already kind of work, by accident, if you
> > instantiate multiple reactors; you can kind of re-set a reactor if you
> > know exactly what to twiddle.
>
> Let me rephrase that, then.  I think that in Python, the goal is usually
> to create a flexible API and to document how it should be properly used
> rather than creating barriers to stop people from doing something just
> because it might be a bad idea in some contexts.
>
>
> > When I say it's nice to be able to say that something's impossible, that
> > doesn't mean that I don't want to support all the reasonable use-cases,
> > just that boundaries are a useful tool.  This is very much the Python
> > idiom - consider your options for indenting your code in strange ways,
> > for example :).
>
> Again, I think we agree for the most part.
>
> --
> Andrew McNabb
> http://www.mcnabbs.org/andrew/
> PGP Fingerprint: 8A17 B57C 6879 1863 DE55  8012 AB4D 6098 8826 6868
>
> _______________________________________________
> Twisted-web mailing list
> Twisted-web@twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web
>
>


-- =

Blog:  http://channel3b.wordpress.com
Second Life Name:  Ciemaar Flintoff

Watch out for the invisible man.
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-web/attachments/20081106/1f=
6ceea9/attachment.htm
From michal.dtz at gmail.com  Sun Nov  9 07:28:26 2008
From: michal.dtz at gmail.com (=?ISO-8859-2?Q?Micha=B3_Pasternak?=)
Date: Sun Nov  9 07:28:32 2008
Subject: [Twisted-web] Adding athena.LiveElement to an already-rendered
	LivePage
Message-ID: <4916D76A.5050803@gmail.com>

Hi,

I want to be able to add athena.LiveElement to an already rendered 
LivePage. Quick Googling revealed this blog entry:

    
http://techblog.ironfroggy.com/2006/01/nevow-post-render-injection-of.html

I'd like to know, if there are any other, simpler ways to do that - or, 
maybe, is there a preferred method to do that in the API already?

Regards,
-- 
m


From exarkun at divmod.com  Sun Nov  9 08:47:00 2008
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Sun Nov  9 08:47:15 2008
Subject: [Twisted-web] Adding athena.LiveElement to an already-rendered
	LivePage
In-Reply-To: <4916D76A.5050803@gmail.com>
Message-ID: <20081109134700.20272.808233601.divmod.quotient.1008@ohm>

On Sun, 09 Nov 2008 13:28:26 +0100, Micha? Pasternak <michal.dtz@gmail.com> wrote:
>Hi,
>
>I want to be able to add athena.LiveElement to an already rendered LivePage. 
>Quick Googling revealed this blog entry:
>
>    http://techblog.ironfroggy.com/2006/01/nevow-post-render-injection- 
>of.html
>
>I'd like to know, if there are any other, simpler ways to do that - or, 
>maybe, is there a preferred method to do that in the API already?

See Nevow.Athena.Widget.addChildWidgetFromWidgetInfo.

Jean-Paul

From michal.dtz at gmail.com  Sun Nov  9 12:21:28 2008
From: michal.dtz at gmail.com (=?UTF-8?B?TWljaGHFgiBQYXN0ZXJuYWs=?=)
Date: Sun Nov  9 12:21:42 2008
Subject: [Twisted-web] Adding athena.LiveElement to an already-rendered
	LivePage
In-Reply-To: <20081109134700.20272.808233601.divmod.quotient.1008@ohm>
References: <20081109134700.20272.808233601.divmod.quotient.1008@ohm>
Message-ID: <49171C18.8080905@gmail.com>

Jean-Paul Calderone pisze:
> On Sun, 09 Nov 2008 13:28:26 +0100, Micha? Pasternak 
> <michal.dtz@gmail.com> wrote:
>> Hi,
>>
>> I want to be able to add athena.LiveElement to an already rendered 
>> LivePage. Quick Googling revealed this blog entry:
>>
>>    
>> http://techblog.ironfroggy.com/2006/01/nevow-post-render-injection- 
>> of.html
>>
>> I'd like to know, if there are any other, simpler ways to do that - 
>> or, maybe, is there a preferred method to do that in the API already?
>
> See Nevow.Athena.Widget.addChildWidgetFromWidgetInfo. 

Wiki FAQ updated, thanks! :-)

-- 
m

From michal.dtz at gmail.com  Sun Nov  9 15:09:41 2008
From: michal.dtz at gmail.com (=?UTF-8?B?TWljaGHFgiBQYXN0ZXJuYWs=?=)
Date: Sun Nov  9 15:09:47 2008
Subject: [Twisted-web] Adding athena.LiveElement to an already-rendered
	LivePage
In-Reply-To: <20081109134700.20272.808233601.divmod.quotient.1008@ohm>
References: <20081109134700.20272.808233601.divmod.quotient.1008@ohm>
Message-ID: <49174385.1010005@gmail.com>

Jean-Paul Calderone pisze:
> On Sun, 09 Nov 2008 13:28:26 +0100, Micha? Pasternak 
> <michal.dtz@gmail.com> wrote:
>> Hi,
>>
>> I want to be able to add athena.LiveElement to an already rendered 
>> LivePage. Quick Googling revealed this blog entry:
>>
>>    
>> http://techblog.ironfroggy.com/2006/01/nevow-post-render-injection- 
>> of.html
>>
>> I'd like to know, if there are any other, simpler ways to do that - 
>> or, maybe, is there a preferred method to do that in the API already?
>
> See Nevow.Athena.Widget.addChildWidgetFromWidgetInfo.
This method will not add the markup automatically. Am I right?

I want to append incoming LiveFragments to the page.

Right now, I am doing something like this on the client:

// import Divmod.Runtime

What.Ever = Nevow.Athena.Widget.subclass('What.Ever');
What.Ever.methods =(

  function foo(self) {
    d = self.callRemote('getLiveFragment');

    d.addCallback(

      function liveFragmentReceived(lf) {

        d2 = self.addChildWidgetFromWidgetInfo(lf);

        d2.addCallback(

          function added(res) {

            d = Divmod.Runtime.theRuntime.parseXHTMLString(
              lf.markup).documentElement;

            self.nodeById('lastNode').appendChild(d);

          });

      });

  });

Is this the official way of doing that, or am I missing something?

-- 
m


From kozneb at gmail.com  Sun Nov  9 15:50:45 2008
From: kozneb at gmail.com (=?UTF-8?Q?Harald_Bl=C3=A5tand?=)
Date: Sun Nov  9 15:50:52 2008
Subject: [Twisted-web] Adding athena.LiveElement to an already-rendered
	LivePage
In-Reply-To: <49174385.1010005@gmail.com>
References: <20081109134700.20272.808233601.divmod.quotient.1008@ohm>
	<49174385.1010005@gmail.com>
Message-ID: <1ff309e60811091250r6c43622ey94c42caf87935b72@mail.gmail.com>

T24gU3VuLCBOb3YgOSwgMjAwOCBhdCA5OjA5IFBNLCBNaWNoYcWCIFBhc3Rlcm5hayA8bWljaGFs
LmR0ekBnbWFpbC5jb20+d3JvdGU6Cgo+IEplYW4tUGF1bCBDYWxkZXJvbmUgcGlzemU6Cj4KPj4g
T24gU3VuLCAwOSBOb3YgMjAwOCAxMzoyODoyNiArMDEwMCwgTWljaGHFgiBQYXN0ZXJuYWsgPAo+
PiBtaWNoYWwuZHR6QGdtYWlsLmNvbT4gd3JvdGU6Cj4+Cj4+PiBIaSwKPj4+Cj4+PiBJIHdhbnQg
dG8gYmUgYWJsZSB0byBhZGQgYXRoZW5hLkxpdmVFbGVtZW50IHRvIGFuIGFscmVhZHkgcmVuZGVy
ZWQKPj4+IExpdmVQYWdlLiBRdWljayBHb29nbGluZyByZXZlYWxlZCB0aGlzIGJsb2cgZW50cnk6
Cj4+Pgo+Pj4gICBodHRwOi8vdGVjaGJsb2cuaXJvbmZyb2dneS5jb20vMjAwNi8wMS9uZXZvdy1w
b3N0LXJlbmRlci1pbmplY3Rpb24tb2YuaHRtbAo+Pj4KPj4+IEknZCBsaWtlIHRvIGtub3csIGlm
IHRoZXJlIGFyZSBhbnkgb3RoZXIsIHNpbXBsZXIgd2F5cyB0byBkbyB0aGF0IC0gb3IsCj4+PiBt
YXliZSwgaXMgdGhlcmUgYSBwcmVmZXJyZWQgbWV0aG9kIHRvIGRvIHRoYXQgaW4gdGhlIEFQSSBh
bHJlYWR5Pwo+Pj4KPj4KPj4gU2VlIE5ldm93LkF0aGVuYS5XaWRnZXQuYWRkQ2hpbGRXaWRnZXRG
cm9tV2lkZ2V0SW5mby4KPj4KPiBUaGlzIG1ldGhvZCB3aWxsIG5vdCBhZGQgdGhlIG1hcmt1cCBh
dXRvbWF0aWNhbGx5LiBBbSBJIHJpZ2h0PwoKClllcCwgSSB0aGluayB5b3UncmUgcmlnaHQuCgoK
Pgo+IElzIHRoaXMgdGhlIG9mZmljaWFsIHdheSBvZiBkb2luZyB0aGF0LCBvciBhbSBJIG1pc3Np
bmcgc29tZXRoaW5nPwo+CgoKSSdtIG9uIGEgc2ltaWxhciB0cmFjayAtIGhlcmUncyB3aGF0IEkg
dXNlIChkb24ndCBrbm93IGlmIGl0J3MgIm9mZmljaWFsIgplaXRoZXIgOikgLQoKICAgIGZ1bmN0
aW9uIGNyZWF0ZUR5bmFtaWNXaWRnZXQoc2VsZiwgY2xhc3NOYW1lLCBsZWZ0LCB0b3AsIGFyZ3Ms
IGt3KSB7CiAgICAgICAgdmFyIHJlc3VsdCA9IHNlbGYuY2FsbFJlbW90ZSgnZ2V0RHluYW1pY1dp
ZGdldCcsIGNsYXNzTmFtZSwgbGVmdCwKdG9wLCBhcmdzLCAoKGt3KSA/IGt3IDoge30pKTsKICAg
ICAgICByZXN1bHQuYWRkQ2FsbGJhY2soCiAgICAgICAgICAgIGZ1bmN0aW9uKHdpZGdldEluZm8p
IHsKICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLmFkZENoaWxkV2lkZ2V0RnJvbVdpZGdldElu
Zm8od2lkZ2V0SW5mbyk7CiAgICAgICAgICAgIH0pOwogICAgICAgIHJlc3VsdC5hZGRDYWxsYmFj
aygKICAgICAgICAgICAgZnVuY3Rpb24od2lkZ2V0KSB7CiAgICAgICAgICAgICAgICB2YXIgaW5z
ZXJ0ZWROb2RlID0KZG9jdW1lbnQuYm9keS5jaGlsZHJlbigwKS5pbnNlcnRBZGphY2VudEVsZW1l
bnQoJ2JlZm9yZUJlZ2luJywgd2lkZ2V0Lm5vZGUpOwogICAgICAgICAgICAgICAgdmFyIHMgPSBp
bnNlcnRlZE5vZGUuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3NjcmlwdCcpOwogICAgICAgICAgICAg
ICAgaWYgKHMubGVuZ3RoID09IDEpIHsKICAgICAgICAgICAgICAgICAgICB2YXIganMgPSBuZXcg
RnVuY3Rpb24oc1swXS50ZXh0KTsKICAgICAgICAgICAgICAgICAgICBqcy5hcHBseShpbnNlcnRl
ZE5vZGUpOwogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgaW5zZXJ0ZWROb2RlLnN0
eWxlLnpJbmRleCA9ICsrbWF4X3pJbmRleDsKICAgICAgICAgICAgICAgIHJldHVybiB3aWRnZXQu
b2JqZWN0SUQ7CiAgICAgICAgICAgIH0pOwogICAgICAgIHJldHVybiByZXN1bHQ7CiAgICB9LApI
YXJhbGQKLS0tLS0tLS0tLS0tLS0gbmV4dCBwYXJ0IC0tLS0tLS0tLS0tLS0tCkFuIEhUTUwgYXR0
YWNobWVudCB3YXMgc2NydWJiZWQuLi4KVVJMOiBodHRwOi8vdHdpc3RlZG1hdHJpeC5jb20vcGlw
ZXJtYWlsL3R3aXN0ZWQtd2ViL2F0dGFjaG1lbnRzLzIwMDgxMTA5LzI1NTZiNzRkL2F0dGFjaG1l
bnQuaHRtCg==
From exarkun at divmod.com  Sun Nov  9 16:09:32 2008
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Sun Nov  9 16:09:50 2008
Subject: [Twisted-web] Adding athena.LiveElement to an already-rendered
	LivePage
In-Reply-To: <49174385.1010005@gmail.com>
Message-ID: <20081109210932.20272.1316779379.divmod.quotient.1183@ohm>

On Sun, 09 Nov 2008 21:09:41 +0100, Micha? Pasternak <michal.dtz@gmail.com> wrote:
>Jean-Paul Calderone pisze:
>>On Sun, 09 Nov 2008 13:28:26 +0100, Micha? Pasternak <michal.dtz@gmail.com> 
>>wrote:
>>>Hi,
>>>
>>>I want to be able to add athena.LiveElement to an already rendered 
>>>LivePage. Quick Googling revealed this blog entry:
>>>
>>>    http://techblog.ironfroggy.com/2006/01/nevow-post-render-injection- 
>>>of.html
>>>
>>>I'd like to know, if there are any other, simpler ways to do that - or, 
>>>maybe, is there a preferred method to do that in the API already?
>>
>>See Nevow.Athena.Widget.addChildWidgetFromWidgetInfo.
>This method will not add the markup automatically. Am I right?
>
>I want to append incoming LiveFragments to the page.
>
>Right now, I am doing something like this on the client:
>
>// import Divmod.Runtime
>
>What.Ever = Nevow.Athena.Widget.subclass('What.Ever');
>What.Ever.methods =(
>
>  function foo(self) {
>    d = self.callRemote('getLiveFragment');
>
>    d.addCallback(
>
>      function liveFragmentReceived(lf) {
>
>        d2 = self.addChildWidgetFromWidgetInfo(lf);
>
>        d2.addCallback(
>
>          function added(res) {
>
>            d = Divmod.Runtime.theRuntime.parseXHTMLString(
>              lf.markup).documentElement;
>
>            self.nodeById('lastNode').appendChild(d);
>
>          });
>
>      });

You don't have to parse the markup.  It's already parsed.  The DOM
element which results is the `node? attribute of the Widget instance
(which you get as `res? - the result of the callback).  You shouldn't
use any attributes of `lf?, since it is an opaque handle: there is no
API stability guarantee about it.  The *only* thing you can do with it
is pass it to `addChildWidgetFromWidgetInfo?.

Jean-Paul

From exarkun at divmod.com  Sun Nov  9 16:10:46 2008
From: exarkun at divmod.com (Jean-Paul Calderone)
Date: Sun Nov  9 16:11:01 2008
Subject: [Twisted-web] Adding athena.LiveElement to an already-rendered
	LivePage
In-Reply-To: <1ff309e60811091250r6c43622ey94c42caf87935b72@mail.gmail.com>
Message-ID: <20081109211046.20272.1675875516.divmod.quotient.1184@ohm>

On Sun, 9 Nov 2008 21:50:45 +0100, Harald Bl?tand <kozneb@gmail.com> wrote:
>On Sun, Nov 9, 2008 at 9:09 PM, Micha? Pasternak <michal.dtz@gmail.com>wrote:
>
>> Jean-Paul Calderone pisze:
>>
>>> On Sun, 09 Nov 2008 13:28:26 +0100, Micha? Pasternak <
>>> michal.dtz@gmail.com> wrote:
>>>
>>>> Hi,
>>>>
>>>> I want to be able to add athena.LiveElement to an already rendered
>>>> LivePage. Quick Googling revealed this blog entry:
>>>>
>>>>   http://techblog.ironfroggy.com/2006/01/nevow-post-render-injection-of.html
>>>>
>>>> I'd like to know, if there are any other, simpler ways to do that - or,
>>>> maybe, is there a preferred method to do that in the API already?
>>>>
>>>
>>> See Nevow.Athena.Widget.addChildWidgetFromWidgetInfo.
>>>
>> This method will not add the markup automatically. Am I right?
>
>
>Yep, I think you're right.
>
>
>>
>> Is this the official way of doing that, or am I missing something?
>>
>
>
>I'm on a similar track - here's what I use (don't know if it's "official"
>either :) -
>
>    function createDynamicWidget(self, className, left, top, args, kw) {
>        var result = self.callRemote('getDynamicWidget', className, left,
>top, args, ((kw) ? kw : {}));
>        result.addCallback(
>            function(widgetInfo) {
>                return self.addChildWidgetFromWidgetInfo(widgetInfo);
>            });
>        result.addCallback(
>            function(widget) {
>                var insertedNode =
>document.body.children(0).insertAdjacentElement('beforeBegin', widget.node);
>                var s = insertedNode.getElementsByTagName('script');
>                if (s.length == 1) {
>                    var js = new Function(s[0].text);
>                    js.apply(insertedNode);
>                }
>                insertedNode.style.zIndex = ++max_zIndex;
>                return widget.objectID;
>            });
>        return result;
>    },

I'm not sure why you're re-evaluating the contents of the script node.
Athena has already evaluated that script.  If you find some case where
this isn't true, please report a bug.

Jean-Paul

From kozneb at gmail.com  Sun Nov  9 17:00:27 2008
From: kozneb at gmail.com (=?UTF-8?Q?Harald_Bl=C3=A5tand?=)
Date: Sun Nov  9 17:00:30 2008
Subject: [Twisted-web] Adding athena.LiveElement to an already-rendered
	LivePage
In-Reply-To: <20081109211046.20272.1675875516.divmod.quotient.1184@ohm>
References: <1ff309e60811091250r6c43622ey94c42caf87935b72@mail.gmail.com>
	<20081109211046.20272.1675875516.divmod.quotient.1184@ohm>
Message-ID: <1ff309e60811091400o128fc594t7247f033ae2facab@mail.gmail.com>

T24gU3VuLCBOb3YgOSwgMjAwOCBhdCAxMDoxMCBQTSwgSmVhbi1QYXVsIENhbGRlcm9uZSA8ZXhh
cmt1bkBkaXZtb2QuY29tPndyb3RlOgoKPiAgT24gU3VuLCA5IE5vdiAyMDA4IDIxOjUwOjQ1ICsw
MTAwLCBIYXJhbGQgQmzDpXRhbmQgPGtvem5lYkBnbWFpbC5jb20+Cj4gd3JvdGU6Cj4KPj4KPj4g
SSdtIG9uIGEgc2ltaWxhciB0cmFjayAtIGhlcmUncyB3aGF0IEkgdXNlIChkb24ndCBrbm93IGlm
IGl0J3MgIm9mZmljaWFsIgo+PiBlaXRoZXIgOikgLQo+Pgo+PiAgIGZ1bmN0aW9uIGNyZWF0ZUR5
bmFtaWNXaWRnZXQoc2VsZiwgY2xhc3NOYW1lLCBsZWZ0LCB0b3AsIGFyZ3MsIGt3KSB7Cj4+ICAg
ICAgIHZhciByZXN1bHQgPSBzZWxmLmNhbGxSZW1vdGUoJ2dldER5bmFtaWNXaWRnZXQnLCBjbGFz
c05hbWUsIGxlZnQsCj4+IHRvcCwgYXJncywgKChrdykgPyBrdyA6IHt9KSk7Cj4+ICAgICAgIHJl
c3VsdC5hZGRDYWxsYmFjaygKPj4gICAgICAgICAgIGZ1bmN0aW9uKHdpZGdldEluZm8pIHsKPj4g
ICAgICAgICAgICAgICByZXR1cm4gc2VsZi5hZGRDaGlsZFdpZGdldEZyb21XaWRnZXRJbmZvKHdp
ZGdldEluZm8pOwo+PiAgICAgICAgICAgfSk7Cj4+ICAgICAgIHJlc3VsdC5hZGRDYWxsYmFjaygK
Pj4gICAgICAgICAgIGZ1bmN0aW9uKHdpZGdldCkgewo+PiAgICAgICAgICAgICAgIHZhciBpbnNl
cnRlZE5vZGUgPQo+PiBkb2N1bWVudC5ib2R5LmNoaWxkcmVuKDApLmluc2VydEFkamFjZW50RWxl
bWVudCgnYmVmb3JlQmVnaW4nLAo+PiB3aWRnZXQubm9kZSk7Cj4+ICAgICAgICAgICAgICAgdmFy
IHMgPSBpbnNlcnRlZE5vZGUuZ2V0RWxlbWVudHNCeVRhZ05hbWUoJ3NjcmlwdCcpOwo+PiAgICAg
ICAgICAgICAgIGlmIChzLmxlbmd0aCA9PSAxKSB7Cj4+ICAgICAgICAgICAgICAgICAgIHZhciBq
cyA9IG5ldyBGdW5jdGlvbihzWzBdLnRleHQpOwo+PiAgICAgICAgICAgICAgICAgICBqcy5hcHBs
eShpbnNlcnRlZE5vZGUpOwo+PiAgICAgICAgICAgICAgIH0KPj4gICAgICAgICAgICAgICBpbnNl
cnRlZE5vZGUuc3R5bGUuekluZGV4ID0gKyttYXhfekluZGV4Owo+PiAgICAgICAgICAgICAgIHJl
dHVybiB3aWRnZXQub2JqZWN0SUQ7Cj4+ICAgICAgICAgICB9KTsKPj4gICAgICAgcmV0dXJuIHJl
c3VsdDsKPj4gICB9LAo+Pgo+Cj4gSSdtIG5vdCBzdXJlIHdoeSB5b3UncmUgcmUtZXZhbHVhdGlu
ZyB0aGUgY29udGVudHMgb2YgdGhlIHNjcmlwdCBub2RlLgo+IEF0aGVuYSBoYXMgYWxyZWFkeSBl
dmFsdWF0ZWQgdGhhdCBzY3JpcHQuICBJZiB5b3UgZmluZCBzb21lIGNhc2Ugd2hlcmUKPiB0aGlz
IGlzbid0IHRydWUsIHBsZWFzZSByZXBvcnQgYSBidWcuCj4KPgo+CgpEb24ndCBmZWVsIGNvbmZp
ZGVudCBlbm91Z2ggeWV0IGluIHdoYXQgSSdtIGRvaW5nIHRvIHJlcG9ydCBhbnkgYnVncyA6KQox
KSBHZXR0aW5nIElFIHRvIGJ1eSBzY3JpcHQgdGFncyBpbiB0aGUgYm9keS4uLiBzZWVtcyB0byBy
ZXF1aXJlIHRoaXMga2x1ZGdlCjIpIENvbWJpbmluZyBOZXZvdyBhbmQgalF1ZXJ5LCB0byBnZXQg
cmVzaXphYmxlL2RyYWdnYWJsZSB3aWRnZXRzCjMpIFRyeWluZyBvdXQgYSAiU3RhbiBhbHRlcm5h
dGl2ZSIgIChzZWUgYmVsb3cpCjQpIEhhdmluZyBmdW4gOikKCkluIGNhc2UgeW91J3JlIGludGVy
ZXN0ZWQgLQoKZGVmIG1ha2VERih4bWxEY3QsIGZpbGxpbmc9e30pOgogICAgcmV0dXJuIGxvYWRl
cnMueG1sc3RyKHhtbEZyYWdtZW50cy5kaWN0VG9YTUwoeG1sRGN0KSAlIGZpbGxpbmcpCgpjbGFz
cyBYaE1haW4oYXRoZW5hLkxpdmVGcmFnbWVudCk6CiAgICBYTSA9ICcnJ1wKZGl2IHhtbG5zOm5l
dm93PSJodHRwOi8vbmV2b3cuY29tL25zL25ldm93LzAuMSIKICAgIHhtbG5zOmF0aGVuYT0iaHR0
cDovL2Rpdm1vZC5vcmcvbnMvYXRoZW5hLzAuNyIKICAgIG5ldm93OnJlbmRlcj0ibGl2ZUZyYWdt
ZW50IicnJwoKY2xhc3MgR2VuZXJhbFN0dWZmKFhoTWFpbiwgU3FsTWV0aG9kcywgSHRtbE1ldGhv
ZHMpOgogICAgaHQgPSBbCiAgICAgICAgeydzY3JpcHQnIDogICcnJyQoZnVuY3Rpb24oKXsKCiQo
Ii5pbml0RHJhZ2dhYmxlIikuZHJhZ2dhYmxlKCkucmVzaXphYmxlKCkuYmluZCgicmVzaXplIiwK
cmVzaXplSGFuZGxlcikucmVtb3ZlQ2xhc3MoImluaXREcmFnZ2FibGUiKTsKCiQoIi5pbml0UmVz
dWx0IikuYWRkQ2xhc3MoImF1dG9TY3JvbGwiKS5yZW1vdmVDbGFzcygiaW5pdFJlc3VsdCIpOwoK
JCgiLmluaXRDbGljayIpLmNsaWNrKCkucmVtb3ZlQ2xhc3MoImluaXRDbGljayIpOwogICAgICAg
ICAgICAgICAgICAgICAgICAgIH0pJycnfSwKICAgICAgICB7J2RpdiBjbGFzcz0iZHJhZ2dhYmxl
IGluaXREcmFnZ2FibGUiJyA6CiAgICAgICAgICAgWwogICAgICAgIC4uLi4uLi4KICAgICAgICAg
ICAgIHsnZGl2IGNsYXNzPSJtZW51YmFyIicgOgogICAgICAgICAgICAgIFsKICAgICAgICAgICAg
ICAgeydhIGhyZWY9IiMiIGNsYXNzPSJjbGljayBpbml0Q2xpY2siJyA6IFt7J2F0aGVuYTpoYW5k
bGVyCmV2ZW50PSJvbmNsaWNrIiBoYW5kbGVyPSJ3aWRnZXRfYWN0aW9uIicgOiAnJ30sIHsnc3Bh
bicgOiAnUmVmcmVzaCd9LF19LAogICAgICAgICAgICAgIF0KICAgICAgICAgICAgIH0sCiAgICAg
ICAgICAgICB7J2RpdiBpZD0icmVzdWx0IiBjbGFzcz0icmVzdWx0IGluaXRSZXN1bHQiJyA6ICcn
fSwKICAgICAgICAgICBdCiAgICAgICAgIH0sCiAgICAgXQogICAgZGVmIF9faW5pdF9fKHNlbGYs
IGRiKToKICAgICAgICAuLi4uLgogICAgICAgIHNlbGYuanNDbGFzcyA9IHNlbGYuYXJnc1snanND
bGFzcyddCiAgICAgICAgc2VsZi5kb2NGYWN0b3J5ID0gbWFrZURGKHtzZWxmLlhNIDogc2VsZi5o
dH0sIHNlbGYuYXJncykKICAgICAgICBzdXBlcihHZW5lcmFsU3R1ZmYsIHNlbGYpLl9faW5pdF9f
KCkKY2xhc3MgQWJzdHJhY3QoR2VuZXJhbFN0dWZmKToKICAgIGRlZiBfX2luaXRfXyhzZWxmLCBk
YiwgYT17fSk6CiAgICAgICAgc2VsZi5hcmdzID0gewogICAgICAgICAgICAnanNDbGFzcycgICAg
ICA6IHUiWEguQWJzdHJhY3QiLAogICAgICAgICAgICAnd2lkZ2V0SGVhZGVyJyA6ICJBYnN0cmFj
dCIsCiAgICAgICAgICAgIH0KICAgICAgICBzZWxmLmFyZ3MudXBkYXRlKGEpCiAgICAgICAgc3Vw
ZXIoQWJzdHJhY3QsIHNlbGYpLl9faW5pdF9fKGRiKQogICAgICAgIHNlbGYuYWRkVG9NZW51KHsn
YSBocmVmPSIjIiBjbGFzcz0iY2xpY2siJyA6IFt7J2F0aGVuYTpoYW5kbGVyCmV2ZW50PSJvbmNs
aWNrIiBoYW5kbGVyPSJtYXJrX2Zvcl9kZWxldGlvbiInIDogJyd9LCB7J3NwYW4nIDogJ0RlbGV0
ZSd9LF19KQotLS0tLS0tLS0tLS0tLSBuZXh0IHBhcnQgLS0tLS0tLS0tLS0tLS0KQW4gSFRNTCBh
dHRhY2htZW50IHdhcyBzY3J1YmJlZC4uLgpVUkw6IGh0dHA6Ly90d2lzdGVkbWF0cml4LmNvbS9w
aXBlcm1haWwvdHdpc3RlZC13ZWIvYXR0YWNobWVudHMvMjAwODExMDkvYzEzMWQ4N2MvYXR0YWNo
bWVudC0wMDAxLmh0bQo=
From michal.dtz at gmail.com  Mon Nov 10 10:22:21 2008
From: michal.dtz at gmail.com (=?UTF-8?B?TWljaGHFgiBQYXN0ZXJuYWs=?=)
Date: Mon Nov 10 10:23:01 2008
Subject: [Twisted-web] Adding athena.LiveElement to an already-rendered
	LivePage
In-Reply-To: <20081109210932.20272.1316779379.divmod.quotient.1183@ohm>
References: <20081109210932.20272.1316779379.divmod.quotient.1183@ohm>
Message-ID: <491851AD.2050805@gmail.com>

Jean-Paul Calderone pisze:
> On Sun, 09 Nov 2008 21:09:41 +0100, Micha? Pasternak 
> <michal.dtz@gmail.com> wrote:
>> Jean-Paul Calderone pisze:
>>> On Sun, 09 Nov 2008 13:28:26 +0100, Micha? Pasternak 
>>> <michal.dtz@gmail.com> wrote:
>>>> Hi,
>>>>
>>>> I want to be able to add athena.LiveElement to an already rendered 
>>>> LivePage. Quick Googling revealed this blog entry:
>>>>
>>>>    
>>>> http://techblog.ironfroggy.com/2006/01/nevow-post-render-injection- 
>>>> of.html
>>>>
>>>> I'd like to know, if there are any other, simpler ways to do that - 
>>>> or, maybe, is there a preferred method to do that in the API already?
>>>
>>> See Nevow.Athena.Widget.addChildWidgetFromWidgetInfo.
>> This method will not add the markup automatically. Am I right?
>>
>> I want to append incoming LiveFragments to the page.
>>
>> Right now, I am doing something like this on the client:
>>
>> // import Divmod.Runtime
>>
>> What.Ever = Nevow.Athena.Widget.subclass('What.Ever');
>> What.Ever.methods =(
>>
>>  function foo(self) {
>>    d = self.callRemote('getLiveFragment');
>>
>>    d.addCallback(
>>
>>      function liveFragmentReceived(lf) {
>>
>>        d2 = self.addChildWidgetFromWidgetInfo(lf);
>>
>>        d2.addCallback(
>>
>>          function added(res) {
>>
>>            d = Divmod.Runtime.theRuntime.parseXHTMLString(
>>              lf.markup).documentElement;
>>
>>            self.nodeById('lastNode').appendChild(d);
>>
>>          });
>>
>>      });
>
> You don't have to parse the markup.  It's already parsed.  The DOM
> element which results is the `node? attribute of the Widget instance
> (which you get as `res? - the result of the callback).  You shouldn't
> use any attributes of `lf?, since it is an opaque handle: there is no
> API stability guarantee about it.  The *only* thing you can do with it
> is pass it to `addChildWidgetFromWidgetInfo?.

Yes sir!

To whom it may concern: I've created a short how-to page:
http://divmod.org/trac/wiki/DivmodNevow/Athena/Tutorials/LiveElementsOnFly

-- 
m


From p.mayers at imperial.ac.uk  Wed Nov 12 08:38:22 2008
From: p.mayers at imperial.ac.uk (Phil Mayers)
Date: Wed Nov 12 08:38:58 2008
Subject: [Twisted-web] Negotiate/Kerberos Auth
Message-ID: <491ADC4E.6090302@imperial.ac.uk>

Interested parties might want to look at and comment on:

http://twistedmatrix.com/trac/ticket/3532
http://twistedmatrix.com/trac/ticket/3530

...the former being a "native" Negotiate auth method, the latter being a 
discussion of X-Remote-User and apache mod_auth_kerb.

The code in there is very much "todo", but we use both method and 
Twisted Web extensively, so I'll put some work into it over the next few 
days.

From mithrandi at mithrandi.net  Tue Nov 18 13:33:06 2008
From: mithrandi at mithrandi.net (Tristan Seligmann)
Date: Tue Nov 18 13:33:20 2008
Subject: [Twisted-web] Nevow 0.9.32
Message-ID: <20081118183306.GA23937@mithrandi.net>

SGkgYWxsLAoKSSdtIHBsZWFzZWQgdG8gKGJlbGF0ZWRseSwgdW5mb3J0dW5hdGVseSkgYW5ub3Vu
Y2UgdGhlIHJlbGVhc2Ugb2YgTmV2b3cKMC45LjMyLiBZb3UgY2FuIGdyYWIgaXQgaGVyZToKCmh0
dHA6Ly9kaXZtb2Qub3JnL3RyYWMvYXR0YWNobWVudC93aWtpL1NvZnR3YXJlUmVsZWFzZXMvTmV2
b3ctMC45LjMyLnRhci5nej9mb3JtYXQ9cmF3CgpDaGFuZ2VzIGZyb20gTmV2b3cgMC45LjMxOgoK
MC45LjMyICgyMDA4LTA4LTEyKToKICAtIEEgcmVzb3VyY2Ugd3JhcHBlciBmb3Igb24tdGhlLWZs
eSBnemlwIGNvbXByZXNzaW9uIGhhcyBiZWVuIGFkZGVkLgogIC0gQSB0d2lzdGQgcGx1Z2luLCAn
YXRoZW5hLXdpZGdldCcsIGlzIG5vdyBhdmFpbGFibGUgZm9yIHNlcnZpbmcKICAgIHNpbmdsZSBB
dGhlbmEgd2lkZ2V0cy4KICAtIEJhc2ljIEF0aGVuYSBzdXBwb3J0IGZvciBTYWZhcmkgYWRkZWQu
CiAgLSBBZGRlZCBmaWxlIG5hbWUsIGxpbmUgbnVtYmVyLCBhbmQgY29sdW1uIG51bWJlciBpbmZv
cm1hdGlvbiB0bwogICAgc2xvdHMgYW5kIHRhZ3MgcGFyc2VkIGZyb20gWE1MIGZpbGVzIGluIG9y
ZGVyIHRvIG1ha2UgZGVidWdnaW5nCiAgICB0ZW1wbGF0ZS9yZW5kZXJlciBpbnRlcmFjdGlvbnMg
c2ltcGxlci4KICAtIEEgY29udGV4dC1mcmVlIGZsYXR0ZW5lciBoYXMgYmVlbiBhZGRlZC4gRnJh
Z21lbnQgYW5kIGl0cwogICAgc3ViY2xhc3NlcyBhcmUgbm93IGRlcHJlY2F0ZWQgaW4gZmF2b3Ig
b2YgRWxlbWVudC4KICAtIEphdmFzY3JpcHQgY2xhc3NlcyBkZXJpdmVkIGZyb20gdGhlIHRhYmJl
ZHBhbmUgY2xhc3MgY2FuIG5vdwogICAgb3ZlcnJpZGUgaG93IHRhYiBzZWxlY3Rpb24gaXMgaGFu
ZGxlZC4KLS0tLS0tLS0tLS0tLS0gbmV4dCBwYXJ0IC0tLS0tLS0tLS0tLS0tCkEgbm9uLXRleHQg
YXR0YWNobWVudCB3YXMgc2NydWJiZWQuLi4KTmFtZTogbm90IGF2YWlsYWJsZQpUeXBlOiBhcHBs
aWNhdGlvbi9wZ3Atc2lnbmF0dXJlClNpemU6IDE5NyBieXRlcwpEZXNjOiBEaWdpdGFsIHNpZ25h
dHVyZQpVcmwgOiBodHRwOi8vdHdpc3RlZG1hdHJpeC5jb20vcGlwZXJtYWlsL3R3aXN0ZWQtd2Vi
L2F0dGFjaG1lbnRzLzIwMDgxMTE4LzM3MjdiMDRlL2F0dGFjaG1lbnQucGdwCg==
From ksbuble at gmail.com  Tue Nov 25 00:15:54 2008
From: ksbuble at gmail.com (Katheryn Buble)
Date: Tue Nov 25 00:15:59 2008
Subject: [Twisted-web] Tabbed menus in Nevow
Message-ID: <b06dbdb10811242115pf9e1fdcvdbc42adeaabb4e54@mail.gmail.com>

Is there a standard way to implement tabbed menus in Nevow?
I would like something that looks like the tabbed.py example,

http://www.divmod.org/trac/browser/trunk/Nevow/examples/tabbed/tabbed.py

which uses nevow.taglibrary.tabbedPane, but where clicking on each tab
regenerates its contents (for example in order to perform a database query).

This could be achieved with a css menu where each tab is a link to a new
page. Then the "tabs" would be reloaded each time the link is clicked. The
tabbedPane looks good though and was wondering if a similar feature is
provided somewhere. I'd rather not reinvent the wheel:-). I could not find
any examples in the archive or documentation.

Thank you,
Katheryn
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-web/attachments/20081124/1b=
84b29e/attachment.htm
From Martin.Bright at casero.com  Tue Nov 25 00:28:21 2008
From: Martin.Bright at casero.com (Martin Bright)
Date: Tue Nov 25 00:28:48 2008
Subject: [Twisted-web] database best practices
Message-ID: <29216E03CB2EDA448AE99071A3D9DE7202C30014@mail.casero.com>


Hi!

What is the best way to implement synchronous DB access in a twisted applic=
ation?  I've read about defer.deferredGenerator, and various threads about =
how it's a stupid idea to even attempt this. Do I have restructure my code =
such that everything that depends on results from a database query is in a =
callback to a deferred object?

-martin
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-web/attachments/20081125/2b=
c634b8/attachment.htm
From bernat at luffy.cx  Tue Nov 25 04:18:48 2008
From: bernat at luffy.cx (Vincent Bernat)
Date: Tue Nov 25 04:19:27 2008
Subject: [Twisted-web] database best practices
In-Reply-To: <29216E03CB2EDA448AE99071A3D9DE7202C30014@mail.casero.com>
References: <29216E03CB2EDA448AE99071A3D9DE7202C30014@mail.casero.com>
Message-ID: <9e1032c914162a2994ff120b7e1d4362@chopper.luffy.cx>


On Tue, 25 Nov 2008 00:28:21 -0500, "Martin Bright"
<Martin.Bright@casero.com> wrote:

> What is the best way to implement synchronous DB access in a twisted
> application?  I've read about defer.deferredGenerator, and various
threads
> about how it's a stupid idea to even attempt this. Do I have restructure
my
> code such that everything that depends on results from a database query
is
> in a callback to a deferred object?

You can use runInteraction(). This will execute your DB query in a separate
thread and in a transaction.

From abdulwahid at gmail.com  Tue Nov 25 04:30:30 2008
From: abdulwahid at gmail.com (Abdul-Wahid Paterson)
Date: Tue Nov 25 04:30:33 2008
Subject: [Twisted-web] database best practices
In-Reply-To: <9e1032c914162a2994ff120b7e1d4362@chopper.luffy.cx>
References: <29216E03CB2EDA448AE99071A3D9DE7202C30014@mail.casero.com>
	<9e1032c914162a2994ff120b7e1d4362@chopper.luffy.cx>
Message-ID: <995fcdb00811250130q65670cb4h4109e40b34f7462a@mail.gmail.com>

Hi

I thought the twisted enterprise was meant to be more suited...

http://twistedmatrix.com/projects/core/documentation/howto/enterprise.html

(Sorry Martin for hijacking your question but I think we want to know the
same thing). Anyway, the method on this page sounds good but I wasn't
actually sure how I fit this in with the renderers. Especially, there are
some SQL queries I want to do before rendering anything on the page and
perhaps before even sending HTTP header information. If I am calling the
deffered from renderHTTP how do I use the result within renderHTTP.

An example would be nice :)

Regards,

AW

On Tue, Nov 25, 2008 at 12:18 PM, Vincent Bernat <bernat@luffy.cx> wrote:

>
> On Tue, 25 Nov 2008 00:28:21 -0500, "Martin Bright"
> <Martin.Bright@casero.com> wrote:
>
> > What is the best way to implement synchronous DB access in a twisted
> > application?  I've read about defer.deferredGenerator, and various
> threads
> > about how it's a stupid idea to even attempt this. Do I have restructure
> my
> > code such that everything that depends on results from a database query
> is
> > in a callback to a deferred object?
>
> You can use runInteraction(). This will execute your DB query in a separa=
te
> thread and in a transaction.
>
> _______________________________________________
> Twisted-web mailing list
> Twisted-web@twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-web/attachments/20081125/d2=
87befd/attachment.htm
From p.mayers at imperial.ac.uk  Tue Nov 25 04:58:37 2008
From: p.mayers at imperial.ac.uk (Phil Mayers)
Date: Tue Nov 25 04:59:13 2008
Subject: [Twisted-web] database best practices
In-Reply-To: <995fcdb00811250130q65670cb4h4109e40b34f7462a@mail.gmail.com>
References: <29216E03CB2EDA448AE99071A3D9DE7202C30014@mail.casero.com>	<9e1032c914162a2994ff120b7e1d4362@chopper.luffy.cx>
	<995fcdb00811250130q65670cb4h4109e40b34f7462a@mail.gmail.com>
Message-ID: <492BCC4D.2020306@imperial.ac.uk>

Abdul-Wahid Paterson wrote:
> Hi
>  
> I thought the twisted enterprise was meant to be more suited...
>  
> http://twistedmatrix.com/projects/core/documentation/howto/enterprise.html
>  
> (Sorry Martin for hijacking your question but I think we want to know 
> the same thing). Anyway, the method on this page sounds good but I 
> wasn't actually sure how I fit this in with the renderers. Especially, 
> there are some SQL queries I want to do before rendering anything on the 
> page and perhaps before even sending HTTP header information. If I am 
> calling the deffered from renderHTTP how do I use the result within 
> renderHTTP.
>  
> An example would be nice :)

That's a pretty elementary question. Perhaps someone could add a simple 
example like this to the twisted.web docs?


from twisted.web import resource, server
from twisted.enterprise import adbapi

mypool = adbapi.ConnectionPool(...)

class page(resource.Resource)
   def render_GET(self, request):
     d = mypool.runInteraction(self.query, request_args)
     d.addCallback(self.ok, request)
     d.addErrback(self.err, request)

     return server.NOT_DONE_YET

   def query(self, cursor, request_args):
     """I run in a thread. Do database stuff here"""
     cursor.execute(...)
     return cursor.fetchall()

   def ok(self, results, request):
     request.write("""<html>...""")
     for row in results:
         request.write(...row...)
     request.finish()

   def ok(self, failure, request):
     request.write("""<html><body><h2>Error</h2>""")
     request.write(failure.getErrorMessage())
     request.write("""</body></html>""")
     request.finish()

From michal.dtz at gmail.com  Tue Nov 25 09:09:28 2008
From: michal.dtz at gmail.com (=?UTF-8?B?TWljaGHFgiBQYXN0ZXJuYWs=?=)
Date: Tue Nov 25 09:09:34 2008
Subject: [Twisted-web] database best practices
In-Reply-To: <29216E03CB2EDA448AE99071A3D9DE7202C30014@mail.casero.com>
References: <29216E03CB2EDA448AE99071A3D9DE7202C30014@mail.casero.com>
Message-ID: <492C0718.1050400@gmail.com>

TWFydGluIEJyaWdodCB3cm90ZToKPgo+IEhpIQo+Cj4gV2hhdCBpcyB0aGUgYmVzdCB3YXkgdG8g
aW1wbGVtZW50IHN5bmNocm9ub3VzIERCIGFjY2VzcyBpbiBhIHR3aXN0ZWQgCj4gYXBwbGljYXRp
b24/Cj4KCkZvciBuZXdseSBjcmVhdGVkIHNvZnR3YXJlIEkgd291bGQgdXNlIERpdm1vZCBBeGlv
bS4gSXQgdXNlcyBTUUxpdGUgYXMgYSAKYmFja2VuZC4KCkZvciBhbHJlYWR5IGV4aXN0aW5nIGRh
dGFiYXNlcyAoaW4gTXlTUUwgb3IgUG9zdGdyZVNRTCkgSSB3b3VsZCB1c2UgCkNhbm9uaWNhbCBT
dG9ybS4gSXQgZXZlbiBoYXMgYSBicmFuY2ggZm9yIGludGVncmVhdGlvbiB3aXRoIFR3aXN0ZWQs
IAp3aGljaCB1c2VzIHNlcGFyYXRlIHRocmVhZCB0byBhY2Nlc3MgZGF0YWJhc2UuCgo+IERvIEkg
aGF2ZSByZXN0cnVjdHVyZSBteSBjb2RlIHN1Y2ggdGhhdCBldmVyeXRoaW5nIHRoYXQgZGVwZW5k
cyBvbiAKPiByZXN1bHRzIGZyb20gYSBkYXRhYmFzZSBxdWVyeSBpcyBpbiBhIGNhbGxiYWNrIHRv
IGEgZGVmZXJyZWQgb2JqZWN0Pwo+CkkgYmVsaWV2ZSBpdCB3YXMgR2x5cGggTGVma293aXR6IHdo
byBvbmNlIHNhaWQsIHRoYXQgaGUgZmluZHMgCmFzeW5jaHJvbm91cyBkYXRhIGFjY2VzcyBBUElz
IGV4dHJlbWVseSBwYWluZnVsIChhbmQgdGhhdCdzIHdoeSBEaXZtb2QgCkF4aW9tIGhhcyBzeW5j
aHJvbm91cyBBUEkpLiBJIGNvdWxkIG5vdCBhZ3JlZSBtb3JlOyBJIHRoaW5rIHRoaXMgaXMgYWxz
byAKYSBjb25jZXJuIGZvciB5b3UsIHRoYXQncyB3aHkgeW91IGFza2VkIHRoaXMgcXVlc3Rpb24u
IEV2ZW4gaWYgdXNpbmcgU1FMIAp3aXRoIFR3aXN0ZWQgaXMgbm90IGEgcHJvYmxlbSwgYmFzaW5n
IG9uIG15IGV4cGVyaWVuY2UgSSB3b3VsZCByYXRoZXIgCnN1Z2dlc3Qgb25lIG9mIG1lbnRpb25l
ZCBhcHByb2FjaGVzLCB0aGFuIGFueXRoaW5nIGVsc2UuCgotLSAKbQoKLS0tLS0tLS0tLS0tLS0g
bmV4dCBwYXJ0IC0tLS0tLS0tLS0tLS0tCkFuIEhUTUwgYXR0YWNobWVudCB3YXMgc2NydWJiZWQu
Li4KVVJMOiBodHRwOi8vdHdpc3RlZG1hdHJpeC5jb20vcGlwZXJtYWlsL3R3aXN0ZWQtd2ViL2F0
dGFjaG1lbnRzLzIwMDgxMTI1L2NiNTMxMWZkL2F0dGFjaG1lbnQuaHRtCg==
From Martin.Bright at casero.com  Tue Nov 25 19:32:47 2008
From: Martin.Bright at casero.com (Martin Bright)
Date: Tue Nov 25 19:32:56 2008
Subject: [Twisted-web] using asynqueue as part of twisted application
Message-ID: <29216E03CB2EDA448AE99071A3D9DE720507E922@mail.casero.com>

The only way I have ever successfully used the wonderful Asynqueue
<http://pypi.python.org/pypi/AsynQueue/0.3>  module in a twisted
application (using twistd) is by calling

 

reactor.callWhenRunning(srvc.startup)

 

where 'srvc' is a twisted.application.service object, and 'startup' is a
function in which the queue is instantiated.

 

Is there a more obvious way?

 

Simply composing an object with a member that is a queue does not seem
to work. The queue has to be started only when the reactor is running,
which kinda makes sense, but is difficult for a noobie like me to figure
out.

 

 

-martin

 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-web/attachments/20081125/479cc30e/attachment.htm
From tarjei at nu.no  Wed Nov 26 05:12:43 2008
From: tarjei at nu.no (tarjei)
Date: Wed Nov 26 06:11:08 2008
Subject: [Twisted-web] database best practices
In-Reply-To: <492C0718.1050400@gmail.com>
References: <29216E03CB2EDA448AE99071A3D9DE7202C30014@mail.casero.com>
	<492C0718.1050400@gmail.com>
Message-ID: <492D211B.9030401@nu.no>

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Hi there,
Micha? Pasternak wrote:
> Martin Bright wrote:
>>
>> Hi!
>>
>> What is the best way to implement synchronous DB access in a twisted
>> application?
>>
> For newly created software I would use Divmod Axiom. It uses SQLite as a
> backend.
> For already existing databases (in MySQL or PostgreSQL) I would use
> Canonical Storm. It even has a branch for integreation with Twisted,
> which uses separate thread to access database.
Has anyone tested this branch? I'd love to see a smallish usage example.


>> Do I have restructure my code such that everything that depends on
>> results from a database query is in a callback to a deferred object?
>>
> I believe it was Glyph Lefkowitz who once said, that he finds
> asynchronous data access APIs extremely painful (and that's why Divmod
> Axiom has synchronous API). I could not agree more; I think this is also
> a concern for you, that's why you asked this question. Even if using SQL
> with Twisted is not a problem, basing on my experience I would rather
> suggest one of mentioned approaches, than anything else.

AFAIK some of the db interfaces (at least MysqlDB) will not block other
threads when running in one so it makes a lot of sense to throw those
operations into a separate thread.

I usually try to separate out the code doing db operations into threads
to keep the application responsive - instead of just the call to the db
operation. This makes for easier coding but with more code in the thread.

regards,
Tarjei




> 
> -- 
> m
> 
> 
> ------------------------------------------------------------------------
> 
> _______________________________________________
> Twisted-web mailing list
> Twisted-web@twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v1.4.6 (GNU/Linux)
Comment: Using GnuPG with Mozilla - http://enigmail.mozdev.org

iD8DBQFJLSEbYVRKCnSvzfIRAkX7AKCqg3RB2LAAlaGjbZMPYz8m1jws6QCfRic5
KHX3nnnPr+C6rUdwUqY3isg=
=4Vdg
-----END PGP SIGNATURE-----

From duncan.mcgreggor at gmail.com  Wed Nov 26 10:02:27 2008
From: duncan.mcgreggor at gmail.com (Duncan McGreggor)
Date: Wed Nov 26 10:02:29 2008
Subject: [Twisted-web] database best practices
In-Reply-To: <492D211B.9030401@nu.no>
References: <29216E03CB2EDA448AE99071A3D9DE7202C30014@mail.casero.com>
	<492C0718.1050400@gmail.com>  <492D211B.9030401@nu.no>
Message-ID: <1227711747.3709.18.camel@rhosgobel>

On Wed, 2008-11-26 at 11:12 +0100, tarjei wrote:
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
> 
> Hi there,
> Micha? Pasternak wrote:
> > Martin Bright wrote:
> >>
> >> Hi!
> >>
> >> What is the best way to implement synchronous DB access in a
> twisted
> >> application?
> >>
> > For newly created software I would use Divmod Axiom. It uses SQLite
> as a
> > backend.
> > For already existing databases (in MySQL or PostgreSQL) I would use
> > Canonical Storm. It even has a branch for integreation with Twisted,
> > which uses separate thread to access database.
> Has anyone tested this branch? I'd love to see a smallish usage
> example.

I have, and I'm a big fan. It's been on my list (of a billion things to
do) for a while to put together a mini tutorial for storm.twisted and
Nevow...

However, Thomas' tests for this branch are really good; they show nice
usage examples (for unit tests).

d


From drew.smathers at gmail.com  Wed Nov 26 11:51:50 2008
From: drew.smathers at gmail.com (Drew Smathers)
Date: Wed Nov 26 11:52:28 2008
Subject: [Twisted-web] using asynqueue as part of twisted application
In-Reply-To: <29216E03CB2EDA448AE99071A3D9DE720507E922@mail.casero.com>
References: <29216E03CB2EDA448AE99071A3D9DE720507E922@mail.casero.com>
Message-ID: <368574aa0811260851u3b04ccb1s145e465fed5a70ec@mail.gmail.com>

On Tue, Nov 25, 2008 at 7:32 PM, Martin Bright <Martin.Bright@casero.com> wrote:
> The only way I have ever successfully used the wonderful Asynqueue module in
> a twisted application (using twistd) is by calling
>
>
>
> reactor.callWhenRunning(srvc.startup)
>
>
>
> where 'srvc' is a twisted.application.service object, and 'startup' is a
> function in which the queue is instantiated.
>
>


I have nil experience with Asynqueue, but you shouldn't have to
directly interact with the reactor to start a service.

>
> Is there a more obvious way?
>
>

The "obvious way" depends on the application.  If you're writing a
simple client application you might try something like this:

...
if __name__ = '__builtin__': # run with twistd -y
    from twisted.application import service
    application = service.Application('foo')
    svc = ... # Initialize asyncqueue service
    ...
    svc.setServiceParent(application)

This might be more than you need for your application, but I would
suggest also reading about Twisted application plugins:

http://twistedmatrix.com/projects/core/documentation/howto/tap.html


>
> Simply composing an object with a member that is a queue does not seem to
> work. The queue has to be started only when the reactor is running, which
> kinda makes sense, but is difficult for a noobie like me to figure out.
>

If you want a function to be called when the reactor is running, then
what you've done is correct - reactor.callWhenRunning().  However,
this is not the normal way to start services.

Drew

From drew.smathers at gmail.com  Wed Nov 26 12:24:20 2008
From: drew.smathers at gmail.com (Drew Smathers)
Date: Wed Nov 26 12:24:24 2008
Subject: [Twisted-web] database best practices
In-Reply-To: <492D211B.9030401@nu.no>
References: <29216E03CB2EDA448AE99071A3D9DE7202C30014@mail.casero.com>
	<492C0718.1050400@gmail.com> <492D211B.9030401@nu.no>
Message-ID: <368574aa0811260924s25cb136u538a78e02cead0da@mail.gmail.com>

On Wed, Nov 26, 2008 at 5:12 AM, tarjei <tarjei@nu.no> wrote:
> -----BEGIN PGP SIGNED MESSAGE-----
> Hash: SHA1
>
> Hi there,
> Micha? Pasternak wrote:
>> Martin Bright wrote:
>>>
>>> Hi!
>>>
>>> What is the best way to implement synchronous DB access in a twisted
>>> application?
>>>
>> For newly created software I would use Divmod Axiom. It uses SQLite as a
>> backend.
>> For already existing databases (in MySQL or PostgreSQL) I would use
>> Canonical Storm. It even has a branch for integreation with Twisted,
>> which uses separate thread to access database.
> Has anyone tested this branch? I'd love to see a smallish usage example.
>

I've been using the twisted-integration branch on a project at work.
So far I have used with sqlite (for unit tests) and MySQL and have not
found any issues.

Per Duncan's comments, the unit tests tests/twistorm.py are the best
place to look now to see how to use the API.  I've been working on
adding some unit tests and minor features + more tests as well, in
hopes that we can get this branch merged into storm proper.  A small
howto might be in order as well - some external documentation doesn't
hurt.

>
>>> Do I have restructure my code such that everything that depends on
>>> results from a database query is in a callback to a deferred object?
>>>
>> I believe it was Glyph Lefkowitz who once said, that he finds
>> asynchronous data access APIs extremely painful (and that's why Divmod
>> Axiom has synchronous API). I could not agree more; I think this is also
>> a concern for you, that's why you asked this question. Even if using SQL
>> with Twisted is not a problem, basing on my experience I would rather
>> suggest one of mentioned approaches, than anything else.
>
> AFAIK some of the db interfaces (at least MysqlDB) will not block other
> threads when running in one so it makes a lot of sense to throw those
> operations into a separate thread.
>
> I usually try to separate out the code doing db operations into threads
> to keep the application responsive - instead of just the call to the db
> operation. This makes for easier coding but with more code in the thread.
>

twisted-integration uses threads of course - most importantly it
couples a single thread to a store (StoreThread), which is the only
safe way I know of to do transactions.
From drewp at bigasterisk.com  Sat Nov 29 17:00:23 2008
From: drewp at bigasterisk.com (Drew Perttula)
Date: Sat Nov 29 17:00:26 2008
Subject: [Twisted-web] database best practices
In-Reply-To: <29216E03CB2EDA448AE99071A3D9DE7202C30014@mail.casero.com>
References: <29216E03CB2EDA448AE99071A3D9DE7202C30014@mail.casero.com>
Message-ID: <4931BB77.8090303@bigasterisk.com>

Martin Bright wrote:
>
> What is the best way to implement synchronous DB access in a twisted 
> application?  I've read about defer.deferredGenerator, and various 
> threads about how it's a stupid idea to even attempt this. Do I have 
> restructure my code such that everything that depends on results from 
> a database query is in a callback to a deferred object?
>
I'm using deferredGenerator (and the yummier inlineCallbacks) all over 
with my database calls. My database is an RDF database that I talk to 
over HTTP (with my http://projects.bigasterisk.com/sparqlhttp/). The 
inlineCallbacks API is so great, you won't miss synchronous code at all.

My setup doesn't have transactions, which is one issue with twisted db 
access. I try to arrange my updates so only the last atomic piece 
matters. If something goes wrong, my worst case should be some orphaned 
data. Ebay might work like this too: 
http://martinfowler.com/bliki/Transactionless.html


From dev at abita.fi  Sun Nov 30 09:02:01 2008
From: dev at abita.fi (Taito Horiuchi)
Date: Sun Nov 30 09:02:09 2008
Subject: [Twisted-web] Internal link shows port behind the server by
	ReverseProxyResource.
Message-ID: <c0c604470811300602p729863d5qb02ac8bceacdd323@mail.gmail.com>

Hi,

I'm new to Twisted, but would like to try to use it as a web front server.
I try to use ReverseProxyResource to provide internal server with port 20001
to port 80.
The code below successfully provides the content of http://localhost:20001/=
as
http://localhost/,
but the internal link within the page shows port 20001.
How can I fix this?

Taito

The code:

from twisted.internet import reactor
from twisted.web import server, proxy, vhost

PORT =3D 20001
HostName =3D 'localhost'
reverseProxy =3D proxy.ReverseProxyResource(HostName, PORT, '')


root =3D vhost.NameVirtualHost()
root.addHost(HostName, reverseProxy)
site =3D server.Site(root)
reactor.listenTCP(80, site)
reactor.run()
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-web/attachments/20081130/a5=
75fada/attachment.htm
