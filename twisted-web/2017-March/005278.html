<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] internal vs. external hostname in Request.getHost9)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-web%5D%20internal%20vs.%20external%20hostname%20in%20Request.getHost9%29&In-Reply-To=%3CCAOG7vkxQWwrctx0d5_L2A5SAh_2e7mFA%2Bj%3DPPGHQ9FAeoT0SUQ%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   
   <LINK REL="Next"  HREF="005279.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] internal vs. external hostname in Request.getHost9)</H1>
    <B>Ilya Skriblovsky</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-web%5D%20internal%20vs.%20external%20hostname%20in%20Request.getHost9%29&In-Reply-To=%3CCAOG7vkxQWwrctx0d5_L2A5SAh_2e7mFA%2Bj%3DPPGHQ9FAeoT0SUQ%40mail.gmail.com%3E"
       TITLE="[Twisted-web] internal vs. external hostname in Request.getHost9)">ilyaskriblovsky at gmail.com
       </A><BR>
    <I>Tue Mar 14 00:01:00 MDT 2017</I>
    <P><UL>
        
        <LI>Next message: <A HREF="005279.html">[Twisted-web] internal vs. external hostname in	Request.getHost9)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5278">[ date ]</a>
              <a href="thread.html#5278">[ thread ]</a>
              <a href="subject.html#5278">[ subject ]</a>
              <a href="author.html#5278">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

I'm using Twisted Web server behind Nginx reverse-proxy and I'm getting
backend's internal host:port from Request.getHost().

Seems like Request.host is explicitly set to socket's address (i.e.
internal address) here: &#8203;
<A HREF="https://github.com/twisted/twisted/blob/trunk/src/twisted/web/http.py#L838">https://github.com/twisted/twisted/blob/trunk/src/twisted/web/http.py#L838</A>
But comment at &#8203;
<A HREF="https://github.com/twisted/twisted/blob/trunk/src/twisted/web/http.py#L1297">https://github.com/twisted/twisted/blob/trunk/src/twisted/web/http.py#L1297</A>
and what this method does points that Request.host meant to reflect Host
header of the request, i.e. user-visible hostname and port.

This creates problems for me when using Klein because it correctly uses
Request.getHost() to create host part of URLs for redirects.

It seems like inconsistency in Twisted code. I'd expect Request.host should
be only set from the Host request header to reflect user-visible hostname,
not the internal backend server's address. Or may be I'm missing something?

Thanks for reply

--
  ilya
-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://twistedmatrix.com/pipermail/twisted-web/attachments/20170314/e92cbc15/attachment.html">http://twistedmatrix.com/pipermail/twisted-web/attachments/20170314/e92cbc15/attachment.html</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	
	<LI>Next message: <A HREF="005279.html">[Twisted-web] internal vs. external hostname in	Request.getHost9)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5278">[ date ]</a>
              <a href="thread.html#5278">[ thread ]</a>
              <a href="subject.html#5278">[ subject ]</a>
              <a href="author.html#5278">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
