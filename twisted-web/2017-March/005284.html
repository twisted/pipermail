<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] internal vs. external hostname in	Request.getHost9)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-web%5D%20internal%20vs.%20external%20hostname%20in%0A%09Request.getHost9%29&In-Reply-To=%3CDF6B5132-CC42-4A69-8B76-7F5F26EAABC7%40twistedmatrix.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005283.html">
   <LINK REL="Next"  HREF="005285.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] internal vs. external hostname in	Request.getHost9)</H1>
    <B>Glyph</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-web%5D%20internal%20vs.%20external%20hostname%20in%0A%09Request.getHost9%29&In-Reply-To=%3CDF6B5132-CC42-4A69-8B76-7F5F26EAABC7%40twistedmatrix.com%3E"
       TITLE="[Twisted-web] internal vs. external hostname in	Request.getHost9)">glyph at twistedmatrix.com
       </A><BR>
    <I>Fri Mar 17 02:16:27 MDT 2017</I>
    <P><UL>
        <LI>Previous message: <A HREF="005283.html">[Twisted-web] internal vs. external hostname in	Request.getHost9)
</A></li>
        <LI>Next message: <A HREF="005285.html">[Twisted-web] internal vs. external hostname in	Request.getHost9)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5284">[ date ]</a>
              <a href="thread.html#5284">[ thread ]</a>
              <a href="subject.html#5284">[ subject ]</a>
              <a href="author.html#5284">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
&gt;<i> On Mar 15, 2017, at 1:20 AM, Ilya Skriblovsky &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">ilyaskriblovsky at gmail.com</A>&gt; wrote:
</I>&gt;<i> 
</I>&gt;<i> Ok, so in the sort term you are suggesting to change Request.URLPath
</I>
Yes.

&gt;<i> (uppercased method? Hmm)
</I>
Like I said, not a great interface, overall :-).

&gt;<i> to use Host header instead of getRequestHostname and to change Klein to use it instead of Request.getHost(), right?
</I>&gt;<i> Sounds wise and reasonable :)
</I>
OK, glad you agree :).

&gt;<i> But I'd like to add one more thing. In order to build correct external URL we need to know is it http or https. Currently URLPath is using Request.isSecure(), but it is not sufficient since Request.isSecure() just checks if backend connection is SSL while encryption is often terminated at a reverse proxy. Can we add &quot;useXForwardedProto=False&quot; argument to Request.URLPath() and check X-Forwarded-Proto header if it is true? And may be add &quot;useXForwardedHost=False&quot; too to simplify setting up a reverse proxy (with a bold red warning in docstring that it can be set to True only if reverse proxy is correctly configured to drop corresponding client-specified headers). What do you think?
</I>
I think that for starters, it would make more sense to just fix it to always honor forwarded-for and x-forwarded-for headers.  The code calling request.URLPath(), in a given Resource, or application, is highly unlikely to know whether it wants to honor (x-)forwarded-for.  The code that might know about this sort of configuration would be the thing that constructs the Site object, but I'd be much happier to just get a change that always honors it first, and then figure out how to customize it later.

-glyph

-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://twistedmatrix.com/pipermail/twisted-web/attachments/20170317/5ae7ae3e/attachment.html">http://twistedmatrix.com/pipermail/twisted-web/attachments/20170317/5ae7ae3e/attachment.html</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="005283.html">[Twisted-web] internal vs. external hostname in	Request.getHost9)
</A></li>
	<LI>Next message: <A HREF="005285.html">[Twisted-web] internal vs. external hostname in	Request.getHost9)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5284">[ date ]</a>
              <a href="thread.html#5284">[ thread ]</a>
              <a href="subject.html#5284">[ subject ]</a>
              <a href="author.html#5284">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
