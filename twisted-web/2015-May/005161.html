<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] A twisted wsgi success
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-web%5D%20A%20twisted%20wsgi%20success&In-Reply-To=%3CCAGNewGR6RMYfHgh1yhKy_Epn7My7H-MS5VRBvcsxx5ikhRzirg%40mail.gmail.com%3E">
   <META NAME="robots" CONTENT="index,nofollow">
   <style type="text/css">
       pre {
           white-space: pre-wrap;       /* css-2.1, curent FF, Opera, Safari */
           }
   </style>
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="005160.html">
   <LINK REL="Next"  HREF="005162.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] A twisted wsgi success</H1>
    <B>Ian Schenck</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=Re%3A%20%5BTwisted-web%5D%20A%20twisted%20wsgi%20success&In-Reply-To=%3CCAGNewGR6RMYfHgh1yhKy_Epn7My7H-MS5VRBvcsxx5ikhRzirg%40mail.gmail.com%3E"
       TITLE="[Twisted-web] A twisted wsgi success">ian.schenck at gmail.com
       </A><BR>
    <I>Thu May 21 10:09:28 MDT 2015</I>
    <P><UL>
        <LI>Previous message: <A HREF="005160.html">[Twisted-web] A twisted wsgi success
</A></li>
        <LI>Next message: <A HREF="005162.html">[Twisted-web] A twisted wsgi success
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5161">[ date ]</a>
              <a href="thread.html#5161">[ thread ]</a>
              <a href="subject.html#5161">[ subject ]</a>
              <a href="author.html#5161">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Gelin,

I'm loathsome to share my data as benchmark data. We came up with an
acceptable range of performance before we set out, decided on what to test
and how based on real traffic, and did a very short test to confirm we were
ok. We picked a particular page that hits a few of our internal systems. We
ran the benchmark against 3 twisted processes with default threadpool
parameters vs the other with 8 workers on a single core VPS. We don't care
about 2 or 10 or probably even 50 milliseconds. We didn't bother tuning the
old setup (or maybe we did in the past before I arrived). We really just
wanted to check for a huge, perceptual regression in performance. We were
comfortable enough with this test to use it, but I wouldn't refer to it or
publish it as a benchmark.

With that disclaimer, I've attached a graph of mean and standard deviation
in our particular test.


Run with:
ab -c 1 -n 100
ab -c 10 -n 1000
ab -c 25 -n 5000

I don't know if I have complete output from ab anymore.

On Wed, May 20, 2015 at 10:06 PM Gelin Yan &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">dynamicgl at gmail.com</A>&gt; wrote:

&gt;<i> On Thu, May 21, 2015 at 1:56 AM, Ian Schenck &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">ian.schenck at gmail.com</A>&gt;
</I>&gt;<i> wrote:
</I>&gt;<i>
</I>&gt;&gt;<i> I mostly lurk on here, but I wanted to share my recent experience
</I>&gt;&gt;<i> switching my company's wsgi container to twisted wsgi.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> We had been using a particular wsgi container implemented in C. As time
</I>&gt;&gt;<i> went on problems creeped up with cython modules, segfaults happened, and
</I>&gt;&gt;<i> threading had to be disabled. Things that worked in development would not
</I>&gt;&gt;<i> work in production. At this point I wanted two things: the development
</I>&gt;&gt;<i> container should be the production container, and the container of choice
</I>&gt;&gt;<i> should provide a python interpreter environment consistent with actual
</I>&gt;&gt;<i> python. These containers written in C which treat your application like a
</I>&gt;&gt;<i> plugin fail to do that across the board.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> We no longer have any of the issues we had before (cython, threading,
</I>&gt;&gt;<i> segfaults), and if something were to break in production, it is probably
</I>&gt;&gt;<i> broken in development and won't make it out the door. Development servers
</I>&gt;&gt;<i> run the same twisted wsgi container that runs in production, in fact they
</I>&gt;&gt;<i> are both launched the same (but middlewares and reloaders differ). That
</I>&gt;&gt;<i> consistency is a really big deal. Additionally, deployment and config
</I>&gt;&gt;<i> management dropped a few hundred lines.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> The biggest pushback I received was over performance. We benched our real
</I>&gt;&gt;<i> world application (versus, ahem, just returning a string) and found our
</I>&gt;&gt;<i> median response time was consistently 1-2ms higher across various
</I>&gt;&gt;<i> concurrency levels. That's insignificant for us. Under high load, twisted
</I>&gt;&gt;<i> wsgi actually did better with tail latency (99%ile and max). Maybe that
</I>&gt;&gt;<i> slight bump in median latency is because our web workers now speak http
</I>&gt;&gt;<i> instead of a &quot;light weight protocol&quot; akin to scgi, but the benefits of
</I>&gt;&gt;<i> talking http (curl much?) are also worth a millisecond or two.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Thanks for all the hard work, and thanks Glyph for your 2011 Djangocon
</I>&gt;&gt;<i> talk and your tweets leading me to twisted wsgi. We're very happy. If
</I>&gt;&gt;<i> anyone wants details or a peek at some of the wiring, I can probably get
</I>&gt;&gt;<i> approval to share more.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>
</I>&gt;<i> Hi Ian
</I>&gt;<i>
</I>&gt;<i>     Could you tell me a bit your benchmark data? I am interested in moving
</I>&gt;<i> our container to twisted recently.
</I>&gt;<i>
</I>&gt;<i> Regards
</I>&gt;<i>
</I>&gt;<i> gelin yan
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-web mailing list
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">Twisted-web at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web</A>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: &lt;<A HREF="http://twistedmatrix.com/pipermail/twisted-web/attachments/20150521/869ca54a/attachment-0001.html">http://twistedmatrix.com/pipermail/twisted-web/attachments/20150521/869ca54a/attachment-0001.html</A>&gt;
-------------- next part --------------
A non-text attachment was scrubbed...
Name: Request-Response Latency.png
Type: image/png
Size: 60415 bytes
Desc: not available
URL: &lt;<A HREF="http://twistedmatrix.com/pipermail/twisted-web/attachments/20150521/869ca54a/attachment-0001.png">http://twistedmatrix.com/pipermail/twisted-web/attachments/20150521/869ca54a/attachment-0001.png</A>&gt;
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="005160.html">[Twisted-web] A twisted wsgi success
</A></li>
	<LI>Next message: <A HREF="005162.html">[Twisted-web] A twisted wsgi success
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#5161">[ date ]</a>
              <a href="thread.html#5161">[ thread ]</a>
              <a href="subject.html#5161">[ subject ]</a>
              <a href="author.html#5161">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
