<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] Possible bug in	nevow.testutil.FakeRequest	setHeaders and getHeaders
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Possible%20bug%20in%0A%09nevow.testutil.FakeRequest%09setHeaders%20and%20getHeaders&In-Reply-To=1285694631.24671.1397331661%40webmail.messagingengine.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004532.html">
   <LINK REL="Next"  HREF="004534.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] Possible bug in	nevow.testutil.FakeRequest	setHeaders and getHeaders</H1>
    <B>exarkun at twistedmatrix.com</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Possible%20bug%20in%0A%09nevow.testutil.FakeRequest%09setHeaders%20and%20getHeaders&In-Reply-To=1285694631.24671.1397331661%40webmail.messagingengine.com"
       TITLE="[Twisted-web] Possible bug in	nevow.testutil.FakeRequest	setHeaders and getHeaders">exarkun at twistedmatrix.com
       </A><BR>
    <I>Tue Sep 28 13:52:06 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="004532.html">[Twisted-web] Possible bug in nevow.testutil.FakeRequest setHeaders	and getHeaders
</A></li>
        <LI>Next message: <A HREF="004534.html">[Twisted-web] Possible bug in nevow.testutil.FakeRequest setHeaders and getHeaders
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4533">[ date ]</a>
              <a href="thread.html#4533">[ thread ]</a>
              <a href="subject.html#4533">[ subject ]</a>
              <a href="author.html#4533">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 05:23 pm, <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">peter.westlake at pobox.com</A> wrote:
&gt;<i>Recently my nevow web server's unit tests started to fail, because the
</I>&gt;<i>tests used request.getHeader() to check that request.setHeader() had
</I>&gt;<i>been called correctly. This used to work.
</I>&gt;<i>
</I>&gt;<i>I can see from testutil.py that setHeaders sets self.headers, but
</I>&gt;<i>getHeaders gets a value from received_headers, and there is a test in
</I>&gt;<i>test_testutil.py to make sure it does. So is this really how it is 
</I>&gt;<i>meant
</I>&gt;<i>to work? Is setHeader really meant to set something that getHeader 
</I>&gt;<i>can't
</I>&gt;<i>get? If so, what's the correct method for testing the result of
</I>&gt;<i>setHeader?
</I>
It's correct that setHeader and getHeader operate on different data 
sets.  Less confusing names for what the two methods do would have been 
setResponseHeader and getRequestHeader respectively.

In newer versions of Twisted, the requests have two new attributes, 
requestHeaders and responseHeaders, with various methods for inspection 
and modification.  Nevow's Request class should inherit these.  However 
Nevow's FakeRequest probably doesn't.

The right way to test for headers is probably to fix the FakeRequest 
class so that it is more inspectable, and to verify that it actually 
behaves in the same way as a real request object.
&gt;<i>To reproduce the problem, run this with &quot;trial&quot;:
</I>&gt;<i>
</I>&gt;<i>from nevow.testutil import FakeRequest, TestCase
</I>&gt;<i>
</I>&gt;<i>class TestHeaders(TestCase):
</I>&gt;<i>    def setUp(self):
</I>&gt;<i>        self.request = FakeRequest()
</I>&gt;<i>
</I>&gt;<i>    def test_set(self):
</I>&gt;<i>        self.request.setHeader('location', 'somewhere')
</I>&gt;<i>        self.failUnlessEqual(self.request.getHeader('location'),
</I>&gt;<i>        'somewhere')
</I>&gt;<i>
</I>&gt;<i>Peter.
</I>
Jean-Paul

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004532.html">[Twisted-web] Possible bug in nevow.testutil.FakeRequest setHeaders	and getHeaders
</A></li>
	<LI>Next message: <A HREF="004534.html">[Twisted-web] Possible bug in nevow.testutil.FakeRequest setHeaders and getHeaders
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4533">[ date ]</a>
              <a href="thread.html#4533">[ thread ]</a>
              <a href="subject.html#4533">[ subject ]</a>
              <a href="author.html#4533">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
