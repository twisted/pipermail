<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] Connection lost in a non-clean fashion
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Connection%20lost%20in%20a%20non-clean%20fashion&In-Reply-To=47592eb90912090337l49ef5896qb3a033f77c0f695b%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004385.html">
   <LINK REL="Next"  HREF="004388.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] Connection lost in a non-clean fashion</H1>
    <B>exarkun at twistedmatrix.com</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Connection%20lost%20in%20a%20non-clean%20fashion&In-Reply-To=47592eb90912090337l49ef5896qb3a033f77c0f695b%40mail.gmail.com"
       TITLE="[Twisted-web] Connection lost in a non-clean fashion">exarkun at twistedmatrix.com
       </A><BR>
    <I>Wed Dec  9 10:30:09 EST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="004385.html">[Twisted-web] Connection lost in a non-clean fashion
</A></li>
        <LI>Next message: <A HREF="004388.html">[Twisted-web] twisted web write to a connection closed from	client-side
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4386">[ date ]</a>
              <a href="thread.html#4386">[ thread ]</a>
              <a href="subject.html#4386">[ subject ]</a>
              <a href="author.html#4386">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 11:37 am, <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">billoldroyd at gmail.com</A> wrote:
&gt;<i>I have developed a web server based on twisted-web that acts as a 
</I>&gt;<i>gateway
</I>&gt;<i>between the SRU search protocol and the Z39.50 search protocol. ( 
</I>&gt;<i>Details at
</I>&gt;<i><A HREF="http://www.loc.gov/z3950/agency/">http://www.loc.gov/z3950/agency/</A> )
</I>
Cool.  I dabbled with Z39.50 very briefly a while ago.  Any chance 
you'll develop a Twisted-based implementation of this protocol? :)
&gt;<i>Each SRU search request opens a thread which performs a Z39.50 search 
</I>&gt;<i>on a
</I>&gt;<i>remote target and then returns the results which are converted into the 
</I>&gt;<i>SRU
</I>&gt;<i>response.
</I>&gt;<i>
</I>&gt;<i>Sometimes the connection with the client issuing the SRU request is 
</I>&gt;<i>lost. In
</I>&gt;<i>a few cases this produces the message &quot;Connection to the other side was 
</I>&gt;<i>lost
</I>&gt;<i>in a non-clean fashion: Connection lost. &quot;. When several of these non- 
</I>&gt;<i>clean
</I>&gt;<i>connection losses occur the web server will become unresponsive and 
</I>&gt;<i>will not
</I>&gt;<i>respond to any new requests.
</I>
I think it's unusual that the server would become unresponsive after 
several lost client connections.  Are you using deferToThread to do the 
Z39.50 searches?  If so, then the task should complete (or not) 
regardless of what happens to the web connection.  deferToThread uses a 
thread pool, though.  Once all the threads in the pool are in use, 
further jobs won't even be started until one of the threads becomes 
available.

Perhaps some searches take a long, long time?  This would tie up thread 
pool resources, preventing new jobs from being processed, and perhaps 
correlate somewhat with lost client connections (which give up after 
waiting for such a long time for their results).
&gt;<i>Can anyone help with how I should respond to these non-clean lost
</I>&gt;<i>connections ?. I can't find any documentation which helps me understand 
</I>&gt;<i>the
</I>&gt;<i>impact of this type of error. As the connection is lost there is no 
</I>&gt;<i>point in
</I>&gt;<i>returning any error response, but are there systems resources left 
</I>&gt;<i>allocated
</I>&gt;<i>which might be causing the server to become unresponsive.
</I>
I wrote about how to do this:

  <A HREF="http://jcalderone.livejournal.com/50890.html">http://jcalderone.livejournal.com/50890.html</A>

So, regardless of the thread pool stuff I talked about above, that 
should help you to at least handle the connection lost errors and clean 
up other resources.

Jean-Paul

</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004385.html">[Twisted-web] Connection lost in a non-clean fashion
</A></li>
	<LI>Next message: <A HREF="004388.html">[Twisted-web] twisted web write to a connection closed from	client-side
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4386">[ date ]</a>
              <a href="thread.html#4386">[ thread ]</a>
              <a href="subject.html#4386">[ subject ]</a>
              <a href="author.html#4386">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
