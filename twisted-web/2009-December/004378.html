<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] [nevow &amp; deferreds] page rendering occurs	before	data is available after callback
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20%5Bnevow%20%26%20deferreds%5D%20page%20rendering%20occurs%0A%09before%09data%20is%20available%20after%20callback&In-Reply-To=1259773315.31569.60.camel%40mhu.ifr.lan">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004377.html">
   <LINK REL="Next"  HREF="004379.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] [nevow &amp; deferreds] page rendering occurs	before	data is available after callback</H1>
    <B>exarkun at twistedmatrix.com</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20%5Bnevow%20%26%20deferreds%5D%20page%20rendering%20occurs%0A%09before%09data%20is%20available%20after%20callback&In-Reply-To=1259773315.31569.60.camel%40mhu.ifr.lan"
       TITLE="[Twisted-web] [nevow &amp; deferreds] page rendering occurs	before	data is available after callback">exarkun at twistedmatrix.com
       </A><BR>
    <I>Wed Dec  2 12:45:36 EST 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="004377.html">[Twisted-web] [nevow &amp; deferreds] page rendering occurs before data is available after callback
</A></li>
        <LI>Next message: <A HREF="004379.html">[Twisted-web] ANN: Twisted 9.0.0
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4378">[ date ]</a>
              <a href="thread.html#4378">[ thread ]</a>
              <a href="subject.html#4378">[ subject ]</a>
              <a href="author.html#4378">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 05:01 pm, <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">matthieu.huin at wallix.com</A> wrote:
&gt;<i>Greetings,
</I>&gt;<i>
</I>&gt;<i>I need to render a page with Nevow containing data extracted from a
</I>&gt;<i>database. The query might take time so it is taken care of with
</I>&gt;<i>twisted.adbapi, and thus with a Deferred.
</I>&gt;<i>
</I>&gt;<i>My render function returns this Deferred - to which some callbacks have
</I>&gt;<i>been added to format the data. All is well as long as the request is
</I>&gt;<i>fast enough for the Deferred to be dealt with quasi-synchronously. If
</I>&gt;<i>the query takes too much time, the render function simply returns the
</I>&gt;<i>Deferred, which is set at None, instead of its result value.
</I>
It's hard to tell from the code that you've posted, but it sounds like 
your &quot;too much time&quot; case is probably triggering a different path 
through your code - one that results in one of the necessary Deferreds 
not being chained to the Deferred returned from your renderHTTP 
implementation.  This results in the renderHTTP Deferred firing while 
some other asynchronous task is still going on.

Are you aware of nevow.guard, which implements authentication in a 
general way and can be applied to arbitrary other pages?  That might let 
you delete a lot of your code, possibly getting rid of the bug in the 
process, but at least reducing the amount of code you need to look 
through to find the problem.

Jean-Paul

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004377.html">[Twisted-web] [nevow &amp; deferreds] page rendering occurs before data is available after callback
</A></li>
	<LI>Next message: <A HREF="004379.html">[Twisted-web] ANN: Twisted 9.0.0
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4378">[ date ]</a>
              <a href="thread.html#4378">[ thread ]</a>
              <a href="subject.html#4378">[ subject ]</a>
              <a href="author.html#4378">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
