<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] Re: Good ROM tool ?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Re%3A%20Good%20ROM%20tool%20%3F&In-Reply-To=20060118162538.GV19010%40opteron.random">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002348.html">
   <LINK REL="Next"  HREF="002352.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] Re: Good ROM tool ?</H1>
    <B>Valentino Volonghi aka Dialtone</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Re%3A%20Good%20ROM%20tool%20%3F&In-Reply-To=20060118162538.GV19010%40opteron.random"
       TITLE="[Twisted-web] Re: Good ROM tool ?">dialtone at divmod.com
       </A><BR>
    <I>Wed Jan 18 10:40:08 MST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="002348.html">[Twisted-web] Re: Good ROM tool ?
</A></li>
        <LI>Next message: <A HREF="002352.html">[Twisted-web] Re: Good ROM tool ?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2349">[ date ]</a>
              <a href="thread.html#2349">[ thread ]</a>
              <a href="subject.html#2349">[ subject ]</a>
              <a href="author.html#2349">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Wed, Jan 18, 2006 at 05:25:38PM +0100, Andrea Arcangeli wrote:

&gt;<i> 	def render_book_composite(self, ctx, data):
</I>&gt;<i> 		ptrn_bid = inevow.IQ(ctx).patternGenerator('book_sequence_bid')
</I>&gt;<i> 		ptrn_ask = inevow.IQ(ctx).patternGenerator('book_sequence_ask')
</I>&gt;<i> 		return ctx.tag[[ tags.tr(_class=&quot;book_outside&quot;)
</I>&gt;<i> 				 [tags.td(_class=&quot;book_outside&quot;)[ptrn_bid(data=(x[0], x[1], x[2]))],
</I>&gt;<i> 				  tags.td(_class=&quot;book_outside&quot;)[ptrn_ask(data=(x[0], x[3], x[4]))]]
</I>&gt;<i> 				 for x in data ]]
</I>&gt;<i> 	def render_book_sequence(self, ctx, data): 
</I>&gt;<i> 		'This is the same as &quot;sequence&quot; but uses data[1] instead of data'
</I>&gt;<i> 		tag = ctx.tag
</I>&gt;<i> 		headers = tag.allPatterns('header')
</I>&gt;<i> 		pattern = tag.patternGenerator('item')
</I>&gt;<i> 		divider = tag.patternGenerator('divider', default=tags.invisible)
</I>&gt;<i> 		content = [(pattern(data=element), divider(data=element)) for element in data[2]]
</I>&gt;<i> 		if not content:
</I>&gt;<i> 			content = tag.allPatterns('empty')
</I>&gt;<i> 		else:
</I>&gt;<i> 			## No divider after the last thing.
</I>&gt;<i> 			content[-1] = content[-1][0]
</I>&gt;<i> 		footers = tag.allPatterns('footer')
</I>&gt;<i> 
</I>&gt;<i> 		return tag.clear()[ headers, content, footers ]
</I>&gt;<i> 	def render_book_header(self, ctx, data):
</I>&gt;<i> 		currency = data[0]
</I>&gt;<i> 		nr_orders = data[1]
</I>&gt;<i> 		ctx.fillSlots('currency', currency)
</I>&gt;<i> 		nr_orders_str = '%d Order' % nr_orders
</I>&gt;<i> 		if nr_orders != 1:
</I>&gt;<i> 			nr_orders_str += 's'
</I>&gt;<i> 		if nr_orders &gt; BOOK_SIZE:
</I>&gt;<i> 			nr_orders_str += ' (%d not shown)' % (nr_orders-BOOK_SIZE)
</I>&gt;<i> 		ctx.fillSlots('nr_orders', nr_orders_str)
</I>&gt;<i> 		return ctx.tag
</I>&gt;<i> 
</I>&gt;<i> If you find the above readable after 1 day, then it means you've a very
</I>&gt;<i> good memory and you only work on Nevow, I work on a moltitude of
</I>&gt;<i> different projects so there's no way I can know exactly what the
</I>&gt;<i> patternGenerator does or other subtle details with allPatterns,
</I>&gt;<i> inevow.IQ etc...  Plus the code renders slow (no surprise given all
</I>&gt;<i> those inevow.* and tags.pattern*).
</I>
I agree the code above is ugly, today I wouldn't write it that way of course.
Since I don't remember your constraints I can't comment too much on the code
above. Besides one thing:

I've been rather dumb with the code above to be honest.

data[2] can be done pretty easily with:

&lt;tr nevow:pattern=&quot;item&quot;&gt;
    &lt;td nevow:data=&quot;2&quot; nevow:render=&quot;blabla&quot; /&gt;
&lt;/tr&gt;

One thing that I remember though was the constraint on having a renderer to
generate the book_header because you didn't want to repeat the html for the 3
currencies (something that any designer would do to style the page in the
right way). There is a much better way to deal with that problem and it's the
way you used below for cheetah:

&lt;table nevow:data=&quot;currencies&quot;&gt;
    &lt;tr nevow:render=&quot;sequence&quot;&gt;
        &lt;td nevow:pattern=&quot;item&quot;&gt;
            &lt;table nevow:render=&quot;sequence&quot;&gt;
                &lt;tr nevow:pattern=&quot;item&quot;&gt;
                    &lt;td nevow:data=&quot;0&quot; nevow:render=&quot;data&quot; /&gt;
                    &lt;td nevow:data=&quot;1&quot; nevow:render=&quot;data&quot; /&gt;
                    &lt;td nevow:data=&quot;2&quot; nevow:render=&quot;data&quot; /&gt;
                    ...
                &lt;/tr&gt;
            &lt;/table&gt;
        &lt;/td&gt;
    &lt;/tr&gt;
&lt;/table&gt;

&gt;<i> As soon as I rewrite the whole thing with Cheetah it'll be like this!!
</I>&gt;<i> 
</I>&gt;<i> #for $currency in $currencies
</I>&gt;<i> 	&lt;table&gt;
</I>&gt;<i> #for $entry in $currency
</I>&gt;<i> 		&lt;table&gt;
</I>&gt;<i> [..]
</I>&gt;<i> 		&lt;td&gt;$entry.something&lt;/td&gt;
</I>&gt;<i> [..]
</I>&gt;<i> 		&lt;/table&gt;
</I>&gt;<i> #end for
</I>&gt;<i> 	&lt;/table&gt;
</I>&gt;<i> #end for
</I>
&gt;<i> It's obvious what is an order of magnitude more readable... There's no
</I>&gt;<i> chance I may not be able to understand the above, with Cheetah one
</I>&gt;<i> doesn't need to be a nevow hacker to render two nested tables.
</I>
As I showed the code here is translated with the simple yet more flexible
template above. With a bit more work (like returning a dictionary from the
query instead of a list) it could become:


&lt;table nevow:data=&quot;currencies&quot;&gt;
    &lt;tr nevow:render=&quot;sequence&quot;&gt;
        &lt;td nevow:pattern=&quot;item&quot;&gt;
            &lt;table nevow:render=&quot;sequence&quot;&gt;
                &lt;tr nevow:pattern=&quot;item&quot; nevow:render=&quot;mapping&quot;&gt;
                    &lt;td&gt;&lt;nevow:slot name=&quot;first_column&quot; /&gt;&lt;/td&gt;
                    &lt;td&gt;&lt;nevow:slot name=&quot;second_column&quot; /&gt;&lt;/td&gt;
                    &lt;td&gt;&lt;nevow:slot name=&quot;third_column&quot; /&gt;&lt;/td&gt;
                    &lt;td&gt;&lt;nevow:slot name=&quot;fourth_column&quot; /&gt;&lt;/td&gt;
                    &lt;td&gt;&lt;nevow:slot name=&quot;fifth_column&quot; /&gt;&lt;/td&gt;
                &lt;/tr&gt;
            &lt;/table&gt;
        &lt;/td&gt;
    &lt;/tr&gt;
&lt;/table&gt;

Which would be even faster thanks to using only one render instead of 4/5
(which means only 1 python function call, which is what is slow).

&gt;<i> As said yesterday it's a breath of fresh air being able to get full
</I>&gt;<i> flexibility with full python control mixed with html, without having to
</I>&gt;<i> call into obscure things like nevow.IQ. If you prefer the nevow version
</I>&gt;<i> of rendering nested tables, I think you must be a nevow developer, no
</I>&gt;<i> mere mortal out there could ever prefer the nevow version if compared to
</I>&gt;<i> the Cheetah version.
</I>
The nevow way of rendering nested tables is the one above. The one I gave you
a year ago does something wrong (or it does that in face of some kind of
constraint).

And yes, Nevow is not perfect. Now you are starting insulting the others' work
just because you haven't been able to understand it at all. We are friends and
I don't think my work (but not only mine) deserves such a bad judgement. First
of all if you think you can do better then do it, and after if you don't like
Nevow then fine, but your recent rants seem to grow from something else than
technical problems. See? That's exactly why after some point, and I speak for
myself, I stop caring for users. This is something that happens to me daily
with both twisted and Nevow and others, I don't have the time to care for all
the users complaining because they want X or Y and/or because they don't like
Z. Nobody is paying me to work for them on what they want, I have a job,
university to finish and some free time that I want to preserve. If you
disagree then step in or pay some of us to work on
twisted/nevow/something_else otherwise then you should have made some
library/framework evaluation before starting with your life's project and you
can't blame anyone because you made that evaluation wrong even if you are now
frustrated.

&gt;<i> Also note, I'm recompiling the templates every time, the same way nevow
</I>&gt;<i> parses xml every time. There's also the option to precompile them to get
</I>&gt;<i> even high perf, but since I can't measure any slowdown in the rendering
</I>&gt;<i> anymore (it's already a lot faster than nevow), there's no point for me
</I>&gt;<i> to precompile the templates right now.
</I>
And now we start with FUD. Just to show you don't actually understand nevow
you are saying something plain false. Nevow never recompiles templates unless
you modify them. It parses and precompiles templates once.

&gt;<i> On the long term techning Cheetah how to handle a deferred would be
</I>&gt;<i> cool.
</I>
And impossible if Cheetah is not extremely well designed (by impossible I mean
more work than outcome is worth).

Now to put an end to this: I don't think I'll have the time to keep answering
in this thread, both because I've lost any interest in this thread and because
It's clear that you simply don't like Nevow which is fine, but I beg you not
to spread any more FUD.

-- 
Valentino Volonghi aka Dialtone
Now Running MacOSX 10.4
Blog: <A HREF="http://vvolonghi.blogspot.com">http://vvolonghi.blogspot.com</A>
<A HREF="http://weever.berlios.de">http://weever.berlios.de</A>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 186 bytes
Desc: not available
Url : <A HREF="http://twistedmatrix.com/pipermail/twisted-web/attachments/20060118/d5d8cefc/attachment.pgp">http://twistedmatrix.com/pipermail/twisted-web/attachments/20060118/d5d8cefc/attachment.pgp</A>
</PRE>




















<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002348.html">[Twisted-web] Re: Good ROM tool ?
</A></li>
	<LI>Next message: <A HREF="002352.html">[Twisted-web] Re: Good ROM tool ?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2349">[ date ]</a>
              <a href="thread.html#2349">[ thread ]</a>
              <a href="subject.html#2349">[ subject ]</a>
              <a href="author.html#2349">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
