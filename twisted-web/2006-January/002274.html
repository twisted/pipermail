<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] Different behaviour of Nevow loaders xmlstr and stan
 when used in macro methods.
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Different%20behaviour%20of%20Nevow%20loaders%20xmlstr%20and%20stan%0A%20when%20used%20in%20macro%20methods.&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002273.html">
   <LINK REL="Next"  HREF="002427.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] Different behaviour of Nevow loaders xmlstr and stan
 when used in macro methods.</H1>
    <B>Richard Wall</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Different%20behaviour%20of%20Nevow%20loaders%20xmlstr%20and%20stan%0A%20when%20used%20in%20macro%20methods.&In-Reply-To="
       TITLE="[Twisted-web] Different behaviour of Nevow loaders xmlstr and stan
 when used in macro methods.">m-lists at the-moon.net
       </A><BR>
    <I>Wed Jan 11 10:20:47 MST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="002273.html">[Twisted-web] simple registry failure - __adapt__
</A></li>
        <LI>Next message: <A HREF="002427.html">[Twisted-web] Web Shop (e-commerce)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2274">[ date ]</a>
              <a href="thread.html#2274">[ thread ]</a>
              <a href="subject.html#2274">[ subject ]</a>
              <a href="author.html#2274">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>A few hours ago I posted a unit test to #twisted.web that I thought
demonstrated a problem I'm having with Nevow. It was wrong though, and
this is an updated version:

<A HREF="http://rafb.net/paste/results/sf5B5s57.html">http://rafb.net/paste/results/sf5B5s57.html</A>

What the test is supposed to demonstrate, is a difference in the
behaviour of loaders.stan and loaders.xmlstr (or xmlfile).

The test contains a rend.Page class with a macro_pattern(ctx, name)
method. The purpose of the macro is to lookup patterns called &quot;name&quot;
from a nevow.loaders.* instance at self.patternFactory.

If a matching pattern is found in patternFactory, it's children are
inserted into the tag that called the macro otherwise the original
contents are returned instead. So given a patternFactory:

&lt;div n:pattern=&quot;body&quot;&gt;
	&lt;p&gt;Page specific Text&lt;/p&gt;
&lt;/div&gt;

...and docFactory:...

&lt;div n:macro=&quot;pattern body&quot;&gt;
	&lt;p&gt;Default text&lt;/p&gt;
&lt;/div&gt;

You'd get:
&lt;div&gt;
	&lt;p&gt;Default text&lt;/p&gt;
&lt;/div&gt;

That works fine with both loaders.stan and loaders.xmlstr. If however
the pattern its self uses the same macro, I get a recursion error in
loaders.xmlstr only. eg

&lt;div n:pattern=&quot;body&quot;&gt;
	&lt;div n:macro=&quot;pattern menu&quot;&gt;
		&lt;ul&gt;
			&lt;li&gt;Default menu&lt;/li&gt;
		&lt;/ul&gt;
	&lt;/div&gt;
	&lt;p&gt;Page specific Text&lt;/p&gt;
&lt;/div&gt;

I can understand why this might cause recursion, and i have managed to
fix it in my app by adding checks to the macro method. I just don't
understand why the xml and stan loaders don't behave the same. I have
tried to isolate where the recursion starts and it seems to be in
loaders.xmlstr.load (~L200):
doc = flatsax.parseString(self.template, self.ignoreDocType,
self.ignoreComment)
# recursion seems to start here.
doc = flat.precompile(doc, ctx)

...I can't work out how the stan version prevents the recursion though.

Has anyone come across this before? Is it a bug or just an unsupported
use of macros? If anyone has any ideas, I'd be grateful.

I hope to post a fuller example of what I'm trying to achieve with this
later. Something like what I remember of Zope, where child pages can
inherit page patterns from parent pages.
-- 
Richard Wall

</PRE>
































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002273.html">[Twisted-web] simple registry failure - __adapt__
</A></li>
	<LI>Next message: <A HREF="002427.html">[Twisted-web] Web Shop (e-commerce)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2274">[ date ]</a>
              <a href="thread.html#2274">[ thread ]</a>
              <a href="subject.html#2274">[ subject ]</a>
              <a href="author.html#2274">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
