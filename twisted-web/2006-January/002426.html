<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] how to send parallel requests to the dbms while
	rendering html with Cheetah
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20how%20to%20send%20parallel%20requests%20to%20the%20dbms%20while%0A%09rendering%20html%20with%20Cheetah&In-Reply-To=20060123000342.GT20603%40opteron.random">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002425.html">
   <LINK REL="Next"  HREF="002428.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] how to send parallel requests to the dbms while
	rendering html with Cheetah</H1>
    <B>Jean-Paul Calderone</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20how%20to%20send%20parallel%20requests%20to%20the%20dbms%20while%0A%09rendering%20html%20with%20Cheetah&In-Reply-To=20060123000342.GT20603%40opteron.random"
       TITLE="[Twisted-web] how to send parallel requests to the dbms while
	rendering html with Cheetah">exarkun at divmod.com
       </A><BR>
    <I>Sun Jan 22 17:46:39 MST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="002425.html">[Twisted-web] how to send parallel requests to the dbms while
	rendering html with Cheetah
</A></li>
        <LI>Next message: <A HREF="002428.html">[Twisted-web] how to send parallel requests to the dbms while
	rendering html with Cheetah
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2426">[ date ]</a>
              <a href="thread.html#2426">[ thread ]</a>
              <a href="subject.html#2426">[ subject ]</a>
              <a href="author.html#2426">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Mon, 23 Jan 2006 01:03:42 +0100, Andrea Arcangeli &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">andrea at cpushare.com</A>&gt; wrote:
&gt;<i>Hello,
</I>&gt;<i>
</I>&gt;<i>With Cheetah I have full control on the serialization or parallelism of
</I>&gt;<i>my queries and thanks to a real dbms I can execute very expensive
</I>&gt;<i>queries in parallel on multiple cpus with just a small change:
</I>&gt;<i>
</I>&gt;<i> [snip big diff]
</I>&gt;<i>
</I>&gt;<i>I've an old (slow) 2-way smp server, and by sending (readonly) queries
</I>&gt;<i>to postgresql in parallel I just reduce the time it takes to render the
</I>&gt;<i>usual klive pages from 2.9sec to 1.49sec (2 cpus working at 100%
</I>&gt;<i>executes the queries in parallel and so the results now arrives in
</I>&gt;<i>_exactly_ half the time, postgresql is really scaling perfectly in this
</I>&gt;<i>test). This new smp improvement comes after the huge boost I had after
</I>&gt;<i>moving from Nevow to Cheetah for the rendering of the html (from &gt;5.9sec
</I>&gt;<i>to 2.9sec). On my 4-way dualcore opteron desktop the rendering time
</I>&gt;<i>changes from ~1sec to ~370msec.
</I>&gt;<i>
</I>&gt;<i>So the overall since I started migrating to Cheetah, the time it takes
</I>&gt;<i>to render the klive homepage went down from 5.9sec (old
</I>&gt;<i>nevow+twisted.web code) to 1.5sec (new cheetah+twisted.web2 code). A
</I>&gt;<i>~300% performance improvement in rendering pages isn't bad. The code is
</I>&gt;<i>almost unchanged, just the html rendering model has changed.
</I>&gt;<i>
</I>&gt;<i>This is just to share my real life experience and perhaps this could be
</I>&gt;<i>useful to others.
</I>&gt;<i>
</I>&gt;<i>Now the 1.5sec are almost all spent waiting the sql queries and anyway
</I>&gt;<i>both cpus are fully utilized (Cheetah renders the first #blocks while
</I>&gt;<i>the other cpu calculates the results for the next block in parallel), so
</I>&gt;<i>there's probably not much left to optimize (nothing as easy as the
</I>&gt;<i>changes I did in the last days to move from 5.9sec to 1.5sec at least).
</I>&gt;<i>
</I>
That's great, Andrea.

&gt;<i>Parallel expensive queries to the db, is something that the axiom model
</I>&gt;<i>will never be able to achieve (as long as the api isn't changed to
</I>&gt;<i>return deferreds to allow real dbms instead of sqllite, which means all
</I>&gt;<i>code written today for the current axiom API will have to changed
</I>&gt;<i>significantly). Having to schedule to another context while waiting the
</I>&gt;<i>deferred to fire, may open a window for for race conditions too,
</I>&gt;<i>and have fun writing unit-test verifying race conditions.
</I>&gt;<i>
</I>&gt;<i>While you can scale the network load by running multiple twisted
</I>&gt;<i>servers, you can't scale the db queries coming from different twisted
</I>&gt;<i>servers in parallel with the axiom API. This ignoring the fact nevow
</I>&gt;<i>doesn't contemplates the possibility of sending all queries in parallel.
</I>
I don't understand why you insist on continuing to harp on this point, though.  Even if it were accurate (which I must stress, it /isn't/, and if you care to discuss the technical merits of Axiom, I'd be happy to do so on &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">divmod-dev at divmod.org</A>&gt; but /not/ here), no one cares.  You've been asked repeatedly to let it go, and by refusing to do so you are being very rude to the people who wrote the software you continue to use.  Please, you do your thing, let us do ours.

Jean-Paul

</PRE>






<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002425.html">[Twisted-web] how to send parallel requests to the dbms while
	rendering html with Cheetah
</A></li>
	<LI>Next message: <A HREF="002428.html">[Twisted-web] how to send parallel requests to the dbms while
	rendering html with Cheetah
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2426">[ date ]</a>
              <a href="thread.html#2426">[ thread ]</a>
              <a href="subject.html#2426">[ subject ]</a>
              <a href="author.html#2426">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
