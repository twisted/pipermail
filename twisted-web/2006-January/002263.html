<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] Re: [Nevow-commits] r3904 - server-side (fragment)
 nesting, and convenience descriptor generator
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Re%3A%20%5BNevow-commits%5D%20r3904%20-%20server-side%20%28fragment%29%0A%20nesting%2C%20and%20convenience%20descriptor%20generator&In-Reply-To=E1Eu2Qr-00017B-Tx%40divmod.org">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002262.html">
   <LINK REL="Next"  HREF="002264.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] Re: [Nevow-commits] r3904 - server-side (fragment)
 nesting, and convenience descriptor generator</H1>
    <B>Matt Goodall</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Re%3A%20%5BNevow-commits%5D%20r3904%20-%20server-side%20%28fragment%29%0A%20nesting%2C%20and%20convenience%20descriptor%20generator&In-Reply-To=E1Eu2Qr-00017B-Tx%40divmod.org"
       TITLE="[Twisted-web] Re: [Nevow-commits] r3904 - server-side (fragment)
 nesting, and convenience descriptor generator">matt at pollenation.net
       </A><BR>
    <I>Wed Jan  4 03:45:13 MST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="002262.html">[Twisted-web] XForms HTTP POST with twisted web ?
</A></li>
        <LI>Next message: <A HREF="002264.html">[Twisted-web] Re: [Nevow-commits] r3904 - server-side (fragment)
	nesting, and convenience descriptor generator
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2263">[ date ]</a>
              <a href="thread.html#2263">[ thread ]</a>
              <a href="subject.html#2263">[ subject ]</a>
              <a href="author.html#2263">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi all,

I really don't see any benefit in introducing a Nevow dependency on
Epsilon for this change.

In fact, the whole epsilon.descriptor module looks a little pointless to
me. All it does, AFAICT, is make something that's a property not look
like a property anymore and *maybe* adds an extra method call per
property access (I'm not sure how the standard property() is implemented
so perhaps they're the same in the end).

For those who don't want to read the changeset, but have valid comments,
here are some example uses:

Epsilon-dependent way:

    from epsilon import descriptor

    class Foo(object):
        _foo = 0
        class foo(descriptor.attribute):
            def get(self):
                return self._foo

+ Ha ha, fooled you ... I can't think of any ;-)
- Obfuscated
- Extra method call per property access ?

Normal way:

    class Foo(object):
        _foo = 0
        def getFoo(self):
            return self._foo
        foo = property(getFoo)

+ Obvious
+ Definitely no extra method call
+ Also provides a getFoo method (why do people insist on hiding them?)

Normal way but with a hidden getter method:

    class Foo(object):
        _foo = 0
        def foo():
            def get(self):
                return self._foo
            return property(get)
        foo = foo()

+ Still fairly obvious
+ Hides the foo get method without meta magic
+ Definitely no extra method call


My feelings are probably fairly obvious ;-) but what do others in the
Divmod community think?


Note: I have absolutely no objection to packages dependencies when
useful. I just don't think this qualifies as useful at all.


- Matt


Glyph Lefkowitz wrote:
&gt;<i> MIME-Version: 1.0
</I>&gt;<i> Content-Type: text/plain; charset=UTF-8
</I>&gt;<i> 
</I>&gt;<i> Author: glyph
</I>&gt;<i> Date: Wed Jan  4 01:47:36 2006
</I>&gt;<i> New Revision: 3904
</I>&gt;<i> 
</I>&gt;<i> Added:
</I>&gt;<i>    branches/signup-config-464-9/Epsilon/epsilon/descriptor.py
</I>&gt;<i>    branches/signup-config-464-9/Epsilon/epsilon/test/test_descriptor.py
</I>&gt;<i> Modified:
</I>&gt;<i>    branches/signup-config-464-9/Nevow/nevow/athena.py
</I>&gt;<i>    branches/signup-config-464-9/Nevow/nevow/test/test_athena.py
</I>&gt;<i> Log:
</I>&gt;<i> server-side (fragment) nesting, and convenience descriptor generator
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> Modified: branches/signup-config-464-9/Nevow/nevow/athena.py
</I>&gt;<i> ==============================================================================
</I>&gt;<i> --- branches/signup-config-464-9/Nevow/nevow/athena.py	(original)
</I>&gt;<i> +++ branches/signup-config-464-9/Nevow/nevow/athena.py	Wed Jan  4 01:47:36 2006
</I>&gt;<i> @@ -320,7 +320,7 @@
</I>&gt;<i>      def _newClientID(self):
</I>&gt;<i>          return guard._sessionCookie()
</I>&gt;<i>  
</I>&gt;<i> -
</I>&gt;<i> +from epsilon import descriptor
</I>&gt;<i>  
</I>&gt;<i>  class LivePage(rend.Page):
</I>&gt;<i>      transportFactory = LivePageTransport
</I>&gt;<i> @@ -347,6 +347,10 @@
</I>&gt;<i>      # bugs.
</I>&gt;<i>      TRANSPORT_IDLE_TIMEOUT = 300
</I>&gt;<i>  
</I>&gt;<i> +    class page(descriptor.attribute):
</I>&gt;<i> +        def get(self):
</I>&gt;<i> +            return self
</I>&gt;<i> +
</I>&gt;<i>      def __init__(self, iface=None, rootObject=None, jsModules=None, jsModuleRoot=None, *a, **kw):
</I>&gt;<i>          super(LivePage, self).__init__(*a, **kw)
</I>&gt;<i>  
</I>&gt;<i> @@ -356,6 +360,7 @@
</I>&gt;<i>              jsModules = JSPackage(jsDeps.mapping)
</I>&gt;<i>          self.jsModules = jsModules
</I>&gt;<i>          self.jsModuleRoot = jsModuleRoot
</I>&gt;<i> +        self.liveFragmentChildren = []
</I>&gt;<i>          self._includedModules = ['MochiKit', 'Divmod', 'Nevow.Athena']
</I>&gt;<i>  
</I>&gt;<i>  
</I>&gt;<i> @@ -612,12 +617,43 @@
</I>&gt;<i>  
</I>&gt;<i>      jsClass = u'Nevow.Athena.Widget'
</I>&gt;<i>  
</I>&gt;<i> +    def __init__(self, *a, **k):
</I>&gt;<i> +        super(LiveFragment, self).__init__(*a, **k)
</I>&gt;<i> +        self.liveFragmentChildren = []
</I>&gt;<i> +
</I>&gt;<i>      def rend(self, context, data):
</I>&gt;<i>          self._athenaID = self.page.addLocalObject(self)
</I>&gt;<i>          context.fillSlots('athena:id', self._athenaID)
</I>&gt;<i>          return super(LiveFragment, self).rend(context, data)
</I>&gt;<i>  
</I>&gt;<i>  
</I>&gt;<i> +    def setFragmentParent(self, fragmentParent):
</I>&gt;<i> +        &quot;&quot;&quot;
</I>&gt;<i> +        Sets the L{LiveFragment} (or L{LivePage}) which is the logical parent
</I>&gt;<i> +        of this fragment.  This should parallel the client-side hierarchy.
</I>&gt;<i> +
</I>&gt;<i> +        All LiveFragments must have setFragmentParent called on them before
</I>&gt;<i> +        they are rendered for the client; otherwise, they will be unable to
</I>&gt;<i> +        properly hook up to the page.
</I>&gt;<i> +
</I>&gt;<i> +        LiveFragments should have their own setFragmentParent called before
</I>&gt;<i> +        calling setFragmentParent on any of their own children.  The normal way
</I>&gt;<i> +        to accomplish this is to instantiate your fragment children during the
</I>&gt;<i> +        render pass.
</I>&gt;<i> +
</I>&gt;<i> +        If that isn't feasible, instead override setFragmentParent and
</I>&gt;<i> +        instantiate your children there.
</I>&gt;<i> +
</I>&gt;<i> +        This architecture might seem contorted, but what it allows that is
</I>&gt;<i> +        interesting is adaptation of foreign objects to LiveFragment.  Anywhere
</I>&gt;<i> +        you adapt to LiveFragment, setFragmentParent is the next thing that
</I>&gt;<i> +        should be called.
</I>&gt;<i> +        &quot;&quot;&quot;
</I>&gt;<i> +        self.fragmentParent = fragmentParent
</I>&gt;<i> +        self.page = fragmentParent.page
</I>&gt;<i> +        fragmentParent.liveFragmentChildren.append(self)
</I>&gt;<i> +
</I>&gt;<i> +
</I>&gt;<i>      def _getModuleForClass(self):
</I>&gt;<i>          return jsDeps.getModuleForClass(self.jsClass)
</I>&gt;<i>  
</I>&gt;<i> 
</I>&gt;<i> Modified: branches/signup-config-464-9/Nevow/nevow/test/test_athena.py
</I>&gt;<i> ==============================================================================
</I>&gt;<i> --- branches/signup-config-464-9/Nevow/nevow/test/test_athena.py	(original)
</I>&gt;<i> +++ branches/signup-config-464-9/Nevow/nevow/test/test_athena.py	Wed Jan  4 01:47:36 2006
</I>&gt;<i> @@ -68,3 +68,27 @@
</I>&gt;<i>                  # All dependencies should be loaded before the module
</I>&gt;<i>                  # that depends upon them.
</I>&gt;<i>                  self.failUnless(allDeps.index(d) &lt; allDeps.index(m))
</I>&gt;<i> +
</I>&gt;<i> +class TestFragment(athena.LiveFragment):
</I>&gt;<i> +    pass
</I>&gt;<i> +
</I>&gt;<i> +class Nesting(unittest.TestCase):
</I>&gt;<i> +
</I>&gt;<i> +    def testFragmentNesting(self):
</I>&gt;<i> +        lp = athena.LivePage()
</I>&gt;<i> +        tf1 = TestFragment()
</I>&gt;<i> +        tf2 = TestFragment()
</I>&gt;<i> +
</I>&gt;<i> +        tf1.setFragmentParent(lp)
</I>&gt;<i> +        tf2.setFragmentParent(tf1)
</I>&gt;<i> +
</I>&gt;<i> +        self.assertEquals(lp.liveFragmentChildren, [tf1])
</I>&gt;<i> +        self.assertEquals(tf1.liveFragmentChildren, [tf2])
</I>&gt;<i> +        self.assertEquals(tf2.liveFragmentChildren, [])
</I>&gt;<i> +        self.assertEquals(tf2.fragmentParent, tf1)
</I>&gt;<i> +        self.assertEquals(tf1.fragmentParent, lp)
</I>&gt;<i> +
</I>&gt;<i> +        self.assertEquals(tf2.page, lp)
</I>&gt;<i> +        self.assertEquals(tf1.page, lp)
</I>&gt;<i> +
</I>&gt;<i> +
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Nevow-commits mailing list
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">Nevow-commits at divmod.org</A>
</I>&gt;<i> <A HREF="http://divmod.org/users/mailman.twistd/listinfo/nevow-commits">http://divmod.org/users/mailman.twistd/listinfo/nevow-commits</A>
</I>
-- 
     __
    /  \__     Matt Goodall, Pollenation Internet Ltd
    \__/  \    w: <A HREF="http://www.pollenation.net">http://www.pollenation.net</A>
  __/  \__/    e: <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">matt at pollenation.net</A>
 /  \__/  \    t: +44 (0)113 2252500
 \__/  \__/
 /  \          Any views expressed are my own and do not necessarily
 \__/          reflect the views of my employer.

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002262.html">[Twisted-web] XForms HTTP POST with twisted web ?
</A></li>
	<LI>Next message: <A HREF="002264.html">[Twisted-web] Re: [Nevow-commits] r3904 - server-side (fragment)
	nesting, and convenience descriptor generator
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2263">[ date ]</a>
              <a href="thread.html#2263">[ thread ]</a>
              <a href="subject.html#2263">[ subject ]</a>
              <a href="author.html#2263">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
