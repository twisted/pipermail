<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] simple registry failure - __adapt__
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20simple%20registry%20failure%20-%20__adapt__&In-Reply-To=b89831b80601071048y7a3067d1h632d0ede1d472c7d%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002271.html">
   <LINK REL="Next"  HREF="002273.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] simple registry failure - __adapt__</H1>
    <B>Jean-Paul Calderone</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20simple%20registry%20failure%20-%20__adapt__&In-Reply-To=b89831b80601071048y7a3067d1h632d0ede1d472c7d%40mail.gmail.com"
       TITLE="[Twisted-web] simple registry failure - __adapt__">exarkun at divmod.com
       </A><BR>
    <I>Sat Jan  7 12:01:59 MST 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="002271.html">[Twisted-web] simple registry failure - __adapt__
</A></li>
        <LI>Next message: <A HREF="002273.html">[Twisted-web] simple registry failure - __adapt__
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2272">[ date ]</a>
              <a href="thread.html#2272">[ thread ]</a>
              <a href="subject.html#2272">[ subject ]</a>
              <a href="author.html#2272">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Sat, 7 Jan 2006 13:48:43 -0500, charlie detar &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">chazen at gmail.com</A>&gt; wrote:
&gt;<i>Hi,
</I>&gt;<i>
</I>&gt;<i>I noticed an email from Dickon Reed referencing this issue last June
</I>&gt;<i>(<A HREF="http://twistedmatrix.com/pipermail/twisted-web/2005-June/001536.html">http://twistedmatrix.com/pipermail/twisted-web/2005-June/001536.html</A>),
</I>&gt;<i>but there is no reply in the archives - I was wondering if someone had
</I>&gt;<i>discovered a solution?
</I>&gt;<i>
</I>&gt;<i>I am attempting to write a simple rpi script which uses a registry, as
</I>&gt;<i>described in the documentation:
</I>&gt;<i><A HREF="http://twistedmatrix.com/projects/web/documentation/howto/using-twistedweb.html#auto17">http://twistedmatrix.com/projects/web/documentation/howto/using-twistedweb.html#auto17</A>
</I>&gt;<i>
</I>&gt;<i>My rpy script is as follows:
</I>&gt;<i>----
</I>&gt;<i>from twisted.web import resource
</I>&gt;<i>
</I>&gt;<i>class Counter:
</I>&gt;<i>    def __init__(self):
</I>&gt;<i>        self.value = 0
</I>&gt;<i>    def increment(self):
</I>&gt;<i>        self.value += 1
</I>&gt;<i>    def getValue(self):
</I>&gt;<i>        return self.value
</I>&gt;<i>
</I>&gt;<i>counter = registry.getComponent(Counter)
</I>&gt;<i>if not counter:
</I>&gt;<i>   registry.setComponent(Counter, Counter())
</I>&gt;<i>counter = registry.getComponent(Counter)
</I>&gt;<i>
</I>&gt;<i>class MyResource(resource.Resource):
</I>&gt;<i>    def render_GET(self, request):
</I>&gt;<i>        counter.increment()
</I>&gt;<i>        return &quot;you are visitor %d&quot; % counter.getValue()
</I>&gt;<i>
</I>&gt;<i>resource = MyResource()
</I>&gt;<i>----
</I>
The component registry is not intended as a dumping ground for 
random global variables.  I am not sure if the particular usage 
above was ever supported behavior (I am inclined to think not, 
but tpc was some heinous stuff, so who knows), but it is definitely 
no longer supported.

Replace the argument to getComponent and the first argument to 
setComponent with an interface (a subclass of zope.interface.Interface),
or just skip components entirely and use a boring dictionary:

import myproject
counter = myproject.globals.get(Counter, None)
if counter is None:
    counter = myproject.globals[Counter] = Counter()

Hope this helps,

Jean-Paul

</PRE>































<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002271.html">[Twisted-web] simple registry failure - __adapt__
</A></li>
	<LI>Next message: <A HREF="002273.html">[Twisted-web] simple registry failure - __adapt__
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2272">[ date ]</a>
              <a href="thread.html#2272">[ thread ]</a>
              <a href="subject.html#2272">[ subject ]</a>
              <a href="author.html#2272">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
