<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] asynchronous WSGI implementation
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20asynchronous%20WSGI%20implementation&In-Reply-To=20100409125950.2779.837503704.divmod.xquotient.184%40localhost.localdomain">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004458.html">
   <LINK REL="Next"  HREF="004461.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] asynchronous WSGI implementation</H1>
    <B>Manlio Perillo</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20asynchronous%20WSGI%20implementation&In-Reply-To=20100409125950.2779.837503704.divmod.xquotient.184%40localhost.localdomain"
       TITLE="[Twisted-web] asynchronous WSGI implementation">manlio_perillo at libero.it
       </A><BR>
    <I>Fri Apr  9 10:33:22 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="004458.html">[Twisted-web] asynchronous WSGI implementation
</A></li>
        <LI>Next message: <A HREF="004461.html">[Twisted-web] asynchronous WSGI implementation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4459">[ date ]</a>
              <a href="thread.html#4459">[ thread ]</a>
              <a href="subject.html#4459">[ subject ]</a>
              <a href="author.html#4459">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE><A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">exarkun at twistedmatrix.com</A> ha scritto:
&gt;<i> On 10:32 am, <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">manlio_perillo at libero.it</A> wrote:
</I>&gt;&gt;<i> Hi.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I have started to write an asynchronous WSGI implementation for
</I>&gt;&gt;<i> Twisted Web.
</I>&gt;&gt;<i>
</I>&gt;<i> [...]
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> I have some questions:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> * What's the use of
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>     __metaclass__ = type
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>   in twisted.web.wsgi ?
</I>&gt;<i> 
</I>&gt;<i> This makes all classes without a base class defined in the module new-
</I>&gt;<i> style.
</I>
Ok.

Then I assume it is safe to remove it, and derive every class from object.

&gt;&gt;<i> * Is request.content always buffered (in memory or temporary file)?
</I>&gt;<i> 
</I>&gt;<i> It's always buffered, in memory if it is small, in a temporary file if
</I>&gt;<i> it is large (same rules as for a normal request in Twisted Web).  
</I>
Good.
It is the same with Nginx.

&gt;<i> [...]
</I>
&gt;&gt;<i> * In my ngx_http_wsgi_module, when the yielded string can not be sent to
</I>&gt;&gt;<i>  the client (because OS buffer is full), I suspend the execution of the
</I>&gt;&gt;<i>  application, and resume it when the socket is ready.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>  I want to do the same with Twisted, and the way to go is to be a
</I>&gt;&gt;<i>  push producer.
</I>&gt;&gt;<i>
</I>&gt;&gt;<i>  However I don't know how to implement and use the IPushProducer
</I>&gt;&gt;<i>  interface for _WSGIResponse.
</I>&gt;<i> 
</I>&gt;<i> The request object has a register producer method.  What else are you
</I>&gt;<i> having trouble with?
</I>
I was just not sure if I just have to call registerProducer.

I have implemented it:
<A HREF="http://hg.mperillo.ath.cx/twisted/twsgi/rev/22738dce8721">http://hg.mperillo.ath.cx/twisted/twsgi/rev/22738dce8721</A>

Now the WSGI implementation is complete.

Still not sure if I should call unregisterProducer in the case
notifyFinish callback is called.
It seems that it is not required.


&gt;&gt;<i>
</I>&gt;&gt;<i> By the way: it seems that the WSGI implementation in Twisted Web has
</I>&gt;&gt;<i> some bugs:
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> * close method of the application iterator is not called in case of
</I>&gt;&gt;<i>  errors
</I>&gt;<i> 
</I>&gt;<i> This looks like a bug that should be fixed.
</I>
I will open a ticket, unless someone else already opened it.

&gt;&gt;<i> * _sendResponseHeaders does not check if start_response has been called
</I>&gt;<i> 
</I>&gt;<i> What are the practical consequences of this?
</I>&gt;<i> 
</I>
That in case WSGI application does not call start_response,
_sendResponseHeaders will fail with an AttributeError, since self.status
is not available.


Thanks  Manlio

</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004458.html">[Twisted-web] asynchronous WSGI implementation
</A></li>
	<LI>Next message: <A HREF="004461.html">[Twisted-web] asynchronous WSGI implementation
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4459">[ date ]</a>
              <a href="thread.html#4459">[ thread ]</a>
              <a href="subject.html#4459">[ subject ]</a>
              <a href="author.html#4459">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
