<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] Multiple choices
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Multiple%20choices&In-Reply-To=11B9E077-A80C-11D8-AAA1-000A95864FC4%40ulaluma.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000436.html">
   <LINK REL="Next"  HREF="000440.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] Multiple choices</H1>
    <B>Justin Johnson</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Multiple%20choices&In-Reply-To=11B9E077-A80C-11D8-AAA1-000A95864FC4%40ulaluma.com"
       TITLE="[Twisted-web] Multiple choices">justinjohnson at gmail.com
       </A><BR>
    <I>Mon May 17 09:15:02 MDT 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="000436.html">[Twisted-web] Multiple choices
</A></li>
        <LI>Next message: <A HREF="000440.html">[Twisted-web] ProcessMethodBinding
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#437">[ date ]</a>
              <a href="thread.html#437">[ thread ]</a>
              <a href="subject.html#437">[ subject ]</a>
              <a href="author.html#437">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Here's an example of what I did to get a multiple choice select box. 
It's been a while since I did this so it could probably use some
cleanup.  But it is working for me.



class MultipleChoice(formless.Typed):
    &quot;&quot;&quot;Allow the user to pick from a list of &quot;choices&quot;, or a list of
choices found
    by accessing the list in the attribute &quot;choicesAttribute&quot; of the object we
    are configuring. The elements of the list will be rendered by calling the 
    function passed to stringify, which is by default &quot;str&quot;.
    &quot;&quot;&quot;
    def __init__(self, choices=None, choicesAttribute=None,
stringify=str, *args, **kw):
        formless.Typed.__init__(self, *args, **kw)
        if choices is None:
            self.choices = []
        else:
            self.choices = choices
        self.choicesAttribute = choicesAttribute
        self.stringify = stringify

    def coerceWithBinding(self, values, binding):
        &quot;&quot;&quot;Coerce a value with the help of an object, which is the object
        we are configuring.
        &quot;&quot;&quot;
        int_values = []
        try:
            for val in values:
                int_values.append(int(val))
        except ValueError:
            raise InputError(&quot;%s contains an invalid choice.&quot; % str(values))
        if self.choicesAttribute is not None:
            choices = getattr(binding, self.choicesAttribute)
        else:
            choices = self.choices
        return [choices[val] for val in int_values]


class MultipleChoiceInputProcessor(compy.Adapter):
    __implements__ = iformless.IInputProcessor,

    def process(self, context, boundTo, data):
        &quot;&quot;&quot;data is a list of strings at this point
        &quot;&quot;&quot;
        typed = self.original

        if data[0] == '':
            if typed.required:
                raise InputError(typed.requiredFailMessage)
            else:
                return []
        elif hasattr(typed, 'coerceWithBinding'):
            return typed.coerceWithBinding(data, boundTo)
        return typed.coerce(data)


class MultipleChoiceRenderer(webform.BaseInputRenderer):
    def input(self, context, slot, data, name, value):
        tv = data.typedValue
        if tv.choicesAttribute:
            choices = getattr(context.locate(formless.IConfigurable),
tv.choicesAttribute)
        else:
            choices = tv.choices

        numChoices = len(choices)
        if numChoices == 0:
            return None

        selecter = select(name=name, size=min(5,numChoices), multiple=1)
        stringify = tv.stringify

        for index, val in enumerate(choices):
            if val == value:
                selecter[option(value=str(index),
selected=&quot;selected&quot;)[stringify(val)]]
            else:
                selecter[option(value=str(index))[stringify(val)]]
        return slot[selecter]


class Sites(MultipleChoice):
    def __init__(self, choices=None, choicesAttribute=None,
stringify=str, *args, **kw):
        choices = SITES  # SITES is a list of strings
        MultipleChoice.__init__(self, choices, choicesAttribute,
stringify, *args, **kw)
        self.requiredFailMessage = &quot;Please select at least one site.&quot;

compy.registerAdapter(MultipleChoiceRenderer, MultipleChoice,
iformless.ITypedRenderer)
compy.registerAdapter(MultipleChoiceInputProcessor, MultipleChoice,
iformless.IInputProcessor)

compy.registerAdapter(MultipleChoiceRenderer, Sites, iformless.ITypedRenderer)
compy.registerAdapter(MultipleChoiceInputProcessor, Sites,
iformless.IInputProcessor)


On Mon, 17 May 2004 10:11:19 -0400, Donovan Preston &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">dp at ulaluma.com</A>&gt; wrote:
&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> On May 17, 2004, at 9:41 AM, vicky wrote:
</I>&gt;<i> 
</I>&gt;<i> &gt;          I'm working on forms with nevow. I would like to know if it's
</I>&gt;<i> &gt; possible to use multiple choices with ChoiceRenderer. I noticed that
</I>&gt;<i> &gt; the
</I>&gt;<i> &gt; multiple choices are not available because the class ProcessTyped
</I>&gt;<i> &gt; return
</I>&gt;<i> &gt; data[0] and not the complete list data. I know that I could create my
</I>&gt;<i> &gt; own
</I>&gt;<i> &gt; classes and functions but I wanted to know if it was already possible
</I>&gt;<i> &gt; to do
</I>&gt;<i> &gt; it.
</I>&gt;<i> 
</I>&gt;<i> No, currently there are no implementations of a multiple choice ui and
</I>&gt;<i> form handling, I just haven't had the need for it. Patches would be
</I>&gt;<i> welcome.
</I>&gt;<i> 
</I>&gt;<i> dp
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-web mailing list
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">Twisted-web at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web</A>
</I>&gt;<i>
</I>
</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000436.html">[Twisted-web] Multiple choices
</A></li>
	<LI>Next message: <A HREF="000440.html">[Twisted-web] ProcessMethodBinding
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#437">[ date ]</a>
              <a href="thread.html#437">[ thread ]</a>
              <a href="subject.html#437">[ subject ]</a>
              <a href="author.html#437">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
