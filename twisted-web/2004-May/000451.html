<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] IRedirectAfterPost
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20IRedirectAfterPost&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000455.html">
   <LINK REL="Next"  HREF="000453.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] IRedirectAfterPost</H1>
    <B>vicky</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20IRedirectAfterPost&In-Reply-To="
       TITLE="[Twisted-web] IRedirectAfterPost">vlupien at drummonddesigns.com
       </A><BR>
    <I>Thu May 27 08:34:40 MDT 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="000455.html">[Twisted-web] IRedirectAfterPost
</A></li>
        <LI>Next message: <A HREF="000453.html">[Twisted-web] IRedirectAfterPost
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#451">[ date ]</a>
              <a href="thread.html#451">[ thread ]</a>
              <a href="subject.html#451">[ subject ]</a>
              <a href="author.html#451">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

I finally found where the probleme is. It's in the file Rend.py and in the
locateChild function of the class FreeformChildMixin.  The problem is the
content of context. To solve my problem, it was necessary to put
request.context automatically in context instead of verifying if the context
is empty. Otherwise the IRedirectAfterPost works once out of two.    

I would like to know if this change can cause many other problems and if it
is possible for you to change it directly in the code so when I'll update
nevow the change will be in it.

Here's the class with the modification I made:

class FreeformChildMixin:
    &quot;&quot;&quot;Mixin that handles locateChild for freeform segments.&quot;&quot;&quot;
    def locateChild(self, request, segments):
        ## The method or property name we are going to validate ainst/affect
        bindingName = None

        name = segments[0]
        if name.startswith('freeform_post!'):
            configurableName, bindingName = name.split('!')[1:3]
        elif name.startswith('freeform-action-post!'):
            configurableName, request.args['freeform-actee'] =
name.split('!')[1:3]
            bindingName = request.args['freeform-action'][0]
             
        if bindingName:

            #this is where I made my change
            #Instead of verifying if the ctx is empty, I automatically put
#request.context in ctx            
            ctx = request.context
            self.context = ctx
            ctx.remember(self, inevow.IResource)
            ctx.remember(request, inevow.IRequest)
            cf = iformless.IConfigurableFactory(self)
            c = cf.locateConfigurable(ctx, configurableName)
            return self.webFormPost(request, self, c, ctx, bindingName,
request.args)
        return NotFound


Thanks,

Vicky


</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000455.html">[Twisted-web] IRedirectAfterPost
</A></li>
	<LI>Next message: <A HREF="000453.html">[Twisted-web] IRedirectAfterPost
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#451">[ date ]</a>
              <a href="thread.html#451">[ thread ]</a>
              <a href="subject.html#451">[ subject ]</a>
              <a href="author.html#451">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
