<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] Enforcing SSL for non-SSL requests
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Enforcing%20SSL%20for%20non-SSL%20requests&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="001817.html">
   <LINK REL="Next"  HREF="001809.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] Enforcing SSL for non-SSL requests</H1>
    <B>Marek Habersack</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Enforcing%20SSL%20for%20non-SSL%20requests&In-Reply-To="
       TITLE="[Twisted-web] Enforcing SSL for non-SSL requests">grendel at caudium.net
       </A><BR>
    <I>Tue Aug  9 17:26:57 MDT 2005</I>
    <P><UL>
        <LI>Previous message: <A HREF="001817.html">[Twisted-web] twisted.web.xmlrpc.Proxy plus user and password
</A></li>
        <LI>Next message: <A HREF="001809.html">[Twisted-web] Enforcing SSL for non-SSL requests
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1808">[ date ]</a>
              <a href="thread.html#1808">[ thread ]</a>
              <a href="subject.html#1808">[ subject ]</a>
              <a href="author.html#1808">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello everybody,
 
  I'm trying to find a way for a Nevow-based application to enforce SSL
connection on the client when they come in using insecure HTTP. Currently
when the client comes in using a <A HREF="http://site.com">http://site.com</A> URL typed in the browser,
they will get no error and no response from the server as the connection is
closed. The application log reveals the following:

2005/08/09 12:12 CEST [HTTPChannel,0,127.0.0.1] Traceback (most recent call last):
 File &quot;/usr/local/lib/python2.4/site-packages/twisted/python/log.py&quot;, line 56, in callWithLogger
  return callWithContext({&quot;system&quot;: lp}, func, *args, **kw)
 File &quot;/usr/local/lib/python2.4/site-packages/twisted/python/log.py&quot;, line 41, in callWithContext
  return context.call({ILogContext: newCtx}, func, *args, **kw)
 File &quot;/usr/local/lib/python2.4/site-packages/twisted/python/context.py&quot;, line 31, in callWithContext
  return func(*args,**kw)
 File &quot;/usr/local/lib/python2.4/site-packages/twisted/internet/pollreactor.py&quot;, line 160, in _doReadOrWrite
  why = selectable.doRead()
 --- &lt;exception caught here&gt; ---
 File &quot;/usr/local/lib/python2.4/site-packages/twisted/internet/tcp.py&quot;, line 111, in doRead
  return Connection.doRead(self)
 File &quot;/usr/local/lib/python2.4/site-packages/twisted/internet/tcp.py&quot;, line 343, in doRead
  data = self.socket.recv(self.bufferSize)
 OpenSSL.SSL.Error: [('SSL routines', 'SSL23_GET_CLIENT_HELLO', 'http request')]

The error above is obvious and the solution would be to either redirect the
client to <A HREF="https://site.com">https://site.com</A> or present them with some information that the
site requires secure connections and have them click a link that would send
them to <A HREF="https://site.com.">https://site.com.</A> My meager knowledge of Twisted/Nevow tells me that
it isn't possible to subclass the Connection class to handle the situation
in some generic way without having to rewrite parts of Twisted. Ideally, it
should be possible to be able to handle that situation by either providing a
handler for the exception to the SSLServer object (which is the class I'm
using) or by subclassing SSLServer or, perhaps, by putting the code to
handle the situation deeper inside Twisted so that the solution is more
generic and not limited to SSLServer. It is entirely possible that such
solution already exists and I'm simply not aware of it :) - I would
appreciate any help/hints/pointers/rtfms on the issue,

tia,

marek
-------------- next part --------------
A non-text attachment was scrubbed...
Name: not available
Type: application/pgp-signature
Size: 189 bytes
Desc: Digital signature
Url : <A HREF="http://twistedmatrix.com/pipermail/twisted-web/attachments/20050810/22366205/attachment.bin">http://twistedmatrix.com/pipermail/twisted-web/attachments/20050810/22366205/attachment.bin</A>
</PRE>




<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="001817.html">[Twisted-web] twisted.web.xmlrpc.Proxy plus user and password
</A></li>
	<LI>Next message: <A HREF="001809.html">[Twisted-web] Enforcing SSL for non-SSL requests
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#1808">[ date ]</a>
              <a href="thread.html#1808">[ thread ]</a>
              <a href="subject.html#1808">[ subject ]</a>
              <a href="author.html#1808">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
