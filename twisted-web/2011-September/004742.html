<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] using @defer.inlineCallbacks and yield correctly
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20using%20%40defer.inlineCallbacks%20and%20yield%20correctly&In-Reply-To=CADozHMXLhaHPO4OVJN4ee%3Dhdi%2BRYhdXQ-eSLcz0wdUbc08aa%2BA%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004741.html">
   <LINK REL="Next"  HREF="004743.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] using @defer.inlineCallbacks and yield correctly</H1>
    <B>Reza Lotun</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20using%20%40defer.inlineCallbacks%20and%20yield%20correctly&In-Reply-To=CADozHMXLhaHPO4OVJN4ee%3Dhdi%2BRYhdXQ-eSLcz0wdUbc08aa%2BA%40mail.gmail.com"
       TITLE="[Twisted-web] using @defer.inlineCallbacks and yield correctly">rlotun at gmail.com
       </A><BR>
    <I>Thu Sep  1 03:31:27 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="004741.html">[Twisted-web] using @defer.inlineCallbacks and yield correctly
</A></li>
        <LI>Next message: <A HREF="004743.html">[Twisted-web] using @defer.inlineCallbacks and yield correctly
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4742">[ date ]</a>
              <a href="thread.html#4742">[ thread ]</a>
              <a href="subject.html#4742">[ subject ]</a>
              <a href="author.html#4742">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Stephan,


&gt;<i> from what I understand  @defer.inlineCallbacks is used to defer a
</I>&gt;<i> async callback function like how i'm using CallLater below, but where
</I>&gt;<i> is the yield supposed to be? and how should the below code change?
</I>&gt;<i>
</I>&gt;<i>
</I>The advantage defer.inlineCallbacks offers is allowing one to wait on the
result of a deferred inline, without having nested blocks and closures.

So a generic example could be:

Without inlinecallbacks:

def my_func():
    d = func_returnning_deferred()
    def handle_result(r):
        # do something with r
        ..
    d.addCallback(handle_result)
    return d

With inlineCallbacks:

@defer.inlineCallbacks
def my_func():
     r = yield func_returning_deferred()
     # do stuff with r

You can see that we don't have to have a nested block with an addCallback.
Here the yield returns the result that we'd get in our callback function (an
likewise if the errBack fired we've have to wrap that line in a try/except
to handle it).

Keep in mind however that @defer.inlineCallbacks can only wrap generators
(functions with a yield statement in it)


&gt;<i>    def connectionMade(self):
</I>&gt;<i>        logging.debug(&quot;connection made timeout = %d&quot;, self.timeout)
</I>&gt;<i>        @defer.inlineCallbacks
</I>&gt;<i>        def onTimer():
</I>&gt;<i>            logging.debug(&quot;timeout triggered&quot;)
</I>&gt;<i>            self.firefoxProcess.handleProcessTimedOut()
</I>&gt;<i>            self.killProcessIfAlive()
</I>&gt;<i>        d = reactor.callLater(self.timeout, onTimer)
</I>

You can see here that onTimer is not a generator (there's no yield) so
defer.inlineCallbacks cannot be applied to it. Also, based on what you're
doing you don't need it (i.e. you can just remove it).

Keep in mind that callLater doesn't return a deferred - it just schedules
onTimer to be called at a later time, which makes sense for what you are
doing. If for some reason you want a deferred, I'd take a look at
twisted.internet.task.deferLater.

Hope that helps,
Reza

-- 
Reza Lotun
mobile: +44 (0)7521 310 763
email:  <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">rlotun at gmail.com</A>
work:   <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">rlotun at twitter.com</A>
@rlotun
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://twistedmatrix.com/pipermail/twisted-web/attachments/20110901/e8879745/attachment.htm">http://twistedmatrix.com/pipermail/twisted-web/attachments/20110901/e8879745/attachment.htm</A> 
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004741.html">[Twisted-web] using @defer.inlineCallbacks and yield correctly
</A></li>
	<LI>Next message: <A HREF="004743.html">[Twisted-web] using @defer.inlineCallbacks and yield correctly
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4742">[ date ]</a>
              <a href="thread.html#4742">[ thread ]</a>
              <a href="subject.html#4742">[ subject ]</a>
              <a href="author.html#4742">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
