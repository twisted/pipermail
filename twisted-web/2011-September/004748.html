<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] CorePost - a tiny Flask-style REST microframework for twisted.web
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20CorePost%20-%20a%20tiny%20Flask-style%20REST%20microframework%0A%20for%20twisted.web&In-Reply-To=B32F69BC-4EDD-4700-A48C-E5E3D03DF58C%40twistedmatrix.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004747.html">
   <LINK REL="Next"  HREF="004749.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] CorePost - a tiny Flask-style REST microframework for twisted.web</H1>
    <B>Jacek Furmankiewicz</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20CorePost%20-%20a%20tiny%20Flask-style%20REST%20microframework%0A%20for%20twisted.web&In-Reply-To=B32F69BC-4EDD-4700-A48C-E5E3D03DF58C%40twistedmatrix.com"
       TITLE="[Twisted-web] CorePost - a tiny Flask-style REST microframework for twisted.web">jacek99 at gmail.com
       </A><BR>
    <I>Mon Sep  5 12:14:15 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="004747.html">[Twisted-web] CorePost - a tiny Flask-style REST microframework for twisted.web
</A></li>
        <LI>Next message: <A HREF="004749.html">[Twisted-web] CorePost - a tiny Flask-style REST microframework for twisted.web
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4748">[ date ]</a>
              <a href="thread.html#4748">[ thread ]</a>
              <a href="subject.html#4748">[ subject ]</a>
              <a href="author.html#4748">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi Glyph,

I looked at your suggestion, but unfortunately the implementation is very
complex, if not impossible.

The main problem is that
a) a class method with a decorator &quot;forgets&quot; its class, so it's impossible
from the decorator which class it belongs to.
The function has not been bound to a class yet when the decorator is called
for the first time, so there is no way for it to notify the containing class
that this function defines a route for it

b) is is next to impossible for a class to scan its own function and find
their decorators. I've seen some hacks on StackOverflow
where it actually parses the source code, but that is an ugly hack to say
the least (and probably prone to many bugs)

In general, it seems decorators on class methods are missing such crucial
functionality as finding out which class the method belongs to.
Sort of a key requirement, if you ask me (at least after lots of experience
with Java or .Net reflection, where getting this sort of info is trivial).

if you have any suggestions on how to accomplish your recommendation, I
would greatly appreciate it.

The decorator in question that I would need to take out of the CorePost
class and make it a standalone function looks like this:

    def
route(self,url,methods=(Http.GET,),accepts=MediaType.WILDCARD,produces=None,cache=True):
        &quot;&quot;&quot;Main decorator for registering REST functions &quot;&quot;&quot;
        def wrap(f,*args,**kwargs):
            self.__registerFunction(f, url, methods, accepts,
produces,cache)
            return f
        return wrap

it's obtaining the reference to 'self' when it is not a class method any
more is the problem. Not sure how to get around it.

Cheers,
Jacek

On Sun, Sep 4, 2011 at 12:01 AM, Glyph Lefkowitz &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">glyph at twistedmatrix.com</A>&gt;wrote:

&gt;<i>
</I>&gt;<i> On Sep 3, 2011, at 8:28 PM, Jacek Furmankiewicz wrote:
</I>&gt;<i>
</I>&gt;<i> Any feedback is welcome
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> Hi Jacek,
</I>&gt;<i>
</I>&gt;<i> Great to see more development going into Twisted-based web stuff! :)
</I>&gt;<i>
</I>&gt;<i> However, I do have one question.  Maybe I'm missing something about the way
</I>&gt;<i> Flask does things, but it seems very odd to me that the decorators you're
</I>&gt;<i> using are applied to global functions, rather than instances of an object.
</I>&gt;<i>  For example, instead of:
</I>&gt;<i>
</I>&gt;<i> app = CorePost()
</I>&gt;<i> ...
</I>&gt;<i> @app.route(&quot;/validate/&lt;int:rootId&gt;/schema&quot;,Http.POST)
</I>&gt;<i> @validate(schema=TestSchema)
</I>&gt;<i> def postValidateSchema(request,rootId,childId,**kwargs):
</I>&gt;<i>     '''Validate using a common schema'''
</I>&gt;<i>     return &quot;%s - %s - %s&quot; % (rootId,childId,kwargs)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> You could do:
</I>&gt;<i>
</I>&gt;<i> class MyPost(CorePost):
</I>&gt;<i>     @route(&quot;/validate/&lt;int:rootId&gt;/schema&quot;,Http.POST)
</I>&gt;<i>     @validate(schema=TestSchema)
</I>&gt;<i>     def postValidateSchema(self,request,rootId,childId,**kwargs):
</I>&gt;<i>         '''Validate using a common schema'''
</I>&gt;<i>         return &quot;%s - %s - %s&quot; % (rootId,childId,kwargs)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> This would allow for re-usable objects; for example, rather than having a
</I>&gt;<i> &quot;blog article create&quot; API (sorry for the uninspired example, it's late) for
</I>&gt;<i> your entire site, you would have a &quot;article create&quot; API on a &quot;Blog&quot;, which
</I>&gt;<i> would enable you to have multiple Blog objects (perhaps with different
</I>&gt;<i> authors, in different permission domains, etc).  This would also make
</I>&gt;<i> re-using the relevant objects between different applications easier.
</I>&gt;<i>
</I>&gt;<i> In other words, global variables are bad, and this looks like it depends
</I>&gt;<i> rather heavily on them.
</I>&gt;<i>
</I>&gt;<i> Any thoughts on this?  Am I missing the point?
</I>&gt;<i>
</I>&gt;<i> Thanks,
</I>&gt;<i>
</I>&gt;<i> -glyph
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-web mailing list
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">Twisted-web at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web</A>
</I>&gt;<i>
</I>&gt;<i>
</I>-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://twistedmatrix.com/pipermail/twisted-web/attachments/20110905/edc5a4f9/attachment.htm">http://twistedmatrix.com/pipermail/twisted-web/attachments/20110905/edc5a4f9/attachment.htm</A> 
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004747.html">[Twisted-web] CorePost - a tiny Flask-style REST microframework for twisted.web
</A></li>
	<LI>Next message: <A HREF="004749.html">[Twisted-web] CorePost - a tiny Flask-style REST microframework for twisted.web
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4748">[ date ]</a>
              <a href="thread.html#4748">[ thread ]</a>
              <a href="subject.html#4748">[ subject ]</a>
              <a href="author.html#4748">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
