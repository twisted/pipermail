<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] CorePost 0.0.7 - all about content types
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20CorePost%200.0.7%20-%20all%20about%20content%20types&In-Reply-To=20110930135509.2214.1539730898.divmod.xquotient.173%40localhost.localdomain">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004773.html">
   <LINK REL="Next"  HREF="004775.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] CorePost 0.0.7 - all about content types</H1>
    <B>Jaros&#322;aw Fedewicz</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20CorePost%200.0.7%20-%20all%20about%20content%20types&In-Reply-To=20110930135509.2214.1539730898.divmod.xquotient.173%40localhost.localdomain"
       TITLE="[Twisted-web] CorePost 0.0.7 - all about content types">jaroslaw.fedewicz at gmail.com
       </A><BR>
    <I>Fri Sep 30 11:55:56 EDT 2011</I>
    <P><UL>
        <LI>Previous message: <A HREF="004773.html">[Twisted-web] CorePost 0.0.7 - all about content types
</A></li>
        <LI>Next message: <A HREF="004775.html">[Twisted-web] CorePost 0.0.7 - all about content types
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4774">[ date ]</a>
              <a href="thread.html#4774">[ thread ]</a>
              <a href="subject.html#4774">[ subject ]</a>
              <a href="author.html#4774">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On Sep 30, 2011, at 16:55 , <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">exarkun at twistedmatrix.com</A> wrote:

&gt;<i> On 01:18 pm, <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">jacek99 at gmail.com</A> wrote:
</I>&gt;&gt;<i> And once I reach 0.1 with all of these features, I will post some blog
</I>&gt;&gt;<i> entries about this together with PyPy benchmarks...so that people don't
</I>&gt;&gt;<i> think
</I>&gt;&gt;<i> Javascript / Node.js is your only option when it comes to async I/O web
</I>&gt;&gt;<i> frameworks :-)
</I>&gt;&gt;<i> 
</I>&gt;&gt;<i> BTW, is there any progress on getting Twisted to install under PyPy in 
</I>&gt;&gt;<i> the
</I>&gt;&gt;<i> near future? I know you guys have been looking into it....
</I>&gt;<i> 
</I>&gt;<i> <A HREF="http://twistedmatrix.com/trac/ticket/5158">http://twistedmatrix.com/trac/ticket/5158</A> is resolved now.  If there are 
</I>&gt;<i> still problems with Twisted <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">trunk at HEAD</A> on PyPy, please let us know. :)
</I>&gt;<i> 
</I>
There are in fact some problems.

$ sudo pypy-c ./setup.py install
running install
running bdist_egg
running egg_info
writing top-level names to Twisted.egg-info/top_level.txt
writing requirements to Twisted.egg-info/requires.txt
writing dependency_links to Twisted.egg-info/dependency_links.txt
writing Twisted.egg-info/PKG-INFO
writing manifest file 'Twisted.egg-info/SOURCES.txt'
installing library code to build/bdist.macosx-10.6-i386/egg
running install_lib
running build_py
running build_ext
cc -arch i386 -fPIC -Wimplicit -I/opt/local/lib/pypy/include -c conftest.c -o conftest.o
building 'twisted.runner.portmap' extension
cc -arch i386 -fPIC -Wimplicit -I/opt/local/lib/pypy/include -c twisted/runner/portmap.c -o build/temp.macosx-10.6-i386-2.7/twisted/runner/portmap.o
twisted/runner/portmap.c:10:20: error: Python.h: No such file or directory
twisted/runner/portmap.c:14: error: expected &#8216;=&#8217;, &#8216;,&#8217;, &#8216;;&#8217;, &#8216;asm&#8217; or &#8216;__attribute__&#8217; before &#8216;*&#8217; token
twisted/runner/portmap.c:31: error: expected &#8216;=&#8217;, &#8216;,&#8217;, &#8216;;&#8217;, &#8216;asm&#8217; or &#8216;__attribute__&#8217; before &#8216;*&#8217; token
twisted/runner/portmap.c:45: error: expected &#8216;=&#8217;, &#8216;,&#8217;, &#8216;;&#8217;, &#8216;asm&#8217; or &#8216;__attribute__&#8217; before &#8216;PortmapMethods&#8217;
twisted/runner/portmap.c: In function &#8216;initportmap&#8217;:
twisted/runner/portmap.c:55: warning: implicit declaration of function &#8216;Py_InitModule&#8217;
twisted/runner/portmap.c:55: error: &#8216;PortmapMethods&#8217; undeclared (first use in this function)
twisted/runner/portmap.c:55: error: (Each undeclared identifier is reported only once
twisted/runner/portmap.c:55: error: for each function it appears in.)

I have PyPy 1.6 with cpyext.

This patch seems to fix the C extensions errors:

Index: twisted/topfiles/setup.py
===================================================================
--- twisted/topfiles/setup.py	(revision 32705)
+++ twisted/topfiles/setup.py	(working copy)
@@ -37,10 +37,11 @@
               condition=lambda _: _isCPython and sys.platform == &quot;win32&quot;),
 
     Extension(&quot;twisted.python._initgroups&quot;,
-              [&quot;twisted/python/_initgroups.c&quot;]),
+              [&quot;twisted/python/_initgroups.c&quot;],
+              condition=lambda _: _isCPython),
     Extension(&quot;twisted.internet._sigchld&quot;,
               [&quot;twisted/internet/_sigchld.c&quot;],
-              condition=lambda _: sys.platform != &quot;win32&quot;),
+              condition=lambda _: _isCPython and sys.platform != &quot;win32&quot;),
 ]
 
 # Figure out which plugins to include: all plugins except subproject ones
Index: twisted/runner/topfiles/setup.py
===================================================================
--- twisted/runner/topfiles/setup.py	(revision 32705)
+++ twisted/runner/topfiles/setup.py	(working copy)
@@ -1,6 +1,8 @@
 # Copyright (c) Twisted Matrix Laboratories.
 # See LICENSE for details.
 
+from twisted.python.dist import _isCPython
+
 try:
     from twisted.python.dist import setup, ConditionalExtension as Extension
 except ImportError:
@@ -11,7 +13,7 @@
 extensions = [
     Extension(&quot;twisted.runner.portmap&quot;,
               [&quot;twisted/runner/portmap.c&quot;],
-              condition=lambda builder: builder._check_header(&quot;rpc/rpc.h&quot;)),
+              condition=lambda builder: _isCPython and builder._check_header(&quot;rpc/rpc.h&quot;)),
 ]
 
 if __name__ == '__main__':


however, setuptools trigger GC mis(?)behaviour in PyPy and setup fails:

.... lots of logging snipped
Extracting Twisted-11.0.0_r32705-py2.7-macosx-10.6-i386.egg to /opt/local/lib/pypy/site-packages
error: /opt/local/lib/pypy/site-packages/Twisted-11.0.0_r32705-py2.7-macosx-10.6-i386.egg/twisted/enterprise/row.pyc: Too many open files

This error is known to PyPy guys, they, however, insist that setuptools are wrong and not them. Which sounds totally wrong to me, but again, who am I to judge.
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004773.html">[Twisted-web] CorePost 0.0.7 - all about content types
</A></li>
	<LI>Next message: <A HREF="004775.html">[Twisted-web] CorePost 0.0.7 - all about content types
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4774">[ date ]</a>
              <a href="thread.html#4774">[ thread ]</a>
              <a href="subject.html#4774">[ subject ]</a>
              <a href="author.html#4774">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
