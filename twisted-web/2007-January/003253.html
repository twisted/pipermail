<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] Progress on client POST methods
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Progress%20on%20client%20POST%20methods&In-Reply-To=1168191463.7709.4.camel%40blackadder">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003251.html">
   <LINK REL="Next"  HREF="003252.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] Progress on client POST methods</H1>
    <B>Jean-Paul Calderone</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Progress%20on%20client%20POST%20methods&In-Reply-To=1168191463.7709.4.camel%40blackadder"
       TITLE="[Twisted-web] Progress on client POST methods">exarkun at divmod.com
       </A><BR>
    <I>Sun Jan  7 12:00:35 CST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="003251.html">[Twisted-web] Progress on client POST methods
</A></li>
        <LI>Next message: <A HREF="003252.html">[Twisted-web] performance of web2
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3253">[ date ]</a>
              <a href="thread.html#3253">[ thread ]</a>
              <a href="subject.html#3253">[ subject ]</a>
              <a href="author.html#3253">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Sun, 07 Jan 2007 17:37:44 +0000, Ross Burton &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">ross at burtonini.com</A>&gt; wrote:
&gt;<i>Hi,
</I>&gt;<i>
</I>&gt;<i>I'm writing a Flickr upload tool[1] and would like to be able to show
</I>&gt;<i>the progress of the image upload.  Images are uploaded via HTTP POST:
</I>&gt;<i>
</I>&gt;<i>from twisted.web import client
</I>&gt;<i>...
</I>&gt;<i>return client.getPage(&quot;<A HREF="http://api.flickr.com/services/upload/&quot;,">http://api.flickr.com/services/upload/&quot;,</A>
</I>&gt;<i>                      method=&quot;POST&quot;,
</I>&gt;<i>                      headers=headers,
</I>&gt;<i>                      postdata=form)
</I>&gt;<i>
</I>&gt;<i>where form is the encoded title/tags/image data.  Is there a way to get
</I>&gt;<i>progress information from twisted.web.client?  If I'm uploading 4M
</I>&gt;<i>images the upload takes some time to complete, so I'd like to be able to
</I>&gt;<i>have a progress bar.
</I>
Take a look at twisted.web.client.HTTPPageGetter's implementation.  Note
the last thing it does in connectionMade:

    if data is not None:
        self.transport.write(data)

If you want progress reporting, then this is the code to fix in order to
get it.  Rather than writing all of the data at once, this code could use
a producer to write it approximately only as quickly as the peer reads it.
This will let you generate a progress report, since you can keep track of
how many bytes you have written and how many bytes are yet to be written.

Due to the factoring of this code, I don't really see any way to provide
this feature without at least copying all of the code in the existing
connectionMade method and then only changing the last two lines, unless you
refactor it to be more friendly to this use case and contribute a patch.
Such a patch would be welcome, though, if you choose to do this.

Some producer documentation is available here:

<A HREF="http://twistedmatrix.com/projects/core/documentation/howto/producers.html">http://twistedmatrix.com/projects/core/documentation/howto/producers.html</A>

&gt;<i>
</I>&gt;<i>Also, should I be using twisted.web2.client now, or is it still under
</I>&gt;<i>development?
</I>
It is still under development (like much of Twisted - but more likely to
change incompatibly than much of Twisted).

Jean-Paul

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003251.html">[Twisted-web] Progress on client POST methods
</A></li>
	<LI>Next message: <A HREF="003252.html">[Twisted-web] performance of web2
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3253">[ date ]</a>
              <a href="thread.html#3253">[ thread ]</a>
              <a href="subject.html#3253">[ subject ]</a>
              <a href="author.html#3253">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
