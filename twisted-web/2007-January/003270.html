<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] HTTP authentication and Nevow cred checker
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20HTTP%20authentication%20and%20Nevow%20cred%20checker&In-Reply-To=d3c7f2a50701290450j46bb43aif6537c0dede8dc2a%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="003269.html">
   
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] HTTP authentication and Nevow cred checker</H1>
    <B>Jean-Paul Calderone</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20HTTP%20authentication%20and%20Nevow%20cred%20checker&In-Reply-To=d3c7f2a50701290450j46bb43aif6537c0dede8dc2a%40mail.gmail.com"
       TITLE="[Twisted-web] HTTP authentication and Nevow cred checker">exarkun at divmod.com
       </A><BR>
    <I>Mon Jan 29 07:14:21 CST 2007</I>
    <P><UL>
        <LI>Previous message: <A HREF="003269.html">[Twisted-web] HTTP authentication and Nevow cred checker
</A></li>
        
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3270">[ date ]</a>
              <a href="thread.html#3270">[ thread ]</a>
              <a href="subject.html#3270">[ subject ]</a>
              <a href="author.html#3270">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Mon, 29 Jan 2007 13:50:06 +0100, KC Leong &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">mewanttowork at gmail.com</A>&gt; wrote:
&gt;<i>Hello,
</I>&gt;<i>
</I>&gt;<i>With Twisted and Nevow I'm building an XML-RPC server that does HTTP
</I>&gt;<i>authentication. So a basic XML-RPC client can login using
</I>&gt;<i><A HREF="https://user:passwd@host.">https://user:passwd@host.</A> I can get the credentials with HTTP
</I>&gt;<i>authentication, but how can I check the credentials. I'd tried calling
</I>&gt;<i>guard.SessionWrapper.login(....), but I get the error: 
</I>&gt;<i>&quot;exceptions.TypeError:
</I>&gt;<i>unbound method login() must be called with SessionWrapper instance as first
</I>&gt;<i>argument (got NevowRequest instance instead)&quot;.
</I>
As its name suggests, SessionWrapper is a wrapper.  You're not intended to
call unbound methods from it with instances of an unrelated class. ;)

&gt;<i>
</I>&gt;<i>So I'm guessing that request.getSession() is wrong and I must get the
</I>&gt;<i>session of the guard (or something similar). Or I'm calling the wrong
</I>&gt;<i>function to check the creds. In the guarded.py example from Nevow the
</I>&gt;<i>credentials get checked thru a html form, but that is not what I want.
</I>&gt;<i>
</I>&gt;<i>Below is an example part of my code:
</I>&gt;<i>
</I>&gt;<i>class RootPage(rend.Page):
</I>&gt;<i>    ## We are a directory-like resource because we are at the root
</I>&gt;<i>    addSlash = True
</I>&gt;<i>    ## Doesn't work
</I>&gt;<i>    def tryLogin(self, ctx, request):
</I>&gt;<i>        session =  request.getSession()
</I>&gt;<i>        segments = inevow.ICurrentSegments(ctx)
</I>&gt;<i>        httpAuthCredentials = (self.data_username,self.data_password)
</I>&gt;<i>        return guard.SessionWrapper.login(request, session,
</I>&gt;<i>httpAuthCredentials, segments).addCallback(self._loginSucceeded).addErrback(
</I>&gt;<i>self.loginFailed)
</I>&gt;<i>
</I>&gt;<i>    def renderHTTP(self, ctx):
</I>&gt;<i>        request = inevow.IRequest(ctx)
</I>&gt;<i>        username, password = request.getUser(), request.getPassword()
</I>&gt;<i>        ## No REAL authentication yet, must implement it.
</I>&gt;<i>        if (username, password) == ('', ''):
</I>&gt;<i>            request.setHeader('WWW-Authenticate', 'Basic
</I>&gt;<i>realm='+cfg.app_name)
</I>&gt;<i>            request.setResponseCode(http.UNAUTHORIZED)
</I>&gt;<i>            return &quot;Authentication required.&quot;
</I>&gt;<i>        ## They provided a username and password, so let's let them in!
</I>&gt;<i>horray
</I>&gt;<i>        self.data_username, self.data_password = username, password
</I>&gt;<i>
</I>&gt;<i>        self.tryLogin(ctx, request)
</I>&gt;<i>        return rend.Page.renderHTTP(self, ctx)
</I>&gt;<i>
</I>
All of this is unnecessary.  Get rid of it and instead, wrap your page in
a SessionWrapper and use the SessionWrapper as your resource.  Take a look
at &lt;<A HREF="http://divmod.org/trac/browser/trunk/Nevow/examples/guarded/guarded.py">http://divmod.org/trac/browser/trunk/Nevow/examples/guarded/guarded.py</A>&gt;,
particularly the createResource function at the end, which closely resembles
what you want to do instead of the above.

&gt;<i>    docFactory = loaders.stan(tags.html[
</I>&gt;<i>    tags.body[
</I>&gt;<i>        tags.h1[&quot;Welcome user!&quot;],
</I>&gt;<i>        tags.div[&quot;You said: &quot;,
</I>&gt;<i>            tags.span(data=tags.directive('username'), render=str),
</I>&gt;<i>            &quot; &quot;,
</I>&gt;<i>            tags.span(data=tags.directive('password'), render=str),
</I>&gt;<i>            tags.a(href=guard.LOGOUT_AVATAR)[&quot;Logout&quot;]
</I>&gt;<i>            ]]])
</I>
This stuff will then end up on the wrapped resource, and only be accessible
after SessionWrapper decides authentication has occurred.

Jean-Paul

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="003269.html">[Twisted-web] HTTP authentication and Nevow cred checker
</A></li>
	
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#3270">[ date ]</a>
              <a href="thread.html#3270">[ thread ]</a>
              <a href="subject.html#3270">[ subject ]</a>
              <a href="author.html#3270">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
