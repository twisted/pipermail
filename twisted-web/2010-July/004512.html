<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] Large file uploads
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Large%20file%20uploads&In-Reply-To=20100724035006.27251.1144516852.divmod.xquotient.144%40localhost.localdomain">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004511.html">
   <LINK REL="Next"  HREF="004504.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] Large file uploads</H1>
    <B>Julian Pietron</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Large%20file%20uploads&In-Reply-To=20100724035006.27251.1144516852.divmod.xquotient.144%40localhost.localdomain"
       TITLE="[Twisted-web] Large file uploads">julian at whisper-net.de
       </A><BR>
    <I>Sat Jul 24 08:32:24 EDT 2010</I>
    <P><UL>
        <LI>Previous message: <A HREF="004511.html">[Twisted-web] Large file uploads
</A></li>
        <LI>Next message: <A HREF="004504.html">[Twisted-web] Large file uploads
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4512">[ date ]</a>
              <a href="thread.html#4512">[ thread ]</a>
              <a href="subject.html#4512">[ subject ]</a>
              <a href="author.html#4512">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA1

Am 24.07.2010 05:50, schrieb <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">exarkun at twistedmatrix.com</A>:
&gt;<i> On 23 Jul, 08:34 pm, <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">julian at whisper-net.de</A> wrote:
</I>&gt;&gt;<i> -----BEGIN PGP SIGNED MESSAGE-----
</I>&gt;&gt;<i> Hash: SHA1
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Am 16.07.2010 17:33, schrieb <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">exarkun at twistedmatrix.com</A>:
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> You can override `Request.gotLength` to inspect the request and select
</I>&gt;&gt;&gt;<i> an appropriate destination for the request body.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> You can convince Site to use your custom request by setting it as the
</I>&gt;&gt;&gt;<i> `requestFactory` attribute.
</I>&gt;&gt;&gt;<i>
</I>&gt;&gt;&gt;<i> Jean-Paul
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> Hi,
</I>&gt;&gt;<i>
</I>&gt;&gt;<i> thanks for your reply. In meantime I tried cherrypy, which does its job
</I>&gt;&gt;<i> very good but has some flaws compared to my twisted applications when 
</I>&gt;&gt;<i> it
</I>&gt;&gt;<i> comes to performance and resource usage. So I'm still interested in
</I>&gt;&gt;<i> solving my problem by using twisted.
</I>&gt;&gt;<i> The problem is as follows: The file which shall be uploaded is sent via
</I>&gt;&gt;<i> a HTML form (encoded as multipart/form-data), and I'd like to use
</I>&gt;&gt;<i> Python's FieldStorage to parse the request body because it handles the
</I>&gt;&gt;<i> file matters very well. You can tell cherrypy, that for a certain
</I>&gt;&gt;<i> request uri cherrypy should not parse the request body but instead pass
</I>&gt;&gt;<i> it on unparsed to the handler method.
</I>&gt;&gt;<i> Is there a simple way of configuring twisted.web in this way to?
</I>&gt;&gt;<i> So that e.g. if request uri /do-upload-form is issued, twisted.web does
</I>&gt;&gt;<i> not try to parse the request body on its own and generate the args dict
</I>&gt;&gt;<i> to pass on to the render_POST method, but instead uses FieldStorage (or
</I>&gt;&gt;<i> better: my own subclass of FieldStorage, which employs a NamedTempFile
</I>&gt;&gt;<i> instead of an anonymous tempfile, which allows me to simply rename it
</I>&gt;&gt;<i> after it has passed some sanity checks) for parsing the body?
</I>&gt;<i> 
</I>&gt;<i> This will be easier once #288 is resolved.  Until then, you just have to 
</I>&gt;<i> hack around with the Request to change the behavior at a very low level.
</I>&gt;<i> 
</I>&gt;<i> Jean-Paul
</I>&gt;<i> 
</I>
If I've unterstood the source code of http.py, class Request right, the
methods to override would be:
1. handleContentChunk, which is called after some data has been received
by the transfer decoder. Something that behaves like cgi.FieldStorage,
but in an async way, should be installed here / instead of the StringIO
used for self.content
2. requestReceived, which has nothing to do anymore besides of calling
self.process

The only thing that misses now is request's command (GET, POST, HEAD
etc.) and request path. Is there a way to install these in the Request
instance before allContentReceived is called other than overriding
HTTPChannel's lineReceived?

Thanks,
Julian
-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.15 (GNU/Linux)
Comment: Using GnuPG with Mozilla - <A HREF="http://enigmail.mozdev.org/">http://enigmail.mozdev.org/</A>

iQIcBAEBAgAGBQJMSt1YAAoJENidYKvYQHlQt5UP+waxLHEVCHQOOY7saeECwEEZ
QsxZpsEyHKd8imcpfrzIgQaooj5OlcFLpAWkaaGFOhUDxq6RmXrLL60/awCTSiCI
Xv1EsNJiwml5/uemhny4BCUq1aBcM0qcMg6BAZG8jwDy2nAVgyX3kall2a+17ybr
aBnssceBHFJm2I7o/yV9ZkrzIPtOabZKqEAyBlE9pqYA1SHZfKhuUZw+BQMpdGdV
HnE+58YRk39B1sTi5GQc5Qed3ynTxeE8tLTHgvi/99QMs+pGQP7kmFbq5KYch8ks
IGVBYJCZXoSZ6aow6zkYSZ8/hmiI5bS3OAnzVSkcOz122UlCqhicSQ7aUUJXrKKs
Er9R4ETNbCYAkZqw+8XofSgcawuP3XxDBfChPeDAC7G1bjnVEO7vEAeUyl+wQ9AO
UXnQde25HAIz88ouXo50Au7Q0Wx/qpnC7Xnl2u6Bbykj0c1UNg1146ZyFCXx3L7f
OT7kQgAIGm3cbCtVU1RLKegsXJD318xEEAHEUoAOjLzbHbuM7cLy6lP5udz/U4QF
pcbpEahNesMKiD7qCGrFzp7nEHu2A272iSN3rbOq0YQILCMhe9uBFqwP1KPsPcMQ
2Or1/n0meu00kZqrFy2t7SsPg3c2754UwC9kLwWXrsP/XoP3HG+YeBFe54sowB2S
lEmLCSwtNlEHH0dy4rmr
=IJw9
-----END PGP SIGNATURE-----

</PRE>

<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004511.html">[Twisted-web] Large file uploads
</A></li>
	<LI>Next message: <A HREF="004504.html">[Twisted-web] Large file uploads
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4512">[ date ]</a>
              <a href="thread.html#4512">[ thread ]</a>
              <a href="subject.html#4512">[ subject ]</a>
              <a href="author.html#4512">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
