<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] system.multicall support for the XML-RPC server
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20system.multicall%20support%20for%20the%20XML-RPC%20server&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   
   <LINK REL="Next"  HREF="004170.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] system.multicall support for the XML-RPC server</H1>
    <B>Dave Benjamin</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20system.multicall%20support%20for%20the%20XML-RPC%20server&In-Reply-To="
       TITLE="[Twisted-web] system.multicall support for the XML-RPC server">dave at ramenlabs.com
       </A><BR>
    <I>Fri May  1 14:29:30 EDT 2009</I>
    <P><UL>
        
        <LI>Next message: <A HREF="004170.html">[Twisted-web] system.multicall support for the XML-RPC server
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4169">[ date ]</a>
              <a href="thread.html#4169">[ thread ]</a>
              <a href="subject.html#4169">[ subject ]</a>
              <a href="author.html#4169">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello,

The Twisted XML-RPC server does not come with system.multicall, a de facto 
standard method which allows a batch of methods to be called in a single 
request.

I wrote an implementation which handles deferred results and ensures that 
exceptions in one method call do not prevent the other methods from 
executing.

I had to add to the XMLRPCIntrospection class in order to include my 
method in the system namespace, even though it is not really an 
introspection method. It's also possible to subclass XMLRPCIntrospection
from outside of xmlrpc.py and use putSubHandler instead of 
xmlrpc.addIntrospection to create the &quot;system&quot; namespace.

Anyhow, let me know what you think. Patch follows. Thanks for making 
Twisted such a joy to read and use.

Dave


--- /usr/share/pyshared/twisted/web/xmlrpc.py   2008-09-05 
02:18:26.000000000 -0700
+++ xmlrpc.py   2009-05-01 10:58:39.000000000 -0700
@@ -246,6 +246,33 @@
      xmlrpc_methodSignature.signature = [['array', 'string'],
                                          ['string', 'string']]

+    def xmlrpc_multicall(self, calls):
+        &quot;&quot;&quot;
+        Boxcar multiple RPC calls in one request.
+        &quot;&quot;&quot;
+        results = []
+        for call in calls:
+            name = call['methodName']
+            params = call['params']
+            method = self._xmlrpc_parent._getFunction(name)
+            try:
+                d = defer.maybeDeferred(method, *params)
+                g = defer.waitForDeferred(d)
+                yield g
+                result = [g.getResult()]
+            except Fault, f:
+                result = {'faultCode': f.faultCode,
+                          'faultString': f.faultString}
+            except Exception, e:
+                log.err(e)
+                result = {'faultCode': self.FAILURE,
+                          'faultString': 'error'}
+            results.append(result)
+        yield results
+
+    xmlrpc_multicall = defer.deferredGenerator(xmlrpc_multicall)
+    xmlrpc_multicall.signature = [['array', 'array']]
+

  def addIntrospection(xmlrpc):
      &quot;&quot;&quot;

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	
	<LI>Next message: <A HREF="004170.html">[Twisted-web] system.multicall support for the XML-RPC server
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4169">[ date ]</a>
              <a href="thread.html#4169">[ thread ]</a>
              <a href="subject.html#4169">[ subject ]</a>
              <a href="author.html#4169">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
