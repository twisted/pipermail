<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] system.multicall support for the XML-RPC server
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20system.multicall%20support%20for%20the%20XML-RPC%20server&In-Reply-To=alpine.DEB.2.00.0905011129050.14916%40spoomusic.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004169.html">
   <LINK REL="Next"  HREF="004171.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] system.multicall support for the XML-RPC server</H1>
    <B>glyph at divmod.com</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20system.multicall%20support%20for%20the%20XML-RPC%20server&In-Reply-To=alpine.DEB.2.00.0905011129050.14916%40spoomusic.com"
       TITLE="[Twisted-web] system.multicall support for the XML-RPC server">glyph at divmod.com
       </A><BR>
    <I>Fri May  1 21:26:28 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="004169.html">[Twisted-web] system.multicall support for the XML-RPC server
</A></li>
        <LI>Next message: <A HREF="004171.html">[Twisted-web] system.multicall support for the XML-RPC server
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4170">[ date ]</a>
              <a href="thread.html#4170">[ thread ]</a>
              <a href="subject.html#4170">[ subject ]</a>
              <a href="author.html#4170">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On 1 May, 06:29 pm, <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">dave at ramenlabs.com</A> wrote:
&gt;<i>Hello,
</I>
Hi Dave!  Thanks for taking the time to contribute.

Unfortunately, this contribution will almost certainly be lost if you 
don't open a ticket for it at &lt;<A HREF="http://twistedmatrix.com/trac/newticket">http://twistedmatrix.com/trac/newticket</A>&gt;. 
Once you've done that, you'll need to mark it for review by adding the 
&quot;review&quot; keyword and reassigning it to nobody - the empty entry at the 
top of the &quot;reassign&quot; menu.

More information on our development process is here:

    <A HREF="http://twistedmatrix.com/trac/wiki/TwistedDevelopment">http://twistedmatrix.com/trac/wiki/TwistedDevelopment</A>

I'll give you the first round of review on the list, though :).
&gt;<i>The Twisted XML-RPC server does not come with system.multicall, a de 
</I>&gt;<i>facto
</I>&gt;<i>standard method which allows a batch of methods to be called in a 
</I>&gt;<i>single
</I>&gt;<i>request.
</I>
Can you include a reference in the docstrig to some document describing 
this standard, even if it's just a blog post or a wiki page somewhere 
explaining its expected semantics?
&gt;<i>I had to add to the XMLRPCIntrospection class in order to include my
</I>&gt;<i>method in the system namespace, even though it is not really an
</I>&gt;<i>introspection method. It's also possible to subclass 
</I>&gt;<i>XMLRPCIntrospection
</I>&gt;<i>from outside of xmlrpc.py and use putSubHandler instead of
</I>&gt;<i>xmlrpc.addIntrospection to create the &quot;system&quot; namespace.
</I>
I'm not quite sure what you're getting at here - do you think one of 
these other approaches would be better!
&gt;<i>Anyhow, let me know what you think. Patch follows. Thanks for making
</I>&gt;<i>Twisted such a joy to read and use.
</I>
Thanks for contributing!

The first and most important thought I have about this patch is that 
sadly, it does not include any unit tests.  Our development process 
mandates that all new features have complete test coverage.  Ideally new 
features would all be developed in a test-driven way.

If you need some help with that, you're in luck.  There's a Twisted 
sprint tomorrow (Saturday, May 2).  If you're in the vicinity of 
Cambridge, MA, you can drop by the Divmod office and join us physically; 
otherwise, join us in the #twisted IRC channel on chat.freenode.net.
&gt;<i>--- /usr/share/pyshared/twisted/web/xmlrpc.py   2008-09-05
</I>&gt;<i>02:18:26.000000000 -0700
</I>&gt;<i>+++ xmlrpc.py   2009-05-01 10:58:39.000000000 -0700
</I>&gt;<i>@@ -246,6 +246,33 @@
</I>
Just looking at this information in the diff here; the best way to 
generate diffs for contribution is to have a checkout of current SVN 
trunk and run 'svn diff' at the root.  Generating diffs against your 
system installation of Twisted is problematic for many reasons.  For one 
thing, it makes them harder to apply to the most recent code.  For 
another, ubuntu and debian's versions of Twisted can diverge from the 
version that we distribute, sometimes substantially, since they apply 
their own patches.
&gt;<i>      xmlrpc_methodSignature.signature = [['array', 'string'],
</I>&gt;<i>                                          ['string', 'string']]
</I>&gt;<i>
</I>&gt;<i>+    def xmlrpc_multicall(self, calls):
</I>&gt;<i>+        &quot;&quot;&quot;
</I>&gt;<i>+        Boxcar multiple RPC calls in one request.
</I>&gt;<i>+        &quot;&quot;&quot;
</I>
It would be helpful if you included a &quot;@param&quot; describing the expected 
structure of &quot;calls&quot; here, in addition to the description of this de- 
facto standard.  As it is, I have to puzzle it out from .signature below 
and the body of the method.
&gt;<i>+        results = []
</I>&gt;<i>+        for call in calls:
</I>&gt;<i>+            name = call['methodName']
</I>&gt;<i>+            params = call['params']
</I>&gt;<i>+            method = self._xmlrpc_parent._getFunction(name)
</I>&gt;<i>+            try:
</I>&gt;<i>+                d = defer.maybeDeferred(method, *params)
</I>&gt;<i>+                g = defer.waitForDeferred(d)
</I>&gt;<i>+                yield g
</I>&gt;<i>+                result = [g.getResult()]
</I>&gt;<i>+            except Fault, f:
</I>&gt;<i>+                result = {'faultCode': f.faultCode,
</I>&gt;<i>+                          'faultString': f.faultString}
</I>&gt;<i>+            except Exception, e:
</I>&gt;<i>+                log.err(e)
</I>&gt;<i>+                result = {'faultCode': self.FAILURE,
</I>&gt;<i>+                          'faultString': 'error'}
</I>&gt;<i>+            results.append(result)
</I>&gt;<i>+        yield results
</I>&gt;<i>+
</I>&gt;<i>+    xmlrpc_multicall = defer.deferredGenerator(xmlrpc_multicall)
</I>
By using deferredGenerator here, you're eliminating any possible 
parallelism and forcing all of the requests to happen in serial, even if 
they're deferred.  Is that intentional?  It looks like this would be 
better written as a normal Deferred-using function.
&gt;<i>+    xmlrpc_multicall.signature = [['array', 'array']]
</I>&gt;<i>+
</I>&gt;<i>
</I>&gt;<i>  def addIntrospection(xmlrpc):
</I>&gt;<i>      &quot;&quot;&quot;
</I>&gt;<i>
</I>&gt;<i>_______________________________________________
</I>&gt;<i>Twisted-web mailing list
</I>&gt;<i><A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">Twisted-web at twistedmatrix.com</A>
</I>&gt;<i><A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web</A>
</I>
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004169.html">[Twisted-web] system.multicall support for the XML-RPC server
</A></li>
	<LI>Next message: <A HREF="004171.html">[Twisted-web] system.multicall support for the XML-RPC server
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4170">[ date ]</a>
              <a href="thread.html#4170">[ thread ]</a>
              <a href="subject.html#4170">[ subject ]</a>
              <a href="author.html#4170">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
