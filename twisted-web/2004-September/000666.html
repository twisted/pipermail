<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] Re: [Web-SIG] WSGI woes
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Re%3A%20%5BWeb-SIG%5D%20WSGI%20woes&In-Reply-To=5.1.1.6.0.20040916180735.02fa5e80%40mail.telecommunity.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000665.html">
   <LINK REL="Next"  HREF="000667.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] Re: [Web-SIG] WSGI woes</H1>
    <B>Phillip J. Eby</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Re%3A%20%5BWeb-SIG%5D%20WSGI%20woes&In-Reply-To=5.1.1.6.0.20040916180735.02fa5e80%40mail.telecommunity.com"
       TITLE="[Twisted-web] Re: [Web-SIG] WSGI woes">pje at telecommunity.com
       </A><BR>
    <I>Thu Sep 16 16:59:28 MDT 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="000665.html">[Twisted-web] Re: [Web-SIG] WSGI woes
</A></li>
        <LI>Next message: <A HREF="000667.html">[Twisted-web] Re: [Twisted-Python] Fwd: [Twisted-commits] r11721 -
	revert r11685
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#666">[ date ]</a>
              <a href="thread.html#666">[ thread ]</a>
              <a href="subject.html#666">[ subject ]</a>
              <a href="author.html#666">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>At 06:37 PM 9/16/04 -0400, Phillip J. Eby wrote:
&gt;<i>Not entirely, actually.  For my approach to really work, the middleware 
</I>&gt;<i>would have to be guaranteed to return something from read(), as long as 
</I>&gt;<i>the parent's read() returns something.  Otherwise, the resumption would 
</I>&gt;<i>block, unless the middleware were much smarter.  I've got to think about 
</I>&gt;<i>it some more, because right now I'm still not happy with the specifics of 
</I>&gt;<i>any of the proposals for pausing and resuming output.
</I>
Aha!  There's the problem.  The 'read()' protocol is what's wrong.  If 
'wsgi.input' were an *iterator* instead of a file-like object, it would be 
fairly straightforward for async servers to implement &quot;would block&quot; reads 
as yielding empty strings.  And, servers could actually support streaming 
input via chunked encoding, because they could just yield blocks once 
they've arrived.

The downside to making 'wsgi.input' an iterator is that you lose control 
over how much data to read at a time: the upstream server or middleware 
determines how much data you get.  But, it's quite possible to make a 
buffering, file-like wrapper over such an iterator, if that's what you 
really need, and your code is synchronous.  (This will slightly increase 
the coding burden for interfacing applications and frameworks that expect 
to have a readable stream for CGI input.)  For asynchronous code, you're 
just going to invoke some sort of callback with each block, and it's the 
callback's job to deal with it.

What does everybody think?  If combined with a &quot;pause iterating me until 
there's input data available&quot; extension API, this would let the input 
stream be non-blocking, and solve the chunked-encoding input issue all in 
one change to the protocol.  Or am I missing something here?


</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000665.html">[Twisted-web] Re: [Web-SIG] WSGI woes
</A></li>
	<LI>Next message: <A HREF="000667.html">[Twisted-web] Re: [Twisted-Python] Fwd: [Twisted-commits] r11721 -
	revert r11685
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#666">[ date ]</a>
              <a href="thread.html#666">[ thread ]</a>
              <a href="subject.html#666">[ subject ]</a>
              <a href="author.html#666">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
