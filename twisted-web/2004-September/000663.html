<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] Draft language for WSGI to forbid blocking by
	middleware
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Draft%20language%20for%20WSGI%20to%20forbid%20blocking%20by%0A%09middleware&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000662.html">
   <LINK REL="Next"  HREF="000664.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] Draft language for WSGI to forbid blocking by
	middleware</H1>
    <B>Phillip J. Eby</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Draft%20language%20for%20WSGI%20to%20forbid%20blocking%20by%0A%09middleware&In-Reply-To="
       TITLE="[Twisted-web] Draft language for WSGI to forbid blocking by
	middleware">pje at telecommunity.com
       </A><BR>
    <I>Thu Sep 16 12:03:27 MDT 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="000662.html">[Twisted-web] Re: [Web-SIG] WSGI woes
</A></li>
        <LI>Next message: <A HREF="000664.html">[Twisted-web] Re: [Web-SIG] WSGI woes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#663">[ date ]</a>
              <a href="thread.html#663">[ thread ]</a>
              <a href="subject.html#663">[ subject ]</a>
              <a href="author.html#663">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>I'm proposing the following language to be added to PEP 333, as a 
subsection under &quot;Buffering and Streaming&quot;, just before the subsection 
entitled, &quot;The write() callable&quot;.  It doesn't address pausing or resuming 
iteration (which I don't have a PEP-able proposal for yet), but it should 
ensure that middleware doesn't introduce any additional blocking issues:

===excerpt start===

Middleware Handling of Block Boundaries
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

In order to better support asynchronous applications and servers,
middleware components **must not** block iteration waiting for
multiple values from an application iterable.  If the middleware
needs to accumulate more data from the application before it can
produce any output, it **must** yield an empty string.

To put this requirement another way, a middleware component **must
yield at least one value** each time its underlying application
yields a value.  If the middleware cannot yield any other value,
it must yield an empty string.

This requirement ensures that asynchronous applications and servers
can conspire to reduce the number of threads that are required
to run a given number of application instances simultaneously.

Note also that this requirement means that middleware **must**
return an iterable as soon as its underlying application returns
an iterable.  It is also forbidden for middleware to use the
``write()`` callable to transmit data that is yielded by an
underlying application.  Middleware may only use their parent
server's ``write()`` callable to transmit data that the
underlying application sent using a middleware-provided ``write()``
callable.

===excerpt end===

In addition to this insertion, I would modify the 'start_response()' 
specification to note that HTTP headers should not be sent until the first 
*non-empty* string is yielded from the iterable.

Comments?


</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000662.html">[Twisted-web] Re: [Web-SIG] WSGI woes
</A></li>
	<LI>Next message: <A HREF="000664.html">[Twisted-web] Re: [Web-SIG] WSGI woes
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#663">[ date ]</a>
              <a href="thread.html#663">[ thread ]</a>
              <a href="subject.html#663">[ subject ]</a>
              <a href="author.html#663">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
