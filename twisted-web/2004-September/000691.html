<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] nevow 0.3 + encoding
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20nevow%200.3%20%2B%20encoding&In-Reply-To=152558725.20040928004713%40eranet.pl">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000690.html">
   <LINK REL="Next"  HREF="000698.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] nevow 0.3 + encoding</H1>
    <B>James Y Knight</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20nevow%200.3%20%2B%20encoding&In-Reply-To=152558725.20040928004713%40eranet.pl"
       TITLE="[Twisted-web] nevow 0.3 + encoding">foom at fuhm.net
       </A><BR>
    <I>Mon Sep 27 21:05:19 MDT 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="000690.html">[Twisted-web] nevow 0.3 + encoding
</A></li>
        <LI>Next message: <A HREF="000698.html">[Twisted-web] Serving files from many web-servers thru one central
	web-server
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#691">[ date ]</a>
              <a href="thread.html#691">[ thread ]</a>
              <a href="subject.html#691">[ subject ]</a>
              <a href="author.html#691">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Sep 28, 2004, at 12:47 AM, Bartek Bargiel wrote:
&gt;<i> My first comment after having installed Nevow 0.3: my polish cp1250
</I>&gt;<i> encoding chars are not displayed:
</I>&gt;<i>
</I>&gt;<i> - htmlfile replaces them all with question marks (it works OK when 
</I>&gt;<i> using
</I>&gt;<i> UTF-8 encoding)
</I>&gt;<i>
</I>&gt;<i> - xmlfile works fine when reading the text from file but again it
</I>&gt;<i> fails to display national charset when it gets it returned from Python 
</I>&gt;<i> code
</I>&gt;<i>
</I>&gt;<i> Maybe it's me doing something wrong somewhere, I'm getting more&amp;more
</I>&gt;<i> confused with that encoding stuff :)
</I>
Firstly, Nevow is and always will be designed to use only unicode 
internally. Doing anything else at this point in time is complete 
madness.

This has a few consequences:
1) you should always use unicode strings in your python code if they 
have any non-core-ASCII characters in them.
   like e.g. u&quot;&#49352;&#52852;&#47564; &#52964;&#54588; oh no~ &#49352;&#54616;&#50560; &#50864;&#50976; oh yes~&quot;
Additionally, you have to make sure your source code file encoding is 
set properly &lt;<A HREF="http://www.python.org/peps/pep-0263.html">http://www.python.org/peps/pep-0263.html</A>&gt; or else use 
unicode escapes instead of the actual characters,
   e.g. u&quot;\uc0c8\uce74\ub9cc \ucee4\ud53c oh no~ \uc0c8\ud558\uc580 
\uc6b0\uc720 oh yes~&quot;

2) xmlfile and htmlfile must decode from the file's encoding to 
unicode. However, htmlfile is completely broken in this regard: it does 
not decode the file encoding at all. If the file happens to be in UTF-8 
already, it will &quot;work&quot;, but only because it returns byte strings, 
which are not encoded upon output.

This really ought to be fixed; people have lots of pre-existing files 
in strange encodings, and utf-8 editor support isn't quite all there 
yet, either. htmlfile should do META content-type tag sniffing (like a 
browser would), and also allow the developer to specify a default 
encoding in the htmlfile constructor.

Fortunately, xmlfile does work right: use a standard &lt;?xml 
version=&quot;1.0&quot; encoding=&quot;cp1250&quot;?&gt; declaration at the top of the file 
and it'll do the right thing.

3) When writing the response to the client, nevow must encode from 
unicode into the proper response encoding.  Currently there is no way 
to specify any response encoding besides UTF-8. I do not believe this 
needs to be (or even should be) fixed: any browser that cannot handle 
UTF-8 encoding is utterly worthless, and I don't think there are any 
browsers that worthless still in use. At least I hope there aren't.

James


</PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000690.html">[Twisted-web] nevow 0.3 + encoding
</A></li>
	<LI>Next message: <A HREF="000698.html">[Twisted-web] Serving files from many web-servers thru one central
	web-server
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#691">[ date ]</a>
              <a href="thread.html#691">[ thread ]</a>
              <a href="subject.html#691">[ subject ]</a>
              <a href="author.html#691">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
