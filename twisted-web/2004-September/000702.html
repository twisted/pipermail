<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] adding etag and modified arguments to twisted
	feedparser
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20adding%20etag%20and%20modified%20arguments%20to%20twisted%0A%09feedparser&In-Reply-To=4159DD5B.9070202%40stonebow.otago.ac.nz">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000701.html">
   <LINK REL="Next"  HREF="000703.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] adding etag and modified arguments to twisted
	feedparser</H1>
    <B>James Y Knight</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20adding%20etag%20and%20modified%20arguments%20to%20twisted%0A%09feedparser&In-Reply-To=4159DD5B.9070202%40stonebow.otago.ac.nz"
       TITLE="[Twisted-web] adding etag and modified arguments to twisted
	feedparser">foom at fuhm.net
       </A><BR>
    <I>Tue Sep 28 18:10:05 MDT 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="000701.html">[Twisted-web] adding etag and modified arguments to twisted
	feedparser
</A></li>
        <LI>Next message: <A HREF="000703.html">[Twisted-web] adding etag and modified arguments to
	twisted	feedparser
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#702">[ date ]</a>
              <a href="thread.html#702">[ thread ]</a>
              <a href="subject.html#702">[ subject ]</a>
              <a href="author.html#702">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Sep 28, 2004, at 5:53 PM, Selwyn McCracken wrote:
&gt;<i> I am having trouble modifying the twisted-based rss aggregator from 
</I>&gt;<i> the python cookbook so that feedparser can make use of the update 
</I>&gt;<i> related arguments of 'etag' and 'modified' to save bandwith.
</I>&gt;<i> (see <A HREF="http://aspn.activestate.com/ASPN/Cookbook/Python/Recipe/277099">http://aspn.activestate.com/ASPN/Cookbook/Python/Recipe/277099</A>)
</I>&gt;<i>
</I>&gt;<i> I realise that the problem is deferred related, but I can't seem to 
</I>&gt;<i> resolve the problem, even after reading the deferred documentation.
</I>
Not particularly deferred related, more t.w.client related. I assume 
what's happening is that feedparser.parse() can either take a URL or a 
file-like-object. If it takes a URL, it uses its internal HTTP getting 
method, which is synchronous. Twisted's HTTP client is asynchronous, so 
you want to use that.

So what you need to know how to do is send the etag/modified 
information to Twisted's HTTP client.

You want something like:

def getPage(self, data, args): #args is the rss feed link
         return client.getPage(args,timeout=TIMEOUT, 
headers={'If-None-Match': '&quot;xyzzy&quot;', 'If-Modified-Since': 'Sun, 09 Sep 
2001 01:46:40 GMT'})

However, client.getPage doesn't leave you with any way to get at the 
response headers (so you can save the etag and last modified responses 
for the next request), so you'll need to use HTTPClientFactory directly 
(cribbing from the code in client.getPage). Basically, after the 
deferred fires, factory.response_headers will have the data you want, 
so you just need to keep a reference to factory around.

James


</PRE>





<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000701.html">[Twisted-web] adding etag and modified arguments to twisted
	feedparser
</A></li>
	<LI>Next message: <A HREF="000703.html">[Twisted-web] adding etag and modified arguments to
	twisted	feedparser
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#702">[ date ]</a>
              <a href="thread.html#702">[ thread ]</a>
              <a href="subject.html#702">[ subject ]</a>
              <a href="author.html#702">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
