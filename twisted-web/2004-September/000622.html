<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] nevow FileUpload
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20nevow%20FileUpload&In-Reply-To=343540CF89C2774289E7F3C9EE4F5DF10553A647%40nt-lonex1.bl.uk">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000619.html">
   <LINK REL="Next"  HREF="000620.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] nevow FileUpload</H1>
    <B>David Ferlier</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20nevow%20FileUpload&In-Reply-To=343540CF89C2774289E7F3C9EE4F5DF10553A647%40nt-lonex1.bl.uk"
       TITLE="[Twisted-web] nevow FileUpload">david at endlessremix.shacknet.nu
       </A><BR>
    <I>Wed Sep  8 10:17:02 MDT 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="000619.html">[Twisted-web] nevow FileUpload
</A></li>
        <LI>Next message: <A HREF="000620.html">[Twisted-web] Add segmentsResolved method to inevow.IResource
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#622">[ date ]</a>
              <a href="thread.html#622">[ thread ]</a>
              <a href="subject.html#622">[ subject ]</a>
              <a href="author.html#622">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hi,

First, you should know that there is a very disturbing bug in
NevowSite's code that makes twisted block while nevow creates the
cgi.FieldStorage's instance in finish() (so your website won't be able
to answer requests while the file is uploaded, which makes it
useless). To correct that you need to overload NevowSite : just
overload its finish() method and remove the creation of the
cgi.FieldStorage.

That said, accessing file data from the FieldStorage instance is quite
easy. Let's say that you now have the request object. To access file
data from the 'myfile' field :

file = request[&quot;myfile&quot;].file
filedata = file.read()

Hope it helps,

David

On Wed, Sep 08, 2004 at 12:01:02PM +0100, Williamson, Mark wrote:
&gt;<i> Hi, 
</I>&gt;<i> 
</I>&gt;<i> I'm building a web app with nevow/twisted and I'm really 
</I>&gt;<i> impressed. 
</I>&gt;<i> 
</I>&gt;<i> I'm having a small problem with Formless though when trying to 
</I>&gt;<i> upload a file: 
</I>&gt;<i> 
</I>&gt;<i> here is my interface:
</I>&gt;<i> 
</I>&gt;<i> class IAddDocument( formless.TypedInterface ):
</I>&gt;<i>    &quot;&quot;&quot;Interface for Add Document form&quot;&quot;&quot;
</I>&gt;<i>    def addDocument( self , context = annotate.Context() , fdata =
</I>&gt;<i> annotate.FileUpload( required = True ) ):
</I>&gt;<i>       pass
</I>&gt;<i>    addDocument = formless.autocallable( addDocument )
</I>&gt;<i> 
</I>&gt;<i> The form renders fine (I'm using a template pretty much based on the one in
</I>&gt;<i> one of the 
</I>&gt;<i> tutorials except I've messed about with the table layout a bit) and lets me
</I>&gt;<i> choose a file
</I>&gt;<i> for upload - it also seems to upload the file. However when my method is
</I>&gt;<i> called 
</I>&gt;<i> on my page class: 
</I>&gt;<i> 
</I>&gt;<i>    def addDocument( self , context , fdata ):
</I>&gt;<i>        ...
</I>&gt;<i> 
</I>&gt;<i> fdata is None. I've looked at the request from the context and the filename
</I>&gt;<i> seems to be there 
</I>&gt;<i> but not the file data. 
</I>&gt;<i> 
</I>&gt;<i> Can anyone shed any light on this. Its a bit of a sticking point for me 
</I>&gt;<i> right now
</I>&gt;<i> 
</I>&gt;<i> cheers 
</I>&gt;<i> 
</I>&gt;<i> mark 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> **************************************************************************
</I>&gt;<i> 
</I>&gt;<i> Experience the British Library online at www.bl.uk 
</I>&gt;<i> 
</I>&gt;<i> Help the British Library conserve the world's knowledge. Adopt a Book.
</I>&gt;<i> www.bl.uk/adoptabook 
</I>&gt;<i> 
</I>&gt;<i> *************************************************************************
</I>&gt;<i> 
</I>&gt;<i> The information contained in this e-mail is confidential and may be legally
</I>&gt;<i> privileged. It is intended for the addressee(s) only. If you are not the
</I>&gt;<i> intended recipient, please delete this e-mail and notify the
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">postmaster at bl.uk</A> : The contents of this e-mail must not be disclosed or
</I>&gt;<i> copied without the sender's consent. 
</I>&gt;<i> 
</I>&gt;<i> The statements and opinions expressed in this message are those of the
</I>&gt;<i> author and do not necessarily reflect those of the British Library. The
</I>&gt;<i> British Library does not take any responsibility for the views of the
</I>&gt;<i> author. 
</I>&gt;<i> 
</I>&gt;<i> ************************************************************************* 
</I>&gt;<i> 
</I>&gt;<i> 
</I>&gt;<i> _______________________________________________
</I>&gt;<i> Twisted-web mailing list
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">Twisted-web at twistedmatrix.com</A>
</I>&gt;<i> <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web</A>
</I>
-- 
	David Ferlier -- <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">david at endlessremix.shacknet.nu</A>


</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000619.html">[Twisted-web] nevow FileUpload
</A></li>
	<LI>Next message: <A HREF="000620.html">[Twisted-web] Add segmentsResolved method to inevow.IResource
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#622">[ date ]</a>
              <a href="thread.html#622">[ thread ]</a>
              <a href="subject.html#622">[ subject ]</a>
              <a href="author.html#622">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
