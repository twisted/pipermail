<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] Mysterious behavior w/ XMLRPC plus adbapi
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Mysterious%20behavior%20w/%20XMLRPC%20plus%20adbapi&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002636.html">
   <LINK REL="Next"  HREF="002638.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] Mysterious behavior w/ XMLRPC plus adbapi</H1>
    <B>Sean Scoggins</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Mysterious%20behavior%20w/%20XMLRPC%20plus%20adbapi&In-Reply-To="
       TITLE="[Twisted-web] Mysterious behavior w/ XMLRPC plus adbapi">seanscoggins at gmail.com
       </A><BR>
    <I>Mon May 22 19:24:36 CDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="002636.html">[Twisted-web] tap2ntsvc
</A></li>
        <LI>Next message: <A HREF="002638.html">[Twisted-web] Mysterious behavior w/ XMLRPC plus adbapi
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2637">[ date ]</a>
              <a href="thread.html#2637">[ thread ]</a>
              <a href="subject.html#2637">[ subject ]</a>
              <a href="author.html#2637">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Hello from a new list member!  I'm evaluating Twisted for use in my
company's product, and I'm currently stuck on a problem that I don't know
how to debug.

I am creating an XMLRPC server that uses twisted.enterprise.adbapi to query
a database.  The symptom I've seeing is that the *third* call to an xmlrpc
method that queries the database delays for some time (a minute or so)
before returning with the correct results.  The first two calls always
return very quickly.  Calls after the third one usually return quickly as
well.

I've narrowed down the code as far as I can, and I'm not sure what to check
next.  Any help would be appreciated.  Here's what I've found so far
(complete code is at the bottom of the email):

1) Not using the XMLRPC server, just using reactor.callLater() to run the
query, then calling callLater again in the callback results in the query
getting run over and over and I never see a delay.  So I suspected the
XMLRPC server code.

2) Calling XMLRPC methods that don't use the dbpool always return quickly.
So I suspected the adbapi code.

3) Changing the cp_min argument to ConnectionPool's constructor can change
the behavior - making it larger than 3 results in the third call being
delayed, then the fourth call getting error 8002 back from the server.

4) I've tried adodbapi as well as the eval version of mxODBC just to make
sure it wasn't the db driver - the behavior is identical in both cases.

Any ideas?  Thanks in advance,
Sean

---
from twisted.internet import reactor
from twisted.web import xmlrpc
from twisted.enterprise import adbapi

class ReportRunner(xmlrpc.XMLRPC):
    def __init__(self):
        self.dbpool = adbapi.ConnectionPool(&quot;mx.ODBC.Windows&quot;,
&quot;dsn&quot;,&quot;user&quot;,&quot;pwd&quot;)

    def xmlrpc_test(self):
        return self.dbpool.runQuery(&quot;select 1&quot;)

    def xmlrpc_quit(self):
        reactor.callLater(1, reactor.stop)
        return &quot;OK&quot;

def main():
    from twisted.web import server
    r = ReportRunner()
    reactor.listenTCP(7080, server.Site(r))
    reactor.run()


if __name__ == '__main__':
    main()
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <A HREF="http://twistedmatrix.com/pipermail/twisted-web/attachments/20060522/252d5eca/attachment.htm">http://twistedmatrix.com/pipermail/twisted-web/attachments/20060522/252d5eca/attachment.htm</A>
</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002636.html">[Twisted-web] tap2ntsvc
</A></li>
	<LI>Next message: <A HREF="002638.html">[Twisted-web] Mysterious behavior w/ XMLRPC plus adbapi
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2637">[ date ]</a>
              <a href="thread.html#2637">[ thread ]</a>
              <a href="subject.html#2637">[ subject ]</a>
              <a href="author.html#2637">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
