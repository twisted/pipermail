<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] large file upload in web2 (was Re:
	http.HTTPFactory(site) equivalent in web2.0.2?)
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20large%20file%20upload%20in%20web2%20%28was%20Re%3A%0A%09http.HTTPFactory%28site%29%20equivalent%20in%20web2.0.2%3F%29&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="002729.html">
   <LINK REL="Next"  HREF="002732.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] large file upload in web2 (was Re:
	http.HTTPFactory(site) equivalent in web2.0.2?)</H1>
    <B>Lenny G Arbage</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20large%20file%20upload%20in%20web2%20%28was%20Re%3A%0A%09http.HTTPFactory%28site%29%20equivalent%20in%20web2.0.2%3F%29&In-Reply-To="
       TITLE="[Twisted-web] large file upload in web2 (was Re:
	http.HTTPFactory(site) equivalent in web2.0.2?)">alengarbage at yahoo.com
       </A><BR>
    <I>Tue Jun 27 10:52:39 CDT 2006</I>
    <P><UL>
        <LI>Previous message: <A HREF="002729.html">[Twisted-web] Bay Area Twisted sprint.
</A></li>
        <LI>Next message: <A HREF="002732.html">[Twisted-web] large file upload in web2 (was
	Re:	http.HTTPFactory(site) equivalent in web2.0.2?)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2731">[ date ]</a>
              <a href="thread.html#2731">[ thread ]</a>
              <a href="subject.html#2731">[ subject ]</a>
              <a href="author.html#2731">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>&gt;<i> Did you create a bug about it when you found it in
</I>&gt;<i> 0.1? If not could you?  Because I didn't know about
</I>&gt;<i> any such issue, and I'm guessing neither did
</I>&gt;<i> anyone else. Assign it to me and I'll look into it
</I>&gt;<i> this evening after work (any code you have to
</I>&gt;<i> reproduce such an issue would be helpful it doesn't
</I>&gt;<i> necessarily have to be in the form of a unittest
</I>&gt;<i> but if you can do that it'd be awesome.)
</I>
  I just found it yesterday (in 0.1) and thought I
should upgrade to 0.2 before bugging anyone about it. 
I'd be happy to create a bug, but I have no idea how
to do that (&quot;TICKET_CREATE privileges are required to
perform this operation&quot;, and I haven't been able to
get myself over the wall of &quot;where are the
instructions on getting an account or gaining those
privileges?&quot;)

  Here, though, is a simple example illustrating the
problem:

#!/usr/bin/python

import os
from twisted.internet import reactor
from twisted.web2 import server, http, resource,\
    channel
from twisted.web2 import http_headers, responsecode
from twisted.web2 import iweb

SAVEDIR = &quot;/tmp&quot;
READSIZE=8192

class UploadFile(resource.PostableResource):
    def render(self, ctx):
        request = iweb.IRequest(ctx)
        filename = request.files['filename'][0][0]
        file = request.files['filename'][0][2]

        dest = os.path.join(SAVEDIR, filename)
        destfile = open(dest, 'wb')
        tot = 0
        while True:
            buf = file.read(READSIZE)
            tot = tot + READSIZE
            print &quot;reading %d...&quot; % tot
            if buf == '':
                break
            destfile.write(buf)
        destfile.close()
        file.close()

        msg = &quot;saved %s to %s&quot; % (filename, dest)
        print msg
        return http.Response(stream=&quot;%s&quot; % msg)

class Toplevel(resource.Resource):
    addSlash = True
    def render(self, ctx):
        return http.Response(responsecode.OK,
                {'content-type':
http_headers.MimeType('text', 'html')},
                &quot;Hello&quot;)

    child_uploadfile = UploadFile()

if __name__ == &quot;__main__&quot;:
    site = server.Site(Toplevel())
    reactor.listenTCP(1080, channel.HTTPFactory(site))
    reactor.run()


  Run this script, then upload a file to it with the
client of your choice.  Here is an html form which you
can use to do that:

&lt;html&gt;
    &lt;form action=&quot;<A HREF="http://localhost:1080/uploadfile&quot;">http://localhost:1080/uploadfile&quot;</A>
            enctype=&quot;multipart/form-data&quot;
            method=&quot;post&quot;&gt;
        filename: &lt;input type=&quot;file&quot; name=&quot;filename&quot;&gt;
        &lt;input type=&quot;submit&quot; value=&quot;submit&quot;&gt;
    &lt;/form&gt;
&lt;/html&gt;

  You should be able to upload files smaller than 9M
without any problem, and files larger than 10M not at
all.

  I can send you an httplib client as well, but at
least this should be enough to get you started.

  I'll go try again, now, to figure out how to get
this filed properly in Trac (and maybe even as a
unittest!).

  Thanks!
  Lenny

__________________________________________________
Do You Yahoo!?
Tired of spam?  Yahoo! Mail has the best spam protection around 
<A HREF="http://mail.yahoo.com">http://mail.yahoo.com</A> 

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="002729.html">[Twisted-web] Bay Area Twisted sprint.
</A></li>
	<LI>Next message: <A HREF="002732.html">[Twisted-web] large file upload in web2 (was
	Re:	http.HTTPFactory(site) equivalent in web2.0.2?)
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#2731">[ date ]</a>
              <a href="thread.html#2731">[ thread ]</a>
              <a href="subject.html#2731">[ subject ]</a>
              <a href="author.html#2731">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
