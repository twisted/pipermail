From phil at bubblehouse.org  Tue Oct  6 01:31:50 2009
From: phil at bubblehouse.org (Phil Christensen)
Date: Tue, 6 Oct 2009 01:31:50 -0400
Subject: [Twisted-web] [Twisted-Python] Is it necessary to utilize
	twisted.cred in twisted web?
In-Reply-To: <d067ddcf0910052108x47fe7efey753b9e9d72f6c97d@mail.gmail.com>
References: <d067ddcf0910052108x47fe7efey753b9e9d72f6c97d@mail.gmail.com>
Message-ID: <7DDA846A-5A87-4F3F-9212-5ADD45A8074E@bubblehouse.org>

crossposted to twisted-web at twistedmatrix.com, which is probably a  
better venue...

On Oct 6, 2009, at 12:08 AM, biziap biziap wrote:
> I have googled this topic and found and example in
> (A) http://www.mail-archive.com/twisted-web at twistedmatrix.com/msg01796.html
> well, another simpler example is
> (B) http://www.mail-archive.com/twisted-web at twistedmatrix.com/msg01788.html
>
> My questions are:
> 1. Does the approach in (A) be recommended? To generate resource
> dynamically seems not efficient and not necessary for simple scenario.
> Is there other way to bind twisted.cred and twisted.web together?
> (except the  deprecated twisted.web.guard)

There's a few problems with this approach. The biggest is that it  
requires username/password data to be sent on every authenticated  
request.

Another one is more of a design principle; that you shouldn't have  
account/permissions code inside resource display code. I violate this  
principle all the time ;-)

The use of dynamic resource instantiation is a common idiom in  
twisted.web coding, though. it isn't inherently inefficient, as long  
as your resource objects are fairly sane.

> 2. The approach in (B) which suggests that request.getSession() along
> is quite enough to implement an simple authentication feature. Here
> the "simple scenario" means to guard some resource with username and
> password.
> To do it: In a protected resource, just to check for a flag in the
> session, if failure, then redirect to login page. If succeeded, render
> the resource. Why shall we bother the portal, credentials,
> checker,.... ?


true, depending on your needs, this may be all that you need. from  
your description, though, it sounds like you'd be doing this  
authentication step in every resource you want to protect, which could  
become tedious (aka error-prone) in a big project.

twisted.cred can seem daunting when you're just trying to protect a  
trivial web resource or two, but for more advanced uses like more  
complicated authentication levels, it's worth the time to learn. also,  
a big part of its real value comes when you need to support a variety  
of protocols and/or authentication types.

-phil


From markscottwright at gmail.com  Tue Oct  6 18:38:59 2009
From: markscottwright at gmail.com (markscottwright at gmail.com)
Date: Tue, 06 Oct 2009 22:38:59 +0000
Subject: [Twisted-web] I can't be the only one who prefers trailing slashes
	on my URLs...
Message-ID: <000325579f02726b5c04754be597@google.com>

I've got a resource that a) dynamically builds it's children using getChild  
and b) I'd like to have trailing slashes.

It seems like a lot of work - is there a facility to do this already in  
twisted.web.resource.Resource?

It seems like in every resource's render(), I need to do something like:

def render(self, request):
if request.prepath[-1] != '':
request.redirect(request.childLink(""))
request.finish()
return ""
else:
return resource.Resource.render(self, request)

And every getChild needs to look like this:

def getChild(self, path, request):
if path == '':
return self
elif path == 'edit':
return CrudEdit()
else:
return None

It looks like overriding this wouldn't be much better - since if I still  
want to use render(), the child needs to remember to call  
TrailingSlashResource.render(self, request) in its render() - same with  
getChild. Decorators need to decorate both methods as well.

Is there a facility in twisted.web that does this? I'm not using nevow,  
which appears to just have an addSlash property on it's Page objects.

Thanks all.

markscottwright at gmail.com
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-web/attachments/20091006/b292952e/attachment.htm 

From chris.were at gmail.com  Tue Oct  6 23:33:11 2009
From: chris.were at gmail.com (Chris Were)
Date: Wed, 7 Oct 2009 14:03:11 +1030
Subject: [Twisted-web] Exceptions in twisted.web.client
Message-ID: <35bb42690910062033g7b0d5d2dhae5f5cbc6afaa075@mail.gmail.com>

Hi,
I have an application that fetches many urls, following any redirects. Every
so often I get a variety of unhandled exceptions from within
twisted.web.client (see snippet at the bottom of email).

My code has an addErrback attached to the deferred and a try/except around
the getPage() call, neither of which get invoked.

Are these exceptions that web.client needs to catch internally and then call
self.deferred.errback so that my error handler will receive it?

If not, how can I catch them?

Cheers,
Chris

--- Exception 1 ---

2009-10-06 20:21:16-0700 [HTTPPageGetter,client] Unhandled Error
 Traceback (most recent call last):
  File
"/usr/local/lib/python2.6/site-packages/Twisted-8.2.0-py2.6-linux-x86_64.egg/twisted/python/log.py",
line 84, in callWithLogger
    return callWithContext({"system": lp}, func, *args, **kw)
  File
"/usr/local/lib/python2.6/site-packages/Twisted-8.2.0-py2.6-linux-x86_64.egg/twisted/python/log.py",
line 69, in callWithContext
    return context.call({ILogContext: newCtx}, func, *args, **kw)
  File
"/usr/local/lib/python2.6/site-packages/Twisted-8.2.0-py2.6-linux-x86_64.egg/twisted/python/context.py",
line 59, in callWithContext
    return self.currentContext().callWithContext(ctx, func, *args, **kw)
  File
"/usr/local/lib/python2.6/site-packages/Twisted-8.2.0-py2.6-linux-x86_64.egg/twisted/python/context.py",
line 37, in callWithContext
    return func(*args,**kw)
--- <exception caught here> ---
  File
"/usr/local/lib/python2.6/site-packages/Twisted-8.2.0-py2.6-linux-x86_64.egg/twisted/internet/selectreactor.py",
line 146, in _doReadOrWrite
    why = getattr(selectable, method)()
  File
"/usr/local/lib/python2.6/site-packages/Twisted-8.2.0-py2.6-linux-x86_64.egg/twisted/internet/tcp.py",
line 463, in doRead
    return self.protocol.dataReceived(data)
  File
"/usr/local/lib/python2.6/site-packages/Twisted-8.2.0-py2.6-linux-x86_64.egg/twisted/protocols/basic.py",
line 231, in dataReceived
    why = self.lineReceived(line)
  File
"/usr/local/lib/python2.6/site-packages/Twisted-8.2.0-py2.6-linux-x86_64.egg/twisted/web/http.py",
line 420, in lineReceived
    self.handleEndHeaders()
  File
"/usr/local/lib/python2.6/site-packages/Twisted-8.2.0-py2.6-linux-x86_64.egg/twisted/web/client.py",
line 74, in handleEndHeaders
    m()
  File
"/usr/local/lib/python2.6/site-packages/Twisted-8.2.0-py2.6-linux-x86_64.egg/twisted/web/client.py",
line 93, in handleStatus_301
    _parse(url, defaultPort=self.transport.getPeer().port)
  File
"/usr/local/lib/python2.6/site-packages/Twisted-8.2.0-py2.6-linux-x86_64.egg/twisted/web/client.py",
line 426, in _parse
    port = int(port)
exceptions.ValueError: invalid literal for int() with base 10: ''

--- Exception 2 ---

2009-10-06 20:28:42-0700 [HTTPPageGetter,client] Unhandled Error
Traceback (most recent call last):
  File
"/usr/local/lib/python2.6/site-packages/Twisted-8.2.0-py2.6-linux-x86_64.egg/twisted/python/log.py",
line 84, in callWithLogger
    return callWithContext({"system": lp}, func, *args, **kw)
  File
"/usr/local/lib/python2.6/site-packages/Twisted-8.2.0-py2.6-linux-x86_64.egg/twisted/python/log.py",
line 69, in callWithContext
    return context.call({ILogContext: newCtx}, func, *args, **kw)
  File
"/usr/local/lib/python2.6/site-packages/Twisted-8.2.0-py2.6-linux-x86_64.egg/twisted/python/context.py",
line 59, in callWithContext
    return self.currentContext().callWithContext(ctx, func, *args, **kw)
  File
"/usr/local/lib/python2.6/site-packages/Twisted-8.2.0-py2.6-linux-x86_64.egg/twisted/python/context.py",
line 37, in callWithContext
    return func(*args,**kw)
--- <exception caught here> ---
  File
"/usr/local/lib/python2.6/site-packages/Twisted-8.2.0-py2.6-linux-x86_64.egg/twisted/internet/selectreactor.py",
line 146, in _doReadOrWrite
    why = getattr(selectable, method)()
  File
"/usr/local/lib/python2.6/site-packages/Twisted-8.2.0-py2.6-linux-x86_64.egg/twisted/internet/tcp.py",
line 463, in doRead
    return self.protocol.dataReceived(data)
  File
"/usr/local/lib/python2.6/site-packages/Twisted-8.2.0-py2.6-linux-x86_64.egg/twisted/protocols/basic.py",
line 231, in dataReceived
    why = self.lineReceived(line)
  File
"/usr/local/lib/python2.6/site-packages/Twisted-8.2.0-py2.6-linux-x86_64.egg/twisted/web/http.py",
line 420, in lineReceived
    self.handleEndHeaders()
  File
"/usr/local/lib/python2.6/site-packages/Twisted-8.2.0-py2.6-linux-x86_64.egg/twisted/web/client.py",
line 74, in handleEndHeaders
    m()
  File
"/usr/local/lib/python2.6/site-packages/Twisted-8.2.0-py2.6-linux-x86_64.egg/twisted/web/client.py",
line 93, in handleStatus_301
    _parse(url, defaultPort=self.transport.getPeer().port)
  File
"/usr/local/lib/python2.6/site-packages/Twisted-8.2.0-py2.6-linux-x86_64.egg/twisted/web/client.py",
line 425, in _parse
    host, port = host.split(':')
exceptions.ValueError: too many values to unpack

--- Exception 3 ---

2009-10-06 20:31:11-0700 [HTTPPageGetter,client] Unhandled Error
Traceback (most recent call last):
  File "/usr/local/lib/python2.6/site-packages/twisted/python/log.py", line
84, in callWithLogger
    return callWithContext({"system": lp}, func, *args, **kw)
  File "/usr/local/lib/python2.6/site-packages/twisted/python/log.py", line
69, in callWithContext
    return context.call({ILogContext: newCtx}, func, *args, **kw)
  File "/usr/local/lib/python2.6/site-packages/twisted/python/context.py",
line 59, in callWithContext
    return self.currentContext().callWithContext(ctx, func, *args, **kw)
  File "/usr/local/lib/python2.6/site-packages/twisted/python/context.py",
line 37, in callWithContext
    return func(*args,**kw)
 --- <exception caught here> ---
  File
"/usr/local/lib/python2.6/site-packages/twisted/internet/selectreactor.py",
line 146, in _doReadOrWrite
    why = getattr(selectable, method)()
  File "/usr/local/lib/python2.6/site-packages/twisted/internet/tcp.py",
line 463, in doRead
    return self.protocol.dataReceived(data)
  File "/usr/local/lib/python2.6/site-packages/twisted/protocols/basic.py",
line 231, in dataReceived
    why = self.lineReceived(line)
  File "/usr/local/lib/python2.6/site-packages/twisted/web/http.py", line
404, in lineReceived
    status = l[1]
exceptions.IndexError: list index out of range
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-web/attachments/20091007/310aeb7e/attachment.htm 

From markscottwright at gmail.com  Wed Oct  7 11:50:02 2009
From: markscottwright at gmail.com (Mark Wright)
Date: Wed, 7 Oct 2009 10:50:02 -0500
Subject: [Twisted-web] My solution to appending slashes to resources
Message-ID: <db986be80910070850i7d8e4a8fp6d21b03189487363@mail.gmail.com>

(I didn't reply to my original message because the mailing list never
sent it to me.  Yet, I can see it at the archives here
http://twistedmatrix.com/pipermail/twisted-web/2009-October/004334.html
- is anyone getting these messages?)

A bit of metaprogramming to the rescue.  For those Resource classes
that you want to append slashes automatically, this seems to work.
Can anyone see any problems with this?

def append_slashes(rsc_class):
    original_getChild = rsc_class.getChild
    original_render = rsc_class.render

    def slash_appending_getChild(self, path, request):
        if path == '':
            return self
        else:
            return original_getChild(self, path, request)

    def slash_appending_render(self, request):
        if request.prepath[-1] != '':
            request.redirect(request.childLink(""))
            return ""
        else:
            return original_render(self, request)

    rsc_class.getChild = slash_appending_getChild
    rsc_class.render = slash_appending_render
    rsc_class.isLeaf = False
    return rsc_class


# test code
# entering http://localhost:8080/hello should redirect to
http://localhost:8080/hello/

from twisted.internet import reactor
from twisted.python import log
from twisted.web import server, resource, static
import sys

class MyPage(resource.Resource):
    def render_GET(self, request):
        return "<html><body><p>Hello World</p></body></html>"
append_slashes(MyPage)

log.startLogging(sys.stdout)
root = resource.Resource()
root.putChild("hello", MyPage())
site = server.Site(root)
reactor.listenTCP(8080, site)
reactor.run()



-- 
Mark Wright
markscottwright at gmail.com


From p.mayers at imperial.ac.uk  Wed Oct  7 12:06:45 2009
From: p.mayers at imperial.ac.uk (Phil Mayers)
Date: Wed, 07 Oct 2009 17:06:45 +0100
Subject: [Twisted-web] My solution to appending slashes to resources
In-Reply-To: <db986be80910070850i7d8e4a8fp6d21b03189487363@mail.gmail.com>
References: <db986be80910070850i7d8e4a8fp6d21b03189487363@mail.gmail.com>
Message-ID: <4ACCBC95.7090601@imperial.ac.uk>

Mark Wright wrote:
> (I didn't reply to my original message because the mailing list never
> sent it to me.  Yet, I can see it at the archives here
> http://twistedmatrix.com/pipermail/twisted-web/2009-October/004334.html
> - is anyone getting these messages?)

Yes. Mailman doesn't send the mail to the sender by default, hence you 
not getting a copy.

> 
> A bit of metaprogramming to the rescue.  For those Resource classes
> that you want to append slashes automatically, this seems to work.
> Can anyone see any problems with this?

It's... an awful lot of effort, but hey - if trailing slashes are that 
important to you, knock yourself out ;o)


From jjconti at gmail.com  Wed Oct  7 14:39:55 2009
From: jjconti at gmail.com (Juanjo Conti)
Date: Wed, 7 Oct 2009 15:39:55 -0300
Subject: [Twisted-web] docFactory at Nevow Elements
In-Reply-To: <3f9007680909301426i2c62d8b5m7dca0b22221e3881@mail.gmail.com>
References: <3f9007680909301310t56df9214j652754f7b16e4aa7@mail.gmail.com>
	<20090930202529.1533.1590753640.divmod.xquotient.482@localhost.localdomain>
	<3f9007680909301337m63b2982ena6dbc76a41b917fc@mail.gmail.com>
	<3f9007680909301418s22c9c356i4b52928483366ecb@mail.gmail.com>
	<3f9007680909301426i2c62d8b5m7dca0b22221e3881@mail.gmail.com>
Message-ID: <3f9007680910071139p1fe72bbcxe91369ae62fc030d@mail.gmail.com>

Can I change doc_factory in the __init__ method of MyLiveElement?

2009/9/30 Juanjo Conti <jjconti at gmail.com>:
> Any document about how does docFactory actually work?
>
> 2009/9/30 Juanjo Conti <jjconti at gmail.com>
>>
>> 2009/9/30 Juanjo Conti <jjconti at gmail.com>
>>>
>>> 2009/9/30 <exarkun at twistedmatrix.com>
>>> [snip]
>>>>
>>>> There's also nevow.loaders.xmlstr.
>>>>
>>>> You may not want to bother making a new docFactory for every page
>>>> render, though. ?You might want to make a single render function and
>>>> return the string from that, wrapped in nevow.tags.xml.
>>>>
>>>
>>> Excelent!
>>>
>>> docFactory = loaders.stan(T.xml(render_to_string('ter.html', {})))
>>
>> Not so fast.
>>
>> This 2 lines donot generate the same page :(
>>
>> docFactory = xmlfile(sibpath(__file__, 'ter.html'))
>> docFactory = loaders.stan(T.xml(render_to_string('ter.html', {})))
>>
>> --
>> Juanjo Conti
>> blog: http://www.juanjoconti.com.ar
>
>
>
> --
> Juanjo Conti
> blog: http://www.juanjoconti.com.ar
>



-- 
Juanjo Conti
blog: http://www.juanjoconti.com.ar


From exarkun at twistedmatrix.com  Thu Oct  8 08:17:47 2009
From: exarkun at twistedmatrix.com (exarkun at twistedmatrix.com)
Date: Thu, 08 Oct 2009 12:17:47 -0000
Subject: [Twisted-web] Exceptions in twisted.web.client
In-Reply-To: <35bb42690910062033g7b0d5d2dhae5f5cbc6afaa075@mail.gmail.com>
References: <35bb42690910062033g7b0d5d2dhae5f5cbc6afaa075@mail.gmail.com>
Message-ID: <20091008121747.24460.367199738.divmod.xquotient.221@boson>

On 7 Oct, 03:33 am, chris.were at gmail.com wrote:
>Hi,
>I have an application that fetches many urls, following any redirects. 
>Every
>so often I get a variety of unhandled exceptions from within
>twisted.web.client (see snippet at the bottom of email).
>
>My code has an addErrback attached to the deferred and a try/except 
>around
>the getPage() call, neither of which get invoked.
>
>Are these exceptions that web.client needs to catch internally and then 
>call
>self.deferred.errback so that my error handler will receive it?
>
>If not, how can I catch them?

This does look like a bug in twisted.web.client.  Any error with the 
request should result in the Deferred being fired so that the caller can 
react to the problem.

Jean-Paul


From jjconti at gmail.com  Sat Oct 10 09:13:41 2009
From: jjconti at gmail.com (Juanjo Conti)
Date: Sat, 10 Oct 2009 10:13:41 -0300
Subject: [Twisted-web] docFactory at Nevow Elements
In-Reply-To: <3f9007680910071139p1fe72bbcxe91369ae62fc030d@mail.gmail.com>
References: <3f9007680909301310t56df9214j652754f7b16e4aa7@mail.gmail.com>
	<20090930202529.1533.1590753640.divmod.xquotient.482@localhost.localdomain>
	<3f9007680909301337m63b2982ena6dbc76a41b917fc@mail.gmail.com>
	<3f9007680909301418s22c9c356i4b52928483366ecb@mail.gmail.com>
	<3f9007680909301426i2c62d8b5m7dca0b22221e3881@mail.gmail.com>
	<3f9007680910071139p1fe72bbcxe91369ae62fc030d@mail.gmail.com>
Message-ID: <3f9007680910100613p5d6cff09p6d53ec839295742c@mail.gmail.com>

2009/10/7 Juanjo Conti <jjconti at gmail.com>:
> Can I change doc_factory in the __init__ method of MyLiveElement?

Yes. It' ok.

class TempElement(LiveElement):

    #docFactory = xmlfile(sibpath(__file__, 'ter.html'))
    jsClass = u'TempDisplay.TempWidget'

    def __init__(self, sitio='', robot=''):
        self.sitio = sitio
        self.robot = robot
        self.client = [c for c in factory.clients.values() if
c['sitio'].ccc == robot.sitio.ccc][0]['self']

        configuracion = robot.robotconfig_set.all()
        entradasanalogicas = [c for c in configuracion if c.tipoio.esEA()]
        registros = [c for c in configuracion if c.tipoio.esRE()]
        salidasdigitales = [c for c in configuracion if c.tipoio.esSD()]
        entradasdigitales = [c for c in configuracion if
c.tipoio.esED()]
        s = render_to_string('tero.html', {'robot': self.robot,
                                           'entradasanalogicas':
entradasanalogicas,
                                           'registros': registros,
                                           'salidasdigitales': salidasdigitales,
                                           'entradasdigitales':
entradasdigitales}).encode('utf-8')
        self.docFactory = loaders.xmlstr(s)
        super(TempElement, self).__init__()

-- 
Juanjo Conti
blog: http://www.juanjoconti.com.ar


From descentspb at gmail.com  Sat Oct 24 09:20:49 2009
From: descentspb at gmail.com (Igor Katson)
Date: Sat, 24 Oct 2009 17:20:49 +0400
Subject: [Twisted-web] Limit the simultaneous
	twisted.web.client.downloadPage requests
Message-ID: <4AE2FF31.9080506@gmail.com>

Hello!

I am a newbie in twisted, sorry if my question sounds awkward.

I have written a pretty simple recursive page downloader, which parses 
an html, extracts all the needed links from it, and starts dowloading 
them. The links are the videofiles, so they are pretty large. The 
problem is, that the downloader works TOO FAST :) I want to set 
something like the global bandwidth limit or the maximum limit of 
concurrently downloading files.

I am using the twisted.web.client.downloadPage to download the files and 
using the Deferred, that it returns.
I can't understand how to make it still return a Deferred, corresponding 
to that file, but not start downloading right away, but instead start 
downloading it on some kind of event (make a manger-like wrapper for 
that function).

So I want the code to still look simple like this:

for link in links:
    d = downloadPage_limited(link, filename)

And the wrapper(function downloadPage_limited) will manage the amount of 
concurrent downloads, and will still return the Deferred, which will be 
returned by twisted.web.client.downloadPage.

Is my idea about a "wrapper" practical and what's the general way to 
write it?
On which event is it better to decrement the counter of the amount 
currently downloading files?

Hope it is clear enough.

Thanks in advance,
Igor Katson.


From exarkun at twistedmatrix.com  Sat Oct 24 09:32:48 2009
From: exarkun at twistedmatrix.com (exarkun at twistedmatrix.com)
Date: Sat, 24 Oct 2009 13:32:48 -0000
Subject: [Twisted-web] Limit the
	simultaneous	twisted.web.client.downloadPage requests
In-Reply-To: <4AE2FF31.9080506@gmail.com>
References: <4AE2FF31.9080506@gmail.com>
Message-ID: <20091024133248.11571.1868868150.divmod.xquotient.1469@localhost.localdomain>

On 01:20 pm, descentspb at gmail.com wrote:
>Hello!
>
>I am a newbie in twisted, sorry if my question sounds awkward.
>
>I have written a pretty simple recursive page downloader, which parses
>an html, extracts all the needed links from it, and starts dowloading
>them. The links are the videofiles, so they are pretty large. The
>problem is, that the downloader works TOO FAST :) I want to set
>something like the global bandwidth limit or the maximum limit of
>concurrently downloading files.
>
>I am using the twisted.web.client.downloadPage to download the files 
>and
>using the Deferred, that it returns.
>I can't understand how to make it still return a Deferred, 
>corresponding
>to that file, but not start downloading right away, but instead start
>downloading it on some kind of event (make a manger-like wrapper for
>that function).
>
>So I want the code to still look simple like this:
>
>for link in links:
>    d = downloadPage_limited(link, filename)
>
>And the wrapper(function downloadPage_limited) will manage the amount 
>of
>concurrent downloads, and will still return the Deferred, which will be
>returned by twisted.web.client.downloadPage.
>
>Is my idea about a "wrapper" practical and what's the general way to
>write it?
>On which event is it better to decrement the counter of the amount
>currently downloading files?

Yes, that's a good idea.

You might be able to use twisted.internet.defer.DeferredSemaphore to 
handle all of the counting for you.  For example,

    from twisted.internet.defer import DeferredSemaphore
    from twisted.web.client import downloadPage

    class LimitedDownloader:
        def __init__(self, howMany):
            self._semaphore = DeferredSemaphore(howMany)

        def downloadPage(self, *a, **kw):
            return self._semaphore.run(downloadPage, *a, **kw)

    downloader = LimitedDownloader(3)
    downloader.downloadPage(...)

In this example, DeferredSemaphore.run will only let 3 downloadPage 
calls run concurrently.  If a 4th is attempted before any earlier ones 
finish, it won't actually be called until one of the earlier ones does 
finish, and then it will be called.
Jean-Paul


From terry at jon.es  Sat Oct 24 09:39:27 2009
From: terry at jon.es (Terry Jones)
Date: Sat, 24 Oct 2009 15:39:27 +0200
Subject: [Twisted-web] Limit the
	simultaneous	twisted.web.client.downloadPage requests
In-Reply-To: Your message at 17:20:49 on Saturday, 24 October 2009
References: <4AE2FF31.9080506@gmail.com>
Message-ID: <19171.911.629630.210805@jon.es>

Hi Igor

Check out http://jcalderone.livejournal.com/24285.html from JP Calderone.
It does a good bit of what you want. It might be a little difficult to
understand, so feel free to come back with questions. Also check the
underlying Cooperator API docs at

  http://twistedmatrix.com/documents/current/api/twisted.internet.task.Cooperator.html

Terry


From descentspb at gmail.com  Sat Oct 24 09:43:08 2009
From: descentspb at gmail.com (Igor Katson)
Date: Sat, 24 Oct 2009 17:43:08 +0400
Subject: [Twisted-web] Limit the
 simultaneous	twisted.web.client.downloadPage requests
In-Reply-To: <20091024133248.11571.1868868150.divmod.xquotient.1469@localhost.localdomain>
References: <4AE2FF31.9080506@gmail.com>
	<20091024133248.11571.1868868150.divmod.xquotient.1469@localhost.localdomain>
Message-ID: <4AE3046C.9080607@gmail.com>

exarkun at twistedmatrix.com wrote:
> On 01:20 pm, descentspb at gmail.com wrote:
>> Hello!
>>
>> I am a newbie in twisted, sorry if my question sounds awkward.
>>
>> I have written a pretty simple recursive page downloader, which parses
>> an html, extracts all the needed links from it, and starts dowloading
>> them. The links are the videofiles, so they are pretty large. The
>> problem is, that the downloader works TOO FAST :) I want to set
>> something like the global bandwidth limit or the maximum limit of
>> concurrently downloading files.
>>
>> I am using the twisted.web.client.downloadPage to download the files 
>> and
>> using the Deferred, that it returns.
>> I can't understand how to make it still return a Deferred, 
>> corresponding
>> to that file, but not start downloading right away, but instead start
>> downloading it on some kind of event (make a manger-like wrapper for
>> that function).
>>
>> So I want the code to still look simple like this:
>>
>> for link in links:
>>    d = downloadPage_limited(link, filename)
>>
>> And the wrapper(function downloadPage_limited) will manage the amount 
>> of
>> concurrent downloads, and will still return the Deferred, which will be
>> returned by twisted.web.client.downloadPage.
>>
>> Is my idea about a "wrapper" practical and what's the general way to
>> write it?
>> On which event is it better to decrement the counter of the amount
>> currently downloading files?
> 
> Yes, that's a good idea.
> 
> You might be able to use twisted.internet.defer.DeferredSemaphore to 
> handle all of the counting for you.  For example,
> 
>     from twisted.internet.defer import DeferredSemaphore
>     from twisted.web.client import downloadPage
> 
>     class LimitedDownloader:
>         def __init__(self, howMany):
>             self._semaphore = DeferredSemaphore(howMany)
> 
>         def downloadPage(self, *a, **kw):
>             return self._semaphore.run(downloadPage, *a, **kw)
> 
>     downloader = LimitedDownloader(3)
>     downloader.downloadPage(...)
> 
> In this example, DeferredSemaphore.run will only let 3 downloadPage 
> calls run concurrently.  If a 4th is attempted before any earlier ones 
> finish, it won't actually be called until one of the earlier ones does 
> finish, and then it will be called.

Thanks for quick and great help, Terry and Jean-Paul!



From terry at jon.es  Sat Oct 24 09:59:16 2009
From: terry at jon.es (Terry Jones)
Date: Sat, 24 Oct 2009 15:59:16 +0200
Subject: [Twisted-web] Limit
	the	simultaneous	twisted.web.client.downloadPage requests
In-Reply-To: Your message at 17:43:08 on Saturday, 24 October 2009
References: <4AE2FF31.9080506@gmail.com>
	<20091024133248.11571.1868868150.divmod.xquotient.1469@localhost.localdomain>
	<4AE3046C.9080607@gmail.com>
Message-ID: <19171.2100.633773.147971@jon.es>

> Thanks for quick and great help, Terry and Jean-Paul!

You're welcome. If in any doubt about conflicting advice, do what JP suggests.

The reason I pointed you to JP's Cooperator solution was that when you
extract the set of links from a page that you also want to fetch, you could
make another generator and submit that to the same cooperator's coiterate
function. That would just schedule the additional getPage calls to be run.

The only wrinkle (I think) in that is that in doing the very last getPage,
the cooperator will run out of more work and fire the deferred you got
originally. But the final page may contain more links. I'm not sure if I'm
thinking clearly about that final bit. That's your job :-)

Terry


From exarkun at twistedmatrix.com  Sat Oct 24 10:14:27 2009
From: exarkun at twistedmatrix.com (exarkun at twistedmatrix.com)
Date: Sat, 24 Oct 2009 14:14:27 -0000
Subject: [Twisted-web] Limit the
	simultaneous	twisted.web.client.downloadPage requests
In-Reply-To: <19171.2100.633773.147971@jon.es>
References: <4AE2FF31.9080506@gmail.com>
	<20091024133248.11571.1868868150.divmod.xquotient.1469@localhost.localdomain>
	<4AE3046C.9080607@gmail.com> <19171.2100.633773.147971@jon.es>
Message-ID: <20091024141427.11571.1937225544.divmod.xquotient.1479@localhost.localdomain>

On 01:59 pm, terry at jon.es wrote:
>>Thanks for quick and great help, Terry and Jean-Paul!
>
>You're welcome. If in any doubt about conflicting advice, do what JP 
>suggests.
>
>The reason I pointed you to JP's Cooperator solution was that when you
>extract the set of links from a page that you also want to fetch, you 
>could
>make another generator and submit that to the same cooperator's 
>coiterate
>function. That would just schedule the additional getPage calls to be 
>run.
>
>The only wrinkle (I think) in that is that in doing the very last 
>getPage,
>the cooperator will run out of more work and fire the deferred you got
>originally. But the final page may contain more links. I'm not sure if 
>I'm
>thinking clearly about that final bit. That's your job :-)

cooperator and DeferredSemaphore are probably both good solutions. 
There's not much reason to prefer one over the other. :)

Jean-Paul


From descentspb at gmail.com  Sat Oct 24 10:21:47 2009
From: descentspb at gmail.com (Igor Katson)
Date: Sat, 24 Oct 2009 18:21:47 +0400
Subject: [Twisted-web] Limit the
 simultaneous	twisted.web.client.downloadPage requests
In-Reply-To: <20091024141427.11571.1937225544.divmod.xquotient.1479@localhost.localdomain>
References: <4AE2FF31.9080506@gmail.com>	<20091024133248.11571.1868868150.divmod.xquotient.1469@localhost.localdomain>	<4AE3046C.9080607@gmail.com>
	<19171.2100.633773.147971@jon.es>
	<20091024141427.11571.1937225544.divmod.xquotient.1479@localhost.localdomain>
Message-ID: <4AE30D7B.5030200@gmail.com>

exarkun at twistedmatrix.com wrote:
> On 01:59 pm, terry at jon.es wrote:
>>> Thanks for quick and great help, Terry and Jean-Paul!
>> You're welcome. If in any doubt about conflicting advice, do what JP 
>> suggests.
>>
>> The reason I pointed you to JP's Cooperator solution was that when you
>> extract the set of links from a page that you also want to fetch, you 
>> could
>> make another generator and submit that to the same cooperator's 
>> coiterate
>> function. That would just schedule the additional getPage calls to be 
>> run.
>>
>> The only wrinkle (I think) in that is that in doing the very last 
>> getPage,
>> the cooperator will run out of more work and fire the deferred you got
>> originally. But the final page may contain more links. I'm not sure if 
>> I'm
>> thinking clearly about that final bit. That's your job :-)
> 
> cooperator and DeferredSemaphore are probably both good solutions. 
> There's not much reason to prefer one over the other. :)
> 
> Jean-Paul
> 

That list seems like far from the most active one, but the one filled 
with friendly people :) The thing I like when dealing with Twisted and 
it's documentation is that it is seen often that people who make it, and 
who use it, really love Twisted.


From terry at jon.es  Sat Oct 24 10:49:03 2009
From: terry at jon.es (Terry Jones)
Date: Sat, 24 Oct 2009 16:49:03 +0200
Subject: [Twisted-web] Limit
	the	simultaneous	twisted.web.client.downloadPage requests
In-Reply-To: Your message at 18:21:47 on Saturday, 24 October 2009
References: <4AE2FF31.9080506@gmail.com>
	<20091024133248.11571.1868868150.divmod.xquotient.1469@localhost.localdomain>
	<4AE3046C.9080607@gmail.com> <19171.2100.633773.147971@jon.es>
	<20091024141427.11571.1937225544.divmod.xquotient.1479@localhost.localdomain>
	<4AE30D7B.5030200@gmail.com>
Message-ID: <19171.5087.380228.864022@jon.es>

> That list seems like far from the most active one, but the one filled
> with friendly people :) The thing I like when dealing with Twisted and
> it's documentation is that it is seen often that people who make it, and
> who use it, really love Twisted.

Yes. Without the community, Twisted would mainly be an adjective :-)

Terry


From michal.dtz at gmail.com  Sun Oct 25 04:55:37 2009
From: michal.dtz at gmail.com (=?iso-8859-2?Q?Micha=B3_Pasternak?=)
Date: Sun, 25 Oct 2009 09:55:37 +0100
Subject: [Twisted-web] Limit
	the	simultaneous	twisted.web.client.downloadPage requests
In-Reply-To: <20091024141427.11571.1937225544.divmod.xquotient.1479@localhost.localdomain>
References: <4AE2FF31.9080506@gmail.com>	<20091024133248.11571.1868868150.divmod.xquotient.1469@localhost.localdomain>	<4AE3046C.9080607@gmail.com>
	<19171.2100.633773.147971@jon.es>
	<20091024141427.11571.1937225544.divmod.xquotient.1479@localhost.localdomain>
Message-ID: <4ae41285.25e2660a.3124.7e54@mx.google.com>

... can.. not.. reist.. posting...

http://oubiwann.blogspot.com/2008/06/async-batching-with-twisted-walkthrough
.html :-) 

-- 
M




From namanvit at gmail.com  Tue Oct 27 01:48:25 2009
From: namanvit at gmail.com (naman jain)
Date: Tue, 27 Oct 2009 06:48:25 +0100
Subject: [Twisted-web] Tracking the progress of the server
Message-ID: <74b1256b0910262248k51787554l934d1f339b782a15@mail.gmail.com>

Hi,

I have a client server model in twisted, where the server spawns a thread (
basically a test script in python that runs for about 20 mins)
I want to track the progress of the thread, and send the progress to the
client back

So, I write something like this in my server:

parent_conn, child_conn = Pipe()
thread = Process(target = start_test.main_func, args=(SCRIPT_PATH,
TEMP_OUTPUT_PATH, self.output_name, child_conn))
thread.start()

response = parent_conn.recv()
print response //prints like: initialization done
self.transport.write(response)


response = parent_conn.recv()
print response // configuration done
self.transport.write(response)

.
.
.

thread.join()


But the transport.write calls don't send at the same time. instead they wait
for the thread to finish (coz of thread.join) and then append all the
response and send it back; like "initialization doneconfiguration
done...done"
thereby defeating the purpose of creating a thread.

How do I give the control to the reactor to write the data back, and still
keep the thread running?
or is there any other way these kinda of progress can be tracked ?
I am kinda stuck with this :(
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-web/attachments/20091027/d7bb2957/attachment.htm 

From dialtone at gmail.com  Tue Oct 27 14:43:00 2009
From: dialtone at gmail.com (Valentino Volonghi)
Date: Tue, 27 Oct 2009 11:43:00 -0700
Subject: [Twisted-web] Limit the simultaneous
	twisted.web.client.downloadPage requests
In-Reply-To: <4AE2FF31.9080506@gmail.com>
References: <4AE2FF31.9080506@gmail.com>
Message-ID: <4B8B958B-DAB9-41F2-A072-B754C9F86493@gmail.com>


On Oct 24, 2009, at 6:20 AM, Igor Katson wrote:

> Is my idea about a "wrapper" practical and what's the general way to
> write it?
> On which event is it better to decrement the counter of the amount
> currently downloading files?


Another way that you might do this is by using this small snippet:

http://bitbucket.org/adroll/turtl/src/tip/turtl/engine.py

turtl is a project that you can use either as a proxy server in front
of all of your clients (and throttle the requests on a url basis) or
embedded in your system like this:

                 from turtl import engine
                 thr = engine.ThrottlingDeferred(parallelism, calls,  
interval)
                 dl = [thr.run(callable, *args, **kwargs) for args in  
self.args]
                 defer.DeferredList(dl).addBoth(lambda _: reactor.stop 
())

In this case you get a lot more control over the number of calls in a  
given
interval that you are allowed to make (for example Amazon Alexa allows
only 15 calls per second).

-- 
Valentino Volonghi aka Dialtone
Now Running MacOSX 10.6
http://www.adroll.com/



From eric.medina.atienza at gmail.com  Wed Oct 28 03:45:30 2009
From: eric.medina.atienza at gmail.com (Eric Medina)
Date: Wed, 28 Oct 2009 15:45:30 +0800
Subject: [Twisted-web] using css with nevow
Message-ID: <9ce0c1400910280045i183136fasc7d73da078bc9c3a@mail.gmail.com>

Hi,

I have been using twisted quite a bit these last 6 months for a networked
application i'm
working on. Recently, i've decided to port the web part of the app from
spyce to nevow.
However, i have encountered a problem with using css file. My css file has
references to
image files like below:

*...
body {
    background: #EEE url(img/bg.gif);
    color: #444;
    font: normal 62.5% "Lucida Sans Unicode",sans-serif;
    margin: 0;
}
...*

The following is a test file that loads an external xml file which
references a css file:

*class TestPage(rend.Page):
    addSlash = True
    child_images = static.File('img')
    children = {'default.css': static.File('default.css')}
    docFactory = loaders.xmlfile('webtest.html')

site = appserver.NevowSite(TestPage())
reactor.listenTCP(8080, site)
reactor.run()*

The problem is that the images referenced inside the css file is not being
loaded when
the page is rendered. Can someone tell me how to fix this? This is the first
time i've used
nevow or even twisted.web.

Thank you very much.

Regards,
Eric
-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-web/attachments/20091028/4a6b216a/attachment.htm 

From michal.dtz at gmail.com  Wed Oct 28 09:25:29 2009
From: michal.dtz at gmail.com (=?iso-8859-2?Q?Micha=B3_Pasternak?=)
Date: Wed, 28 Oct 2009 14:25:29 +0100
Subject: [Twisted-web] using css with nevow
In-Reply-To: <9ce0c1400910280045i183136fasc7d73da078bc9c3a@mail.gmail.com>
References: <9ce0c1400910280045i183136fasc7d73da078bc9c3a@mail.gmail.com>
Message-ID: <4ae84641.09a1660a.7214.ffffeec2@mx.google.com>

Just add 'img' directory to rend.Page.children:

 

                children = { 'defaults.css' : static.File(.),

                                               'img':
static.File('path_to_image_directory')}

 

HTH,

-- 

m

 

From: twisted-web-bounces at twistedmatrix.com
[mailto:twisted-web-bounces at twistedmatrix.com] On Behalf Of Eric Medina
Sent: Wednesday, October 28, 2009 8:46 AM
To: twisted-web at twistedmatrix.com
Subject: [Twisted-web] using css with nevow

 

Hi,

I have been using twisted quite a bit these last 6 months for a networked
application i'm
working on. Recently, i've decided to port the web part of the app from
spyce to nevow.
However, i have encountered a problem with using css file. My css file has
references to
image files like below:

...
body {
    background: #EEE url(img/bg.gif);
    color: #444;
    font: normal 62.5% "Lucida Sans Unicode",sans-serif;
    margin: 0;
}
...

The following is a test file that loads an external xml file which
references a css file:

class TestPage(rend.Page):
    addSlash = True
    child_images = static.File('img')
    children = {'default.css': static.File('default.css')}
    docFactory = loaders.xmlfile('webtest.html')

site = appserver.NevowSite(TestPage())
reactor.listenTCP(8080, site)
reactor.run()

The problem is that the images referenced inside the css file is not being
loaded when
the page is rendered. Can someone tell me how to fix this? This is the first
time i've used 
nevow or even twisted.web.

Thank you very much.

Regards,
Eric 

-------------- next part --------------
An HTML attachment was scrubbed...
URL: http://twistedmatrix.com/pipermail/twisted-web/attachments/20091028/ac6f2650/attachment.htm 

From bernat at luffy.cx  Wed Oct 28 14:31:48 2009
From: bernat at luffy.cx (Vincent Bernat)
Date: Wed, 28 Oct 2009 19:31:48 +0100
Subject: [Twisted-web] using css with nevow
In-Reply-To: <9ce0c1400910280045i183136fasc7d73da078bc9c3a@mail.gmail.com>
	(Eric Medina's message of "Wed, 28 Oct 2009 15:45:30 +0800")
References: <9ce0c1400910280045i183136fasc7d73da078bc9c3a@mail.gmail.com>
Message-ID: <m3eion4bfv.fsf@neo.luffy.cx>

OoO En ce doux d?but de matin?e du mercredi 28 octobre 2009, vers 08:45,
Eric Medina <eric.medina.atienza at gmail.com> disait?:

> body {
> ??? background: #EEE url(img/bg.gif);
> ??? color: #444;
> ??? font: normal 62.5% "Lucida Sans Unicode",sans-serif;
> ??? margin: 0;
> }

[...]

> class TestPage(rend.Page):
> ??? addSlash = True
> ??? child_images = static.File('img')
> ??? children = {'default.css': static.File('default.css')}
> ??? docFactory = loaders.xmlfile('webtest.html')

In  CSS,   you  should  use  url("images/bg.gif")   because  you  define
child_images (and not child_img).
-- 
panic("esp_handle: current_SC == penguin within interrupt!");
	2.2.16 /usr/src/linux/drivers/scsi/esp.c


