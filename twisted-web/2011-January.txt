From goffi at goffi.org  Thu Jan 27 19:01:49 2011
From: goffi at goffi.org (goffi)
Date: Fri, 28 Jan 2011 01:01:49 +0100
Subject: [Twisted-web] txJSONRPC: issue accesson Session information and
	returning error
Message-ID: <4D42076D.2090901@goffi.org>

G'day everybody,

I'm using TxJSON-RPC with twisted.web for a project.
In my JSON-RPC method, I want to access the Request instance to call 
getSession() (I need to identify the user which is calling the method 
with the Session instance), but the request object is not forwarded to 
jsonrpc_xxx methods. I don't see any other way than overidding the 
render method, is there any better way ?

My other issue is that I want to be able to return a jsonrpc error (when 
the user is not identified), and when I send a 
jsonrpclib.Fail(12,"hello") like in the tests, I have a HTML 500 error. 
Any suggestion ?

Thanks
Goffi


From phil at bubblehouse.org  Fri Jan 28 11:04:25 2011
From: phil at bubblehouse.org (Phil Christensen)
Date: Fri, 28 Jan 2011 11:04:25 -0500
Subject: [Twisted-web] txJSONRPC: issue accesson Session information and
	returning error
In-Reply-To: <4D42076D.2090901@goffi.org>
References: <4D42076D.2090901@goffi.org>
Message-ID: <93F717C9-4A3D-4769-AABA-F3755253FCD4@bubblehouse.org>

On Jan 27, 2011, at 7:01 PM, goffi wrote:
> G'day everybody,
> 
> I'm using TxJSON-RPC with twisted.web for a project.
> In my JSON-RPC method, I want to access the Request instance to call 
> getSession() (I need to identify the user which is calling the method 
> with the Session instance), but the request object is not forwarded to 
> jsonrpc_xxx methods. I don't see any other way than overidding the 
> render method, is there any better way ?

Technically, no. The issue is just that your approach wouldn't exactly be the "twisted way".

Instead, in one of your getChild/locateChild methods, you should be passing the user info as an argument to the constructor for your JSON-RPC resource instance, and saving it as an instance attribute. This will allow you to test your RPC resource more easily as well.

Ideally, you'll only use that user info for data purposes, not to delegate access to some method. If different users are to have different abilities, they should get different kinds of resource instances returned. But for simpler security setups, it's okay to cheat and just throw in a few if-statements.

> My other issue is that I want to be able to return a jsonrpc error (when 
> the user is not identified), and when I send a 
> jsonrpclib.Fail(12,"hello") like in the tests, I have a HTML 500 error. 
> Any suggestion ?

I think you might just need to use jsonrpclib.Fault, not Fail.

-phil

From exarkun at twistedmatrix.com  Fri Jan 28 13:48:18 2011
From: exarkun at twistedmatrix.com (exarkun at twistedmatrix.com)
Date: Fri, 28 Jan 2011 18:48:18 -0000
Subject: [Twisted-web] txJSONRPC: issue accesson Session information
	and	returning error
In-Reply-To: <4D42076D.2090901@goffi.org>
References: <4D42076D.2090901@goffi.org>
Message-ID: <20110128184818.1699.1384194118.divmod.xquotient.388@localhost.localdomain>

On 12:01 am, goffi at goffi.org wrote:
>G'day everybody,
>
>I'm using TxJSON-RPC with twisted.web for a project.
>In my JSON-RPC method, I want to access the Request instance to call
>getSession() (I need to identify the user which is calling the method
>with the Session instance), but the request object is not forwarded to
>jsonrpc_xxx methods. I don't see any other way than overidding the
>render method, is there any better way ?

twisted.web.xmlrpc had the same limitation until http://tm.tl/3073 was 
resolved recently.  For that ticket we added a `withRequest` decorator. 
The same solution could most likely be applied to txjsonrpc.

Jean-Paul
>My other issue is that I want to be able to return a jsonrpc error 
>(when
>the user is not identified), and when I send a
>jsonrpclib.Fail(12,"hello") like in the tests, I have a HTML 500 error.
>Any suggestion ?
>
>Thanks
>Goffi
>
>_______________________________________________
>Twisted-web mailing list
>Twisted-web at twistedmatrix.com
>http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web


From goffi at goffi.org  Sun Jan 30 11:41:29 2011
From: goffi at goffi.org (goffi)
Date: Sun, 30 Jan 2011 17:41:29 +0100
Subject: [Twisted-web] txJSONRPC: issue accesson Session information	and
 returning error
In-Reply-To: <20110128184818.1699.1384194118.divmod.xquotient.388@localhost.localdomain>
References: <4D42076D.2090901@goffi.org>
	<20110128184818.1699.1384194118.divmod.xquotient.388@localhost.localdomain>
Message-ID: <4D4594B9.5060605@goffi.org>

Thanks for the answers. For the moment I'm saving the request to 
self.request, I like the idea of the decorator.

> I think you might just need to use jsonrpclib.Fault, not Fail.

Sorry for the typo, I'm actually using jsonrpclib.Fault and not Fail, 
but I found my (stupid !) mistake: I was raising it directly in the 
render method (the idea is: you are not identified, you can't use the 
json API) instead of managing it with JSONRPC._cbRender. I'm now doing 
that, and it works as expected.

Thanks
Goffi

On 28/01/2011 19:48, exarkun at twistedmatrix.com wrote:
> On 12:01 am, goffi at goffi.org wrote:
>> G'day everybody,
>>
>> I'm using TxJSON-RPC with twisted.web for a project.
>> In my JSON-RPC method, I want to access the Request instance to call
>> getSession() (I need to identify the user which is calling the method
>> with the Session instance), but the request object is not forwarded to
>> jsonrpc_xxx methods. I don't see any other way than overidding the
>> render method, is there any better way ?
> twisted.web.xmlrpc had the same limitation until http://tm.tl/3073 was
> resolved recently.  For that ticket we added a `withRequest` decorator.
> The same solution could most likely be applied to txjsonrpc.
>
> Jean-Paul
>> My other issue is that I want to be able to return a jsonrpc error
>> (when
>> the user is not identified), and when I send a
>> jsonrpclib.Fail(12,"hello") like in the tests, I have a HTML 500 error.
>> Any suggestion ?
>>
>> Thanks
>> Goffi
>>
>> _______________________________________________
>> Twisted-web mailing list
>> Twisted-web at twistedmatrix.com
>> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web
> _______________________________________________
> Twisted-web mailing list
> Twisted-web at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web



