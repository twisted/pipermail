<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] Buffered requests
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Buffered%20requests&In-Reply-To=6654eac404110410353e82b23d%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000804.html">
   <LINK REL="Next"  HREF="000806.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] Buffered requests</H1>
    <B>Donovan Preston</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Buffered%20requests&In-Reply-To=6654eac404110410353e82b23d%40mail.gmail.com"
       TITLE="[Twisted-web] Buffered requests">dp at ulaluma.com
       </A><BR>
    <I>Thu Nov  4 14:02:14 MST 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="000804.html">[Twisted-web] Buffered requests
</A></li>
        <LI>Next message: <A HREF="000806.html">[Twisted-web] Buffered requests
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#805">[ date ]</a>
              <a href="thread.html#805">[ thread ]</a>
              <a href="subject.html#805">[ subject ]</a>
              <a href="author.html#805">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>
On Nov 4, 2004, at 10:35 AM, Peter Hunt wrote:

&gt;<i> I'm wondering if there is a way that I can &quot;buffer&quot; a request, store
</I>&gt;<i> the output it would normally send to the client in a string, and then
</I>&gt;<i> output something different, such as a redirect, to the client.
</I>&gt;<i>
</I>&gt;<i> For example, it'd be nice if it worked like this:
</I>&gt;<i>
</I>&gt;<i> buffered_request.setHeader(&quot;Content-type&quot;,&quot;text/html&quot;)
</I>&gt;<i> buffered_request.write(&quot;&lt;html&gt;Hello %s&lt;/html&gt;&quot; %
</I>&gt;<i> buffered_request.args.get(&quot;name&quot;,[&quot;world&quot;])[0])
</I>&gt;<i> buffered_request.finish()
</I>&gt;<i> output = buffered_request.getOutput()
</I>&gt;<i> request.setHeader(&quot;Content-type&quot;,&quot;text/plain&quot;)
</I>&gt;<i> request.write(&quot;The output that will be written to the client is:\n &quot; + 
</I>&gt;<i> output)
</I>&gt;<i>
</I>&gt;<i> The end result (in the browser) should be:
</I>&gt;<i>
</I>&gt;<i> The output that will be written to the client is:
</I>&gt;<i> 200 OK
</I>&gt;<i> Content-type: text/plain
</I>&gt;<i>
</I>&gt;<i> &lt;html&gt;Hello world&lt;/html&gt;
</I>&gt;<i>
</I>&gt;<i> I've tried playing around with something called &quot;queued&quot;, but I'm not
</I>&gt;<i> sure if that's what I want. Essentially I just want to capture the
</I>&gt;<i> output of a request in a string.
</I>
You'll have to do it yourself. You could just do it explicitly by 
constructing an object around the request and doing the buffering in 
that. Or you could try being really tricky and doing something like 
this (untested):

class Foo(Resource):
     def render_GET(self, request):
         buffer = StringIO()
         original_write = request.write
         request.write = buffer.write
         original_finish = request.finish
         request.finish = lambda: (original_write(buffer.getvalue()), 
original_finish())
         self.renderTheActualPage()
         return NOT_DONE_YET

nevow's rend.Page has a &quot;buffered&quot; attribute which, when set, does all 
this for you, so you can set headers any time during the rendering 
process and the headers will not be written until the entire body has 
been rendered.

dp


</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000804.html">[Twisted-web] Buffered requests
</A></li>
	<LI>Next message: <A HREF="000806.html">[Twisted-web] Buffered requests
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#805">[ date ]</a>
              <a href="thread.html#805">[ thread ]</a>
              <a href="subject.html#805">[ subject ]</a>
              <a href="author.html#805">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
