<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] [PATCH] Are we ready for a Page.remember fix?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20%5BPATCH%5D%20Are%20we%20ready%20for%20a%20Page.remember%20fix%3F&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000902.html">
   <LINK REL="Next"  HREF="000880.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] [PATCH] Are we ready for a Page.remember fix?</H1>
    <B>Alex Levy</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20%5BPATCH%5D%20Are%20we%20ready%20for%20a%20Page.remember%20fix%3F&In-Reply-To="
       TITLE="[Twisted-web] [PATCH] Are we ready for a Page.remember fix?">mesozoic at polynode.com
       </A><BR>
    <I>Mon Nov 22 11:00:10 MST 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="000902.html">[Twisted-web] nevow tutorial
</A></li>
        <LI>Next message: <A HREF="000880.html">[Twisted-web] [PATCH] Are we ready for a Page.remember fix?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#878">[ date ]</a>
              <a href="thread.html#878">[ thread ]</a>
              <a href="subject.html#878">[ subject ]</a>
              <a href="author.html#878">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>This was suggested a long time ago, and when I tried adding it, I broke
Quotient somewhat badly. From what I can tell, the problem in Quotient which
prevented Page.remember from being changed has been fixed; I'd like to see
this patch added.

Some have suggested a SiteContext as an alternative; however, I see these
two as addressing two different concerns. A SiteContext (as described in
Roundup &lt;<A HREF="http://divmod.org/users/roundup.twistd/nevow/issue137">http://divmod.org/users/roundup.twistd/nevow/issue137</A>&gt;) would be
good for remembering data that are universal to a specific NevowSite
instance. However, this is not my use case.

In my case, I want my Realm to be able to remember objects that are
particular to a certain logged in user. The obvious example is an
ICurrentUser interface, which lets the resource hierarchy quickly reference
what user (if any) is logged in. I'm sure I'll come up with other uses, but
this is my current need. Doing this at the SiteContext level would (from
what I can tell) produce overlaps when more than one user is logged in.

So, are there any objections to Page.remember()? Even if it's not an elegant
solution, it works for me, and it's generic enough that I think it's worth
keeping.

-- 
Alex Levy
WWW: <A HREF="http://mesozoic.geecs.org/">http://mesozoic.geecs.org/</A>
 
&quot;Never let your sense of morals prevent you from doing what is right.&quot;
 -- Salvor Hardin, Isaac Asimov's _Foundation_
-------------- next part --------------
Index: nevow/rend.py
===================================================================
--- nevow/rend.py       (revision 847)
+++ nevow/rend.py       (working copy)
@@ -247,7 +247,8 @@

     docFactory = None
     original = None
-
+    toremember = None
+
     def __init__(self, original=None, docFactory=None):
         if original is not None:
             self.original = original
@@ -289,16 +290,7 @@
         XXX THIS IS DEPRECATED. The page context is now passed to various
         Page apis. Remember things there instead.
         &quot;&quot;&quot;
-        import sys
-        frame = sys._getframe()
-        done = False
-        while not done:
-            for ctx in frame.f_locals.values():
-                if isinstance(ctx, PageContext):
-                    done=True
-                    break
-            frame = frame.f_back
-        ctx.remember(obj, inter)
+        self.toremember.append((obj, inter))

     def rememberStuff(self, ctx):
         ctx.remember(self, inevow.IRenderer)
Index: nevow/context.py
===================================================================
--- nevow/context.py    (revision 847)
+++ nevow/context.py    (working copy)
@@ -235,9 +235,14 @@
     IRendererFactory
     IData
     &quot;&quot;&quot;
-    context = property(getRequestContext)

+    def __init__(self, *args, **kw):
+        FactoryContext.__init__(self, *args, **kw)
+        if self.tag is not None and hasattr(self.tag, 'toremember'):
+            for i in self.tag.toremember:
+                self.remember(*i)

+    context = property(getRequestContext)

 # TTT: To stay here.
 NodeNotFound = stan.NodeNotFound # XXX: DeprecationWarning?

</PRE>









<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000902.html">[Twisted-web] nevow tutorial
</A></li>
	<LI>Next message: <A HREF="000880.html">[Twisted-web] [PATCH] Are we ready for a Page.remember fix?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#878">[ date ]</a>
              <a href="thread.html#878">[ thread ]</a>
              <a href="subject.html#878">[ subject ]</a>
              <a href="author.html#878">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
