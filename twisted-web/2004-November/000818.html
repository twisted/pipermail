<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] reverse proxy with nevow
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20reverse%20proxy%20with%20nevow&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000817.html">
   <LINK REL="Next"  HREF="000819.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] reverse proxy with nevow</H1>
    <B>Mike Mueller</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20reverse%20proxy%20with%20nevow&In-Reply-To="
       TITLE="[Twisted-web] reverse proxy with nevow">pyp at gmx.net
       </A><BR>
    <I>Sun Nov  7 05:36:19 MST 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="000817.html">[Twisted-web] RE: [Twisted-Python] Log in - state of the art?
</A></li>
        <LI>Next message: <A HREF="000819.html">[Twisted-web] reverse proxy with nevow
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#818">[ date ]</a>
              <a href="thread.html#818">[ thread ]</a>
              <a href="subject.html#818">[ subject ]</a>
              <a href="author.html#818">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>After fiddling for quite a while I am running out of ideas how get the 
following to work.

I would like to run a nevow site on port 8080 on the same machine I run a 
twisted web
server that serves static pages. Instead of showing the 8080 in the address 
I would like
to run the nevow site as VHostMonsterResource.

My twisted web server looks like this:

#twistedStaticServer.py

from twisted.web import vhost, static, server, proxy
from twisted.application import internet, service
import os

vhostDir = '..\hosts'
root = vhost.NameVirtualHost()
dir = 'domain1.com'
root.addHost(dir, static.File(os.path.join(vhostDir, dir)))
vhostName = 'domain2.com'
reverseProxy = proxy.ReverseProxyResource('localhost', 8080,
                                           '/vhost/http/'+vhostName)
root.addHost(vhostName, reverseProxy)
application = service.Application('web')
sc = service.IServiceCollection(application)
site = server.Site(root)
i = internet.TCPServer(80, site)
i.setServiceParent(sc)

The nevow site looks like this:

#nevowProxy.py

import random
from nevow import appserver, vhost
from twisted.application import internet, service
from nevow import rend, tags
from nevow import loaders

vResource = vhost.VHostMonsterResource()

class VHostGreeter(rend.Page):
     docFactory = loaders.stan(
     tags.html[
     tags.head[ tags.title[ &quot;Runnig as VHostMonsterResource&quot; ]],
     tags.body[
         tags.h1(style=&quot;font-size: large&quot;)[ &quot;This works.&quot; ]
     ]
])

default = VHostGreeter()
default.putChild(&quot;vhost&quot;, vResource)

application = service.Application('web-proxy')
sc = service.IServiceCollection(application)
site = appserver.NevowSite(default)
i = internet.TCPServer(8080, site)
i.setServiceParent(sc)

After modifying /etc/hosts (or C:\WINNT\system32\drivers\etc\hosts):

127.0.0.1       domain1.com
127.0.0.1       domain2.com


domain1.com works as expected. It serves static pages out of the given 
directory.

Also domain2.com:8080 works.

But domain2.com just shows an empty page.

I tested this with Opera 7.11 and IE 6.0.

The nevow server gets an GET request. There is no difference in the server 
messages
between a direct call (8080) or using it as a reverse proxy:

Opera:

domain2.com:
2004/11/07 13:06 Westeurop&#245;ische Normalzeit [HTTPChannel,1,127.0.0.1] 127.0.0.1
- - [07/Nov/2004:12:06:20 +0000] &quot;GET / HTTP/1.0&quot; 200 129 &quot;-&quot; &quot;Mozilla/4.0 
(comp
atible; MSIE 6.0; Windows NT 5.0) Opera 7.11  [de]&quot;

domain2.com:8080:
2004/11/07 13:06 Westeurop&#245;ische Normalzeit [HTTPChannel,2,127.0.0.1] 127.0.0.1
- - [07/Nov/2004:12:06:32 +0000] &quot;GET / HTTP/1.1&quot; 200 129 &quot;-&quot; &quot;Mozilla/4.0 
(comp
atible; MSIE 6.0; Windows NT 5.0) Opera 7.11  [de]&quot;

IE6.0:

domain2.com:
2004/11/07 13:07 Westeurop&#245;ische Normalzeit [HTTPChannel,3,127.0.0.1] 127.0.0.1
- - [07/Nov/2004:12:07:25 +0000] &quot;GET / HTTP/1.1&quot; 200 129 &quot;-&quot; &quot;Mozilla/4.0 
(comp
atible; MSIE 6.0; Windows NT 5.0)&quot;

domain2.com:8080:
2004/11/07 13:07 Westeurop&#245;ische Normalzeit [HTTPChannel,4,127.0.0.1] 127.0.0.1
- - [07/Nov/2004:12:07:46 +0000] &quot;GET / HTTP/1.1&quot; 200 129 &quot;-&quot; &quot;Mozilla/4.0 
(comp
atible; MSIE 6.0; Windows NT 5.0)&quot;

The twisted web server shows the following messages:

2004/11/07 13:07 Westeurop&#245;ische Normalzeit [HTTPChannel,2,127.0.0.1] 
Starting f
actory &lt;twisted.web.proxy.ProxyClientFactory instance at 0x00B716E8&gt;
2004/11/07 13:07 Westeurop&#245;ische Normalzeit [ProxyClient,client] Stopping 
factor
y &lt;twisted.web.proxy.ProxyClientFactory instance at 0x00B716E8&gt;

How do get the page display when requesting domain2.com?

Thanks.

Mike


</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000817.html">[Twisted-web] RE: [Twisted-Python] Log in - state of the art?
</A></li>
	<LI>Next message: <A HREF="000819.html">[Twisted-web] reverse proxy with nevow
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#818">[ date ]</a>
              <a href="thread.html#818">[ thread ]</a>
              <a href="subject.html#818">[ subject ]</a>
              <a href="author.html#818">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
