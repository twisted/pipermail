<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] Is there a way to implement a deferred sequence?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Is%20there%20a%20way%20to%20implement%20a%20deferred%20sequence%3F&In-Reply-To=20090410094128.GJ9889%40ruber.office.udmvt.ru">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004131.html">
   <LINK REL="Next"  HREF="004134.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] Is there a way to implement a deferred sequence?</H1>
    <B>Andrew Bennetts</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Is%20there%20a%20way%20to%20implement%20a%20deferred%20sequence%3F&In-Reply-To=20090410094128.GJ9889%40ruber.office.udmvt.ru"
       TITLE="[Twisted-web] Is there a way to implement a deferred sequence?">andrew at bemusement.org
       </A><BR>
    <I>Fri Apr 10 09:28:00 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="004131.html">[Twisted-web] Is there a way to implement a deferred sequence?
</A></li>
        <LI>Next message: <A HREF="004134.html">[Twisted-web] Is there a way to implement a deferred sequence?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4133">[ date ]</a>
              <a href="thread.html#4133">[ thread ]</a>
              <a href="subject.html#4133">[ subject ]</a>
              <a href="author.html#4133">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Alexey S. wrote:
&gt;<i> On Fri, Apr 10, 2009 at 08:43:39AM -0000, <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">glyph at divmod.com</A> wrote:
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; Because Deferreds are intended to be an asynchronous mechanism for  
</I>&gt;<i> &gt; control flow.  They are the way to return a value which is not yet  
</I>&gt;<i> &gt; present.  In other words they are an asynchronous version of exit  
</I>&gt;<i> &gt; semantics; &quot;return&quot; and &quot;raise&quot;.
</I>&gt;<i> &gt;
</I>&gt;<i> &gt; They are very explicitly *not* designed to simultaneously implement  
</I>&gt;<i> &gt; asynchronous versions of every other potential control flow - looping,  
</I>&gt;<i> &gt; for example, which seems to be what you want.
</I>&gt;<i> 
</I>&gt;<i> Yes, but there is no synchronous version of what I want, I can't name any.
</I>&gt;<i> Asynchronousness adds some more capabilities to be introduced into flow control.
</I>&gt;<i> &gt;From my perception Deferred is a point where two entities exchange events
</I>&gt;<i> (one send, other receive)
</I>
A Deferred's purpose is to provide a mechanism for one entity to communicate a
single result to another.  You're asking for it to do something else, therefore
(by definition, basically) you're asking for something other than a Deferred.

What Deferred provides is pretty similar to just passing in a callback to an
async function, except it's much more convenient.  And like passing callbacks
directly it's a building block for richer control flow, not an all-in-one answer
to every problem.

&gt;<i> And if we think about Deferred as an event router, then my question was
</I>&gt;<i> &quot;why there is only two types of events possible and both of them are 'final' events?&quot;
</I>
If you need more events, you can make multiple Deferreds.  in your case you
wanted an event to fire when a set of work has completed &#8212; ok, that's one
Deferred right there, with a simple object to track the outstanding work and
fire that Deferred when the amount of remaining work is zero.  Each of those
individual items of work may also have a corresponding Deferred to report their
individual results.

Or as Glyph says, you may simply want to have an object that is called directly
every time some event happens.  Or some combination of the above.

&gt;<i> I just asked about subclassing that event router to include capability
</I>&gt;<i> to route some other events in addition to two existing.
</I>&gt;<i> It is worth noting, that such improvement does not forbid Deferred from being
</I>&gt;<i> &quot;the way to return a value which is not yet present&quot;. It just make the term
</I>&gt;<i> &quot;value&quot; more complex, allows it to be dispersed in time, not only concentrated
</I>&gt;<i> at a single moment. I think there is no natural analogy for synchronous flow
</I>&gt;<i> control and can't be - results are not synchronous.
</I>&gt;<i> Perhaps the thing I am talking about should not be called &quot;Deferred&quot;, since
</I>&gt;<i> it is only asynchronous version of syncronous flow control. But for me
</I>&gt;<i> extending Deferred looks natural, that is why I am asking.
</I>
No, Deferred is very definitely not about multiple events (which is what
multiple values over time are, unless you only want to deal with a final,
single, aggregated value).  Deferred may be a useful building block for a the
thing you are talking about, but it is definitely not a natural extension of it.

&gt;<i> &gt; There are other mechanisms for doing those things.  For example, if you  
</I>&gt;<i> &gt; want to get a stream of data and handle it incrementally, you want to  
</I>&gt;<i> &gt; implement an IProtocol or ITransport.  Trying to cram all of IProtocol  
</I>&gt;<i> &gt; into Deferred is a mistake.
</I>&gt;<i> IProtocol and ITransport looks like being a byte-oriented interfaces, not
</I>&gt;<i> an arbitrary-object-oriented.
</I>
They were just an example.  It's not hard to imagine examples using richer
objects than bytes, e.g. with methods like &#8220;recordReceived&#8221;, &#8220;accountCreated&#8221; or
&#8220;buttonPressed&#8221; or &#8220;cpuOnFire&#8221; rather than &#8220;bytesReceived&#8221;.  The interesting
part of e.g. IProtocol is that &#8220;bytesReceived&#8221; can be (and usually is) called
many times rather than once.

By the way, I can imagine a similar transformation to passing in an IProtocol
class, analagous to the transformation of replacing passing in a callback
function with making that function return a Deferred which you then add the
callback to.  So instead of e.g.:

    clientCreator = ClientCreator(reactor, MyProtocolClass)
    d = clientCreator.connectTCP(host, port)
    d.addCallback(doSomethingWithProtocolInstance)

I suppose you could avoid passing the protocol up front:

    clientCreator = HypotheticalDeferringClientCreator(reactor)
    d = clientCreator.connectTCP(host, port)
    def connectionMade(transport):
        protocolInstance = MyProtocolClass()
        protocolInstance.makeConnection(transport)
        return protocolInstance
    d.addCallback(connectionMade)
    d.addCallback(doSomethingWithProtocolInstance)

But really that's just reinventing twisted.internet.protocol.Factory in a less
convenient form...

My point here is basically just that there isn't a single API or design pattern
that is best in every situation.

[...]
&gt;<i> I am asking for an half-duplex Event-pipe which can be closed from the sending end.
</I>&gt;<i> Just as variant it can be used to deliver cumulative results, but not fixed to that.
</I>&gt;<i> I said &quot;Deferred&quot; because the implementation of such thing will be identical to
</I>&gt;<i> Deferred's. It will be a Deferred with additional callback(s) which is(are) not
</I>&gt;<i> restricted to be invoked only once. 
</I>
So, &#8220;identical&#8221; except for some fundamental bits that are radically different? :)

Seriously, the extra complexity of the semantics you want is way beyond the
scope of what's reasonable for Deferred.  Handling multiple events is vastly
more complicated in the general case than handling a single result (consider for
instance the various options on DeferredList, and still that API can't even
handle common situations like a dynamically sized list of results, as you've
noticed).  That's not to say that what you want is unreasonable, just that what
you want isn't called &#8220;Deferred&#8221;.  Deferred does one thing, and does it very
well.

-Andrew.


</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004131.html">[Twisted-web] Is there a way to implement a deferred sequence?
</A></li>
	<LI>Next message: <A HREF="004134.html">[Twisted-web] Is there a way to implement a deferred sequence?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4133">[ date ]</a>
              <a href="thread.html#4133">[ thread ]</a>
              <a href="subject.html#4133">[ subject ]</a>
              <a href="author.html#4133">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
