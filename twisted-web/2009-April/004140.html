<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] Finer-Grained Security System for Twisted Web/Nevow?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Finer-Grained%20Security%20System%20for%20Twisted%20Web/Nevow%3F&In-Reply-To=10c877d90904191732i43f7a15ejfac05325ebd9e3e1%40mail.gmail.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004139.html">
   <LINK REL="Next"  HREF="004141.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] Finer-Grained Security System for Twisted Web/Nevow?</H1>
    <B>Jeff Rush</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Finer-Grained%20Security%20System%20for%20Twisted%20Web/Nevow%3F&In-Reply-To=10c877d90904191732i43f7a15ejfac05325ebd9e3e1%40mail.gmail.com"
       TITLE="[Twisted-web] Finer-Grained Security System for Twisted Web/Nevow?">jeff at taupro.com
       </A><BR>
    <I>Mon Apr 20 06:08:56 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="004139.html">[Twisted-web] Finer-Grained Security System for Twisted Web/Nevow?
</A></li>
        <LI>Next message: <A HREF="004141.html">[Twisted-web] Finer-Grained Security System for Twisted Web/Nevow?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4140">[ date ]</a>
              <a href="thread.html#4140">[ thread ]</a>
              <a href="subject.html#4140">[ subject ]</a>
              <a href="author.html#4140">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Michal Pasternak wrote:
&gt;<i> 2009/4/19 Jeff Rush &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">jeff at taupro.com</A>&gt;:
</I>&gt;<i> [...]
</I>&gt;&gt;<i> 2) Alternatively, one could dynamically generate a custom tree of
</I>&gt;&gt;<i>                        pages/resources within the realm object, returning a
</I>&gt;&gt;<i> different tree depending                           upon the
</I>&gt;&gt;<i> identity/permissions of the user.
</I>&gt;<i> 
</I>&gt;<i> I think this is the preferred approach ATM.
</I>&gt;<i> 
</I>&gt;&gt;<i>  This would seem to make it
</I>&gt;&gt;<i>                 complicated to (a) guarantee that all visitors see the exact
</I>&gt;&gt;<i> same URL                                   structure and,
</I>&gt;<i> 
</I>&gt;<i> You can share the same URL mapper between all users of you site.
</I>
Hmmm, I'm not aware of a centralized URL mapper in the Twisted framework as
there is in other Python frameworks that use regular expression mappers.
AFAIK, in Twisted, the URL tree is constructed piece by piece using a series
of .putChild('segment', resource) calls (or child_XXX class attributes) which
if you construct a complex tree with lots of conditionals based on the access
rights of the user, can be messy.



&gt;&gt;<i> (b) consume more
</I>&gt;&gt;<i> time/memory with constructing duplicate page/resource trees when thousands of
</I>&gt;&gt;<i> users may be visiting the site, with a mix of permissions.
</I>&gt;<i> 
</I>&gt;<i> You don't have to duplicate page resources; you can create a single
</I>&gt;<i> resource and return it for as many users as you want.
</I>
WHile users with identical roles can share resource trees, it seems you'd need
a unique tree for each 'kind' of user.


&gt;&gt;<i> I'm thinking I'll have to write something like decorators for page resources
</I>&gt;&gt;<i> that front-end the locateChild method (for access control over traversal),
</I>&gt;&gt;<i> and perhaps the renderHTTP method (for access control over page delivery) with
</I>&gt;&gt;<i>                         permissions checking logic.
</I>&gt;<i> 
</I>&gt;<i> What is your permission model exactly? What kind of limitations of
</I>&gt;<i> current guard implementation would you like to solve?
</I>
It is role-based, where a user can possess a mix of multiple roles, such as
user A is (member, ), user B is (member, instructor), user C is (admin, ).
For that scenario I'd need three resource trees that include/exclude different
things.  I could pre-build trees for all possible combinations of roles, or
build on demand and cache the last N trees keyed by role combination.  Not
very elegant though.

Instead I'm looking for something more like:

  @access('instructor')
  class StudentRosterPage(rend.Page):
     ...

where after traversal ends, a page's renderHTTP() method does:

  if request.user.session.role in self.page_roles:
     ...return content


&gt;<i> I think I like the current approach... Once you learn how to use it
</I>&gt;<i> and how to set it up properly (this is a key phrase here), it will
</I>&gt;<i> take a few things off your head. Even if setting it up is cumbersome,
</I>&gt;<i> the idea of web resource wrapping an avatar object is pretty cool,
</I>
It is pretty cool - and that is why I'm asking because Twisted has always
introduced me to new ideas and ways of doing things.  Perhaps there is
significant security leverage already in there I'm not understanding, or maybe
most people using Twisted roll their own web security mechanisms.  The avatar
approach certainly is a perfect fit for guarding SSH, IMAP, POP3 and such
services.  It just seems a bit awkward for fine-grained websites with a mix of
access.


&gt;<i> as
</I>&gt;<i> you don't have to put access control logic into web resource objects
</I>&gt;<i> -- you just enable these and these resources for that level of
</I>&gt;<i> privleges, which in fact gives you fine-grained security model. If you
</I>&gt;<i> look for a tool, that handles setting up such things for you and lets
</I>&gt;<i> you just concentrate on the code, there's Divmod Mantissa;
</I>&gt;<i> unfortunatley, it is not a very well documented piece of software.
</I>
I can see both sides of the issue of whether to place your access control
logic into resources or centralize it into the part that builds up your
website (realm/avatar) ie. a .tac file.  Centralization permits tighter
control over customization of use, but makes it harder to write pluggable
subsystems reusable across different applications.

My experiments so far are something along the lines of:

  class SiteSession(guard.SessionWrapper, membership.SessionMixin):

    # mixin adds new access-testing methods for current user

  # construct resource tree
  root = FrontDoor()
  membership.add_ResourcePages(root)
  return appserver.NevowSite(resource=root)



In my case, after many years with other web frameworks like Zope I'm playing
with Twisted to see how hard it is to write such a subsystem for membership
management.  Basically a drop-in for user registration, forgotten-password
emails, generic user profile editing, login/logout panel to place into any
page, and have it as easy to use as adding an entry to a buildout.cfg and a
couple of lines to a .tac to choose your cred checkers and user info
persistence stores, and poof, a membership-based website.  I can see how to
write it but I'd rather learn from others in the Twisted community if it has
already been done.

Besides security, I'm looking for examples of smart ways to build up a complex
website from parts developed and packaged by others, without a lot of messy
wiring logic.

-Jeff

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004139.html">[Twisted-web] Finer-Grained Security System for Twisted Web/Nevow?
</A></li>
	<LI>Next message: <A HREF="004141.html">[Twisted-web] Finer-Grained Security System for Twisted Web/Nevow?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4140">[ date ]</a>
              <a href="thread.html#4140">[ thread ]</a>
              <a href="subject.html#4140">[ subject ]</a>
              <a href="author.html#4140">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
