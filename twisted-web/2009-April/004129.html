<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] Is there a way to implement a deferred sequence?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Is%20there%20a%20way%20to%20implement%20a%20deferred%20sequence%3F&In-Reply-To=18910.18959.317369.580302%40jon.es">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004128.html">
   <LINK REL="Next"  HREF="004130.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] Is there a way to implement a deferred sequence?</H1>
    <B>Alexey S.</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Is%20there%20a%20way%20to%20implement%20a%20deferred%20sequence%3F&In-Reply-To=18910.18959.317369.580302%40jon.es"
       TITLE="[Twisted-web] Is there a way to implement a deferred sequence?">twisted-web at udmvt.ru
       </A><BR>
    <I>Fri Apr 10 04:12:28 EDT 2009</I>
    <P><UL>
        <LI>Previous message: <A HREF="004128.html">[Twisted-web] Is there a way to implement a deferred sequence?
</A></li>
        <LI>Next message: <A HREF="004130.html">[Twisted-web] Is there a way to implement a deferred sequence?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4129">[ date ]</a>
              <a href="thread.html#4129">[ thread ]</a>
              <a href="subject.html#4129">[ subject ]</a>
              <a href="author.html#4129">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On Thu, Apr 09, 2009 at 09:18:39PM +0200, Terry Jones wrote:
&gt;<i> &gt;&gt;&gt;&gt;&gt; &quot;Alexey&quot; == twisted-web  &lt;<A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">twisted-web at udmvt.ru</A>&gt; writes:
</I>&gt;<i> 
</I>&gt;<i> Hi Alexey
</I>&gt;<i> 
</I>&gt;<i> Alexey&gt; I want a sequence which is Deferred with two callbacks: one as
</I>&gt;<i> Alexey&gt; usual - for the whole result called at the end of the sequence,
</I>&gt;<i> Alexey&gt; another - called for every element of the sequence (as they
</I>&gt;<i> Alexey&gt; arrive).
</I>&gt;<i> 
</I>&gt;<i> I'm pretty sure I don't understand exactly what you want. Maybe you could
</I>&gt;<i> write it in pseudo-code, showing both how you'd call the thing you want and
</I>&gt;<i> what the code to implement it would look like, at least conceptually. I
</I>&gt;<i> can't promise to help, if you can be a bit more specific it might be easier
</I>&gt;<i> to be more helpful.
</I>&gt;<i> 
</I>&gt;<i> You might find something of worth in one of my Twisted mailing list
</I>&gt;<i> soliloquies, which starts here:
</I>&gt;<i> 
</I>&gt;<i>   <A HREF="http://www.twistedmatrix.com/pipermail/twisted-python/2008-June/017904.html">http://www.twistedmatrix.com/pipermail/twisted-python/2008-June/017904.html</A>
</I>&gt;<i> 
</I>&gt;<i> I have feeling that the code Esteve Fernandez and I came up with to tackle
</I>&gt;<i> that situation might be something like what you're after.
</I>Well, that is close to my problem, but I have a feature request with somewhat more
generic requirements.

Current Deferred is used to defer a simple process, that only
have its 'start' and 'end', returning some single result object at the end.
And there is nothing between start and end, it is not allowed to look inside
that process. Once started it can only fail or finish returning a single result.

But what about deferring some more complex process, that may have zero to more
itermediate results before finishing? What if we are inside that process and have
some event, but we are not finished the process? Why can't the consumers of the
Deferred be interested in receiving that event too?
Why not augment the Deferred for that?

As an example consider running deferred the final state machine. Having only a current
Deferred it is not possible to trace the state change if the state is not changed
to the final one, since there is no callback that can be called several times for
every state change. We can only know, when the machine is entered the final state
and stopped or failed.

It is not possible to defer a process that run in stages if each stage does return some
result or if we want to trace the completion of stages, not only the whole process.
(Not possible without further complications, described in the link above.)

It would be nice if Deferred be extended to have another callback to be called for
updating the result or notifying about state change of some process.
In addition to 
  d.callback(result)
we will have something like the
  d.update_state(args)

How this may be used depends on what the process is and what are the intermediate results.
For example d.update_state may be invoked to tell the percentage of completion of the whole deferred process.
Or d.update_state may be invoked to append new item to the resulting sequence as it arrives.
Or d.update_state may be invoked to say that intermediate result should be replaced by a new one
or somehow updated in other fashion.
That could also depend on the type of the final result:
   If we are returning a list, then we may want to append items to it.
   If we are returning a tree we may want to build that tree node by node. (may we want that?)
   If we are aggregating some data series into some single result we may want to present
    current intermediate result to the observer.
   Any other process, that could be useful to observe in its dynamics, not only in its final state.

It is just the way to send/receive the events produced by some process that is deferred
in the case that events are not the 'process_finished' events.

I think that Deferred class can be extended in that way preserving full backward compatibility,
since if noone is interested in recieving intermediate events, noone will register
a callback for that and no callback will be called - noone will notice that.

&gt;<i> 
</I>&gt;<i> You may also like to think about whether you can use
</I>&gt;<i> twisted.internet.task.LoopingCall It's more flexible than it may appear at
</I>&gt;<i> first, and it also fits your pattern at least at a high-level description.
</I>Well, it can solve only a specific problem, as far as I understand.

&gt;<i> 
</I>&gt;<i> Terry
</I>&gt;<i> 
</I>
Thank for your attention and interest.

PS: Should I file a feature request? Or that feature is absolutely unnecessary to have?
PPS: Does anybody need some more detailed explanation?

-- 
Alexey S.

</PRE>


<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004128.html">[Twisted-web] Is there a way to implement a deferred sequence?
</A></li>
	<LI>Next message: <A HREF="004130.html">[Twisted-web] Is there a way to implement a deferred sequence?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4129">[ date ]</a>
              <a href="thread.html#4129">[ thread ]</a>
              <a href="subject.html#4129">[ subject ]</a>
              <a href="author.html#4129">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
