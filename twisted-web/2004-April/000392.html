<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] Twisted &amp; legacy code - Unorthodox? Opinions wanted
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Twisted%20%26%20legacy%20code%20-%20Unorthodox%3F%20Opinions%20wanted&In-Reply-To=">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="000402.html">
   <LINK REL="Next"  HREF="000393.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] Twisted &amp; legacy code - Unorthodox? Opinions wanted</H1>
    <B>Harald.Nyman at astrazeneca.com</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20Twisted%20%26%20legacy%20code%20-%20Unorthodox%3F%20Opinions%20wanted&In-Reply-To="
       TITLE="[Twisted-web] Twisted &amp; legacy code - Unorthodox? Opinions wanted">Harald.Nyman at astrazeneca.com
       </A><BR>
    <I>Thu Apr 22 06:22:56 MDT 2004</I>
    <P><UL>
        <LI>Previous message: <A HREF="000402.html">[Twisted-web] Re: Unwinding the Twisted Web (a progress report)
</A></li>
        <LI>Next message: <A HREF="000393.html">[Twisted-web] Twisted &amp; legacy code - Unorthodox? Opinions wanted
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#392">[ date ]</a>
              <a href="thread.html#392">[ thread ]</a>
              <a href="subject.html#392">[ subject ]</a>
              <a href="author.html#392">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>Apologies for a long post. Felt it was needed to get the message across.

What's described could be a creative approach to dealing with legacy code,
but it could also be an ugly hack, and I would really benefit from the views
of you gurus as to whether this looks like a good/acceptable/bad way to use
Twisted. (If 'bad' - any immediate suggestions? :))

Thanks in advance,
Harald


We have an existing web app (~10 000 lines of Python, generating HTML, with
25 cgi scripts), running on Apache. We are considering Twisted as one
alternative to make it faster and better structured. Just running the
existing code with Twisted instead of Apache doesn't increase performance
much, as CGI's process startups are the bottleneck. So, to really gain from
Twisted, I guess we need to make the code event-driven (and this would be
the ultimate goal).

Now, one design has been proposed, which boosts performance dramatically
with few code changes. It uses Twisted as a plain TCP socket server,
communicating with text strings instead of using HTTP. The browser-server
interaction is -
 - Request: &quot;scriptSelectorKeyword::formInputDict::cookiesDict&quot;
 - Response: &quot;generatedHTML&quot; (as before, but with no line breaks)

Creating the request in the browser:
All links in the page are modified to NOT trigger a GET/POST, but use
javascript to
 - scan form input (&lt;INPUT&gt;, &lt;SELECT&gt;, etc) and build formInputDict (&quot;{name:
value, ...}&quot;)
 - create a similar representation of the cookies, as cookiesDict
 - send the &quot;::&quot;-delimited string using a small applet

The server (having imported all modules used by the app at startup) -
 - evals formInputDict and cookiesDict (since they come as text strings)
 - based on scriptSelectorKeyword, invokes the appropriate module in a
thread (threads.deferToThread)
 - (we don't use CGI, so formInputDict and cookiesDict replace Python's cgi
&amp; Cookies modules)
 - the module has a &quot;getBuffer&quot; method that returns the generated HTML
instead of printing it
 - the generated HTML is written to the socket
(reactor.callFromThread(self.transport.write, html))

The browser
 - receives the generated HTML string through the applet
 - parses the cookies
 - displays the HTML, using document.write

This design is up and running with impressive performance, and the users are
enthusiastic. However, the maintenance team is less so, and these are our
main concerns (with the advocates' answers added) -

Is this really a valid way to use Twisted?
 - Think so. The docs say, &quot;Twisted still allows the use of threads if you
really need them, usually to interface with synchronous legacy code&quot;, but we
should ask the experts.

Will it scale? Will it work with future Twisted versions?
 - Hope so. See previous point.

It's not a web app anymore, it's a javascript app.
 - So? 

It locks us into MS Internet Explorer.
 - Yes. However, MSIE is our corporate standard anyway.

It can't be used through a firewall.
 - No. Luckily, this is a strictly internal app.

We don't want to rely on and maintain home-written javascript.
 - Good point. However,
   1) We're talking about roughly 2 A4 pages
   2) The javascript to handle form input &amp; cookies is meant to be general,
and once it's validated, we should not need to touch it much.
   3) If we accept being tied in with MSIE, ain't its javascript part of the
package?

We can't do unit tests on the javascript.
 - Correct. See previous point.

</PRE>








<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="000402.html">[Twisted-web] Re: Unwinding the Twisted Web (a progress report)
</A></li>
	<LI>Next message: <A HREF="000393.html">[Twisted-web] Twisted &amp; legacy code - Unorthodox? Opinions wanted
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#392">[ date ]</a>
              <a href="thread.html#392">[ thread ]</a>
              <a href="subject.html#392">[ subject ]</a>
              <a href="author.html#392">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
