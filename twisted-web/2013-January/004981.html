<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2//EN">
<HTML>
 <HEAD>
   <TITLE> [Twisted-web] [Twisted-Python] Speed of rendering?
   </TITLE>
   <LINK REL="Index" HREF="index.html" >
   <LINK REL="made" HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20%5BTwisted-Python%5D%20Speed%20of%20rendering%3F&In-Reply-To=1357324247.31399.140661173476561.11F56E5E%40webmail.messagingengine.com">
   <META NAME="robots" CONTENT="index,nofollow">
   <META http-equiv="Content-Type" content="text/html; charset=us-ascii">
   <LINK REL="Previous"  HREF="004980.html">
   <LINK REL="Next"  HREF="004985.html">
 </HEAD>
 <BODY BGCOLOR="#ffffff">
   <H1>[Twisted-web] [Twisted-Python] Speed of rendering?</H1>
    <B>exarkun at twistedmatrix.com</B> 
    <A HREF="mailto:twisted-web%40twistedmatrix.com?Subject=%5BTwisted-web%5D%20%5BTwisted-Python%5D%20Speed%20of%20rendering%3F&In-Reply-To=1357324247.31399.140661173476561.11F56E5E%40webmail.messagingengine.com"
       TITLE="[Twisted-web] [Twisted-Python] Speed of rendering?">exarkun at twistedmatrix.com
       </A><BR>
    <I>Fri Jan  4 14:58:13 EST 2013</I>
    <P><UL>
        <LI>Previous message: <A HREF="004980.html">[Twisted-web] [Twisted-Python] Speed of rendering?
</A></li>
        <LI>Next message: <A HREF="004985.html">[Twisted-web] [Twisted-Python] Speed of rendering?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4981">[ date ]</a>
              <a href="thread.html#4981">[ thread ]</a>
              <a href="subject.html#4981">[ subject ]</a>
              <a href="author.html#4981">[ author ]</a>
         </LI>
       </UL>
    <HR>  
<!--beginarticle-->
<PRE>On 06:30 pm, <A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">peter.westlake at pobox.com</A> wrote:
&gt;<i>A while back I promised to write some benchmarks for
</I>&gt;<i>twisted.web.template's flattening functions. Is something like this
</I>&gt;<i>suitable? If so, I'll add lots more test cases. The output format could
</I>&gt;<i>be improved, too - any preferences?
</I>
The output should be something that we can load into our codespeed 
instance.  The output of any of the existing benchmarks in lp:twisted- 
benchmarks should be a good example of that format (I don't even recall 
what it is right now - it may not even be a &quot;format&quot; so much as a shape 
of data to submit to an HTTP API).

The `timeit` module is probably not suitable to use to collect the data, 
as it makes some questionable choices with respect to measurement 
technique, and at the very least it's inconsistent with the rest of the 
benchmarks we have.

Selecting data to operate on is probably an important part of this 
benchmark (or collection of benchmarks).  It may not be possible to 
capture all of the interesting performance characteristics in a single 
dataset.  However, at least something that includes HTML tags is 
probably desirable, since that is the primary use-case.

There are some other Python templating systems with benchmarks.  One 
approach that might make sense is to try to build analogous benchmarks 
for twisted.web.template.  (Or perhaps a little thought will reveal that 
it's not possible to make comparisons between twisted.web.template and 
those systems, so there's no reason to follow their benchmarking lead.)

Jean-Paul
&gt;<i>Peter.
</I>&gt;<i>
</I>&gt;<i>from twisted.web.template import flatten
</I>&gt;<i>from twisted.web.server import Request
</I>&gt;<i>import twisted.web.http
</I>&gt;<i>
</I>&gt;<i>channel = twisted.web.http.HTTPChannel()
</I>&gt;<i>request = Request(channel, False)
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>def make(content):
</I>&gt;<i>    def f():
</I>&gt;<i>        d = flatten(request, content, lambda _: None)
</I>&gt;<i>        assert d.called
</I>&gt;<i>    return f
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>def test(content):
</I>&gt;<i>    return timeit.timeit(stmt=make(content), number=repeats)
</I>&gt;<i>
</I>&gt;<i>repeats = 1000
</I>&gt;<i>
</I>&gt;<i>deeplist = ['centre']
</I>&gt;<i>for n in range(100):
</I>&gt;<i>    deeplist = [deeplist]
</I>&gt;<i>
</I>&gt;<i>tests = {
</I>&gt;<i>    'empty': '',
</I>&gt;<i>    'string': 'hello',
</I>&gt;<i>    'shortlist': ['hello'],
</I>&gt;<i>    'longlist': [str(n) for n in range(100)],
</I>&gt;<i>    'deeplist': deeplist,
</I>&gt;<i>}
</I>&gt;<i>
</I>&gt;<i>
</I>&gt;<i>if __name__ == '__main__':
</I>&gt;<i>    import timeit
</I>&gt;<i>    from sys import argv
</I>&gt;<i>    for name in argv[1:] or tests:
</I>&gt;<i>        print name, test(tests[name])
</I>&gt;<i>
</I>&gt;<i>_______________________________________________
</I>&gt;<i>Twisted-web mailing list
</I>&gt;<i><A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">Twisted-web at twistedmatrix.com</A>
</I>&gt;<i><A HREF="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web</A>
</I>
</PRE>



<!--endarticle-->
    <HR>
    <P><UL>
        <!--threads-->
	<LI>Previous message: <A HREF="004980.html">[Twisted-web] [Twisted-Python] Speed of rendering?
</A></li>
	<LI>Next message: <A HREF="004985.html">[Twisted-web] [Twisted-Python] Speed of rendering?
</A></li>
         <LI> <B>Messages sorted by:</B> 
              <a href="date.html#4981">[ date ]</a>
              <a href="thread.html#4981">[ thread ]</a>
              <a href="subject.html#4981">[ subject ]</a>
              <a href="author.html#4981">[ author ]</a>
         </LI>
       </UL>

<hr>
<a href="http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web">More information about the Twisted-web
mailing list</a><br>
</body></html>
