From huasha1985 at gmail.com  Mon Jan 27 10:58:00 2014
From: huasha1985 at gmail.com (Sha Hua)
Date: Mon, 27 Jan 2014 09:58:00 -0800
Subject: [Twisted-web] How to write an HTTP1.1 Proxy using Twisted?
Message-ID: <CAG7x0sHd87A0qO0BV==F3Ey0bLwyOS0NDrw-E1wxRaH7RgStiQ@mail.gmail.com>

Hi all,

I have recently started to learn and use Twisted. The first task is to
write an HTTP proxy.
I found Twisted provides a built-in proxy module described here:

http://twistedmatrix.com/documents/current/web/howto/using-twistedweb.html#auto9

It says the server part inherits http.HTTPChannel, while the client part
inherits http.HTTPClient.

However, as I later find out, *http.HTTPClient is only a HTTP 1.0
client,*which is not enough for my task. I also found there is another
class called *twisted.web.client.Agent
*which seems to be more advanced than http.HTTPClient and supports HTTP 1.1.

Questions:
1. Can twisted.web.client.Agent be used in a Proxy implementation with
http.HTTPChannel? Is there any examples?
2. Does http.HTTPChannel support HTTP 1.1?

Thanks!

Sha
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://twistedmatrix.com/pipermail/twisted-web/attachments/20140127/047521d1/attachment.html>

From _ at lvh.io  Mon Jan 27 12:12:35 2014
From: _ at lvh.io (Laurens Van Houtven)
Date: Mon, 27 Jan 2014 20:12:35 +0100
Subject: [Twisted-web] How to write an HTTP1.1 Proxy using Twisted?
In-Reply-To: <CAG7x0sHd87A0qO0BV==F3Ey0bLwyOS0NDrw-E1wxRaH7RgStiQ@mail.gmail.com>
References: <CAG7x0sHd87A0qO0BV==F3Ey0bLwyOS0NDrw-E1wxRaH7RgStiQ@mail.gmail.com>
Message-ID: <CAE_Hg6buKxzEVBDi-7zYN8i4w5QK9ZpnS2eR6Z2AqncKTiu_kA@mail.gmail.com>

Hi Sha,


I'm not sure about HTTPChannel, but Agent definitely supports HTTP/1.1.
Supporting it shouldn't be too hard, but I don't know of any examples.
Essentially, you just replace the proxy's client bits (which makes
responses on behalf of the thing that's connecting to the proxy) with agent
calls. I recommend just reading the code; it's what I did when I wrote
lvh/minitrue.

hth
lvh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://twistedmatrix.com/pipermail/twisted-web/attachments/20140127/5750b4ed/attachment.html>

From huasha1985 at gmail.com  Mon Jan 27 12:23:51 2014
From: huasha1985 at gmail.com (Sha Hua)
Date: Mon, 27 Jan 2014 11:23:51 -0800
Subject: [Twisted-web] How to write an HTTP1.1 Proxy using Twisted?
In-Reply-To: <CAE_Hg6buKxzEVBDi-7zYN8i4w5QK9ZpnS2eR6Z2AqncKTiu_kA@mail.gmail.com>
References: <CAG7x0sHd87A0qO0BV==F3Ey0bLwyOS0NDrw-E1wxRaH7RgStiQ@mail.gmail.com>
 <CAE_Hg6buKxzEVBDi-7zYN8i4w5QK9ZpnS2eR6Z2AqncKTiu_kA@mail.gmail.com>
Message-ID: <CAG7x0sGWAHjr4TDkMQC2HaDrTzdyOcOVT+0pLp6akZmAz63U0Q@mail.gmail.com>

Thanks. Yes. I am just planning to replace the HTTPClient part in the Proxy
implementation with Agent. Not sure if any problems may arise. Thanks!

Why would they have both Agent (1.1) and HTTPClient (1.0) as built-in HTTP
Client modules? The latter should be removed.

Sha


On Mon, Jan 27, 2014 at 11:12 AM, Laurens Van Houtven <_ at lvh.io> wrote:

> Hi Sha,
>
>
> I'm not sure about HTTPChannel, but Agent definitely supports HTTP/1.1.
> Supporting it shouldn't be too hard, but I don't know of any examples.
> Essentially, you just replace the proxy's client bits (which makes
> responses on behalf of the thing that's connecting to the proxy) with agent
> calls. I recommend just reading the code; it's what I did when I wrote
> lvh/minitrue.
>
> hth
> lvh
>
> _______________________________________________
> Twisted-web mailing list
> Twisted-web at twistedmatrix.com
> http://twistedmatrix.com/cgi-bin/mailman/listinfo/twisted-web
>
>
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://twistedmatrix.com/pipermail/twisted-web/attachments/20140127/1773ae71/attachment.html>

From _ at lvh.io  Mon Jan 27 12:30:25 2014
From: _ at lvh.io (Laurens Van Houtven)
Date: Mon, 27 Jan 2014 20:30:25 +0100
Subject: [Twisted-web] How to write an HTTP1.1 Proxy using Twisted?
In-Reply-To: <CAG7x0sGWAHjr4TDkMQC2HaDrTzdyOcOVT+0pLp6akZmAz63U0Q@mail.gmail.com>
References: <CAG7x0sHd87A0qO0BV==F3Ey0bLwyOS0NDrw-E1wxRaH7RgStiQ@mail.gmail.com>
 <CAE_Hg6buKxzEVBDi-7zYN8i4w5QK9ZpnS2eR6Z2AqncKTiu_kA@mail.gmail.com>
 <CAG7x0sGWAHjr4TDkMQC2HaDrTzdyOcOVT+0pLp6akZmAz63U0Q@mail.gmail.com>
Message-ID: <CAE_Hg6bWVMZ+XM6Vh73uHKmH-nHKBR4nnR6re1GNrzfT3XHLOQ@mail.gmail.com>

On Mon, Jan 27, 2014 at 8:23 PM, Sha Hua <huasha1985 at gmail.com> wrote:

> Why would they have both Agent (1.1) and HTTPClient (1.0) as built-in HTTP
> Client modules? The latter should be removed.
>

Backwards compatibilty. Tons of code uses HTTPChannel, including the proxy
code you're using. It'd be great if it could be deprecated, but it'll take
a while before that's done.

Hopefully your contribution of HTTP proxy code using Agent to twisted will
help this process forward ;)

hth
lvh
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://twistedmatrix.com/pipermail/twisted-web/attachments/20140127/ded8d2a3/attachment.html>

From glyph at twistedmatrix.com  Tue Jan 28 11:54:09 2014
From: glyph at twistedmatrix.com (Glyph Lefkowitz)
Date: Tue, 28 Jan 2014 10:54:09 -0800
Subject: [Twisted-web] How to write an HTTP1.1 Proxy using Twisted?
In-Reply-To: <CAE_Hg6bWVMZ+XM6Vh73uHKmH-nHKBR4nnR6re1GNrzfT3XHLOQ@mail.gmail.com>
References: <CAG7x0sHd87A0qO0BV==F3Ey0bLwyOS0NDrw-E1wxRaH7RgStiQ@mail.gmail.com>
 <CAE_Hg6buKxzEVBDi-7zYN8i4w5QK9ZpnS2eR6Z2AqncKTiu_kA@mail.gmail.com>
 <CAG7x0sGWAHjr4TDkMQC2HaDrTzdyOcOVT+0pLp6akZmAz63U0Q@mail.gmail.com>
 <CAE_Hg6bWVMZ+XM6Vh73uHKmH-nHKBR4nnR6re1GNrzfT3XHLOQ@mail.gmail.com>
Message-ID: <512362BC-410F-483B-842A-CB32CAE094EE@twistedmatrix.com>


On Jan 27, 2014, at 11:30 AM, Laurens Van Houtven <_ at lvh.io> wrote:

> Hopefully your contribution of HTTP proxy code using Agent to twisted will help this process forward ;)

Yes, please.  This would be great!

-g
-------------- next part --------------
An HTML attachment was scrubbed...
URL: <http://twistedmatrix.com/pipermail/twisted-web/attachments/20140128/54cd6183/attachment.html>
-------------- next part --------------
A non-text attachment was scrubbed...
Name: smime.p7s
Type: application/pkcs7-signature
Size: 4124 bytes
Desc: not available
URL: <http://twistedmatrix.com/pipermail/twisted-web/attachments/20140128/54cd6183/attachment.bin>

